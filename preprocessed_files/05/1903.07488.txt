ar x iv 1 90 3 07 48 8 v 2 m at h c o 2 a pr 2 01 9 upper tail bounds for cycles abigail raz abstract this paper examines bounds on upper tails for cycle counts in gn p for a fixed graph h define h n p h to be the number of copies of h in gn p it is a much studied and surprisingly difficult problem to understand the upper tail of the distribution of h for example to estimate p h 2 e h the best known result for general h and p is due to janson oleszkiewicz and rucin ski who in 2004 proved exp oh mh n p ln 1 p p h 1 e h 1 exp h mh n p thus they determined the upper tail up to a factor of ln 1 p in the exponent there has since been substantial work to improve these bounds for particular h and p we close the ln 1 p gap for cycles up to a constant in the exponent here the lower bound in 1 is the truth for l cycles when p ln 1 l 2 n n 1 introduction let g g m p be the usual erdo s re nyi random graph a copy of h in g is a subgraph of g isomorphic to h it is a much studied question to estimate for 0 and h m p h the number of copies of h in gm p p h 1 e h 2 to avoid irrelevancies we will always assume p m 1 mh where see 20 pg 56 mh max ek vk k h vk 0 so in the case of cycles we assume p m 1 then m 1 mh is a threshold for g h see 20 theorem 3 4 for smaller p and bounded the quantity in 2 is min mvkpek k h ek 0 see 20 theorem 3 9 for a start department of mathematics rutgers university piscataway nj email ajr 224 math rutgers edu 1 http arxiv org abs 1903 07488 v 2 investigation the distribution of h began in 1960 with erdo s and re nyi 10 in the case of triangles it is easy to see that the upper tail is lower bounded by exp o n 2 p 2 ln 1 p since this is the probability that gn p contains a complete graph on say 2 np vertices this is usually much bigger than the naive guess exp n 3 p 3 a first indication that the problem is hard in fact not much was known about the upper tail until 2000 when vu proved the first exponential tail bound in 22 more information on what was known prior to 2002 can be found in 13 a breakthrough occurred in 2004 when in 15 kim and vu showed using the polynomial concentration method of 14 that when h is a triangle and p logm m p h 1 e h exp m 2 p 2 the kim vu bound for triangles was vastly extended by janson olesz kiewicz and rucin ski in 2004 to state their result we require the following definition mh m p m 2 p h if p m 1 h mink h mvkpek 1 k if m 1 mh p m 1 h as usual is fractional independence number see e g 4 and h is maxi mum degree theorem 1 1 19 theorem 1 2 for any h and exp oh mh m p ln 1 p p h 1 e h exp h mh m p 3 note mh m p is not quite the quantity m h m p used in 19 but as shown in their theorem 1 5 the two quantities are equivalent up to a constant factor so the difference is irrelevant here thus they determined the probability in 2 up to a factor of o ln 1 p in the exponent for constant 0 this remains the best result for general h and p the first progress towards closing the ln 1 p gap was made by chatterjee in 5 and demarco and kahn in 9 who independently closed it for triangles showing that for p logm m the lower bound is the truth up to the constant in the exponent demarco and kahn also gave the order of the exponent for smaller p 1 m where the lower bound in 3 namely exp n 2 p 2 lnn is no longer the answer later in 8 demarco and kahn closed the gap for l cliques showing that for p m 2 l 1 0 and l 1 p kl 1 e kl exp l min m 2 pl 1 log 1 p mlp l 2 when h is a strictly balanced graph and p is small p m v e logch m warnke in 23 used a combinatorial sparsification idea based on the bk in equality 3 18 to close the ln 1 p gap improving on work in 22 21 there was a breakthrough in 2016 when chatterjee and dembo introduced a non linear large deviation framework 6 this has been used to close the gap for 2 general h and large p i e p m h 6 16 recently this technique was used in 7 by cook and dembo to close the gap including determining the correct constant in the exponent for cycles when p m 1 2 among other results additionally outside of the large deviation framework warnke and s ileikis in 17 recently determined the correct upper tail bound for stars including in the case where n rather than a constant here we settle the question for cycles i e the order of magnitude of the exponent where with the l cycle denoted cl mcl m p m 2 p 2 formally letting l l g be the number of copies of cl in g we prove theorem 1 2 for any fixed l 0 and p 0 1 p l 1 e l exp l min m 2 p 2 ln 1 p mlpl we are most interested in the range where m 2 p 2 ln 1 p mlpl so essen tially when p ln 1 l 2 m m as in 9 it is convenient to work with an l partite version of the random graph let h be the random l partite graph on ln ver tices where the vertex set is the disjoint union of l n sets say v v h v 1 vl and p xy e h p whenever x vi and y vi 1 for some i all subscripts mod l these choices made independently there are no edges between other pairs vi vj or within a vi we always take vi to be a vertex of vi a copy of cl in h is any subgraph with vertices v 1 v 2 vl isomorphic to cl note these are not all of the subgraphs of h isomorphic to cl since we demand each vertex of the cycle is in a different vi we denote the number of copies of cl in h by l a copy of the l 1 path denoted pl 1 is any path v 1 v 2 vl isomorphic to pl 1 i e vi vi 1 for 1 i l we use v 1 vl to denote both copies of cl and copies of pl 1 since it will always be clear which interpretation is intended we show the following bound theorem 1 3 for any fixed l 0 and p 0 1 p l 1 n lpl exp l min n 2 p 2 ln 1 p nlpl 4 that theorem 1 3 implies theorem 1 2 is likely well known and an easy generalization from the l 3 case which can be found in 9 however for completeness we will still give the general argument proposition 1 4 theorem 1 3 implies theorem 1 2 this is proved in section 2 the rest of the paper is organized as follows section 3 gives notation and states the two main assertions that give theorem 1 3 these are proved in sections 5 7 with section 4 devoted to preliminaries 2 reduction for completeness we give the proof of proposition 1 4 following 9 3 proof of proposition 1 4 we first claim that it is enough to prove proposition 1 4 for m ln assuming we know proposition 1 4 for m ln we show it still holds when m k mod l given and l we may assume m is large formally m m l so for example 1 m l 1 2 m k l therefore p l 1 m l pl p l 1 2 m k l pl exp 2 l min m k 2 p 2 ln 1 p m k lpl exp l min m 2 p 2 ln 1 p mlpl note the second inequality holds since m k is a multiple of l now to prove proposition 1 4 when m ln let be as in theorem 1 2 and set 2 we can choose h by first choosing g on v ln and then selecting a uniform equipartition v 1 vl and setting e h xy e g x y belong to consecutive v i s note that for any possible value g of g e g g g 5 where nl ln l on the other hand letting g p 1 g g g we have e g g g 1 g 1 g g 6 combining 5 and 6 gives g 1 1 1 we also have by theorem 1 3 exp l min n 2 p 2 ln 1 p nlpl p l 1 nlpl additionally we know p l 1 n lpl p l 1 n lpl l 1 1 ln l pl p l 1 1 ln l pl p l 1 1 ln l pl here the final inequality holds since 1 1 1 ln l pl 1 nlpl and as we showed g is always at most 1 since 1 1 1 theorem 1 2 follows 4 3 main lemmas recall that we always take vi to be a vertex in vi indices are always written mod l and copy of cl copy of pl 1 were defined just before the statement of theorem 1 3 we use c to denote the set of copies of cl in h additionally we abusively use just cycle for copy of cl and full path for copy of pl 1 as usual ny x y y xy e h dy x ny x d x y nv x nv y and is the maximum degree in h we also use n x nv x and d v dv x let d vi max dvi 1 vi dvi 1 vi we will abusively refer to d v as the degree of v for disjoint x y v we use x resp x y for the set of edges with one end in x resp one end in each of x y much of the set up that follows is borrowed from or inspired by 9 set t ln 1 p and s min t nl 2 pl 2 so the exponent in 4 is l n 2 p 2 s for simplicity set 1 5 l 2 and 27 l l 1 7 note that for a fixed and p theorem 1 2 is covered by theorem 1 1 for us it is convenient to pick e 4 e 20 l 2 of course the partite version theorem 1 3 was not considered in 19 but it is not too hard to get this from theorem 1 1 proposition 3 1 for p e 20 l 2 theorem 1 3 follows from theorem 1 1 this will be proved at the end of the section in view of proposition 3 1 we may assume for the proof of theorem 1 3 that p e 4 e 20 l 2 8 we may also assume so also is fixed but small since 4 becomes weaker as grows given and l n is large formally n n l and say p 4 n 1 9 since for smaller p theorem 1 3 is trivial for an appropriate l we say that an event occurs with large probability w l p if its probability is at least 1 exp t 4 n 2 p 2 t for some fixed t 0 and small enough we write for w l p note that assuming 9 an intersection of o n events that hold w l p also holds w l p let v i v vi d v np 1 and let f v 1 vl be the number of full paths with endpoints v 1 and vl in which each vertex is in the appropriate v i the next two assertions imply theorem 1 3 w l p v 1 vl c i vi v i 2 nlpl 10 5 p v 1 vl c i vi v i 1 2 nlpl exp l n 2 p 2 s 11 we prove 10 in section 5 and 11 in section 7 in section 6 we prove that v 1 vl f v 1 vl 1 8 nlpl 1 12 which will be used in the proof of 11 we now give the proof of proposition 3 1 to do so we require the following tail bound due to janson 12 see also 20 theorem 2 14 lemma 3 2 let be a set of size n and p the random subset of in which each element is included with probability p independent of the other choices assume s is a family of non empty subsets of and for each a s let ia 1 a p additionally let x a s ia define a b 6 e iaib then for 0 t ex p x t exp t 2 2 proof of proposition 3 1 let h be as in theorem 1 3 and regard h as a sub graph of g gln p set l g l h and thus is the number of cycles in g that are not of the form v 1 vl then e ln ln l 2 l nl pl we first use lemma 3 2 to show p 1 e exp l n 2 to apply lemma 3 2 we take s to be the set cycles in g not of the form v 1 vl so each a s is the edge set of a particular cycle note that when a b k we have e iaib p 2 l k furthermore the number of pairs of cycles sharing exactly k 1 edges is at most ckl n 2 l k 1 for some constants ckl thus we have k ckl n 2 l k 1 p 2 l k cln 2 l 2 since p 1 lemma 3 2 with t e gives p 1 e exp l n 2 13 furthermore we claim that for any 0 p 1 e p 1 e p 1 e 14 6 provided and are such that e e e this is because occurrence of the event on the l h s implies occurrence of one of the events on the r h s namely if 1 e and 1 e then 1 e 1 e e e e 1 e therefore for any 0 we can select and such that p 1 e p 1 e p 1 e exp l n 2 p 1 e exp l n 2 exp l n 2 where the second inequality holds by 13 and the third by theorem 1 1 4 preliminaries to prove 10 and 11 we need the following preliminaries where b m is used for a random variable with the binomial distribution bin m the first two of these are standard large deviation bounds see e g 1 theorem a 1 12 20 theorem 2 1 a and 2 lemma 8 2 the others are applications of lemma 4 1 that we will use repeatedly lemma 4 1 for any 0 1 k 1 m and we have p b m km exp 2 m 4 if k 4 e k km if k 4 15 when m n and p which is what we have when our binomial random variable is dvi 1 vi or dvi 1 vi and k 1 we use qk for the right hand side of 15 that is qk exp 2 np 4 if k 4 e k knp if k 4 16 first note that for any k 1 we have qk exp 2 knp 16 17 of course this is unnecessarily weak when k is not close to 1 as was the first bound in 4 1 but is often enough for our purposes and will be used 7 repeatedly below it will also be useful to have the following upper bound on qk when k p 2 recall was defined before 7 qk exp knpt 4 n 2 18 to show the first inequality holds note that k p 2 and p e 4 see 8 imply k e 2 and e k knp exp knp 1 2 t again p e 4 implies t 4 giving the first inequality in 18 qk e k knp exp knpt 4 the second inequality in 18 follows easily from the combination of t 4 and the fact that p is not extremely small see 9 lemma 4 2 suppose w 1 wm 0 z let 1 m be independent ber noullis iwi and e then for any 0 and p exp z the last two lemmas are the basis for much of what follows lemma 4 4 in particular may be regarded as perhaps the main idea for sections 5 and 6 it allows us to bound sums of atypically large degrees which we then use to bound the number of cycles that include vertices of large degree in section 5 and the number of full paths without vertices of large degree in section 6 lemma 4 3 for k 1 and any i vi vi d vi knp rk 6 k ln if qk n 2 2 npt k lnk otherwise 19 the first ad hoc value is for use in section 6 while the second will be used throughout convenient bounds for the second expression in 19 are 2 npt k lnk 2 npt k if k 1 np k if k p 20 proof of lemma 4 3 let q qk and r min rk 1 we let r min rk 1 because later it will be helpful to have n r n we can enforce this lower bound on r because if rk 1 then p vi vi d vi knp r p vi vi d vi knp 1 without loss of generality let i 1 we show v 1 v 1 dv 2 v 1 knp r 2 21 8 write n for the left hand side of 21 we first assume q n 2 since the dv 2 v 1 s v 1 v 1 are independent copies of b n p two applications of lemma 4 1 give p n r p b n q r 2 2 enq r r 2 2 e q r 2 exp 4 n 2 p 2 t the third inequality holds since q n 2 so n r n q 1 2 now assume q n 2 recall from 17 that we always have q exp 2 knp 16 so n 2 q exp 2 knp 16 implies knp 32 2 logn 22 on the other hand 9 gives q exp 2 knp 16 exp 2 k 16 k l the last inequality uses the fact that exp 2 k 16 k l is minimized at k 16 l 2 and e 16 l l 2 l 1 as we may assume hence p n r 2 p b n q r 2 exp nk l exp n 2 p 2 t where the second inequality uses r 2 3 nq and lemma 4 1 and the very crude third inequality uses k l 2 n log 3 n which follows from 22 and 9 lemma 4 4 for p 64 2 lnn n and any i d vi d vi 1 np 2 n 2 p 2 t 23 and d vi d vi np 1 2 n 2 p 2 24 there is nothing special about 2 here it is simply a value that will work for our purposes the reason for the particular and not very important lower bound on p will appear following 26 proof first we show 23 to slightly lighten the notation we fix i and set w vi d vi 1 np 9 we partition w j j 0 w j where j log 2 p 1 1 1 2 t with w j vi 2 j 1 np d vi 2 j 1 1 np it suffices to show j j 0 w j 2 j 1 1 np 2 n 2 p 2 t 25 lemma 4 1 using just 17 gives p vi w j p d vi 2 j 1 np 2 exp 22 j 4 np exp 22 j 5 np thus for any a 0 aj p w 0 a 0 w j aj exp j j 0 aj 22 j 5 np j j 0 n aj exp j aj lnn 22 j 5 np exp j aj 22 j 6 np 26 for 26 we note that p 64 2 lnn n so 22 j 5 np 2 lnn on the other hand for 25 it is enough to show a 0 aj p w 0 a 0 w j aj exp t 4 n 2 p 2 t 27 for some constant t 0 not depending on where we sum over a 0 aj satisfying j aj 2 j 1 1 np 2 n 2 p 2 t 28 here we can just bound the number of terms in 27 by the trivial nj exp 2 t logn while in view of 28 26 bounds the individual summands in 27 by exp 4 n 2 p 2 t moreover the lemma s lower bound on p or the weaker p log 1 2 n n implies n 2 p 2 t t logn so the left hand side of 27 is at most exp 2 t logn 4 n 2 p 2 t exp 4 n 2 p 2 t 10 as desired to show 24 we now let w vi d vi np 1 2 as before we partition w j j 0 w j where j log 2 p 1 2 1 2 t with w j vi 2 jnp 1 2 d vi 2 j 1 np 1 2 it suffices to show j j 0 w j 2 j 1 np 1 2 n 2 p 2 29 lemma 4 1 and 18 give p vi w j p d vi 2 jnp 1 2 2 exp 2 j 2 np 1 2 t exp 2 j 3 np 1 2 t thus for any a 0 aj p w 0 a 0 w j aj exp j j 0 aj 2 j 3 np 1 2 t j j 0 n j exp j aj lnn 2 j 3 np 1 2 t exp j aj 2 j 4 np 1 2 t 30 30 follows from 2 j 3 np 1 2 t lnn in this case a very weak consequence of our assumed lower bound on p for 29 it is enough to show a 0 aj p w 0 a 0 w j aj exp t 4 n 2 p 2 t 31 for some constant t 0 not depending on where we sum over a 0 aj satisfying j aj 2 j 1 np 1 2 n 2 p 2 32 again we can just bound the number of terms in 31 by the trivial nj exp 2 t logn while in view of 32 30 bounds the individual summands by exp n 2 p 2 t 11 again since the lemma s lower bound on p or the weaker p log 1 2 n n implies n 2 p 2 t t logn the left hand side of 31 is at most exp 2 t logn n 2 p 2 t exp n 2 p 2 t as desired we will also make use of the fact that for any 0 k and p p lnk 1 p k e k 33 to see this let f p p ln k 1 p and notice that f p kp 1 lnk 1 1 p p 1 lnk 1 p p 1 lnk 1 1 p k ln 1 p thus f p is maximized at p e k where it equals the r h s of 33 5 proof of 10 we first rule out very small p showing that when p n 1 1 w l p np 1 34 so that 10 is vacuously true for 34 with k 1 2 p and x any vertex lemma 4 1 and the union bound give p np 1 ln p d x 2 knp ln exp 2 knp ln k e ln exp np 1 t ln 2 e 35 but for p n 1 1 which is the same as np 1 n 2 p 2 the r h s of 35 is exp l n 2 p 2 t note that 8 implies t 4 and the initial ln disappears because 9 makes n 2 p 2 t a large multiple of logn therefore for the remainder of the proof of 10 we may assume that p n 1 1 36 we say v has large degree if d v np 1 2 and intermediate degree if np 1 2 d v 2 np we classify the cycles appearing in 10 according to the positions of their large and intermediate vertices for disjoint m n l say vi is of type m n if d vi np 1 2 if i m 2 np np 1 2 if i n 2 np otherwise 12 and say a set of vertices is of type m n if each of its members is we con sider various possibilities for m n always requiring that all vertices under discussion are of the given type to begin note that since we are in 10 we have m 6 a little preview may be helpful in each case we are trying to show that the size of the set of cycles v 1 vl in question is small relative to m lpl so would like the number of possibilities for vi to be in geometric average somewhat less than mp for example for i m we do much better than this using lemma 4 3 which recall bounds the number of vi s of such large degree by mp 1 2 or mp 1 2 but here the is minor on the other hand for i m n we have only the naive bound m which is clearly unaffordable to control the number of such vi we rely on first selecting some vi 1 or vi 1 and then bounding the number of choices for vi by d vi 1 or d vi 1 if i 1 i m n then given vi 1 we simply use d vi 1 2 mp as a bound on the number of choices for vi however if for example i 1 m n and i m n we require lemma 4 4 to bound the choices for vi 1 vi with vi 1 vi we now consider cycles of type m here the absence of intermediate vertices will allow us to relax our assumption that there is at least one vertex of degree at least np 1 we will only need to assume that there is at least one vertex of degree at least np 1 2 let m i m i 1 m with subscripts interpreted mod l note that m 6 implies m only when m l here and in the future we will tend to somewhat abusively omit w l p in situations where this is clearly what is meant we will bound i for i m m the number of possibilities for vi ii for i m the number of possibilities for vi vi 1 iii given the choices in ii the number of possibilities for vertices of the cycle not chosen in i and ii note that the number of vertices chosen in iii is l m m the reason for treating i m in ii rather than i is roughly that it is through these vertices that we control the number of choices for the vertices that follow them the vi 1 s of ii for i we just recall that lemma 4 3 bounds the number of choices for vi of large degree by np 1 2 so the total number of possibilities in i is at most np 1 2 m m for i as in ii the number of possibilities for vi vi 1 is at most d vi d vi np 1 2 n 2 p 2 with the inequality given by lemma 4 4 thus the total number of possibilities in ii is at most n 2 p 2 m 13 finally we may choose the vi s in iii in an order for which each vi 1 is chosen before vi either because vi 1 is chosen in ii or because i 1 precedes i in our order e g we can use any cyclic order that begins with an i for which i 1 m if m then m l so all vertices were chosen in i but since n the number of choices for vi given vi 1 is at most 2 np combining the above bounds we find that for a given m the number of cycles of type m is at most n 2 p 2 m np 1 2 m m 2 np l m m 2 lnlpl 2 l 2 nlpl using 7 for the last inequality so since there are fewer than 2 l possibilities for m the number of cycles of any type m is at most 4 nlp 2 37 next we consider cycles of type m n with n 6 we may assume at the cost of a negligible factor of l in our eventual bound that 1 n and that k is an index for which d vk np 1 which exists since we are in 10 again we will pay a factor of l 1 for the choice of k we further define n 1 n m 2 k 1 n 2 n m k 1 l n 1 i n 1 k 1 i 1 n 1 and n 2 i n 2 k 1 i 1 n 2 we split into cases based on whether 2 n 1 k and or l n 2 k first assume 2 n 1 k and l n 2 k we will bound i the number of possibilities for vk ii the number of possibilities for v 2 v 1 vl iii for i n 1 n 2 n 1 n 2 the number of possibilities for vi iv for i n 1 the number of possibilities for vi vi 1 v for i n 2 the number of possibilities for vi vi 1 vi given the choices in ii iv and v the number of possibilities for vertices of the cycle not chosen in i v for i we just recall that lemma 4 3 bounds the number of choices for vk by np 1 for ii the number of possibilities for v 2 v 1 vl is bounded by d v 1 2 np 1 2 d v 1 2 np np 1 2 d v 1 d v 1 2 np 2 n 3 p 3 2 t 14 where the second inequality is given by lemma 4 4 for iii lemma 4 3 bounds the number of choices for vi of intermediate or large degree by npt so the number of possibilities in iii is at most npt n 1 n 2 n 1 n 2 for i as in iv the number of possibilities for vi vi 1 is at most d vi d vi 2 np 2 n 2 p 2 t with the inequality given by lemma 4 4 thus the number of possibilities in iv is at most 2 n 2 p 2 t n 1 similarly the total number of possibilities in v is at most 2 n 2 p 2 t n 2 finally for vi we choose the remaining vi s with i k in increasing order of their indices and those with i k in decreasing order in the first case when we come to vi the number of possibilities is at most d vi 1 2 np since vi 1 n 1 and similarly in the second case this number is at most d vi 1 2 np since vi 1 n 2 thus the number of possibilities in vi is at most 2 np l n 1 n 2 n 1 n 2 4 combining the above bounds we find that for a given m and n the number of cycles of type m n is at most 3 nlpl 2 tl 2 l 3 nlpl 10 l 3 l nlpl 4 l 23 l where the second inequality uses 33 now we assume 2 n 1 k but l n 2 k in this case i iii iv and v and their respective bounds all remain the same however now we replace ii with ii the number of possibilities for v 1 vl this is because v 2 will be selected in either i iii or iv our new ii is bounded by d v 1 d v 1 2 np 2 n 2 p 2 t where the inequality comes from lemma 4 4 additionally in vi there are now l n 1 n 2 n 1 n 2 3 vertices left to choose thus our bound for vi becomes 2 np l n 1 n 2 n 1 n 2 3 15 combining these bounds with our previous bounds for i and iii v we find that for a given m and n the number of cycles of type m n is at most 3 nlpl tl 2 l 3 nlpl 4 l 3 l nlpl 4 l 23 l where the second bound is again given by 33 the argument for 2 n 1 k l n 2 k is essentially identical to the preceding one so we will not discuss it further it remains to consider the case when we have both 2 n 1 k and l n 2 k again there is no change in i and iii v and we replace ii in this case by ii the number of possibilities for v 1 since v 2 and vl will be among the vertices chosen in i and iii v by lemma 4 3 the number of possibilities here i e for v 1 is at most 2 npt additionally in vi we are now selecting l n 1 n 2 n 1 n 2 2 vertices so our bound becomes 2 np l n 1 n 2 n 1 n 2 2 again combining bounds we find that the number of cycles of type m n is at most 3 nlpl tl 2 l 3 nlpl 4 l 3 l nlpl 4 l 23 l so to recap we have shown that for any given m n 6 where we assume d vk np 1 and np 1 2 d v 1 2 np there are at most nlpl 4 l 23 l cycles of type m n since there are fewer than 3 l choices for m n and the assumptions on 1 and k only cost a factor of l 2 there are at most nlpl 4 cycles of all types m n with n 6 recalling see 37 that we showed the same bound for the number of cycles of types m with m 6 we have the desired bound 2 nlpl on the l h s of 10 16 6 proof of 12 for the rest of our discussion we may ignore bad vertices meaning those of degree at least np 1 since cycles involving such vertices are excluded from 12 recall we are calling d v the degree of v what s really going on here is as follows we think of choosing v 1 vl after all other edges have been specified the number of cycles again avoiding bad vertices is then v 1 vl f v 1 vl 38 recall f v 1 vl is the number of full paths with endpoints v 1 and vl in which there are no bad vertices given g v 1 vl this is a weighted sum of independent binomials with expectation p v 1 vl f v 1 vl 39 to which we may hope to apply the large deviation bound in lemma 4 2 in this section we give a good w l p bound on the sum in 39 namely 12 once we have this the only difficulty is that some of the weights f v 1 vl may be too large to support finishing via the lemma we will handle this difficulty in section 7 to prove 12 we first consider full paths v 1 vl in which each of v 1 vl 1 has degree at most 1 np there are at most 1 lnlpl 1 1 16 nlpl 1 40 such paths now all the paths v 1 vl left to consider must have some vi where i l 1 such that d vi 1 np to count the number of such paths we split the argument based on p first assume p ln 2 n n 41 this is not a tight bound for either argument but it is a convenient cut off given 41 we know qk exp 2 knp 16 exp 2 ln 2 n 16 n 2 for all k 1 see 16 for the definition of qk so in applications of lemma 4 3 we are always using the second value of rk namely rk 2 npt k lnk additionally since p ln 2 n n lemma 4 4 applies as in section 5 we classify paths according to the positions of vertices with d vi 1 np for m l 1 say vi is of type m if d vi 1 np if i m 1 np otherwise 17 and say a set of vertices is of type m if each of its members is either of type m or in vl note we have already shown that there are at most 1 16 nlpl 1 full paths of type so we now assume m 6 let m be the smallest element of m and let m i m i 1 m we will bound i for i m m the number of possibilities for vi ii for i m the number of possibilities for vi vi 1 iii given the choices in ii the number of possibilities for vertices of the path not chosen in i and ii for i as in i we recall that by lemma 4 3 the number of vi s of degree at least 1 np is at most npt so the total number of possibilities in i is at most npt m m 42 for i as in ii the number of possibilities for vi vi 1 is at most d vi d vi 1 np 2 n 2 p 2 t with the inequality given by lemma 4 4 thus the total number of possibilities in ii is at most 2 n 2 p 2 t m 43 finally for iii we choose the remaining vi s with i m in increasing order of the indices when we come to vi we know i 1 m so given vi 1 there are at most 1 np choices for vi if m 1 then we have selected all the vertices in the path if not then we next select vm 1 since we are ignoring vertices of degree at least np 1 we know that given vm there are at most np 1 ways to select vm 1 if m 2 then we are done and if not then we select the vi s with i m 1 in decreasing order of the indices since i 1 m given vi 1 there are at most 1 np choices for vi thus the number of possibilities in iii is at most 1 np l m m 1 np 1 if m 1 1 np l m m if m 1 44 combining 42 43 and the appropriate bound from 44 we find that for a given m there are at most 1 lnlpl tl 2 l lnlpl 1 nlpl 1 2 l 3 18 full paths of type m where the first inequality uses 33 since there are less than 2 l 1 possibilities for m 6 there are at most nlpl 1 16 full paths of type other than together with our earlier bound on the number of full paths of type this bounds the total number of full paths without vertices of degree at least np 1 by 1 8 nlpl 1 as desired when p ln 2 n n 45 we first note that we have a better bound on the maximum degree than np 1 for 45 lemma 4 1 with k ln 3 n 2 and x any vertex gives p ln 3 n np lnp d x ln 3 n np ln exp np ln 3 n ln lnn exp l n 2 p 2 t using npt ln 3 n and absorbing the initial ln into the exponent since 9 gives np ln 3 n 2 ln 3 n thus ln 3 n np ln 5 n given p let k be minimal with qk n 2 we first bound the number of cycles containing at least one v with d v knp lemma 4 3 says there are at most l 2 npt k lnk such vertices in all of v once such a vertex v has been specified there are at most l 1 ln 5 l 1 n ways to select the remaining vertices in a full path containing v so w l p we have at most l 2 npt ln 5 l 1 n k lnk o nlpl 1 46 full paths containing at least one v as above the quite weak o nlpl 1 follows from the lower and upper bounds on p in 9 and 45 respectively now we count paths in which every vertex has degree at most knp and at least one vertex has degree at least 1 np recalling that we have already treated those violating either condition say v is of type i if 1 2 inp d v 1 2 i 1 np and let ui vertices of type i we say the type of a path p is the largest i for which p contains a vertex of type i lemma 4 3 gives ui 6 l 2 iln note we have already bounded the number of full paths of type i where i log 2 k 1 for smaller i we think of specifying a path p of type i by choosing 19 i some v of type i and then ii the remaining vertices of the path here the bounds are easy the number of possibilities in i is at most ui 6 l 2 iln 47 and the number of possibilities in ii is at most 1 2 i 1 np l 1 since given the choice in i we may order the remaining choices so that each new vertex is drawn from the at most 1 2 i 1 np neighbors of some vertex chosen earlier thus the number of full paths of type i is bounded by 6 l 1 l 12 l i 1 nlpl 1 l 22 l inlpl 1 summing over i we find that w l p there are at most log 2 k 1 i 0 l 22 l inlpl 1 17 nlpl 1 48 full paths of all types up to log 2 k 1 where the inequality follows easily from our choice of see 7 adding 48 to the numbers of full paths with all degrees at most 1 np and those of type i for i log 2 k 1 40 and 46 we find that w l p there are at most 1 8 nlpl 1 full paths with all vertices of degree at most np 1 so regardless of p we have f v 1 vl 1 8 nlpl 1 as desired 7 proof of 11 as explained at the start of section 6 we want to use 12 and finish via lemma 4 2 but some f v 1 vl s may be too large to support this to handle this difficulty we introduce the notion of a heavy path below we then set c v 1 vl c i vi v i and v 1 vl is not heavy and show p c 1 4 nlpl exp l n 2 p 2 s and 49 w l p v 1 vl c i vi v i v 1 vl heavy 4 nlpl 50 20 it will turn out that we need different definitions of heavy path depending on p either of these will say that the number of non heavy paths say g v 1 vl joining any vl vl satisfies g v 1 vl 4 lnl 2 pl 2 s 51 recall s min t nl 2 pl 2 we will return to the definitions of heavy path and the proof of 50 in subsections 7 1 and 7 2 here we assume 51 and give the easy proof of 49 as suggested above this is a straightforward application of lemma 4 2 let v 1 x 1 xn and vl y 1 yn then with wi j g xi yj 4 lnl 2 pl 2 s z and i j the indicator of the event xiyj h we have c ijwi j in addition recalling 12 we have e p wi j p f v 1 vl 1 8 nlpl hence lemma 4 2 with 8 nlpl gives p c 1 4 nlpl exp l n 2 p 2 s as desired 7 1 proof of 50 when p n 5 l 5 l 1 for p n 5 l 5 l 1 we say v 1 vl is heavy if f v 1 vl 4 lnl 2 pl 2 s and v 1 vl is a heavy path if v 1 vl is heavy note that here we have s t ln 1 p so in this case the notion of heavy depends only on the endpoints of the path note that this definition trivially implies 51 a brief indication of why we need two definitions of a heavy path may be helpful in the present case i e p n 5 l 5 l 1 we bound the number of cycles v 1 vl for which v 1 vl is a heavy path by first bounding the number of v 1 s and similarly vl s that are in heavy paths to do this we show that for v 1 to be in a heavy path there must be some v 3 for which d v 1 v 3 n v 1 n v 3 is large and we use this necessary condition to bound the number of v 1 s in heavy paths 21 let v 1 v 1 v 1 vl vl with v 1 vl heavy v l vl v l v 1 v 1 with v 1 vl heavy thus every cycle v 1 vl considered in this section must have v 1 v 1 and vl v l we first bound v 1 and v l and then use this to bound v 1 v l a necessary condition for v 1 v 1 is there exists v 3 such that d v 1 v 3 np 1 l 1 52 to see this fix v 1 and recall that d v np 1 for every vertex under discussion in 11 thus we know that for any vl there are at most np 1 l 3 paths vl v 3 to pick v 2 to complete such a path with v 1 we require v 2 n v 1 n v 3 thus if d v 1 v 3 np 1 l 1 for all v 3 then for any vl f v 1 vl n l 2 pl 2 2 5 l 2 nl 2 pl 2 2 et 4 lnl 2 pl 2 s here the middle inequality comes from 33 with 2 and k 1 so in order to bound v 1 it suffices to bound the number of v 1 s satisfying 52 since d v 3 np 1 lemma 4 1 with m np 1 p and k p 1 l gives p v 1 v 1 np b m p kmp n exp np 1 l 1 1 1 l t note that p e 4 see 8 implies t 4 so exp np 1 l 1 1 1 l t exp np 1 l 1 t 2 thus p v 1 v 1 n exp np 1 l 1 t 2 exp np 1 l 1 t 3 the initial n disappears since p n 5 l 5 l 1 implies np 1 l 1 n 1 5 l 2 l next we show that w l p v 1 and v l are at most np 1 l 1 the lemma will be stated in more generality as we will use it again after 59 lemma 7 1 if c 1 3 and u is a random subset of vi in which each vi is included independently with probability at most exp np 1 l c t 3 then u np 1 l c proof here we apply lemma 4 1 with m n exp np 1 l c 3 and k p 1 l c 1 note that since p n 5 l 5 l 1 we know say k e 1 2 so 22 lemma 4 1 gives p u np 1 l c e k np 1 l c np 1 l c 2 exp n 2 p 2 t 6 hence v 1 v l np 1 l 1 we next show that for any i w l p a b 2 n 2 p 2 53 a vi b vi 1 with a b np 1 l 1 we use 53 to bound v 1 v l and again after 59 to prove 53 we assume a and b are of the appropriate sizes and apply lemma 4 1 with m a b p and k 2 n 2 p 2 mp 1 note that m 2 n 2 p 2 2 l 1 and generously k p 1 2 5 l p 1 2 also since p e 20 l 2 we have ln k t 2 10 l 2 so for a given a and b of the appropriate size lemma 4 1 gives p a b 2 n 2 p 2 exp 2 n 2 p 2 ln k 1 exp 2 n 2 p 2 t 4 simply taking the union bound with the first sum over all possible a b and the next two over all a b np 1 l 1 we have a b p a b 2 n 2 p 2 a b l n a n b exp 2 n 2 p 2 t 4 a b l exp a ln en a b ln en b 2 n 2 p 2 t 4 54 it is easy to see using p n 5 l 5 l 1 and 1 5 l 2 that for a b np 1 l 1 we have n 2 p 2 t max a ln en a b ln en b ln n so 54 is for example at most exp 2 n 2 p 2 t 5 therefore w l p a b 2 n 2 p 2 for all a b with a b np 1 l 1 55 as desired specifically we have w l p v 1 v l 2 n 2 p 2 56 23 we next want to bound the number of full paths between v 1 and v l for i 2 l 1 let v i vi max v vi 2 vi 2 d v vi np 1 l 3 we first bound the number of full paths such that at least one vertex vi in the path is not in the appropriate v i fixing v 1 vl and an index i l 1 we bound the number of full paths v 1 vl with vi v i since d v np 1 for all v under consideration there are at most ni 1 p 1 i 1 ways to choose v 2 vi with v 2 v 1 and nl i 2 p 1 l i 2 ways to choose vl 1 vi 2 with vl 1 vl to complete the path we must have vi 1 n vi n vi 2 since we assume vi v i there are at most np 1 l 3 choices for vi 1 thus there are at most ni 1 p 1 i 1 nl i 2 p 1 l i 2 np 1 l 3 nl 2 pl 2 paths from v 1 to vl with vi v i if i l 1 then we instead bound the number of choices for vl 1 by d vl np 1 and the number of ways to choose v 2 vl 3 with v 2 v 1 by nl 4 p l 4 1 to complete the path we must have vl 2 n vl 3 n vl 1 again as we are assuming vl 1 v l 1 there are at most np 1 l 3 choices for vl 2 so there are at most np 1 nl 4 p 1 l 4 np 1 l 3 nl 2 pl 2 paths from v 1 to vl with vl 1 v l 1 now summing over i there are at most l 2 nl 2 pl 2 paths using at least one vertex outside of l 2 i 2 v i and combining this with 56 bounds the number of cycles as in 50 with some vertex outside of l 2 i 2 v i by l 2 nlpl 8 nlpl 57 the only cycles left to count are those with vi v i for all i we first bound v i lemma 4 1 with m np 1 p and k p 1 l 2 and the union bound gives for any v vi p v v i 2 np b m p kmp 2 n exp np 1 l 3 1 1 l 2 t 58 24 as before t 4 implies the r h s of 58 is at most 2 n exp np 1 l 3 t 2 hence p vi v i 2 n exp np 1 l 3 t 2 exp np 1 l 3 t 3 59 again the initial 2 n disappears since p n 5 l 5 l 1 implies np 1 l 3 n 3 5 l 2 l given 59 lemma 7 1 gives v i np 1 l 3 assuming this 55 gives v i v i 1 n 2 p 2 for all i to finish the proof for p n 5 l 5 l 1 we use the following lemma due to shearer 11 we will use this lemma again when p n 5 l 5 l 1 to state it we require the following definition recall a hypergraph on v is simply a collection possibly with repeats of subsets of v for a hypergraph f on the vertex set v and h v the trace of f on v is defined to be tr f h f h f f lemma 7 2 suppose f is a hypergraph on v and h is another hypergraph on v such that every vertex in v belongs to at least d edges of h then f h h tr f h 1 d 60 to apply lemma 7 2 here let f be the hypergraph on v v h whose edges are the vertex sets of cycles using only vertices in l i 1 v i so f is the number of cycles using only vertices in l i 1 v i let h be the hypergraph on v with edges hi vi vi 1 i l thus each vertex belongs to exactly two edges of h furthermore tr f hi v i v i 1 n 2 p 2 thus lemma 7 2 gives f h h tr f h 1 2 n 2 p 2 l 2 8 nlpl combining this with 57 gives 50 for p n 5 l 5 l 1 25 7 2 proof of 50 when p n 5 l 5 l 1 for p n 5 l 5 l 1 we need the following definitions for j 1 l and i l 1 n j vl vj there exists a path vj vj 1 vl 61 v i vi vi max vl dni 1 vl vi 4 62 that is vi v i if for some vl vi has at least 5 neighbors in vi 1 that are directly reachable from vl we say a path v 1 vl is heavy if vi v i for some i l 1 note as promised we still have 51 since g v 1 vl 4 l 2 4 lnl 2 pl 2 s again recall s min t nl 2 pl 2 in this section we are bounding the number of cycles v 1 vl containing at least one vertex in some v i to do this we fix i and bound the number of cycles with vi v i we first observe that n 2 p 2 t 63 where as usual is the maximim degree in h for 63 lemma 4 1 with k npt 2 and x any vertex together with the union bound gives p n 2 p 2 t lnp d x 2 knp ln exp 2 knp 1 ln k exp n 2 p 2 t so we may assume n 2 p 2 t whence for any j and vl n j vl l 2 n 2 l 2 p 2 l 2 tl 1 m 64 note that m n 2 l 2 5 l 1 logl 1 n since p n 5 l 5 l 1 we next show v i n 2 p 2 65 here for a given vl we may think of n i 1 vl which does not depend on edges involving vi as given then for a given vi we have using 64 p vi v i np b m p 4 66 so applying lemma 4 1 with p and k 4 m 1 p 1 n 3 5 bounds the r h s of 66 by n e k 4 e 4 n 7 5 q another application of lemma 4 1 with m n p and k np 2 q 1 n 2 5 now gives 65 p v i n 2 p 2 e k n 2 p 2 exp 5 n 2 p 2 t 26 we may thus assume from now on that v i n 2 p 2 given v i we bound the number of cycles v 1 vi vl with vi v i this requires the following definitions for i 6 j v 0 i j vj there is a path vi vi 1 vj with vi v i v 1 i j vj there is a path vi vi 1 vj with vi v i vi j v 0 i j v 1 i j note we are reading subscripts mod l thus vi vi j if and only if some cycle containing vj meets v i we also set vi i v 0 i i v 1 i i v i to bound the number of cycles involving some vi v i we need a bound on vi j vi j 1 but will actually bound the larger quantity v 0 i j v 1 i j 1 as elsewhere the point here is to retain some independence given v i v 0 i j and v 1 i j 1 do not depend on v 0 i j v 1 i j 1 thus having specified v i we may think of first exposing the edges of h not involving v 0 i j v 1 i j 1 thus determining v 0 i j and v 1 i j 1 at which point v 0 i j v 1 i j 1 is just a binomial to which we may apply lemma 4 1 note however that v 0 i j v 1 i j 1 will not be independent of the choice of v i so we will need to take a union bound over possibilities for v i we will show v 0 i j v 1 i j 1 4 l 2 l n 2 p 2 67 the eventual punchline here will be an application of lemma 7 2 shearer s lemma similar to the one in section 7 1 this is the reason for the 4 l 2 l which in applying the lemma will be raised to the power l 2 note that for all i j we have very crudely in most cases v 0 i j v 1 i j v i l 1 n 2 p 2 l 1 we apply lemma 4 1 with m v 0 i j v 1 i j 1 2 n 4 p 4 2 l 2 p and k mp 1 4 l 2 l n 2 p 2 a little checking using p n 5 l 5 l 1 confirms that for example k n 1 6 l 27 thus for specified i v i and j lemma 4 1 gives pr v 0 i j v 1 i j 1 4 l 2 l n 2 p 2 exp 4 l 2 ln 2 p 2 t 6 l 68 and summing over possibilities for i v i and j recalling that we have v i n 2 p 2 gives 67 pr i j with v 0 i j v 1 i j 1 4 l 2 l n 2 p 2 l 2 w n 2 p 2 n w exp 4 l 2 ln 2 p 2 t 6 l exp n 2 p 2 t here for the final bound we use that w ln en w n 2 p 2 t and is small enough see 7 to apply lemma 7 2 here let f be the hypergraph on v v h where each edge is the vertex set of a cycle using only vertices in l j 1 vi j again let h be the hypergraph on v with edges hj vj vj 1 j l thus each vertex belongs to exactly two edges of h furthermore 67 says tr f hj vi j vi j 1 v 0 i j v 1 i j 1 4 l 2 l n 2 p 2 thus lemma 7 2 gives f h h tr f h 1 2 4 l 2 l n 2 p 2 l 2 4 l nlpl as desired so summing over choices for i there are less than 4 nlpl cycles using some vi v i as desired references 1 n alon and j h spencer the probabilistic method new york wiley 2015 2 j beck and w chen irregularities of distribution cambridge cam bridge univ pr 1987 3 j van den berg and h kesten inequalities with applications to per colation and reliability in journal of applied probability 22 3 sept 1985 pp 556 569 4 b bolloba s modern graph theory new york springer 1998 28 5 s chatterjee the missing log in large deviations for triangle counts in random structures algorithms 40 4 2011 pp 437 451 6 s chatterjee and a dembo nonlinear large deviations in advances in mathematics 299 2016 pp 396 450 7 n a cook and a dembo large deviations of subgraph counts for sparse erdo s re nyi graphs in arxiv e prints sept 2018 arxiv 1809 11148 math pr 8 r demarco and j kahn tight upper tails bounds for cliques in ran dom structures algorithms 41 4 2012 pp 469 487 url https onlinelibrary wiley com doi abs 10 1002 rsa 20440 9 r demarco and j kahn upper tails for triangles in arxiv e prints 2010 arxiv 1005 4471 math pr 10 p erdo s and a re nyi on the evolution of random graphs in pub lication of the mathematical institute of the hungarian academy of sciences 1960 pp 17 61 11 f chung p frankl and j b shearer some intersection theorems for ordered sets and graphs in journal of combinatorial theory series a 43 1986 pp 23 37 12 s janson poisson approximation for large deviations in random struc tures algorithms 1 1990 pp 221 230 13 s janson and a rucin ski the infamous upper tail in random struc tures algorithms 20 3 2002 pp 317 342 14 j h kim and v h vu concentration of multivariate polynomials and its applications in combinatorica 20 3 2000 pp 417 434 15 j h kim and v h vu divide and conquer martingales and the number of triangles in a random graph in random structures algorithms 24 2 2004 pp 166 174 16 e lubetzky and y zhao on the variational problem for upper tails in sparse random graphs in random structures algorithms 50 2017 pp 420 436 17 m s ileikis and l warnke upper tail bounds for stars in arxiv e prints arxiv 1901 10637 jan 2019 arxiv 1901 10637 arxiv 1901 10637 math pr 18 d reimer proof of the van den berg kesten conjecture in combi natorics probability and computing 9 1 2000 pp 27 32 19 s janson k oleszkiewicz and a rucin ski upper tails for subgraph counts in random graphs in israel journal of mathematics 142 2004 pp 61 92 20 s janson t luczak a rucin ski random graphs new york wiley 2000 21 m s ileikis on the upper tail of counts of strictly balanced subgraphs in electronic journal of combinatorics 19 1 2012 29 http arxiv org abs 1809 11148 https onlinelibrary wiley com doi abs 10 1002 rsa 20440 http arxiv org abs 1005 4471 http arxiv org abs 1901 10637 22 v h vu a large deviation result on the number of small subgraphs of a random graph in combinatorics probability and computing 10 1 2001 pp 79 94 23 l warnke on the missing log in upper tail estimates in arxiv e prints dec 2016 arxiv 1612 08561 math pr 30 http arxiv org abs 1612 08561 1 introduction 2 reduction 3 main lemmas 4 preliminaries 5 proof of 10 6 proof of 12 7 proof of 11 7 1 proof of 50 when p n 5 l 5 l 1 7 2 proof of 50 when pn 5 l 5 l 1