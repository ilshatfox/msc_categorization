noname manuscript no will be inserted by the editor rapid and accurate methods for computing whiskered tori and their manifolds in periodically perturbed planar circular restricted 3 body problems bhanu kumar rodney l anderson rafael de la llave the date of receipt and acceptance should be inserted later abstract when the planar circular restricted 3 body problem rtbp is peri odically perturbed families of unstable periodic orbits break up into whiskered tori with most tori persisting into the perturbed system in this study we 1 de velop a quasi newton method which simultaneously solves for the tori and their center stable and unstable directions 2 implement continuation by both pertur bation as well as rotation numbers 3 compute fourier taylor parameterizations of the stable and unstable manifolds 4 regularize the equations of motion and 5 globalize these manifolds our methodology improves on efficiency and accuracy compared to prior studies and applies to a variety of periodic perturbations we demonstrate the tools near resonances in the planar elliptic rtbp 1 introduction numerous studies have been carried out in recent years where quasi periodic or bits of various restricted 3 or 4 body models have been computed and used for applications to space mission design for instance farre s et al 2017 studied pe riodic and quasi periodic orbits in the phase space of the augmented hill 3 body problem near the l 1 and l 2 libration points olikara 2016 applied collocation methods to the computation of invariant tori near l 1 and l 2 in both spatial circu lar restricted 3 body problem crtbp as well as periodically perturbed planar crtbp models and looking further in the past the book series of go mez et al 2001 presented many other computational methods and applications for quasi periodic orbits near libration points however all of these studies as well as almost all other prior research use methods of computing tori which require solving large dimensional linear systems of equations at each step of the differential correction b kumar r de la llave school of mathematics georgia institute of technology 686 cherry st nw atlanta ga 30332 usa e mail bkumar 30 gatech edu r l anderson jet propulsion laboratory california institute of technology 4800 oak grove drive pasadena ca 91109 ar x iv 2 10 5 11 10 0 v 4 m at h d s 5 o ct 2 02 1 2 bhanu kumar et al furthermore while the quasi periodic orbits are computed successfully using those methods stability information including stable and unstable directions must be computed separately also in most prior work these linear stable unstable direc tions are directly used as approximate local stable unstable manifolds for the tori neglecting higher order terms and thus losing accuracy another characteristic of the vast majority of prior research including the pre viously mentioned studies is that the analysis focuses on tori associated with the libration points such as lissajous or quasi halo orbits bosanac 2018 did compute invariant tori near stable resonant periodic orbits in the planar circular restricted 3 body problem pcrtbp but the tori computed are stable without stable or unstable manifolds unstable resonant periodic orbits and their stable and unsta ble manifolds are known to be important mechanisms of dynamical transport in the interior and exterior realms of the crtbp koon et al 2011 and these orbits have seen significant interest and use as a tool for trajectory design in multi body systems for example out of the nine titan to titan encounters made by cassini between july 2013 and june 2014 eight of the nine resulting transfers involved resonances vaquero et al 2014 more recently the baseline mission design for the europa lander mission concept made profitable use of these mechanisms for the final approach to the surface of europa anderson et al 2019 for further examples and more background on resonant orbits see anderson et al 2016 in this study we develop efficient algorithms which enable simultaneous com putation of not only unstable invariant tori but also of their center stable and unstable directions also known as bundles in periodically perturbed pcrtbp models solving for bundles alongside the tori actually allows us to avoid solving large linear systems thus improving the algorithmic efficiency of our method com pared to tori only methods used in previous investigations we apply our tools to the computation of unstable tori and bundles near pcrtbp resonances using the jupiter europa planar elliptic rtbp as the dynamical model for demonstration and a solution tolerance of 10 7 next we use the results of the preceding step to start a recursive parameterization method cabre et al 2005 huguet et al 2012 haro et al 2016 for the computation of high order fourier taylor approximations of the stable and unstable manifolds of the tori we demonstrate improvements in manifold accuracy as compared with the linear manifold approximations used in other studies these parameterizations can also be differentiated which is useful for computing intersections of manifolds finally we develop a levi civita regu larization for the equations of motion which is used to globalize the parameterized manifolds even when they pass through singularities of the equations of motion we have included several proofs throughout this paper to justify our methods and motivate possible adaptations these may be skipped without detriment by readers primarily interested in details of the algorithm implementation 2 models and background 2 1 planar circular restricted 3 body problem in this study we consider periodic perturbations of the pcrtbp the pcrtbp describes the motion of an infinitesimally small particle thought of as a space craft under the gravitational influence of two large bodies of masses m 1 and m 2 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 3 collectively referred to as the primaries in this model m 1 and m 2 revolve about their barycenter in a circular keplerian orbit units are also normalized so that the distance between the two primaries becomes 1 their period of revolution becomes 2 and g m 1 m 2 becomes 1 we define a mass ratio m 2 m 1 m 2 and use a syn odic rotating non inertial cartesian coordinate system centered at the primaries barycenter such that m 1 and m 2 are always on the x axis in the planar crtbp we also assume that the spacecraft moves in the same plane as the primaries in this case the equations of motion are hamiltonian with form celletti 2010 x h 0 px y h 0 py p x h 0 x p y h 0 y 1 h 0 x y px py p 2 x p 2 y 2 pxy pyx 1 r 1 r 2 2 where r 1 x 2 y 2 is the distance from the spacecraft to m 1 and r 2 x 1 2 y 2 is the distance to m 2 there are two important properties of eq 1 2 to note first of all the hamiltonian in eq 2 is autonomous and is hence an integral of motion hence trajectories in the pcrtbp are restricted to 3 dimensional energy submanifolds of the state space satisfying h x y px py constant the second property is that the equations of motion have a time reversal symmetry namely if x t y t t is a solution of eq 1 2 for t 0 then x t y t t is a solution for t 0 2 2 periodic perturbations of the pcrtbp the pcrtbp model exhibits many of the important dynamical phenomena present in multi body celestial systems however there are many effects which are not in cluded in the pcrtbp many of these other influences on the spacecraft motion act in an approximately time periodic manner while preserving the hamiltonian nature of the system here we will study dynamical models where one such pe riodic forcing effect is considered in addition to the pcrtbp the equations of motion in this case are given by eq 3 along with time periodic hamiltonian 4 x h px y h py p x h x p y h y p p 3 h x y px py p h 0 x y px py h 1 x y px py p 4 where p t is an angle h 0 is the pcrtbp hamiltonian given by eq 2 h 1 is the perturbation by the time periodic effect and satisfies h 1 x y px py p 0 0 and 0 and p are the perturbation parameter and perturbation frequency respectively signifies the strength of the perturbation 0 being the unper turbed pcrtbp and p is a known constant frequency the perturbation from h 1 is 2 p periodic with p being the phase of the perturbation note that the hamiltonian function will no longer be constant along trajectories there are many different hamiltonian periodically perturbed pcrtbp models of interest for applications a common perturbation added to the pcrtbp is that of a third large body revolving in a circle or approximate circle around m 1 or m 2 examples of these restricted 4 body models include the bicircular problem 4 bhanu kumar et al simo et al 1995 the coherent quasi bicircular problem andreu 1998 and the hill restricted 4 body problem scheeres 1998 another common periodically perturbed pcrtbp model is the planar elliptic rtbp pertbp 2 3 planar elliptic restricted 3 body problem the tools we develop in this paper are applicable to a wide variety of hamiltonian periodic perturbations as discussed in the previous section however in this study we use the pertbp for numerical demonstration of their usage the pertbp has the same assumptions as the pcrtbp except that one allows m 1 and m 2 to move around their barycenter in an elliptical keplerian orbit of eccentricity 0 the length unit is normalized such that the semi major axis of the m 1 m 2 orbit is 1 as the period of the primaries orbit is 2 we have that the perturbation frequency p 1 so we can consider p t modulo 2 the pertbp model we use is essentially the same as that used by hiday johnston and howell 1994 except for a transformation from position velocity to position momentum coordinates and a restriction to the xy plane the coordinate system is again such that m 1 and m 2 are always on the x axis with the origin at their barycenter however the distance between them is now time periodic with periapse at t 0 this is different from the pulsating coordinates used by szebehely 1967 the equations of motion are eq 3 with time periodic hamiltonian h x y px py t p 2 x p 2 y 2 n t pxy pyx 1 r 1 r 2 5 where we have n t 1 2 1 cose t 2 r 1 x 1 cose t 2 y 2 and r 2 x 1 1 cose t 2 y 2 e t is the 2 periodic eccentric anomaly of the elliptical m 1 m 2 orbit and can be computed by solving the standard kepler s equation m e sine bate et al 1971 n t is the time derivative of the m 1 m 2 true anomaly from eq 3 and 5 we have px x n t y and py y n t x 2 4 resonant periodic orbits mean motion resonances are pcrtbp periodic orbits which by definition persist from elliptical orbits of the kepler problem and hence are not in the center man ifold of any of the libration points their main characteristic is that their orbital periods are nearly rational multiples of 2 the period of m 1 m 2 motion the peri ods become exact rational multiples of 2 as 0 a family of resonant periodic orbits is characterized by a ratio m n m n z this notation means that in an inertial reference frame the spacecraft makes approximately m revolutions about m 1 in the time that m 1 and m 2 revolve n times around their barycenter for a given resonance m n in the pcrtbp with 0 there typically ex ist one stable and one unstable resonant periodic orbit inside the submanifold h 0 x y px py e for each fixed value of e in some interval of energy values emin emax kumar et al 2021 a this gives us continuous families of stable and unstable resonant periodic orbits the periods of the orbits within a given family computing whiskered tori and their manifolds in periodically perturbed pcrtbp 5 vary with e the unstable resonant periodic orbits have monodromy floquet ma trix eigenvalues 1 1 s and u 1 s where s 1 thus there are 2 d stable and unstable manifolds attached to the unstable resonant periodic orbits these manifolds serve as low energy pathways to and from these periodic orbits further more the manifolds of different resonances at the same energy level can intersect in the pcrtbp giving heteroclinic connections which allow for propellant free resonance transitions for more details see kumar et al 2021 a 3 normally hyperbolic invariant manifolds and existence of tori as discussed in section 2 4 for each value of e in some interval of energy val ues emin emax there exists one unstable m n resonant periodic orbit in the pcrtbp each of these periodic orbits is diffeomorphic to a circle t now con sider the union of all the unstable m n resonant periodic orbits for all values of e emin emax the resulting set is a 2 d manifold diffeomorphic to t 0 1 in the 4 d pcrtbp phase space furthermore at each point of there are stable and unstable directions transverse to the manifold which come from the stable and unstable eigenvectors of the periodic orbits which make up this manifold since the phase space is 4 d and is 2 d at any point of the stable and unsta ble directions together with the 2 d manifold tangent space span the entire phase space this means that is a normally hyperbolic invariant manifold nhim of the pcrtbp flow in fact any family of unstable pcrtbp periodic orbits forms such a nhim for a rigorous definition of nhims for flows see fenichel 1971 nhims are important because they persist under sufficiently small perturba tions of the equations of motion fenichel 1971 as our numerical results later in this paper will demonstrate the perturbations we study are indeed suffi ciently small however to apply this nhim persistence result to our case of time periodic perturbations the original and perturbed systems must be defined on the same phase space hence we take the pcrtbp from its original 4 d phase space x y px py to the 5 d extended phase space x y px py p p t we define p p for the unperturbed pcrtbp in extended phase space while x y px and py still follow equations 1 and 2 hence periodic orbits of period t 1 from the original 4 d pcrtbp phase space become 2 d quasi periodic orbits in the pcrtbp defined on the extended phase space with one of the frequencies being 1 2 t 1 and the other being p unless 1 p is rational the nhim from the original phase space becomes the nhim t in the extended phase space due to the extra angle hence is diffeomorphic to t 2 0 1 now since the pcrtbp and its nhim have been transferred to the same extended phase space as the periodically perturbed models we can conclude that for 0 sufficiently small will persist as a nhim of the perturbed equations of motion 3 and 4 will be diffeomorphic to and hence also to t 2 0 1 furthermore note that in the extended phase space pcrtbp is foliated by 2 d invariant tori since was foliated by periodic orbits from kam theory capin ski et al 2016 we can expect that inside the invariant tori from with sufficiently non resonant frequencies 1 and p will also persist after perturbation with only small gaps between them hence we will focus this study on these 2 d tori in the periodically perturbed pcrtbp models 6 bhanu kumar et al 3 1 stroboscopic maps nhims and invariant circles any 2 d invariant torus in the periodically perturbed pcrtbp extended phase space can be parameterized as the image of a function of two angles k 2 t 2 r 4 t a quasi periodic trajectory x t lying on this torus can be expressed as x t k 2 p 0 1 t p p 0 pt 6 where 0 and p 0 are determined from the initial condition x 0 and 1 2 t 1 where t 1 is the period of the pcrtbp periodic orbit associated with the torus p is the same perturbation phase angle defined in section 2 2 so one of the two torus frequencies will be p we can then define the stroboscopic map f r 4 t r 4 t as the time 2 p mapping of extended phase space points by the equations of motion 3 and 4 with perturbation parameter we find that f k 2 p k 2 p where 2 1 p 7 since the angle p advances by 2 in the time 2 p and is therefore invariant under f hence we can fix p for our pertbp test case we choose p 0 and then define k k 2 p then eq 7 becomes f k k 8 by ignoring the last fixed p component of the extended phase space and a slight abuse of notation we can consider f r 4 r 4 and k t r 4 eq 8 implies that k parameterizes an invariant 1 d torus of the map f it is significantly more computationally efficient to compute 1 d invariant tori invariant circles k of the map f in 4 d phase space than 2 d tori k 2 of the flow in the 5 d extended phase space the reason for this is that the reduction in the dimension of the torus helps mitigate the curse of dimensionality see remark 1 hence from this point onwards we will consider the map f and its invariant circles and manifolds rather than invariant objects of the continuous time flow similar approaches are also used by zhang and de la llave 2018 and haro and mondelo 2021 note that the computation of f is just the integration of an ode as a final note the stroboscopic map allows us to use the theory of nhims of maps fenichel 1971 hirsch et al 1977 to understand the presence of invariant circles in periodically perturbed pcrtbp models in particular note that unsta ble periodic orbits of the unperturbed pcrtbp are also unstable invariant circles of the map f 0 hence the pcrtbp flow nhim defined at the beginning of section 3 is also a nhim of the map f 0 just as in the case of flows the theory shows that nhims of maps persist under sufficiently small perturbations of the map hence for sufficiently small 0 will persist as a nhim of f with diffeomorphic to and hence also to t 0 1 furthermore since is foliated by invariant circles whose rotation numbers satisfy a twist condition kam theory capin ski et al 2016 tells us that that the invariant circles with sufficiently irrational rotation number persist inside for 0 remark 1 the evaluation of f can be computationally expensive hence one may wonder if the dimension reduction actually helps the computation efficiency or not however the problems of propagating in time and computing the tori are numer ically very different while numerical integration remains very feasible for all the computing whiskered tori and their manifolds in periodically perturbed pcrtbp 7 values of tori can break down for larger values of the parameter hence the flow torus parameterization k 2 has very anisotropic regularity and behavior it remains extremely smooth in the flow direction but in the transversal direction it may lose differentiability using algorithms that recognize this effect is advantageous also the problem of integrating ode s has been extensively studied over many years and there are many efficient algorithms that can be tried including adaptive algorithms that use smaller step sizes on small spots where the equation is stiff however computing the 2 d torus parameterization k 2 requires a uniform grid discretizing t 2 which would result in unnecessarily large numbers of discretization points throughout the trajectory for our algorithm the operation count is close to linear in the number of grid points so the cost of adding one more dimension would be significant finally also note that numerically integrating a grid of points is very readily parallelizable by assigning each trajectory to a thread 4 a parameterization method for computing invariant tori and bundles in this section we develop and implement a parameterization method for the simul taneous computation of unstable invariant tori as well as their center stable and unstable directions also known as bundles for stroboscopic maps of periodically perturbed pcrtbp models the method works both for tori with cylindrical stable unstable bundles as well as for those whose bundles are mo bius strips see section 4 9 we present the analytical details and derivation of the method as well as the considerations required for its discretization and numerical implemen tation in a computer program our method is broadly inspired by those of haro et al 2016 except for the additional presence of a center bundle which is not considered by them and requires extra calculations a different but conceptually related method can also be found in the work of fontich et al 2009 4 1 the parameterization method for invariant manifolds the parameterization method is a general technique for the computation of many kinds of invariant objects in dynamical systems including tori and stable and unstable manifolds haro et al 2016 describe several applications the idea is that given a map f rd rd if we know that there is an f invariant object diffeomorphic to some model manifold m then we can solve for a function w m rd and a diffeomorphism f m m such that the invariance equation f w s w f s 9 holds for all s m w is referred to as the parameterization of the invariant manifold and f as the internal dynamics on m eq 9 means that f maps the image w m into itself so that w m is the invariant object in the full space rd 4 2 equations for parameterization method for invariant tori and bundles for notational convenience denote the stroboscopic map f from section 3 1 as f from now on assume we are computing an 0 invariant circle corresponding to 8 bhanu kumar et al a pcrtbp periodic orbit of known period t 1 this fixes the rotation number 2 1 p since 1 2 t 1 as given in eq 8 we wish to find a parameterization k t r 4 of the f invariant circle satisfying the torus invariance equation f k k 10 eq 10 is equivalent to the framework of section 4 1 withm t and f s s in addition for our quasi newton method we will add another equation to be solved for matrix valued periodic functions p t r 4 4 such that df k p p 11 furthermore we mandate that has the form 1 t 0 0 0 1 0 0 0 0 s 0 0 0 0 u 12 for some functions t s u t r to be solved for the form of eq 12 is motivated by geometric considerations that we will detail in section 4 3 as will be explained at the end of section 4 5 solving simultaneously for k p and is actually more efficient than solving for k alone the quasi newton method we will present for solving eq 10 11 uses the near diagonal form of to decouple the linear system of equations we get in each differential correction step the method will require only algebraic operations phase shifts and the solving of 1 d equations for scalar valued functions 4 3 understanding the p and matrices in addition to their numerical utility p and have a geometric significance which will be useful when computing stable and unstable manifolds later on since k is contained in the 2 d normally hyperbolic invariant manifold defined at the end of section 3 1 we know that there are tangent center stable and unstable directions to the torus at each point k the columns of p will be these four vector bundles with s and u set to the stable and unstable multipliers for the corresponding bundles to see why consider eq 11 column by column let vt vc vs and vu denote the first second third and fourth columns of p respectively then equations 11 and 12 are equivalent to df k vt vt 13 df k vc t dk vc 14 df k vs s vs 15 df k vu u vu 16 first of all note that eq 15 16 are the definition of stable and unstable bundles vs and vu and multipliers s and u for the torus k hence the third and fourth columns of p satisfy eq 11 if and only if they are torus stable and unstable bundles respectively also differentiating eq 10 gives df k dk dk 17 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 9 which shows that vt dk solves eq 13 as a result the first column of p can be set as the torus tangent bundle dk in fact if eq 11 has a solution it is easy to show that column 1 of p must be dk for some r finally since f is a hamiltonian flow map and hence is symplectic given k vs and vu we can find vc solving eq 14 for some function t t r we postpone the description and proof of how to compute such a vc to section 4 9 where the method will be used any such vc is known as a symplectic conjugate to dk and is a center direction to the torus k de la llave et al 2005 hence column 2 of p satisfies eq 11 if and only if it is a symplectic conjugate center bundle we should note that eq 11 is actually underdetermined symplectic conjugates are not unique and we can change the scales of the stable and unstable bundles at each we will take advantage of this in section 4 8 to make constant 4 4 summary of steps for quasi newton method for tori and bundles we will now develop our quasi newton method for solving eq 10 and 11 before presenting the details of the method we give a brief overview assume we have an approximate solution k p for eq 10 11 then we will 1 compute e f k k ered p 1 df k p 2 solve p 1 e for t r 4 using eq 23 26 and set k equal to k p details given in section 4 5 3 set column 1 of p to dk recompute df k and ered 4 solve ered q q for q t r 4 4 and using eq 38 49 set p equal to p p q and equal to details given in section 4 6 5 return to step 1 and repeat correction until e and ered are within tolerance 4 5 quasi newton step for correcting k we seek to solve eq 10 and 11 for k p and all the entries of are fixed as 0 or 1 as shown in eq 12 except for t s and u we will now derive an iterative step that given an approximate solution k p of eq 10 and 11 produces a much more accurate one define the errors e f k k 18 ered p 1 df k p 19 we then need to find corrections k p and to cancel e and ered we start with k write k p we will solve for t r 4 satisfying def p 1 e 20 claim for sufficiently irrational and e and ered sufficiently small if solves eq 20 then adding k p to k reduces the error e quadratically 10 bhanu kumar et al remark 2 we use the phrase sufficiently irrational when describing conditions on that ensure the validity of our quasi newton method for those aware of kam theory what we mean by this is that is diophantine as most numbers are de la llave 2001 this condition is useful due to the classic small divisors problem when solving cohomological equations see eq 30 proof substitute k k into the rhs of eq 18 assuming that k is small enough true for e sufficiently small and sufficiently irrational we can expand eq 18 in taylor series to get enew f k k k k f k df k k o k 2 k k e df k k k o k 2 21 k p and eq 19 implies df k p p ered thus enew e df k p p o 2 e p ered o 2 p ered o 2 22 where the last line follows from eq 20 for sufficiently irrational will be similar in magnitude to e so ered will be quadratically small comparable to ered e hence as long as e and hence and k are small enough that the taylor expansion in eq 21 is valid and the o 2 terms of the taylor expansion are small the new error enew will be quadratically smaller than e ut to solve eq 20 let 1 2 3 4 t and 1 2 3 4 t as is nearly diagonal we can write eq 20 component wise as 1 t 2 1 1 23 2 2 2 24 3 s 3 3 25 4 u 4 4 26 4 5 1 fixed point iteration solving for 3 and 4 to solve for 3 and 4 rewrite equations 25 and 26 in the form 3 s 3 3 def a 3 27 4 1 u 4 4 def b 4 28 we define a as a map from functions to functions which sends any f t r to the new function a f s f 3 b is defined similarly using eq 28 to find 3 and 4 let 3 0 4 0 0 and iterate 3 n 1 a 3 n and 4 n 1 b 4 n repeatedly starting at n 0 the iterations will converge to the desired solutions 3 and 4 of eq 27 and 28 we now explain why lemma 1 a b are contraction maps hence the iterations 3 n 1 a 3 n 4 n 1 b 4 n uniformly converge exponentially fast as n to the solutions 3 and 4 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 11 proof note that s 1 and 1 u 1 for all t let f 1 f 2 t r be two continuous functions and define c max t s 1 we have that max t a f 1 a f 2 max t s f 1 s f 2 cmax t f 1 f 2 cmax t f 1 f 2 29 as c 1 a is a contraction map under the uniform norm the same can be shown for b very similarly the contraction mapping theorem chicone 2006 tells us that every such map has a unique fixed point furthermore the fixed point can be found by iterating any value in the domain of the map forwards until convergence the solutions of equations 27 and 28 are by definition the fixed points of contraction maps a and b hence the iterations converge to 3 and 4 ut remark 3 if s and u are constant fourier methods see section 4 5 2 can also be used to solve eq 25 26 this is useful if s u 1 when using the quasi newton method for continuation one can ensure constant s u throughout the correction by applying the procedure of section 4 8 to the solution k p used for continuation initialization and following the instructions in remark 5 when correcting p during each quasi newton step we did not ensure constant s u in our algorithm implementation and used fixed point iteration instead 4 5 2 cohomological equations solving for 1 and 2 we next solve eq 24 for 2 which is then used in the lhs of eq 23 to solve for 1 in both cases we must solve cohomological equations of form b a a 30 where b is known and a is not this can easily be solved by fourier series let a k and b k be the kth fourier coefficients of a and b then eq 30 becomes k z b k e jk k z a k e jk k z a k e jk k z a k 1 ejk ejk 31 where j 1 then setting a k b k 1 ejk 1 allows us to compute a except for a 0 the formal series for a thus defined will converge on t for sufficiently irrational ru ssmann 1975 observe that a necessary condition for the existence of a solution is b 0 0 in the k 0 case a 0 cancels out on the right hand side of eq 30 and can hence take any value making the solution a non unique a 0 and b 0 are simply the averages of a and b on t we first solve eq 24 for 2 k k 6 0 using the fourier series method to set 2 0 first find the average of 1 t 2 2 0 then choose 2 0 t 0 this makes the lhs of eq 23 have zero average when solving for 1 since 2 0 1 t 2 d 2 0 1 t 2 2 0 d 2 0 2 0 t d 2 0 t 0 0 32 12 bhanu kumar et al with 2 fully solved we then solve eq 23 for 1 k k 6 0 and arbitrarily choose 1 0 0 finally with all four components of solved we set k equal to k p concluding the k correction part of the quasi newton step in practice when solving eq 24 for 2 we find that the average of 2 the left hand side of eq 24 is not exactly zero we ignore this nonzero average and solve for the 2 k anyways as described earlier 2 0 decreases to zero with each quasi newton step as the method converges so we are able to solve eq 24 more and more exactly this is a result of the vanishing lemma of fontich et al 2009 which is applicable since f is an exact symplectic map due to being the fixed time map of a hamiltonian system on r 4 gole 2001 also for those familiar with the parameterization method for invariant tori note that the choice of 1 0 0 takes care of the translation non uniqueness of solutions of eq 10 without requiring extra constraint equations remark 4 there are methods of numerically solving for k without using p or including single shooting farre s et al 2017 and collocation olikara 2016 these methods effectively discretize on a grid of n points and solve a linearized version of eq 21 directly for k at those values this requires solving at least a 4 n dimensional linear system at each correction step gaussian elimination applied to this will hence have a computational complexity of o n 3 and require o n 2 stor age however by using p and the nearly diagonal we decouple the equations and avoid this large dimensional system the complexity of our quasi newton method is o n logn as some steps use fft with o n required storage furthermore our method gives not just k but also the bundle and floquet matrices p and the most expensive step in our method is the computation using numerical integration of f and df on the grid of n different values of which is easy to parallelize on the computer 4 6 quasi newton step for correcting p and using the newly computed k we set the first column of p to dk and then recompute df k and ered using eq 19 finding p and to cancel ered then follows similar methodology as k let p p q we will solve for q and t r 4 4 satisfying ered q q 33 claim for sufficiently irrational and ered sufficiently small if q and solve eq 33 then adding p pq to p and to reduces ered quadratically proof substitute p pq and into eq 11 to define e df k p p q p p q 34 using ered p 1 df k p we then find that p 1 e ered p 1 df k p q q ered ered q q ered q q 35 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 13 where the last line follows due to eq 33 evaluating eq 19 with p pq and in place of p and and denoting the result as ered new we have ered new p p q 1 e i q 1 p 1 e i q 1 ered q q 36 now for sufficiently irrational q and will be similar in magnitude to ered hence if ered is small then ered new will be quadratically smaller like e 2 red ut since is nearly diagonal the equations for the different entries of q and following from eq 33 are almost completely decoupled from each other write ered ell elc els elu ecl ecc ecs ecu esl esc ess esu eul euc eus euu q 0 qlc qls qlu 0 qcc qcs qcu 0 qsc qss qsu 0 quc qus quu 0 t 0 0 0 0 0 0 0 0 s 0 0 0 0 u 37 as the first column of p is fixed to be dk we fix the first column of q to be zero so that the first column of p is zero as well we can then write columns 2 4 of eq 33 entry by entry to get 12 scalar equations elc t qcc qlc qlc t 38 els t qcs qls s qls 39 elu t qcu qlu u qlu 40 ecc qcc qcc 41 ecs qcs s qcs 42 ecu qcu u qcu 43 esc s qsc qsc 44 ess s qss s qss s 45 esu s qsu u qsu 46 euc u quc quc 47 eus u qus s qus 48 euu u quu u quu u 49 first we solve equations 42 43 44 46 47 and 48 followed by eq 39 and 40 after back substitution using the exact same method that was used to solve eq 25 and 26 rearrange each equation so that its solution is the fixed point of an appropriately defined contraction map which is then iterated to convergence such maps always multiply their input by either s or 1 u or both eq 41 is solved using the fourier method of section 4 5 2 we arbitrarily choose q cc 0 0 we ignore the nonzero average of ecc which goes to zero with each quasi newton step without affecting method convergence due to f being 14 bhanu kumar et al symplectic see appendix a for the proof of this result finally the solutions to eq 38 45 and 49 are non unique we choose qlc qss quu 0 so that we have t elc t qcc s ess and u euu once q and are known we set p equal to p p q equal to and then recompute e and ered using eq 18 and 19 finally we go back to the quasi newton step for correcting the torus parameteri zation k and repeat the entire method until e and ered are within tolerance remark 5 if t s and u are constant we can choose the non unique solutions of eq 38 45 and 49 such that they remain constant in particular choose t s and u as the constant averages of elc ess and euu respectively and solve for qlc qss and quu using fourier methods our experience was that this choice of solution negatively affected the numerical stability of our method however thus we did not keep t s and u constant in our implementation 4 7 a remark on convergence the focus of this paper is to specify the algorithms provide details of imple mentation and give practical results of the implementation in physical problems nevertheless we wish to mention that there are results which rigorously prove that our algorithm converges when given initial k p with small enough error depending on some condition numbers due to the practical focus of this paper we will not go into detail but we want to give a flavor of the argument for readers interested primarily in applications this section can be skipped the convergence is due to the so called kolmogorov arnold moser kam the ory which is a very far reaching generalization of the newton method in particu lar we take advantage of the recent developments in a posteriori versions of kam theory fontich et al 2009 which does not require an integrable system only approximate solutions of functional equations we present some salient features for any analytic function of an angle u t cn define u sup im z u z it is possible to show ru ssmann 1975 that the solutions of 30 satisfy a c 1 b for some c 1 0 that is if the right hand side is analytic in a certain complex domain the solution is analytic in a slightly smaller complex domain and we have estimates of the size in terms of the domain lost note that both domains contain all real angles from 0 to 2 which is what we are actually interested in the well known cauchy estimates ahlfors 1979 for derivatives of a function in a slightly smaller domain have the same form the formal procedure we have given indeed reduces e and ered to something quadratically smaller but performing the estimates with care only in a slightly smaller complex domain denoting the invariance error and the reducibility errors after one quasi newton step by enew and ered new we have that enew ered new c 2 2 2 e ered 2 50 for some c 2 0 there are standard arguments in kam theory hard implicit function theorems see de la llave 2001 which show that given an algorithm satisfying eq 50 and a sufficiently small initial error the algorithm step can be iterated infinitely many times to convergence in a domain slightly smaller than the original these estimates also show that the final answer is close to the initial approximation of k p if the initial error is small enough computing whiskered tori and their manifolds in periodically perturbed pcrtbp 15 4 8 modifying p for constant let k p and be a solution to eq 10 11 for purposes of numerical stability as well as stable unstable manifold computation see section 5 it can be useful to modify columns 2 3 and 4 of p in such a way that p 1 df k p becomes a constant matrix of the form in eq 12 i e t s and u become constant this can also enable the usage of fourier methods instead of fixed point iteration during the quasi newton method see remarks 3 and 5 for columns 3 and 4 of p the stable and unstable bundles vs and vu respectively just a simple rescaling is needed to make s and u constant let s u r and as au t r be the solutions to log s log s log as log as 51 log u log u log au log au 52 we choose s exp 1 2 2 0 log s d so the lhs of eq 51 has zero average letting u log as eq 51 becomes a cohomological equation of form eq 30 which can be solved for u by the fourier series method we choose u 0 0 this gives as e u we can solve eq 52 for au in the exact same manner finally one can replace columns 3 and 4 of p by as vs and au vu and replace s and u in by s and u we prove that this works now lemma 2 if vs and vu satisfy eq 15 16 and as and au satisfy eq 51 52 then vs new as vs and vu new au vu satisfy df k vs new svs new 53 df k vu new uvu new 54 proof we prove the result for vs new the case of vu new can be proven in the exact same manner since vs satisfies eq 15 we have df k vs new df k as vs as s vs as svs svs new 55 where as s as s follows from exponentiating eq 51 ut we can also modify the second column of p the symplectic conjugate center direction vc to make t constant this is possible because as mentioned in section 4 3 the symplectic conjugate is not unique given a t r and vc satisfying eq 14 the function vc a dk also solves eq 14 except with a change in t which was anyways arbitrary hence we choose a which kills all variation of t about its average t 0 the equation for this is t t 0 a a 56 which can be solved using the fourier series method given for eq 30 then one simply adds a dk to column 2 of p and replaces t with t 0 in note that the lhs of eq 56 has average zero so a solution a can be found 16 bhanu kumar et al lemma 3 if vc and a satisfy eq 14 and 56 respectively then the function vc new vc a dk is also a symplectic conjugate and satisfies df k vc new t 0 dk vc new 57 proof since vc satisfies eq 14 and dk satisfies eq 17 we have df k vc new df k vc a dk t a dk vc t 0 a dk vc t 0 dk vc new 58 where the relation t a t 0 a follows from eq 56 ut 4 9 initialization for continuation by to compute invariant circles and bundles of stroboscopic maps in periodically perturbed pcrtbp models with some desired perturbation parameter f 0 we start from periodic orbits and their bundles in the unperturbed pcrtbp 0 and continue by until the torus and bundles for f are found our quasi newton method based continuation follows the standard procedure choose a number of continuation steps n take an invariant circle and bundles from the 0 system and use them as an initial guess for the quasi newton method to solve for the circle and bundles in the f n system similarly for i 0 n 1 use the solution from the f i n system as an initial guess for the solution in the f i 1 n system once i n 1 we have the torus and bundles for f we need to find the 0 solution to initialize the continuation however to get k p and solving eq 10 and 11 for the 0 pcrtbp case one needs to first choose a periodic orbit which is to be continued recall that pcrtbp periodic orbits are also invariant circles of the stroboscopic map f f 0 unless the orbit period is resonant with 2 p from this periodic orbit we get its period t 1 and hence the rotation number 4 2 t 1 p as well as a point x 0 lying on the orbit let x t denote the time t map of the point x r 4 by the pcrtbp equations of motion then we can take k x 0 t 1 2 if the pe riodic orbit monodromy matrix stable and unstable eigenvalues are positive if they are negative though the double covering trick of haro and de la llave 2007 needs be used so that p can be continuously defined as the stable unstable bundles are mo bius strips in this case for this set k x 0 2 t 1 2 and 2 2 t 1 p so that k sweeps over the periodic orbit twice as goes from 0 to 2 in either case it is easy to verify that k satisfies eq 10 next set the first column of p to be dk and set the third and fourth columns of p as the stable and unstable unit eigenvectors of the periodic orbit monodromy matrix at the point k denote these stable and unstable eigenvec tors as vs and vu respectively one needs to make sure that the directions of vs and vu at each point k are chosen such that they are continuously ori ented functions of this is always possible if k is defined as previously described finally finding the second column of p requires some extra calculations computing whiskered tori and their manifolds in periodically perturbed pcrtbp 17 as mentioned in section 4 3 the second column of p represents the symplectic conjugate direction to dk and is part of the center bundle the first step in its computation is to compute s and u t r such that df k vs s vs 59 df k vu u vu 60 which can be done since df k maps the stable and unstable bundles into themselves next find functions a b c and d t r such that df k j 1 dk dk 2 a dk b j 1 dk dk 2 c vs d vu 61 where j 02 2 i 2 2 i 2 2 02 2 is the 4 4 matrix of the symplectic form in the usual euclidean metric on r 4 all the quantities in 61 are known except for a b c and d we can therefore consider eq 61 as a system of linear equations for a b c and d which can be solved one will find that b 1 this occurs as a result of symplectic geometric considerations see eq 70 after this we solve for functions f 1 f 2 t r such that c f 1 s f 1 62 d f 2 u f 2 63 which can be done using the same contraction map iteration method used to solve equations 25 and 26 in section 4 5 1 finally we can express the second column of p the symplectic conjugate direction vc as vc j 1 dk dk 2 f 1 vs f 2 vu 64 with p known to find one can simply use p 1 df k p after which we can start the continuation as long as the previous steps were followed correctly will be of the form given in eq 12 to see this recall the discussion in section 4 3 and note that the first third and fourth columns of p satisfy equations 13 15 and 16 hence we just need to show that the second column of p satisfies eq 14 we prove this now lemma 4 for some t t r the function vc defined in eq 64 satisfies df k vc t dk vc 65 proof applying eq 64 and then equations 59 60 and 61 we have df k vc df k j 1 dk dk 2 f 1 vs f 2 vu a dk b j 1 dk dk 2 c s f 1 vs d u f 2 vu 66 18 bhanu kumar et al recalling equations 62 and 63 we thus have that df k vc a dk b j 1 dk dk 2 f 1 vs f 2 vu 67 flow maps of hamiltonian systems are symplectic thirring 1992 hence f sat isfies v 1 v 2 df k v 1 df k v 2 for all v 1 v 2 r 4 where is the bilinear symplectic form defined on euclidean r 4 as v 1 v 2 vt 1 jv 2 it is easy to see that v 1 v 1 0 for any v 1 r 4 furthermore defining l max t s 1 and recalling equations 17 and 59 we have that max t dk vs max t df k dk df k vs max t dk s vs max t s dk vs lmax t dk vs lmax t dk vs 68 which implies that max t dk vs 0 since 0 l 1 thus for all t dk vs 0 we can also show that dk vu 0 in a very similar manner to eq 68 hence using eq 64 for vc we find dk vc dk j 1 dk dk 2 f 1 vs f 2 vu dk j 1 dk dk 2 dk t j j 1 dk dk 2 dk tdk dk 2 1 69 since f is a symplectic map using eq 67 we have that 1 dk vc df k dk df k vc dk a dk b j 1 dk dk 2 f 1 vs f 2 vu dk b j 1 dk dk 2 b dk t j j 1 dk dk 2 b 70 proving that b 1 therefore substituting this into eq 67 gives df k vc a dk j 1 dk dk 2 f 1 vs f 2 vu 71 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 19 finally we see from eq 64 that the last 3 terms on the rhs of eq 71 are precisely vc letting t a we hence conclude that df k vc t dk vc 72 which is what we sought to prove ut 4 10 computing families of tori continuation by the continuation by described in section 4 9 is carried out with fixed however in the pcrtbp periodic orbits occur in one parameter families with varying rotation numbers under f 0 the same is true of invariant circles of f for f 0 as well to compute the family of f f invariant tori corresponding to a pcrtbp periodic orbit family one option is to continue several different periodic orbits from that family corresponding to different values by however this is inefficient as the tori and bundles computed for f are not of interest instead it is better to first compute just one invariant circle of f f along with its bundles at some rotation number 0 using continuation by after this one can continue the 0 circle bundles by with f fixed the continuation by is quite similar to the continuation by given a known exact solution to eq 10 and 11 for i i z one uses this to form an initial guess for the quasi newton method to compute the torus bundles for i 1 i i this recursively gives us tori for a range of values the i are called the continuation step sizes one can use the torus and bundles for i directly as an initial guess for i i however it is extremely easy to use k p and from i to compute a better initial guess for the i i torus which aids in quasi newton method convergence assume that has constant t t apply the procedure from section 4 8 to p and if necessary then using vc to denote column 2 of p the initial guess for the i i torus parameterization should be knew k i t vc we justify this now claim if k p and with constant solve eq 10 11 for i then knew k i t vc solves eq 10 for i i up to o 2 i proof for notational convenience write and in place of i and i respec tively then evaluating f knew knew we find this equals f k t vc k t vc f k df k t vc o 2 k dk t vc o 2 t df k vc t dk vc o 2 o 2 73 where the last equality follows from eq 14 ut remark 6 using the poincare lindstedt method it is possible to get higher order expansions in i for knew than the linear approximation k i t vc this requires significant extra computations which we decided not to carry out 20 bhanu kumar et al gap i 0 2 fig 1 schematic of crossing gaps during continuation consider the 0 and 2 lines to be glued together to form a cylinder there is one more difference between continuation by and continuation by the continuation by uses a fixed step size f n however for continuation by the step size i must be varied due to quasi newton method divergence for insufficiently irrational at such values the pcrtbp invariant circle breaks down after the perturbation f leading to a gap between tori at smaller and larger rotation numbers our continuation needs to jump over this gap suppose we have a torus and bundles for i and let i denote the largest of i 1 i 2 i 5 it is natural to try i i if the quasi newton method diverges for i i however then instead one can try i i 2 if this still does not work try i i 2 2 and so on until we find a i that works once we have the circle bundles for i 1 i i we repeat the process in this procedure it is possible for i 1 to be larger than i which is what allows us to jump over gaps in the tori for example suppose that i 1 through i 5 are all equal to 1 5 2 10 4 so i then it can happen that the quasi newton method diverges for i but converges for i 2 i 1 so i 2 however i 1 will still equal so we try i 1 if the quasi newton method converges for i 1 i 3 2 then we will have crossed the torus gap encountered earlier at i this is schematically illustrated in fig 1 we draw the tori on a projection of the 2 d cylindrical nhim defined in section 3 1 we let i be coordinates on 4 11 discretization and implementation when implementing the previously described methods on a computer it is nec essary to discretize all the functions used as well as the operations on them we represent k p and other functions of as arrays of their values on a discrete grid of n evenly spaced values i 2 i n i 0 n 1 many operations on functions can be carried out element wise on these arrays such operations include basic scalar arithmetic matrix multiplication and matrix inversion for instance given arrays of values p i and i we can calculate a new array of n values k i p i i note that the k array will actually contain 4 n floating point numbers since each k i r 4 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 21 other operations are more efficiently carried out using fourier coefficients for instance given an array of function values a i for some a t r we can use a i 1 n n 1 k 0 a k e jk i a i 1 n n 1 k 0 a k e jk e jk i 74 a i 1 n n 1 k 0 a k e jk i da i 1 n n 1 k 0 jka k e jk i 75 to translate or differentiate a we use the fast fourier transform fft to get n fourier coefficients a k multiply each a k by ejk translation or jk dif ferentiation and then take the inverse fft to get an array of values a i or da i solving cohomological equations like 30 also requires working with fourier coefficients as described in section 4 5 a few numerical problems were experienced due to the discretization of contin uous functions on the computer let trans a i represent the array of a i values found by applying the algorithm of eq 74 to the array of a i values the first problem was that trans f i g i 6 trans f i trans g i multiplying two arrays and then translating the result gives a different result than first translating the two arrays and then multiplying the results also f i 6 trans trans f i when n is even and real to complex fft is used for real data these issues can prevent quasi newton method convergence both inequalities are most pronounced when the high frequency discrete fourier transform coefficients of f or g are large in magnitude it is not expected that the tori or bundles we compute should have significant high frequency oscillations as a function of hence a solution to these two problems was to run k i and p i through a lowpass filter during the first two or three quasi newton steps as well as when the quasi newton method would start diverging note that this is somewhat reminiscent of arnold s use of truncated fourier series with succes sively increasing cutoff frequencies in his proof of the kam theory de la llave 2001 we also found that modifying p between continuation steps to make constant as described in section 4 8 greatly mitigates these numerical issues as well finally if the high frequency fourier coefficients keep becoming large after each quasi newton step despite filtering and constant we increase the number of fourier modes used equivalent to increasing n one phenomenon we noticed during the implementation of our quasi newton method based continuation was that generally the torus parameterization k converges to within a given error tolerance before the bundle and floquet matrices p and we can use this to further improve the numerical stability of our quasi newton method by using the converged k to directly compute the full p and matrices to do this as mentioned earlier the first column of p is simply dk the third and fourth columns of p the stable and unstable bundles vs and vu can be found using the power method as is described by haro and de la llave 2006 for this first set vs 0 and vu 0 equal to the unit length normalized third and fourth columns of p the unconverged approximate stable and unstable bundles this is then followed by the iteration vs i 1 df k 1 vs i df k 1 vs i 76 22 bhanu kumar et al vu i 1 df k vu i df k vu i 77 which should converge after a few iterations in practice we also run each vs i vu i through a lowpass filter after its computation once the iterations have converged we use the methods of section 4 8 to rescale vs and vu to ensure constant s and u finally we can use the exact same method presented in section 4 9 to compute the second column of p from the known dk vs and vu see eq 61 64 the method of section 4 8 is then applied to make t constant this gives us the final p and matrices which in our experience not only usually satisfy eq 11 to within tolerance sometimes one last quasi newton correction step is required but also have smaller high order fourier coefficients than the earlier approximate p and this further improves our method s numerical stability 4 12 numerical results in the pertbp we implemented and successfully applied the methods described in the previous sections to the computation of invariant circles and their bundles for the jupiter europa pertbp stroboscopic map we used a tolerance of 10 7 in eq 10 11 the circles and bundles were found by first continuing jupiter europa pcrtbp unstable resonant periodic orbits by eccentricity to 0 0094 the real value for fixed and then continuing the circles and bundles by while fixing 0 0094 both 3 4 as well as 5 6 resonant tori were computed fig 2 shows the contin uation by eccentricity of a 5 6 resonant periodic orbit from the pcrtbp to an invariant circle of the pertbp stroboscopic map for this we used n 2048 discretization i values the plot on the right zooms into the region near europa the leftmost curve there corresponds to 0 0094 which is to be expected as europa s periapsis moves leftwards as increases fig 3 shows the continuation of a 3 4 resonant torus in the physical 0 0094 jupiter europa pertbp by which yields a family of resonant tori in the system for 1 536217 1 567314 n ranged from 1024 to 32768 with larger n required for tori passing close to the singularity in the equations of motion at europa fig 4 shows a family of jupiter europa pertbp 5 6 resonant tori also generated using continuation by this family like the pcrtbp 5 6 resonant orbit family does not have monotonically increasing or decreasing rotation numbers starts at 1 035166 for the leftmost torus in the zoomed in plot decreases to 1 027137 and then increases to 1 040911 for the rightmost torus thus we first continued two different pcrtbp 5 6 reso nant orbits by to get two pertbp tori one in each of the two sections of tori with monotone these two tori were then continued by to sweep out the tori in their corresponding sections for this case n ranged from 1024 to 4096 after computing tori in the physical jupiter europa pertbp with 0 0094 we also tested our quasi newton method to see if it would work for larger fig 5 shows selected tori from the continuation of a 3 4 resonant periodic orbit from the pcrtbp to an invariant circle of the pertbp with jupiter europa mass ratio but 0 206 this eccentricity is larger than that of the sun mercury system which has one of the most eccentric two body orbits of any pair of large solar system bodies we used n 1024 and a continuation step size of 0 0005 the quasi newton method failed to converge for larger step sizes every 20 th torus is shown in the figure as can be seen our method was robust even for large computing whiskered tori and their manifolds in periodically perturbed pcrtbp 23 1 5 1 0 5 0 0 5 1 x dimensionless 1 0 5 0 0 5 1 y d im en si on le ss jupiter europa system continued from e 0 to 0 0094 1 1 01 1 02 1 03 1 04 1 05 1 06 1 07 x dimensionless 0 03 0 02 0 01 0 0 01 0 02 0 03 y d im en si on le ss jupiter europa system continued from e 0 to 0 0094 e 0 e 0 0094 fig 2 continuation of 5 6 jupiter europa pertbp resonant torus from 0 to 0 0094 fig 3 continuation of 0 0094 jupiter europa pertbp 3 4 resonant tori by europa surface shown as red circle 1 5 1 0 5 0 0 5 1 1 5 x dimensionless 1 0 5 0 0 5 1 y d im en si on le ss 5 6 unstable resonant tori family jupiter europa system e 0 0094 0 98 0 99 1 1 01 1 02 1 03 1 04 1 05 1 06 1 07 x dimensionless 0 03 0 02 0 01 0 0 01 0 02 0 03 y d im en si on le ss 5 6 unstable resonant tori family jupiter europa system e 0 0094 fig 4 continuation of 0 0094 jupiter europa pertbp 5 6 resonant tori by europa surface shown as red circle 24 bhanu kumar et al 1 5 1 0 5 0 0 5 1 1 5 x dimensionless 1 0 5 0 0 5 1 y d im e n si o n le ss jupiter europa masses continued from e 0 to 0 206 0 85 0 9 0 95 1 1 05 1 1 x dimensionless 0 1 0 05 0 0 05 0 1 y d im e n si o n le ss jupiter europa masses continued from e 0 to 0 206 e 0 206 e 0 fig 5 selected tori from 3 4 jupiter europa pertbp continuation from 0 to 0 206 values of the perturbation on a 2017 era quad core i 7 laptop cpu our julia program took only about 230 seconds for the entire continuation to 0 206 and less than 10 s for continuation to the physical value 0 0094 5 parameterization method for stable and unstable manifolds with the invariant circles and their stable and unstable bundles computed we next turn our attention to accurate computation of torus stable and unstable manifolds many studies using manifolds such as olikara 2016 use linear approximations of invariant manifolds found by adding small vectors in the stable or unstable directions to the points of the torus and then integrating backwards or forwards however we compute high order fourier taylor polynomials which approximate the manifolds very accurately in some domain of validity the algorithm used here bears many similarities with the method used in previous work kumar et al 2021 a for computation of 1 d manifolds of period maps for periodic orbits in the pcrtbp a different version of this algorithm was also used by zhang and de la llave 2018 in a lower dimensional setting since our f invariant circles are 1 d and have one stable and one unstable direction at each point the circles stable and unstable manifolds will be 2 d and diffeomorphic to either an infinite cylinder or a mo bius strip a cylinder can be continuously parameterized using an angle and a real number s this actually is also possible for a mo bius strip as long as the parameterization is non injective and wraps around the strip twice as goes from 0 to 2 the double covering trick we used in section 4 9 in the framework of section 4 1 we have m t r and f s s where is the stable s or unstable u entry of depending on which manifold we are trying to compute without loss of generality we assume that s and u are constant see section 4 8 with this the equation to solve for the parameterization w t r r 4 of the stable or unstable manifold is f w s w s 0 s t r 78 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 25 5 1 order by order method to find w we express w as a fourier taylor series of form w s k k 1 wk s k 79 where s 0 corresponds to the invariant circle k whose manifold we are trying to compute the s 0 term of w is k and the linear term w 1 is the stable vs or unstable vu bundle known from the third or fourth column of p hence we need to solve for the higher order coefficients wk t r 4 k 2 denote w k s k k 1 j 1 wj s j assume we have solved for all wj for j k so that f w k s w k s has only s k and higher order terms then starting with k 2 the recursive method to solve for wk is 1 find ek f w k s w k s k where k denotes the s k coef ficient of the term inside brackets we show how to do this in section 5 2 2 find wk such that w k s wk s k cancels ek s k in eq 78 thus satisfying eq 78 up to order sk the equation to solve for wk is df k wk k wk ek 80 to solve this let wk 0 0 and iterate the following sequence to convergence wk i 1 kdf k 1 wk i df k 1 ek if 1 kdf k wk i kek if 1 81 fourier methods are an alternate method of solving eq 80 see remark 7 3 set w k 1 s w k s wk s k and return to step 1 the recursion is stopped when we are satisfied with the degree k of w we now prove that the equations and method described in step 2 to find wk are valid claim if wk solves eq 80 then for j k using the k notation defined earlier f w k s wk s k w k s wk s k j 0 82 proof recall that f w k s w k s ek s k o sk 1 expanding eq 82 in taylor series and keeping only sk and lower order terms gives f w k s df w k s wk s k w k s wk s k j ek s k df w k s wk s k kwk s k j 0 if j k ek df k wk kwk 0 if j k 83 where the j k case of the last line follows from the preceding line by dividing sk out from the quantity inside j and then taking s 0 ut 26 bhanu kumar et al claim the sequence wk i i n defined by wk 0 0 and eq 81 converges to wk wk i 1 kdf k 1 wk i df k 1 ek if 1 kdf k wk i kek if 1 84 proof let p be the bundle and floquet matrices for k we assume that is constant as the procedure from section 4 8 gives then it is easy to show that wk i p i 1 j 0 kj j 1 p 1 j 1 ek j if 1 p i 1 j 0 k j 1 j p 1 j ek j 1 if 1 85 solves eq 81 with wk 0 0 simply substitute eq 85 for wk i in eq 81 and use df k p p and df k 1 p 1 p 1 to simplify the rhs of the resulting equation now we will show that wk limi wk i first of all note that j s j j s j j st 0 0 0 j s 0 0 0 0 1 0 0 0 0 j s j u ju j j u j j u t 0 0 0 j u 0 0 0 0 j s j u 0 0 0 0 1 86 for all j n where is of the form given in eq 12 and has constant t s and u as assumed earlier since s 1 and u 1 js j and j u j are hence bounded for all j n now define s 1 p 1 ek and u kp 1 ek also recall that 1 means s and 1 means u we can use all this to rewrite eq 85 as wk i p i 1 j 0 k 1 j s j s j s j if 1 p i 1 j 0 k 1 j u j u j u j if 1 87 in both 1 and 1 cases of eq 87 the quantities in square brackets are bounded for all t and j n as k 2 k 1 s 1 and k 1 u 1 hence if i the sum in eq 87 is absolutely uniformly convergent hence l limi wk i exists letting i on both sides of eq 81 gives l kdf k 1 l df k 1 ek if 1 kdf k l kek if 1 88 which for both 1 and 1 is equivalent to eq 80 with wk l ut remark 7 given p and satisfying eq 11 substituting wk pvk into eq 80 and rearranging gives vk kvk p 1 ek which can be solved for vk component by component using the fourier methods from section 4 5 2 we used the iteration method of eq 81 instead to avoid any possible multiplication translation numerical discretization issues see section 4 11 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 27 5 2 computing ek automatic differentiation and jet transport in step 1 of the order by order method to find w we compute the sk coefficient ek f w k s w k s k 89 in eq 89 the sk term of w k s is 0 since w k s is a fourier taylor series up to order sk 1 and is constant however computing the fourier taylor expansion of f w k s is more complicated as f is a nonlinear stroboscopic map defined by integrating points for a fixed time 2 p by the equations of motion 3 and 4 we will need the tools of automatic differentiation haro et al 2016 and jet transport pe rez palau et al 2015 for this note that some researchers rasotto et al 2016 berz and makino 1998 use the term differential algebra to refer to what we call automatic differentiation automatic differentiation is an efficient and recursive technique for evaluating operations on taylor series for instance let f s and g s s r be two series we can use their known coefficients to compute d s f s g s as a taylor series as well let subscript j denote the sj coefficient of a series since f s d s g s we find that fi i j 0 djgi j i 1 j 0 djgi j s dig 0 which implies that di 1 g 0 fi i 1 j 0 djgi j 90 starting with d 0 f 0 g 0 eq 90 allows us to recursively compute di i 1 similar formulas also exist for recursively evaluating many other functions and operations on taylor series including f s r see haro et al 2016 for more examples most importantly in all automatic differentiation formulas the output series si coefficient is a function of only the si and lower order coefficients of the input series hence we can use truncated taylor series with these algorithms when implementing them in computer programs recall from section 4 11 that on the computer we represent all functions of including the wj as arrays of function values on an evenly spaced grid of values i 2 i n i 0 n 1 note that for fixed i w k i s is a taylor series not fourier taylor with coefficients wj i r 4 using automatic differentiation we can substitute taylor series such as w k i s for x y px py in the equations of motion 3 which gives us series in s for x y p x p y in terms of computer programming this means that after overloading the required operators usually arithmetic and power to accept taylor series arguments we can use numerical integration routines with the series as well to be more clear consider a taylor series valued function of time v s t j 0 vj t s j r 2 r 4 where vj t are its time varying taylor coefficients write vx s t vy s t vpx s t and vpy s t for the x y px and py components of v s t similarly write vj x t vj y t vj px t and vj py t for the components of vj t substituting v in eq 3 yields a system of differential equations d dt vx s t j 0 v j x t s j h px vx s t vy s t vpx s t vpy s t p 91 28 bhanu kumar et al d dt vy s t j 0 v j y t s j h py vx s t vy s t vpx s t vpy s t p 92 d dt vpx s t j 0 v j px t s j h x vx s t vy s t vpx s t vpy s t p 93 d dt vpy s t j 0 v j py t s j h y vx s t vy s t vpx s t vpy s t p 94 p p 95 h and its partials are algebraic functions that are suitable for use with automatic differentiation techniques see for instance the pertbp hamiltonian eq 5 hence if the vj x t vj y t vj px t vj py t and p are known for j n and some t r automatic differentiation allows us to simplify the rhs of each of eq 91 94 to a series in s then for each of eq 91 94 and j n the sj coefficient v j x t v j y t v j px t or v j py t from the lhs must be equal to the s j coefficient of the rhs in other words v j x t v j y t v j px t and v j py t j n are functions of p vj x t vj y t vj px t and vj py t j n this is effectively a system of differential equations for the time varying taylor coefficients of v s t solving eq 91 95 with initial condition v s 0 w k i s and initial p equal to the value fixed in section 3 1 we can compute f w k i s v s 2 p in summary we consider the taylor coefficients of w k i s as initial state variables to be numerically integrated coefficient by coefficient propagating by time 2 p we get the taylor coefficients of f w k i s doing this for each i 0 n 1 is enough to represent the fourier taylor coefficients of f w k s on the computer up to order k the sk coefficient of this gives us ek this approach for numerical integration of taylor series is called jet transport see pe rez palau et al 2015 for more details truncated taylor series can be used with jet transport since the automatic differentiation techniques used to evaluate time derivatives work with truncated series note that for an n dimensional state n 4 in our case and degree d truncated series there are n d 1 coefficients which is the required dimension for the numerical integration 5 3 notes about numerical computation of manifolds we implemented the parameterization method automatic differentiation and jet transport of sections 5 1 and 5 2 in a c program for computation of stable and unstable manifolds for numerical integration including jet transport we used the runge kutta prince dormand 8 9 integrator from the gsl library galassi et al 2009 integrations were parallelized using openmp with one thread for each i value we tested our tools by computing manifolds of some of the 3 4 and 5 6 jupiter europa pertbp tori shown in fig 2 and 3 with n ranging from 1024 to 2048 on a quad core intel i 7 laptop cpu the program took less than 10 seconds for the computation of s 5 order parameterizations note that in each step of order k when f w k i s w k i s is computed in order to find ek i the s j coefficients for j k should be zero to compute the w k i s coefficients use the translation algorithm from computing whiskered tori and their manifolds in periodically perturbed pcrtbp 29 section 4 11 on the arrays of wj i values and then multiply wj i by j this behavior was indeed observed when running the program serving as a check on the accuracy of the computation the final sd degree truncated series w d s k d j 1 wj s j satisfies f w d i s w d i s 0 up to terms of order sd for each i 0 n 1 in the wk step we truncate all series at s k for the automatic differentiation and jet transport steps this optimizes computational time and storage require ments also note that given w s solving eq 78 w s is also a solution for any r sometimes the jet transport integration may struggle to converge as a result of fast growing coefficients wj of w s in this case scaling w s to w s with 1 can help to do this simply multiply w 1 by and then restart the order by order parameterization method algorithm as a final remark note that in certain systems such as the pertbp with p 0 at t 0 the equations of motion have the same time reversal symmetry as the pcrtbp in this case knowledge of the stable manifold w s s gives us the unstable manifold wu s simply by setting wu s mw s 2 s where m is the diagonal matrix with diagonal entries 1 1 1 and 1 by doing this we save half the computation time as compared to computing both w s and wu 5 4 fundamental domains of parameterizations the d degree fourier taylor parameterization w d s of the manifolds of k will be more accurate than linear approximation by the stable or unstable direction at each point k however due to series truncation error w d s is not exact furthermore even the exact infinite series w s satisfying eq 78 would only be valid for s within some radius of convergence thus we must determine the values of s r for which w d s accurately represents the invariant manifold fix an error tolerance say etol 10 5 or 10 6 we now find what haro et al 2016 call the fundamental domain of w d s this is the largest set t d d such that for all s t d d the error in invariance eq 78 is less than etol that is we seek the largest d r such that for all s satisfying s d max t f w d s w d s etol 96 in practice since we know k and wj j 1 d at the values i i 0 n 1 we search for the largest d r such that for all s with s d max i 0 n 1 f w d i s w d i s etol 97 the simplest way of finding d is to first use bisection to find the largest di such that f w d i s w d i s etol for all s di di after doing this for i 0 n 1 d will be the minimum of all the di we computed the fundamental domains of validity for 5 different 3 4 and 5 6 pertbp resonant torus manifold parameterizations we found that the domains for d 5 were 50 200 times larger than those for d 1 for linear parameteri zations d 1 the domain size d of all test cases was on the order of 10 4 at best generally 10 5 however for the degree 5 parameterizations wd 5 s d was on the order of 10 3 or 0 01 higher degree parameterizations may improve 30 bhanu kumar et al even further note that a larger fundamental domain means that less numerical integration is required for manifold globalization reducing the computation time 6 globalization regularization and visualization at this point we have accurate local representations of stable and unstable mani folds of our stroboscopic map invariant circles given a manifold s fourier taylor parameterization wp s and its fundamental domain d t d d the im age wp d gives us a piece of the manifold in the map phase space r 4 however this subset of the manifold will be close to its base invariant circle k gener ally it is motions on the manifold further away from the torus that are of interest for applications hence we need to extend our fourier taylor parameterization wp d r 4 to a function w t r r 4 parameterizing the entire manifold with w wp on d this is referred to as globalization recall from eq 78 that w must satisfy f w s w s applying this repeatedly we have that f k w s w k ks where the superscript k z refers to function composition we can rewrite this as w s f k w k ks 98 w s f k w k k s 99 eq 98 99 allow us to define w s for all s t r if w is an unstable manifold with 1 choose k 0 such that ks d and use wp to evaluate eq 98 if w is a stable manifold with 1 take k 0 such that ks d and evaluate eq 99 the map f k or f k is just a time 2 k p or 2 k p numerical integration w s thus defined satisfies f w s w s for all s t r so the image w t r is f invariant hence eq 98 99 give us a global representation of the entire stable or unstable manifold note that w can be differentiated easily with respect to and s to get the tangent vectors to the manifold as df k is a state transition matrix and dwp only requires polynomial or fourier series differentiation this can be useful for differential correction of approximate heteroclinic connections see kumar et al 2021 b for details 6 1 mesh representations of globalized manifolds for visualization we often want to calculate a mesh of many points on the mani fold rather than just a few w s values to do this we first take an evenly spaced grid of l s values sj from d to d in addition to our grid of n values i and then directly evaluate the fourier taylor parameterization to compute w i sj for each i 0 n 1 j 1 l next we repeatedly apply f or f 1 to the w i sj to get the points w i k ksj f k w i sj if 1 or w i k ksj f k w i sj if 1 for k 0 1 2 up to some kmax z the numerical integrations required in this step may require use of regularized equations of motion which we will discuss in section 6 2 finally we use the translation algorithm given in eq 74 to find the points w i ksj if 1 or w i ksj if 1 we need all points to be at the same set of n i values when trying to create a manifold mesh that can be plotted computing whiskered tori and their manifolds in periodically perturbed pcrtbp 31 fig 6 x y px projection of jupiter europa pertbp 3 4 w s for 1 559620297 by following this procedure we get a discretized plottable representation of the manifold subset w s s t m m where m kmaxd if 1 and m kmaxd if 1 note that the numerical integrations can be parallelized across i values which we took advantage of a 3 d projection of an example globalized stable manifold mesh denoted w s of a 3 4 jupiter europa pertbp invariant circle is given in fig 6 with n 1024 l 101 kmax 6 6 2 the need for regularization an extension of levi civita to the pertbp in the equations of motion for the pertbp and other periodically perturbed pcrtbp models the positions of the two large masses m 1 and m 2 are singulari ties however when numerically integrating points forwards or backwards during the manifold mesh computation described in section 6 1 it is possible for some points trajectories to pass extremely close to the singularity at m 2 moreover this can indicate that the manifold being computed actually passes through the m 2 singularity such behavior was observed for example during computation of manifold meshes for 5 6 jupiter europa pertbp tori these close approaches to m 2 can result in numerical issues including lack of integrator convergence in the pcrtbp the levi civita regularization is very commonly used to com pute trajectories which pass near or through a singularity see celletti 2010 for full details first a canonical coordinate transformation is applied to the pcrtbp hamiltonian h 0 from eq 2 this is followed by the addition of a pair of action angle variables to the transformed hamiltonian the new action s value is set to h 0 which has a constant value along the trajectory this finally allows a time rescaling to be used which cancels the singularity this method however relies on the fact that h 0 is constant along pcrtbp trajectories for our periodically perturbed models this is not the case hence some modification is required for the pertbp the singularity corresponding to m 2 is the time varying point x y 1 1 cose t 0 we now present the derivation of the modified levi civita regularization of m 2 for the pertbp we expect very similar methods 32 bhanu kumar et al to apply for other periodically perturbed pcrtbp models as well readers pri marily interested in using the final regularized equations for numerical integration should skip to section 6 2 1 the following is heavily inspired by celletti 2010 first take the pertbp hamiltonian h from eq 5 and add a momentum variable pt conjugated to t the hamiltonian and equations of motion become h px py pt x y t pt p 2 x p 2 y 2 n t pxy pyx 1 r 1 r 2 100 x h px y h py t h pt p x h x p y h y p t h t 101 where r 1 x 1 t 2 y 2 r 2 x 1 1 t 2 y 2 and t cose t note that adding pt does not change the values of x y p x p y and t h pt 1 as compared to using eq 5 however unlike h the new hamiltonian h does remain constant along trajectories in px py pt x y t space also given an initial condition x y px py t to be propagated the initial value of pt should be set so that h 0 this will be important later on now we perform a canonical coordinate transformation this is required in order to straighten out certain trajectories passing through the singularity which make sharp bends in physical space celletti 2006 define a generating function w px py pt x y t px x 2 y 2 1 1 t p 2 2 xy ptt 102 which is a function of the old momenta and new configuration space coordinates then this defines a transformation between the old px py pt x y t variables and new px py pt x y t variables through the relations thirring 1992 x w px x 2 y 2 1 1 t y w py 2 xy px w x 2 pxx 2 pyy py w y 2 pxy 2 pyx t w pt t pt w t 1 px d dt t pt 103 eq 103 gives us x y and t in terms of the new variables we can also solve for px and py to get px 2 r pxx py y and py 2 r pxy pyx where r 4 x 2 y 2 this then gives us pt pt 2 r 1 pxx py y d dt t note that in the new variables r 2 x 2 y 2 2 2 xy 2 r 4 substituting the previous expressions for px py pt x y t into eq 100 gives h px py pt x y t pt 2 r 1 pxx py y d dt t p 2 x p 2 y 2 r 2 n t 1 4 pxx py y 1 r 1 t pxy pyx 1 x 2 y 2 2 1 t 2 2 x 2 y 2 1 t 4 r 104 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 33 the m 2 singularity is now at x y 0 0 where r 4 r 2 0 since this was a canonical transformation the equations of motion in the new coordinates will be x h px y h py t h pt p x h x p y h y p t h t 105 to regularize the singularity at r 0 we want to be able to use rh instead of h for this define a rescaled time s such that dt rds then we have that d ds d dt dt ds r d dt thus letting prime denote d ds x r h px y r h py t r h pt p x r h x p y r h y p t r h t 106 since r is a function of only x and y it is immediate that x rh px y rh py t rh pt and p t rh t furthermore since pt was cho sen earlier to ensure h 0 we also will have h 0 along the trajectory in px py pt x y t space hence we find that rh x r h x h r x r h x this yields p x rh x we similarly find p y rh y as rh has no sin gularity at r 0 we thus obtain the m 2 regularized time s equations of motion x rh px y rh py t rh pt p x rh x p y rh y p t rh t 107 6 2 1 usage of regularized pertbp equations of motion let xi yi pix p i y be an initial state we wish to integrate from t ti to tf in the pertbp recall h from eq 5 and h from eq 100 with t cose t to use the m 2 regularized equations of motion for this integration we 1 set pit h p i x p i y x i yi ti so that h p i x p i y p i t x i yi ti 0 2 compute initial p ix p i y p i t x i y i t i using the equations where j 1 x jy x 1 1 t jy 1 2 px 2 pxx 2 pyy py 2 pxy 2 pyx t t pt 1 px d dt t pt 108 the sign chosen during the complex square root for x jy does not matter 3 integrate the initial condition p ix p i y p i t x i y i t i using eq 107 where r 4 x 2 y 2 and h is given by eq 104 only stop the integration when t tf do not stop before this occurs even if the integration time reaches tf 4 transform the resulting final state back to px py pt x y t coordinates using x x 2 y 2 1 1 t y 2 xy px 2 r pxx py y py 2 r pxy pyx t t tf pt pt 2 r 1 pxx py y d dt t 109 34 bhanu kumar et al fig 7 x y projection of jupiter europa pertbp 5 6 w s for 1 030011437 the first line of eq 108 should be interpreted as two real equations corresponding to setting real and imaginary parts of both sides equal it follows from the first line of eq 103 combined with the relation x jy 2 x 2 y 2 j 2 xy also for step 3 above the requirement to stop integration when t tf can be implemented using the events functionality of matlab s ode solvers or the callback features in julia s differentialequations jl library the partial derivatives of rh appearing in the equations of motion eq 107 are straightforward to compute but lengthy so we do not write them here throughout the steps listed above as well as for computing the partial derivatives we need the quantities d dt d 2 dt 2 and dn dt these are given by the equations d dt sine 1 cose d 2 dt 2 cose 2 1 cose 3 dn dt 2 1 2 1 cose 4 sine which can be derived from t cose t n t 1 2 1 cose t 2 and the rela tion de dt 1 1 cose which in turn follows from taking the time derivative of the standard kepler s equation m e sine see bate et al 1971 6 2 2 computational results in fig 7 we show a 2 d projection of an example globalized stable manifold mesh for a 5 6 jupiter europa pertbp invariant circle this was computed using the regularized pertbp equations of motion to evaluate f k in the procedure de scribed in section 6 1 in this case n 2048 l 101 kmax 6 we have filtered the computed mesh points so as to only plot those which did not result in a very visually discontinuous mesh this filtering is needed during visualization since close flybys of m 2 can send points which started close together in extremely different directions nevertheless even after discarding some mesh points it is clearly visible in the figure that the manifold passes through the singularity at computing whiskered tori and their manifolds in periodically perturbed pcrtbp 35 m 2 europa marked as a red circle using the regularized equations we experi enced no warnings of integrator divergence during program runtime which were encountered when using the unregularized equations we also used the regularized equations of motion to recompute the 3 4 w s manifold mesh shown earlier in fig 6 the results matched those which were obtained earlier when using eq 3 and 5 for the numerical integrations thus verifying the correctness of the regularization procedure we carried out this com putation in julia using the dp 5 integrator and parallelizing across i with the ensembleproblem feature of differentialequations jl rackauckas and nie 2017 the computation of the 3 4 manifold with n 1024 l 101 kmax 15 took approximately 250 seconds on the same quad core i 7 laptop cpu used earlier 7 conclusion in this paper we first developed a quasi newton method for the simultaneous com putation of unstable invariant circles and their symplectic conjugate center stable and unstable bundles for stroboscopic maps of periodically perturbed pcrtbp models our method improves the computational complexity of the torus calcu lation to o n logn as compared to o n 3 for the methods used in almost all the existing astrodynamics literature in addition to giving useful information on the torus stable and unstable directions our method also extends the o n logn method of haro and de la llave 2006 and haro et al 2016 to unstable tori with center directions as is the case for the vast majority of celestial mechanics applications we used this quasi newton method for continuation of tori and bun dles by both perturbation parameter and rotation number and described how to initialize the continuation from pcrtbp periodic orbits we also gave a set of numerical best practices to aid in quasi newton method convergence after finding the tori and bundles we used the results of the continuation to start an order by order method for the computation of fourier taylor series pa rameterizations of stable and unstable manifolds for the invariant circles we found significant improvements in accuracy and fundamental domain size compared to linear manifold approximations finally we were able to extend the parameteriza tions to compute points of the manifolds outside the fundamental domain with the aid of a modified levi civita regularization which we derived for the pertbp we expect that similar methods can be used to regularize other periodically perturbed pcrtbp models as well the tools developed were tested in the jupiter europa pertbp with the calculations of the circles bundles and manifold parameterizations taking just a few seconds on a 2017 era laptop with a quad core intel i 7 cpu our julia program for computation of meshes of globalized manifold points took a few minutes for each manifold due to the large number of numerical integrations involved as we describe in another paper kumar et al 2021 b with the help of modern computer graphics processing units these manifold parameterizations and meshes can be used to very rapidly search for and accurately compute intersections of stable and unstable manifolds leading to heteroclinic connections the methods presented in this paper can form an important component for low energy mission design and transfer trajectories in such periodically perturbed pcrtbp models 36 bhanu kumar et al acknowledgements this work was supported by a nasa space technology research fel lowship this research was carried out in part at the jet propulsion laboratory california institute of technology under a contract with the national aeronautics and space administra tion r l was supported in part by nsf grant dms 1800241 special thanks to dr lei zhang for providing code from his earlier work zhang and de la llave 2018 which formed a base off of which to build much the code written for the quasi newton method and manifold param eterization also many thanks to professors alex haro josep maria mondelo angel jorba and josep masdemont for useful discussions in barcelona which were of great assistance in this work b k s 2019 visit to barcelona was funded by european commission grant h 2020 msca rise 2015 project 734557 trax many thanks to the italian gruppo nazionale per la fisica matematica for hosting b k at the fall 2019 summer school in ravello italy an earlier and less detailed version of this paper was presented and included in the proceedings of the 2020 aas aiaa astrodynamics specialist conference paper number aas 20 694 a proof of vanishing ecc average in section 4 6 it was mentioned that the average of ecc goes to zero with each quasi newton step we can prove this using a method somewhat inspired by the vanishing lemma proof of fontich et al 2009 for ease of notation denote this average as c e cc 0 and e cc ecc c so that e cc has zero average also write e 2 0 1 0 0 t proof let vc denote the second column of p and define ec elc e cc esc euc t note that ec ce 2 is simply the second column of ered left multiplying the definition of ered eq 19 by p and taking column 2 of the result gives p ec ce 2 df k vc vc t dk 110 define ec p ec and note that p e 2 vc thus eq 110 gives df k vc 1 c vc t dk ec 111 now differentiating eq 18 yields df k dk dk de as mentioned in the proof of lemma 4 f satisfies v 1 v 2 df k v 1 df k v 2 for all v 1 v 2 r 4 where is the symplectic form defined by v 1 v 2 vt 1 jv 2 thus vc dk df k vc df k dk 1 c vc t dk ec dk de 1 c vc dk o de o ec 112 where we use dk dk 0 to get the last line this yields 2 0 vc dk d 1 c 2 0 vc dk d o de o ec 113 recognizing that 2 0 vc dk d 2 0 vc dk d we have c 2 0 vc dk d o de o ec 114 now for e and ered small enough vc is an approximate symplectic conjugate to dk this means that vc dk 1 see eq 69 so 2 0 vc dk d o 1 hence it must be that c o de o ec so that as the quasi newton method reduces de and ec and thus also ec to zero c goes to zero as well ut computing whiskered tori and their manifolds in periodically perturbed pcrtbp 37 when carrying out the quasi newton step of section 4 6 for correcting p and eq 38 44 and 47 can be solved exactly including for non zero averages on the lhs which quadratically reduces the elc esc and euc components of ec using the definitions given in the above proof on the other hand eq 41 for ecc can be written as ecc e cc c qcc qcc 115 as mentioned near the end of section 4 6 we ignore the nonzero lhs average c e cc 0 when solving for qcc thus what happens is that the zero average part e cc is quadrat ically reduced by the quasi newton step but c may initially remain in ered however the quadratic reductions in elc e cc esc and euc and subsequently also in e during the following k correction step quadratically reduce ec and de this necessitates a reduction in c as described at the end of the above proof references ahlfors lv 1979 complex analysis an introduction to the theory of analytic functions of one complex variable 3 rd edn international series in pure and applied mathematics mcgraw hill new york anderson rl campagnola s lantoine g 2016 broad search for unstable resonant orbits in the planar circular restricted three body problem celestial mechanics and dynamical astronomy 124 2 177 199 anderson rl campagnola s koh d mcelrath tp woollands rm 2019 endgame design for europa lander ganymede to europa approach in aas aiaa astrodynamics specialist conference portland me aas 19 745 andreu m 1998 the quasi bicircular problem phd thesis citeseer bate rr mueller dd white je 1971 fundamentals of astrodynamics dover publications new york berz m makino k 1998 verified integration of odes and flows using differential algebraic methods on high order taylor models reliable computing 4 4 361 369 doi 10 1023 a 1024467732637 url https doi org 10 1023 a 1024467732637 bosanac n 2018 bounded motions near resonant orbits in the earth moon and sun earth systems in aas aiaa astrodynamics specialist conference snowbird utah cabre x fontich e de la llave r 2005 the parameterization method for invariant manifolds iii overview and applications journal of differential equations 218 2 444 515 doi https doi org 10 1016 j jde 2004 12 003 url http www sciencedirect com science article pii s 0022039604005170 capin ski mj gidea m de la llave r 2016 arnold diffusion in the planar elliptic restricted three body problem mechanism and numerical verification nonlinearity 30 1 329 celletti a 2006 basics of regularization theory in steves ba maciejewski aj hendry m eds chaotic worlds from order to disorder in gravitational n body dynamical systems springer netherlands dordrecht pp 203 230 celletti a 2010 stability and chaos in celestial mechanics astronomy and planetary sci ences springer verlag berlin heidelberg doi 10 1007 978 3 540 85146 2 chicone c 2006 ordinary differential equations with applications vol 34 springer science business media farre s a jorba a mondelo jm 2017 numerical study of the geometry of the phase space of the augmented hill three body problem celestial mechanics and dynamical as tronomy 129 1 25 55 doi 10 1007 s 10569 017 9762 z url https doi org 10 1007 s 10569 017 9762 z fenichel n 1971 persistence and smoothness of invariant manifolds for flows indiana uni versity mathematics journal 21 3 193 226 fontich e de la llave r sire y 2009 construction of invariant whiskered tori by a pa rameterization method part i maps and flows in finite dimensions journal of differ ential equations 246 8 3136 3213 doi https doi org 10 1016 j jde 2009 01 037 url https www sciencedirect com science article pii s 0022039609000655 galassi m davies j theiler j gough b jungman g alken p booth m rossi f 2009 gnu scientific library reference manual third edition 3 rd edn network theory ltd https doi org 10 1023 a 1024467732637 http www sciencedirect com science article pii s 0022039604005170 http www sciencedirect com science article pii s 0022039604005170 https doi org 10 1007 s 10569 017 9762 z https doi org 10 1007 s 10569 017 9762 z https www sciencedirect com science article pii s 0022039609000655 38 bhanu kumar et al gole c 2001 symplectic twist maps world scientific doi 10 1142 1349 url https www worldscientific com doi abs 10 1142 1349 https www worldscientific com doi pdf 10 1142 1349 go mez g llibre j mart nez r simo c 2001 dynamics and mission design near libration points world scientific haro a de la llave r 2006 a parameterization method for the computation of invariant tori and their whiskers in quasi periodic maps numerical algorithms discrete continuous dynamical systems b 6 6 1261 1300 haro a de la llave r 2007 a parameterization method for the computation of invariant tori and their whiskers in quasi periodic maps explorations and mechanisms for the breakdown of hyperbolicity siam j appl dyn syst 6 1 142 207 doi 10 1137 050637327 url https doi org 10 1137 050637327 haro a mondelo j 2021 flow map parameterization methods for invariant tori in hamiltonian systems communications in nonlinear science and numerical simula tion 101 105859 doi https doi org 10 1016 j cnsns 2021 105859 url https www sciencedirect com science article pii s 1007570421001714 haro a canadell m figueras j luque a mondelo j 2016 the parameterization method for invariant manifolds from rigorous results to effective computations applied math ematical sciences vol 195 springer international publishing hiday johnston l howell k 1994 transfers between libration point orbits in the elliptic restricted problem celestial mechanics and dynamical astronomy 58 4 317 337 hirsch mw pugh cc shub m 1977 invariant manifolds lecture notes in mathematics springer berlin doi 10 1007 bfb 0092042 url https cds cern ch record 1690874 huguet g de la llave r sire y 2012 computation of whiskered invariant tori and their associated manifolds new fast algorithms discrete continuous dynamical systems a 32 4 1309 1353 doi 10 3934 dcds 2012 32 1309 url http aimsciences org article id f 497 a 57 f e 25 e 4 dcb abb 5 15 b 091455833 koon ws lo mw marsden je ross sd 2011 dynamical systems the three body problem and space mission design marsden books url http www dept aoe vt edu sdross books kolomaro dmissionbook 2011 04 25 pdf kumar b anderson rl de la llave r 2021 a high order resonant orbit manifold expan sions for mission design in the planar circular restricted 3 body problem communica tions in nonlinear science and numerical simulation 97 105691 doi https doi org 10 1016 j cnsns 2021 105691 url http www sciencedirect com science article pii s 1007570421000022 kumar b anderson rl de la llave r 2021 b using gpus and the parameterization method for rapid search and refinement of connections between tori in periodically perturbed planar circular restricted 3 body problems in aas aiaa space flight mechanics meeting aas 21 349 de la llave r 2001 a tutorial on kam theory in smooth ergodic theory and its appli cations seattle wa 1999 american mathematical society providence ri vol 69 pp 175 292 doi 10 1090 pspum 069 1858536 de la llave r gonza lez a jorba a villanueva j 2005 kam theory without action angle variables nonlinearity 18 2 855 895 doi 10 1088 0951 7715 18 2 020 url https doi org 10 1088 0951 7715 18 2 020 olikara zp 2016 computation of quasi periodic tori and heteroclinic connections in astro dynamics using collocation techniques phd thesis pe rez palau d masdemont jj go mez g 2015 tools to detect structures in dynamical sys tems using jet transport celestial mechanics and dynamical astronomy 123 3 239 262 doi 10 1007 s 10569 015 9634 3 url https doi org 10 1007 s 10569 015 9634 3 rackauckas c nie q 2017 differentialequations jl a performant and feature rich ecosystem for solving differential equations in julia the journal of open research software 5 1 doi 10 5334 jors 151 url https app dimensions ai details publication pub 1085583166 andhttp openresearchsoftware metajnl com articles 10 5334 jors 151 galley 245 download exported from https app dimensions ai on 2019 05 05 rasotto m morselli a wittig a massari m lizia pd armellin r valles c ortega g 2016 differential algebra space toolbox for nonlinear uncertainty propagation in space dynamics in 6 th international conference on astrodynamics tools and techniques icatt url http epubs surrey ac uk 813477 https www worldscientific com doi abs 10 1142 1349 https www worldscientific com doi abs 10 1142 1349 https www worldscientific com doi pdf 10 1142 1349 https www worldscientific com doi pdf 10 1142 1349 https doi org 10 1137 050637327 https www sciencedirect com science article pii s 1007570421001714 https www sciencedirect com science article pii s 1007570421001714 https cds cern ch record 1690874 http aimsciences org article id f 497 a 57 f e 25 e 4 dcb abb 5 15 b 091455833 http aimsciences org article id f 497 a 57 f e 25 e 4 dcb abb 5 15 b 091455833 http www dept aoe vt edu sdross books kolomaro dmissionbook 2011 04 25 pdf http www dept aoe vt edu sdross books kolomaro dmissionbook 2011 04 25 pdf http www sciencedirect com science article pii s 1007570421000022 http www sciencedirect com science article pii s 1007570421000022 https doi org 10 1088 0951 7715 18 2 020 https doi org 10 1088 0951 7715 18 2 020 https doi org 10 1007 s 10569 015 9634 3 https app dimensions ai details publication pub 1085583166 and http openresearchsoftware metajnl com articles 10 5334 jors 151 galley 245 download https app dimensions ai details publication pub 1085583166 and http openresearchsoftware metajnl com articles 10 5334 jors 151 galley 245 download https app dimensions ai details publication pub 1085583166 and http openresearchsoftware metajnl com articles 10 5334 jors 151 galley 245 download http epubs surrey ac uk 813477 computing whiskered tori and their manifolds in periodically perturbed pcrtbp 39 ru ssmann h 1975 on optimal estimates for the solutions of linear partial differential equations of first order with constant coefficients on the torus springer berlin hei delberg berlin heidelberg pp 598 624 doi 10 1007 3 540 07171 7 19 url https doi org 10 1007 3 540 07171 7 19 scheeres d 1998 the restricted hill four body problem with applications to the earth moon sun system celestial mechanics and dynamical astronomy 70 2 75 98 simo c go mez g jorba a masdemont j 1995 the bicircular model near the triangular libration points of the rtbp in from newton to chaos springer pp 343 370 szebehely v 1967 theory of orbits the restricted problem of three bodies academic press inc new york thirring w 1992 a course in mathematical physics walter thirring translated by evans m harrell t 1 and 2 classical dynamical systems and classical field theory 2 nd edn springer new york vaquero m hahn y stumpf p valerino pn wagner sv wong m 2014 cassini maneuver experience for the fourth year of the solstice mission doi 10 2514 6 2014 4348 url https arc aiaa org doi abs 10 2514 6 2014 4348 https arc aiaa org doi pdf 10 2514 6 2014 4348 zhang l de la llave r 2018 transition state theory with quasi periodic forcing communi cations in nonlinear science and numerical simulations 62 229 243 doi 10 1016 j cnsns 2018 02 014 https doi org 10 1007 3 540 07171 7 19 https doi org 10 1007 3 540 07171 7 19 https arc aiaa org doi abs 10 2514 6 2014 4348 https arc aiaa org doi pdf 10 2514 6 2014 4348 https arc aiaa org doi pdf 10 2514 6 2014 4348 1 introduction 2 models and background 3 normally hyperbolic invariant manifolds and existence of tori 4 a parameterization method for computing invariant tori and bundles 5 parameterization method for stable and unstable manifolds 6 globalization regularization and visualization 7 conclusion a proof of vanishing ecc average