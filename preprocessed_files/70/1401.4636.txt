ar x iv 1 40 1 46 36 v 2 m at h o c 2 2 ja n 20 14 dynamic equilibrium limit order book model and optimal execution problem jin ma xinyang wang and jianfeng zhang abstract in this paper we propose a dynamic model of limit order book lob the main feature of our model is that the shape of the lob is determined endogenously by an expected utility function via a competitive equilibrium argument assuming zero resilience the resulting equilibrium density of the lob is random nonlinear and time inhomogeneous consequently the liquidity cost can be defined dynamically in a natural way we next study an optimal execution problem in our model we verify that the value func tion satisfies the dynamic programming principle and is a viscosity solution to the correspond ing hamilton jacobi bellman equation which is in the form of an integro partial differential quasi variational inequality we also prove the existence and analyze the structure of the optimal strategy via a verification theorem argument assuming that the pde has a classical solution keywords limit order book liquidity risk optimal execution dynamic programming principle viscosity solution verification theorem 2000 ams mathematics subject classification 91 b 51 70 93 e 03 20 department of mathematics university of southern california los angeles ca 90089 e mail jinma usc edu this author is supported in part by nsf grant 1106853 institutional equity division morgan stanley new york ny 10036 email xinyang bryan wang gmail com department of mathematics university of southern california los angeles ca 90089 e mail jian fenz usc edu this author is supported in part by nsf grant 1008873 1 http arxiv org abs 1401 4636 v 2 1 introduction the effect of the liquidity of a security asset both short term and long term has been noticed by practitioners and researchers alike for quite some time tremendous efforts have been made in modeling the liquidity costs as well as its impact on the security prices see e g 4 2 8 15 to mention a few in a frictionless market model black scholes framework for example one assumes that the securities can be bought or sold at a quote price regardless of the trade size and the actual availability of the securities but this is far from being realistic in practice the parity between the supply and demand often causes the actual trade price to deviate from the fundamental price leading to the bid ask spread as a consequence some extra cost has to be paid in actual trading especially when the volume of the trade is relatively large compared to the existing liquidity on the market unlike the quote driven market models in which a market maker sets the price upon which all the trades are made an order driven market model is one that reflects more of the reality in such a model both buyers and sellers are allowed to be patient in the sense that they submit the orders containing the amount of the shares and the prices at which they are willing to buy or sell these orders are called limit orders unlike the market orders which are executed immediately at the market price whenever there is sufficient liquidity the limit orders are executed only when an opposite order with the matching price comes in obviously limit orders are usually not executed immediately a limit order book lob is thus formed intuitively a reasonable model of an lob must contain the following basic elements i the best ask bid price the frontier of the sell buy lob ii the shape of the lob the volumes of the orders at each price there have been many papers in the literature trying to model and analyze the movement of the lob cf e g 11 13 14 16 and the references cited therein as well as the optimal execution liquidation problems in which a large trader needs to acquire liquidate a certain amount of stocks in a given time horizon with the minimal cost see e g 3 12 15 apart from the usual factors such as the fundamental price or mid price and the liquidity often refer to the total amount of shares available for trading an important characteristic of an lob is its shape that is the density function of the lob this is particularly the case when the liquidity cost is among the main concerns however in most of the existing works the shape of the lob is assumed to be exogenously given either in the simple block shaped cf e g 4 15 or in a general given shape that is supposed to be determined by empirical studies cf e g 3 2 17 and the references cited therein however such an assumption obviously lacks the ability to adapt to the changes of market movement especially when the underlying price is volatile within the 2 concerned time horizon a more ideal model would be such that the shape of the lob could be determined endogenously through some more basic market factors such as the bid ask spread the fundamental prices the mid price for example and the market liquidity this paper is an attempt in this direction to simplify the argument in this paper we shall consider only the sell side of the lob namely we assume that all the buyers are impatient in the sense that they only submit the market orders so there is no buy side lob our first objective is to develop a dynamic model for the lob whose shape is determined via the movement of the fundamental price the instantaneous trading size as well as the liquidity the guiding principle of our model comes from the idea of equilibrium distribution initiated by rosu 16 roughly speaking we assume that there exists a competitive equilibrium among all the prices in the lob the existence of such an equilibrium can be heuristically justified as a balance between the expected sell price and the cost of waiting for the order to be executed the equilibrium could be affected by the fundamental price the execution of orders and the arrival of the new orders etc and when an existing equilibrium is broken every seller in lob will reposition until an equilibrium is reached it should be noted that this equilibrium is competitive in the sense that one trader s deviation will be stopped by others immediate undercutting in other words when the market is under monopoly we should allow the distribution to behave differently in this paper we assume that the time of reaching new equilibrium is negligible that is the impact has zero duration or zero resilience for simplicity we should note however that the issue of resilience is interesting in its own right see e g 4 and also 1 2 but this is not the main purpose of this paper mathematically we shall assume that the equilibrium density process takes the form t t xt qt y y p 0 where p 0 is the lowest selling price x is the fundamental value of the asset and q is the total volume of the lob we also assume that the equilibrium is quantified by a common expected utility on each price which depends on the fundamental price and the total liquidity and is denoted by u x q our main premise is that after each trade with size 0 q the following two identities must hold p p 0 x q y dy 1 p p 0 y x q y dy u x q 1 1 here the first equality is self evident p p x q p 0 is the price in lob at which the accumulated volume of sell limit orders between p 0 and p is exactly equal to whereas the second equality means that the average price sold should be equal to u x q the expected utility for the remaining lob a more detailed argument will be given in 3 using the equations in 1 1 we will be able to solve explicitly the process in terms of u and from which we will define the liquidity cost and argue that modulo a term that is of order 2 where is the trading 3 size it is linear although time inhomogeneous in more importantly once we obtain the density function of the lob we can then evaluate the liquidity cost we show that under mild technical conditions the average price including liquidity cost exactly coincides with the supply curve in sense of cetin jarrow protter 8 our second goal of this paper is to consider an optimal execution problem that is finding an optimal strategy of purchasing a large block of shares within a prescribed time duration 0 t with a minimum cost such a problem has been studied by many authors cf e g 2 4 6 17 and the references cited therein but with the endogenously given shape of lob our problem seems to be new we shall consider only two types of actions the buying action of the large investor self and an aggregated action of all the other investors which is modeled as a compound poisson process representing all incoming limit sell orders canceled orders and the market buy orders in other words without the buying action of the investor whose accumulated purchase will be described by an increasing process the movement of the total available shares in the lob is a continuous time pure jump process we then show that the bellman principle of dynamic programming holds in this case and the value function is a viscosity solution of the resulting hjb quasi variational inequality qvi finally in the case that the qvi has a classical solution we shall analyze the optimal strategy by proving a verification theorem it is noted that the continuous or inaction region in our model may not be simply connected and as a consequence the optimal strategy may contain multiple even infinitely many jumps the rest of the paper is organized as follows in 2 we give the necessary technical background and describe the basic elements of the model in 3 we introduce the notion of equilibrium dis tribution and analyze some important quantities that can be derived endogenously from such distribution these in particular include bid ask spread and the liquidity cost that play the fun damental role in our optimal execution problem in 4 we introduce the optimal execution problem and study its various equivalent expressions in 5 and 6 we prove the dynamic programming principle derive the hjb equation and prove that the value function is a viscosity solution to the corresponding hjb equation finally 7 is devoted to the construction of an optimal strategy in the case that the hjb equation has a classical solution 2 preliminaries throughout this paper we assume that all the randomness comes from a complete probability space f p on which are defined a standard brownian motion w wt t 0 and a standard poisson process n nt 0 with intensity in what follows the brownian motion w represents the market noise that drives the fundamental value or mid price of the underlying 4 stock and the poisson process n represents the frequency of the incoming limit orders therefore it is reasonable to assume that w and n are independent we shall denote fw fwt t 0 and fn fnt t 0 to be the natural filtration generated by w and n respectively throughout the paper we denote 0 0 and let 0 1 2 be the jump times of n we consider a finite time horizon 0 t for simplicity we assume that there is only one stock traded in an order driven market and the interest rate is 0 we first give the mathematical description of the basic elements involved in our model 1 fundamental price we assume that the underlying stock has a fundamental value or mid price which is known to the public but the market price deviates away from it due to the possible illiquidity which leads to the bid ask spread since the fundamental value only affects our model as a source of randomness we simply assume that it is a diffusion and satisfies the following stochastic differential equation sde xt x t 0 b s xs ds t 0 s xs dws t 0 2 1 where b and satisfy the following standing assumptions h 1 i b and are deterministic functions continuous in t and uniformly lipschitz continuous in x with a common uniform lipschitz constant l 0 ii x 0 t 0 0 and b t 0 0 remark 2 1 it is clear that the assumption h 1 guarantees the well posedness of the the sde 2 1 and solution satisfies xt 0 for all t 0 p a s the continuity of b and in t is mainly for the viscosity property of the value function in 6 below for notational simplicity in this paper we assume w is 1 dimensional but all the results can be extended to higher dimensional case moreover we may even allow b and to be random and all the results in 4 and 5 will still hold true after obvious modification however in this case the hjb equation in section 6 will become a backward stochastic pde and the associated path dependent pde we refer to 10 for the related theory 2 the limit order book lob we assume that there are patient and impatient investors in the market and they put different bid and or ask prices to either liquidate or purchase the given stock based on their preferences see 3 for more discussion on this since in this paper we consider the optimal execution problem for purchasing the stock only the sell side lob will be relevant we thus assume in what follows that all the buyers are impatient and only make market orders i e buying whatever is available on the market and consequently there is no 5 buy side lob moreover we isolate one particular investor referred as the investor who will carry out the optimal execution problem later we shall assume that the movement of the lob depends solely on the investment activities namely the investor herself and all other investors buyers and sellers for simplicity we assume that the activities of other investors are aggregated as a large investor whose investment activities is described by a compound poisson process yt nt i 1 i t 0 where i i 1 is a sequence of i i d random variables with distribution we shall assume e i we should note that the large investor is allowed to make both buy and sell limit orders and market orders and can also cancel orders thus i s will take values in r i e yt 0 is possible it is useful to introduce the following filtration f fw fy fwt fyt t 0 which will be the basic information source allowed in our execution problem we notice that fn fy f 3 the inventory process we assume that the investor is trying to purchase a certain number say k shares of the given stock within a given time horizon 0 t and denote the accumulated number of shares up to time t 0 t by t then clearly t t 0 is an increasing process and we assume that it is f predictable note that with this assumption all the jumps times of is predictable and consequently i y i 0 since all jump times of n and of y are totally inaccessible in fact for practical reason we could and will assume that n and y have ca dla g paths but is ca gla d and then naturally we have t yt t t yt yt 0 t 0 t p a s note that with such a definition the investor can observe the jump of y and immediately jump afterwards clearly each particular realization of could be considered as an execution strategy we thus define a is f predictable non decreasing has ca gla d paths and t k 2 2 we can now describe the dynamics of the total number of shares of the stock in the sell lob denoted by q qt t 0 t we shall consider in this paper the simplest case in which the dynamics of q can be affected by only two factors the order made by the investor herself and the orders made by the other large investor or the aggregated action by all other market participants y then it is readily seen that for a given strategy a and initial inventory q the movement of q q q is determined by q 0 q and q t q i t i for t i i 1 q i 1 q i 1 y i 1 2 3 6 remark 2 2 i q is ca gla d in each i i 1 however at i 1 q can have left and or right jumps so q has both left and right limits but in general it is neither left continuous nor right continuous on 0 t ii when is continuous which will be the case in most of the paper q is ca dla g we note from 2 3 that q i 1 0 this is a natural constraint since the volume of the lob can never be negative however not all a will guarantee that the corresponding q t 0 for all t 0 t we thus consider the following admissible strategies given q 0 aad q a q qt 0 for all t 0 t p a s where q q is defined by 2 3 2 4 throughout the paper we shall denote r 0 r 0 o r 0 k r o r 0 k r 2 5 we remark that we do not take the closure for the first r in o 3 equilibrium distribution in this section we introduce the notion of equilibrium density of the lob one of the most important ingredients in our model our idea follows from that of rosu s 16 which we now describe we assume that every seller comes into the market with the same amount of information this is different from the asymmetric information assumptions cf 5 each seller sets his her ask price based on the personal preference which is the combination of the expected return of the order and the possible lost value or cost due to say the waiting time for the order to be executed in an equilibrium we assume that every seller will have the same expected return or expected utility of the order which we denote by u x q where x is the fundamental value of the stock and q is the total number shares available the existence of such equilibrium could be argued as follows suppose two sellers do not believe that they have the same expected return then one of them usually the one with lower expected return is going to cancel his her limit order and resubmit it to the market with a different ask price in exchange for a higher expected return then every seller in the market will do the same until an equilibrium is reached we should point out that such an equilibrium approach only works when there is sufficient competition in the market in fact when the market is under monopoly we should not expect the distribution to behave like this given the expected return u x q we now introduce the concept of equilibrium density recall that the density function of an lob is a non negative function y 0 y 0 such that 7 y 0 for y p 0 where p 0 x is the lowest best ask price and that p 0 y dy q 3 1 we note that if y p 0 y p 0 q is a constant then the lob is said to have a block shape see e g 4 and 15 another way to study the problem is to assume the shape of the lob is given exogenously see e g 2 17 our main idea is to show that the shape function is determined by the following simple facts assume that a large market buy order comes in and shares of the stock were purchased where 0 q we assume that the lowest portion of shares in the lob is consumed thus if we denote p 0 p 0 x q to be the lowest ask price then we can find p p 0 such that p p 0 y dy 3 2 on the other hand we assume that in equilibrium the average price of the sold block should have the same expected return of the remaining orders in the lob which has a total of q shares after the purchase in other words we assume that for any that 0 q 1 p p 0 y y dy u x q 3 3 now taking derivative with respect to in 3 2 and 3 3 we obtain p p 1 p p p u x q u x 2 x q 3 4 solving two equations in 3 4 we have p u x q u q x q 3 5 p 1 p 2 u q 2 x q 2 u q x q 1 3 6 we note that by setting 0 in 3 5 p 0 x q u x q 3 7 that is the frontier of the lob is exactly the representative of the equilibrium as expected on the other hand since the function 7 p is obviously non decreasing we can assume further that it is invertible and denote h y p 1 y then 3 6 becomes y 1 p h y h y 2 u q 2 x q h y 2 u q x q h y 1 3 8 8 namely the equilibrium density x q can be explicitly derived as long as u x q is given we should remark here that the modeling of the expected return function u x q is itself an interesting and challenging problem for example in 16 such an expected return function was obtained explicitly by solving a recursive difference equation also in a slightly different setting the relationship between the bid ask spread and the liquidity was considered by avellaneda stoikov 5 in which an argument of indifference pricing was applied to construct the return function u in what follow we shall assume the existence of such a function u and furthermore based on the discussion above we make the following assumptions h 2 the expected utility function u r r 7 r enjoys the following properties i u is non decreasing in x and qu u q 0 2 qu 2 u q 2 0 ii u is uniformly lipschitz continuous in x q with lipschitz constant l 0 remark 3 1 i by 3 6 the properties of u in q guarantees that p 0 for all 0 q which leads further to the existence of its inverse so that the formula 3 8 makes sense moreover by 3 7 we see that the function p 0 p 0 x q is uniform lipschitz for x q r r this fact will be frequently used in our discussion ii h 2 obviously does not render the function u a true utility function in either variable in fact the assumption h 2 i which guarantees the positivity of the density function see 3 6 implies that it is decreasing and convex in q hence a cost function on q in a usual sense of course it would be reasonable to assume that u is concave in x hence a utility on the price but we do not need such an assumption in the rest of our discussion iii in practice it is natural to assume further that u x q x or limq u x q x the latter implies that the liquidity premium vanishes as the supply goes to infinity but technically we do not need them in this paper we conclude this section by observing that given the density function x q the cost for buying shares of stock can be easily calculated as c x q p p 0 y x q y dy u x q 3 9 where the last equality is due to 3 3 from this we obtain that liquidity cost c x q x p 0 x p p 0 y p 0 x q y dy 3 10 9 clearly we can see that the liquidity cost consists of a linear part with respect to the trade size due to the bid ask spread and a higher order part that is determined by the shape of the lob more precisely assume for example p then we can easily derive from 3 10 that c x q p 0 o 2 3 11 in particular if we consider a purchase strategy t then 3 11 amounts to saying that c xt q t t p 0 t o t 2 consequently for a continuous strategy c ct t 0 t the following calculation of the total cost will be useful in the rest of the paper t 0 c xs q c s d c s t 0 p 0 xs q c s d c s t 0 u xs q c s d c s 3 12 remark 3 2 the following obversion is worth noting assume that the function u is sufficiently regular then by 3 3 we see that for each 0 q the process of average price of the stock counting liquidity cost defined by s t 1 c xt qt u xt qt t 0 is a semi martingale furthermore the assumption h 2 implies that it is convex and increasing with respect to the trade size in other words the process s is exactly the supply curve in the sense of cetin jarrow protter 8 4 optimal execution problem we are now ready to introduce the main objective of the paper the optimal execution problem consider the scenario when an investor would like to purchase k shares of the stock within a prescribed time duration 0 t given initial inventory q 0 and a purchase strategy aad q we consider the following cost functional j e 0 s t c xs q s s t 0 u xs q s d c s g xt k t 4 1 where c denotes the continuous part of and g r 0 k r is the terminal penalty function clearly the first term is the cost for the jump part of and the second term is the cost of the continuous part of the value function is thus v 0 v 0 q inf aad q j 4 2 we shall assume that the terminal penalty function g satisfies the following assumption 10 h 3 i g is uniformly lipschitz continuous in x y with lipschitz constant l 0 ii for fixed x g is increasing and convex in y moreover g x 0 0 and g x y u x 0 y remark 4 1 in the case t k one is forced to purchase the remaining amount of shares y k t at time t regardless the liquidity the terminal penalty g x y u x 0 y for y 0 amounts to saying that this price would be more expensive than the highest market price u x 0 the price with zero liquidity furthermore by h 3 ii we see that g x y g x y u x 0 y y for 0 y y therefor if the final inventory is q and the investor needs to purchase a total of y shares but decides to buy 0 y y q from lob right before t and buys the remaining y y using the penalty price then his total cost would be recall 3 9 c x q y g x y y u x q y y g x y y u x 0 y g x y y g x y this again shows that it is disadvantageous to purchase everything at the terminal time we now introduce two alternative expressions for v 0 to facilitate the future discussion first we define the set of continuous strategies by a c ad q aad q t 7 t is continuous p a s 4 3 clearly if a c ad q then q is ca dla g and c xt q t t 0 we thus define j 0 e t 0 u xs q s d s g xt k t aad q v 00 inf a c ad q j 0 4 4 next recall that p 0 x q u x q is decreasing in q thus for 0 q it holds that c x q u x q 0 u x q du 0 u x q u du d x q 4 5 we now replace c by d in 4 1 and define j 1 e 0 s t d xs q s s t 0 u xs q s d c s g xt k t aad q v 10 inf aad q j 1 4 6 we note that since a cad q aad q it follows from 4 5 that v 10 v 0 v 00 our main observation is that the cost d x q can actually be approximated by continuous strategies thus these inequalities should all be equalities we substantiate this in the following theorem 11 theorem 4 2 assume h 1 h 3 then it holds that v 00 v 0 v 1 0 proof since v 10 v 0 v 00 holds by definitions we need only show that v 00 v 10 to this end we fix arbitrary aad q and 0 we claim that v 00 j 1 4 7 indeed for each m n define m 0 0 and mi 1 inf t mi t 1 m t i 0 1 since has right limits and the filtration f is right continuous we see that mi are f stopping times mi m i 1 and mi 1 m whenever mi t define ms c s m 2 i 1 m i 1 m i s s 0 t 4 8 clearly m c c and m this implies that q m q and thus m aad q moreover since m 2 i 1 mi m on m m 2 t we see that lim p mm 2 t 0 consequently limm m t t for all now by the monotonicity of u and 4 5 we have t 0 u xs q m s d m cs t 0 u xs q s d c s 0 s t d xs q m s m s 0 s t d xs q s m s m 2 i 1 d x m i q m i m i 0 s t d xs q s s furthermore since obviously one has limm g xt k mt g xt k t we conclude that limm j 1 m j 1 and thus there exists m such that j 1 m j 1 2 4 9 next recall again that s ns 0 and thus i 6 mj p a s for all i j let 0 be a small number for each i 1 m 2 let ji be the smallest j such that j mi we remark that ji is random and ji is still an f stopping time define m recursively as follows first m s c s for 0 s m 1 for i 1 m 2 denote m i mi mi 1 ji and define m s m m i cs c m i s m i mi m i s mi mi 1 4 10 where we abuse the notation that m m 2 1 t it is clear that m is continuous and m m this implies that m a c ad q note that by changing variable u mi s mi we have d x q 0 u x q u du m i m i u x q s mi ds 12 on the other hand it is not hard to check that for s mi m i it holds that q m s q m m i cs c m i s m i m i q m i cs c m i s m i m i and that lim 0 p m i mi 1 thus we have lim 0 m t t p a s now by the monotonicity of u again and applying the dominated convergence theorm j 0 m j 1 m e t 0 u xs q m s u xs q s d cs g xt k m t g xt k t m 2 i 1 m i m i m i u xs q m s ds d x m i q m i m i e g xt k m t g xt k t m 2 i 1 m i m i m i p 0 xs q m i cs c m i m i s mi p 0 x m i q m i m i s mi ds le m t t t m 2 i 1 m i m i xs x m i cs c m i ds 0 as 0 setting 0 small enough such that j 0 m j 1 m 2 by 4 9 and recalling that m a cad q we prove 4 7 whence the theorem we conclude this section with a dynamic version of the value function v let t x k q 0 t o recall 2 5 and let xt x be the solution to 2 1 on t t with xt x a s denote a t k is f predictable ca gla d non decreasing t k and t k denote t 0 t and t i i 1 being the jump times of n on t t for any a t k let q s q t i s t i for s ti ti 1 q t q q t i 1 q t i 1 y t i 1 i 1 4 11 and define aad t k q a t k q qs 0 s t t p a s a c ad t k q aad t x q is continuous p a s 4 12 by theorem 4 2 we now define the dynamic value function v via two equivalent expressions v t x k q inf a c ad t k q j 0 t x k q inf aad t k q j 1 t x k q 4 13 13 where j 0 t x k q e t t u xt xs q s d s g x t x t k t 4 14 j 1 t x k q e t s t d xt xs q s s t t u xt xs q s d c s g x t x t k t remark 4 3 i we note that the cost functional j 0 t x k q in 4 14 uses only continuous strategies it will facilitate the argument when we prove that the value function v is a viscosity solution to the hjb equation in 5 and 6 ii the cost functional j 1 t x k q will be useful when we investigate the existence of optimal strategy in 7 recall from theorem 4 2 the inequality v 00 v 0 v 10 thus an optimal strategy if exists should also optimize j 1 however it is worth noting that cost function d does not have a practical meaning as opposed to the cost function c and in practice it cannot be implemented directly nevertheless combining the approximations 4 8 and 4 10 in the proof of theorem 4 2 we will be able to find an implementable good approximation of optimal strategy as we shall see in 7 5 dynamic programming principle in this section we verify some properties of the value function v and establish the dynamic programming principle dpp as we pointed out in remark 4 3 i we shall consider the cost functional j 0 we begin by the regularity of v with respect to the spatial variables x k and q respectively proposition 5 1 assume h 1 h 3 then for each t 0 t the value function v t x k q is non decreasing x non increasing in k and q respectively and uniformly lipschitz continuous with respect to x k q o proof we first check the properties in x assume x 1 x 2 then by the comparison theorem of sde we have x t x 1 s xt x 2 s for all t s t p a s since both u and g are non decreasing and uniformly lipschitz continuous in x for any a c ad t k q we see that 0 j 0 t x 2 k q j 0 t x 1 k q 5 1 e t t u xt x 2 s q s u xt x 1 s q s d cs g x t x 2 t k t g xt x 1 t k t ce max s t t xt x 2 s xt x 1 s c x 2 x 1 14 switching the role of x 1 and x 2 we can easily deduce the lipschitz property in x v t x 2 k q v t x 1 k q c x 2 x 1 x 1 x 2 r 5 2 we next check the properties in k let 0 k 1 k 2 k for any a cad t k 1 q consider the strategy s k 2 s k 1 k s t t clearly a cad t k 2 q and it satisfies t t d s d s s t t consequently we have q q q q j 0 t x k 2 q j 0 t x k 1 q and thus v t x k 2 q v t x k 1 q on the other hand for any strategy a cad t k 2 q let k 2 k 1 a cad t k 1 q then q q q q and thus j 0 t x k 1 q j 0 t x k 2 q e g x t x t k t g x t x t k t c k 2 k 1 5 3 similar to 5 2 this implies the uniform lipschitz continuity of v in k it remains to prove the lipschitz property in q as before we first assume 0 q 1 q 2 it is clear that a cad t k q 1 a cad t k q 2 and for any a cad t k q 1 we have q q 1 s q q 2 s then j 0 t x k q 1 j 0 t x k q 2 for all a cad t k q 1 5 4 which leads to v t x k q 1 v t x k q 2 on the other hand note that 0 k a cad t k q 1 for any a c ad t k q 2 denote q q q 2 qk q 1 and inf s t qs 0 t recall 4 11 by induction on i one deduce easily that q is non increasing on t then t i 0 t i 1 t i 1 t i i 0 q t i q t i 1 1 t i qt q qt q 2 q 1 5 5 now define s 0 s 1 t s s 1 t since is continuous and 0 k by 4 11 we see that q 0 as t then q q 1 s q k q 1 s q q 2 s s t and q q 1 s q q 2 s s t namely a c ad t k q 1 moreover 5 5 implies that 0 t t t q 2 q 1 then j 0 t x k q 1 j 0 t x k q 2 e t u xt xs q q 2 s d s g x t x t k t g x t x t k t ce t t c q 2 q 1 since a cad t k q 2 is arbitrary we obtain v t x k q 1 v t x k q 2 c q 2 q 1 reversing the role of q 1 and q 2 we obtain the lipschitz property of v in q proving the proposition we can now follow the standard arguments in the literature to establish the following simpler from of dynamic programming principle when the time increments are deterministic 15 proposition 5 2 assume h 1 h 3 then for any 0 t 1 t 2 t and x k q o v t 1 x k q inf a c ad t 1 k q e t 2 t 1 u xt 1 xs q q s d s v t 2 x t 1 x t 2 t 2 q q t 2 5 6 proof let v t 1 x k q denote the right side of 5 6 we first show that v t 1 x k q v t 1 x k q indeed for any a cad t 1 k q let denote the restriction of on t 2 t then x t 2 x t 1 x t 2 s x t 1 x s q q q t 2 s q q s for s t 2 t in other words a cad t 2 t 2 q q t 2 this implies that j 0 t 1 x k q e t t 1 u xt 1 xs q q s d s g x t 1 x t k t e t 2 t 1 u xt 1 xs q q s d s e t t 2 u x t 2 x t 1 x t 2 q q q t 2 s d s g x t 2 x t 1 x t 2 t k t ft 2 e t 2 t 1 u xt 1 xs q q s d s j 0 t 2 x t 1 x t 2 t 2 q q t 2 e t 2 t 1 u xt 1 xs q q s d s v t 2 x t 1 x t 2 t 2 q q t 2 we remark that in the above the last equality can be proved rigorously by using the notion of regular conditional probability distribution since the argument would be rather lengthy but more or less standard we omit the details now take infimum over a c ad t 1 k q on both sides of above we obtain v t 1 x k q v t 1 x k q to prove the opposite inequality we first fix 0 and consider a countable partition oi i 1 of o and xi ki qi oi i 1 2 such that for any x k q oi it holds that x xi ki k ki and qi q qi now for each i choose i a cad t 2 ki qi such that j 0 t 2 xi ki qi i v t 2 xi ki qi for any x k q oi note that i ki k a cad t 2 k qi a cad t 2 k q then by 5 1 5 3 5 4 and applying proposition 5 1 for a generic constant c we have j 0 t 2 x k q i ki k j 0 t 2 xi ki q i c j 0 t 2 xi ki qi i c v t 2 xi ki qi c v t 2 x k q c 5 7 now for any a c ad t 1 k q define a new strategy s s 1 t 1 t 2 s i is ki t 2 1 di x t 1 x t 2 t 2 q q t 2 1 t 2 t s it is clear that t 1 k is continuous and non decreasing on t t and t it k on each oi moreover q q s q q s 0 for s t 1 t 2 and for s t 2 t on oi we have q qs q i q q t 2 s q i qi s 0 16 thus a cad t 1 k q and therefore it follows from 5 7 that v t 1 x k q j 0 t 1 x k q e t 2 t 1 u xt 1 xs q q s d s e t t 2 u xt 1 xs q q s d s g x t 1 x t k t ft 2 e t 2 t 1 u xt 1 xs q q s d s j 0 t 2 x t 1 x t 2 t 2 q q t 2 e t 2 t 1 u xt 1 xs q q s d s i j 0 t 2 x t 1 x t 2 t 2 q q t 2 i ki t 2 1 di x t 1 x t 2 t 2 q q t 2 e t 2 t 1 u xt 1 xs q q s d s v t 2 x t 1 x t 2 t 2 q q t 2 c now since 0 is arbitrary and a cad t 1 k q we conclude that v t 1 x k q v t 1 x k q proving the proposition as a corollary of proposition 5 2 we shall prove the temporal regularity of v we note that this will be a crucial step towards the general form of dynamical programming principle corollary 5 3 assume h 1 h 3 then for any 0 t 1 t 2 t and x k q o we have v t 1 x k q v t 2 x q c 1 x t 2 t 1 5 8 proof first note that the constant process k a c ad t 1 k q then by propositions 5 2 and 5 1 v t 1 x k q v t 2 x k q e v t 2 xt 1 xt 2 k q k q t 2 v t 2 x k q ce xt 1 xt 2 x q k q t 2 q next recall from 2 that the dynamics of q see 2 3 is driven by the compound poisson process y whose jump size i s and the jump times i s are independent then one can easily check e xt 1 xt 2 x e t 2 t 1 b s xt 1 xs ds t 2 t 1 s xt 1 xs dws c 1 x t 2 t 1 e qk qt 2 q e i 1 i 1 t 1 i t 2 i 1 e i e 1 t 1 i t 2 5 9 e 1 e i 1 1 t 1 i t 2 e 1 e nt 2 nt 1 e 1 t 2 t 1 consequently we obtain v t 1 x k q v t 2 x k q c 1 x t 2 t 1 5 10 17 on the other hand since u 0 and v is decreasing in q v t 2 x k q v t 1 x q v t 2 x k q inf a c ad t 1 k q e v t 2 x t 1 x t 2 t 2 q q t 2 sup a c ad t 1 k q e v t 2 x k q v t 2 xt 1 xt 2 t 2 q q t 2 c sup a c ad t 1 k q e xt 1 xt 2 x q q t 2 q ce xt 1 xt 2 x q k q t 2 q c 1 x t 2 t 1 where the last inequality is due to 5 9 this together with 5 10 leads to 5 8 to conclude this section we give a general version of the dynamic programming principle denote tt to be all the f stopping times taking values in t t theorem 5 4 assume h 1 h 3 then for any t x k q 0 t o and any tt v t x k q inf a c ad t k q e t u xt xs q q s d s v x t x q q 5 11 proof for each a c ad t k q and tt denote i be the expectation on the right side of 5 11 following the arguments in proposition 5 2 one can easily show that v t x k q inf a c ad t k q i so it suffices to prove the reversed inequality v t x k q inf a c ad t k q i 5 12 we first assume that tt takes only finitely many values t t 1 tm t we prove 5 12 by induction on m when m 1 5 12 follows from proposition 5 2 now assume that 5 12 holds for m 1 and that takes m values for any a cad t k q we have i e t 1 t u xt xs q q s d s v t 1 x t x t 1 t 1 q q t 1 1 t 1 t 1 u xt xs q q s d s v x t x q q 1 t 1 note that t 1 ft 1 and takes only m 1 values on t 1 by inductional hypothesis we have i e t 1 t u xt xs q q s d s v t 1 x t x t 1 t 1 q q t 1 1 t 1 e t 1 u xt xs q q s d s v x t x q q ft 1 1 t 1 e t 1 t u xt xs q q s d s v t 1 x t x t 1 t 1 q q t 1 1 t 1 v t 1 x t x t 1 t 1 q q t 1 1 t 1 e t 1 t u xt xs q q s d s v t 1 x t x t 1 t 1 q q t 1 v t x k q 18 where the last inequality is due to proposition 5 2 since a cad t k q is arbitrary we proved 5 12 for m completing the induction to prove 5 12 for arbitrary tt we first find n tt n 1 2 such that n 1 n and n as n by previous arguments we see that 5 12 holds for each n that is v t x k q i n for each a cad t k q moreover by definition of i we have i n i e n u xt xs q q s d s v n x t x n n q q n v xt x q q applying corollary 5 3 and noting that is continuous we see that the right hand side above converges to 0 as n consequently we obtain that v t x k q i for each a c ad t k q this implies 5 12 and hence concludes the proof remark 5 5 combining theorems 5 4 and 4 2 we have the following alternative version of dynamic programming principle corresponding to the cost functional j 1 defined in 4 13 v t x k q inf aad t k q e t u xs q s d c s t s d xs q s s v x q q 5 13 6 the hjb equation in this section we shall prove that the value function while not necessarily smooth is a viscosity solution of the hamilton jacobi bellman equation of the optimal execution problem we begin by introducing some notations for simplicity we often use the equivalent notations for partial derivatives t t the notations x k q and xx are thus obvious in this and next section we denote by c 1 2 b 0 t o the set of continuous functions on 0 t o such that the partial derivatives t x k q and xx exist and are continuous and bounded for each t 0 t we introduce a new filtration f t f ts s 0 fws fys t s 0 6 1 moreover in light of the cost functional j 1 in 4 13 and the dpp 5 13 we define for each t x k q 0 t o aad t x k q c 0 t o and f stopping time i e t u xs q s d c s t s d xs q s s x q t x k q 6 2 next we let t 1 be the first jump time of n after t and is the common distribution of the jump size random variables i s we remark here that by definition 6 1 it is clear that t 1 y t 1 is independent of f t and hence t 1 is not an f t stopping time furthermore we have the following result that is important for our discussion 19 lemma 6 1 for any fixed t k q and any aad t k q there exists an f t adapted process such that s t 1 s t 1 for all s t p a s proof we first note that since is left continuous we need only find a f t adapted process such that for any fixed s t p s 1 t 1 s s 1 t 1 s 1 this amounts to saying that given s t and x l 0 fs there exists x l 0 f ts such that x 1 t 1 s x 1 t 1 s lp a s but this last statement is more or less standard see e g 7 we nevertheless give a brief proof for completeness we fix s t and denote hs x l 0 fs x l 0 f ts such that x 1 t 1 s x 1 t 1 s lp a s clearly hs l 0 fs we claim that hs l 0 fs indeed note that fs f ts yr t r s by a simple monotone class argument for any x l 0 fs we need only assume either x l 0 f ts or x yr for some r t s but in the former case we can choose x x and in the latter case we choose x yt since in both cases x l 0 f ts we conclude that x hs this proves the claim whence the lemma now for any c 1 2 b 0 t o we introduce the following integro differential operators l t x k q t b x 1 2 2 xx t x k q r t x k q u t x k q du 6 3 m t x k q u x q k q t x k q the following lemma is crucial lemma 6 2 assume c 1 2 b 0 t o and is an ft stopping time then it holds that i t 1 e t 1 t l s xs s q s ds t 1 t m s xs s q s d c s t s t 1 s 0 m s xs s u q s u du 6 4 where l and m are defined by 6 3 proof for any ft stopping time we denote t 1 let aad t k q and let be the ft adapted version of defined in lemma 6 1 and define q s q s k s t then it is readily seen that q t 1 q t 1 y t 1 and thus x q t x k q x q t x k q 6 5 t 1 x t 1 t 1 q t 1 y t 1 t 1 x t 1 t 1 q t 1 1 t 1 20 since x q t 1 y t 1 are independent we have e t 1 x t 1 t 1 q t 1 y t 1 t 1 x t 1 t 1 q t 1 1 t 1 e t e s t ds r s xs s q s u s xs s q s du 6 6 e t 1 t 1 s r s xs s q s u s xs s q s du ds e t r s xs s q s u s xs s q s du ds here we used the fact that q s q s t s furthermore applying ito s formula we have e x q t x k q e t t b x 1 2 2 xx s xs s q s ds t k q s xs s q s d c s t s s 0 k q s xs s u q s u du 6 7 plugging 6 6 6 7 into 6 5 and then plugging 6 5 4 5 into 6 2 we obtain 6 4 it is worth noting that if we use the continuous strategy a cad t x k q then 6 2 and 6 4 become i e t u xs q s d s x q t x k q 6 8 e t l s xs s q s ds t m s xs s q s d s 6 9 respectively clearly 6 8 is valid even when is not smooth in fact by theorem 5 4 we have 0 inf a c ad t x k q i v 6 10 furthermore if v c 1 2 b 0 t o then we may plug 6 9 into 6 10 and deduce the following quasi variational inequality qvi min l v m v t x k q 0 t x k q 0 t o 6 11 with the terminal boundary conditions v t x k q g x k k v t x k q 0 l v t x k 0 0 6 12 as we will see in next section in this case v is indeed the unique classical solution of the qvi 6 11 and 6 12 21 in general however v may not be smooth we thus need to make use of the notion of the viscosity solution to this end let us denote for t x k q 0 t r 0 k r a t x k q c 1 2 b 0 t o v t x k q 0 a t x k q a t x k q v attains a global maximum at t x k q 6 13 a t x k q a t x k q v attains a global minimum at t x k q definition 6 3 a continuous function v 0 t o 7 r is called a viscosity subsolution resp supersolution to the qvi 6 11 6 12 if i v t x k q resp g x k k and v t x k q 0 resp 0 ii for any t x k q 0 t o and a t x k q resp a t x k q one has min l m t x k q 0 resp 0 iii for any t x k 0 t r 0 k and a t x k 0 resp a t x k 0 one has l t x k 0 0 resp 0 moreover v is called a viscosity solution if it is both a viscosity subsolution and supersolution our main result of this section is the following theorem theorem 6 4 assume h 1 h 3 then the value function v of the optimal execution problem is a viscosity solution of the qvi 6 11 6 12 proof the terminal condition v t x k q g x k k is obvious moreover note that if t k then s k for all s t t as there is no need to purchase any more thus d s 0 for s t t and clearly g xt k t g xt 0 0 that is v t x k q 0 so definition 6 3 i holds with equalities and thus it suffices to check definition 6 3 ii and iii we first prove the viscosity subsolution properties it suffices to show that for any t x k q 0 t r 0 k r and a t x k q l t x k q 0 for q 0 m t x k q 0 for q 0 6 14 in what follows we denote for 0 small t t 1 and let c 0 be a generic constant that is allowed to vary from line to line we begin by proving the first inequality in 6 14 let k be the constant process then q s q for t s by 6 10 6 13 and 6 9 we have 0 i v k i k e t l s xs k q ds e t t l s xs k q ds e t t 1 l s xs k q ds 1 t 1 t 6 15 22 note that l is bounded and p t 1 t c 6 16 dividing both sides of 6 15 by and then sending 0 we prove the first inequality in 6 14 to check the second inequality in 6 14 for q 0 let 0 and set s k s t q clearly a cad t k q d s q ds and q s 1 s t q s by 6 10 6 13 and 6 9 again we have 0 e q t m s xs s 1 s t q ds t l s xs s q s ds e q t t m s xs s 1 s t q ds cp t 1 t c e q t t sup 0 1 m s xs s 1 q ds c here in the last inequality above we used 6 16 again now sending 0 in the above we can easily deduce that sup 0 1 m t x k 1 q 0 the arbitrariness of 0 then further leads to the second inequality of 6 14 proving the viscosity subsolution property we now turn to the viscosity supersolution property we first check definition 6 3 iii let t x k 0 t r 0 k and a t x k 0 for any a cad t k 0 since there is no liquidity q 0 there is no possibility of trading and thus it must hold that s k and q 0 s 0 s t 1 then by 6 10 6 13 and 6 9 again we have 0 i v k i k e t l s xs k 0 ds dividing both sides above by and then sending 0 similar to the case 6 15 we can prove definition 6 3 iii it remains to verify definition 6 3 ii suppose in the contrary that c min l m t x k q 0 6 17 for some t x k q 0 t o and a t x k q then applying theorem 5 4 on t 1 we can find a c ad t k q such that v t x k q e t 1 t u xt xs q s d s v t 1 x t x t 1 t 1 q q t 1 2 now let be the ft adapted version of as was defined in lemma 6 1 and q s q s k s t for any 0 define the following stopping times x inf s t xt xs x 1 4 t inf s t s k t t x t 1 6 18 23 then is an f t stopping time similar to the first part of proposition 5 2 we can show that v t x k q e t u xs q s d s v x q 2 now following the derivation of 6 15 we obtain 2 e t m s xs s q s d s t l s xs s q s ds 6 19 since is smooth we deduce from 6 17 that for is small enough m s xs s q s c 2 l g s xs s q s c 2 t s thus it follows from 6 19 that 2 c 2 e k t but note that k on this leads further to 2 c 2 e 1 t x t 1 t 1 c 2 ce t x t 1 c 2 c p x t p t 1 t 6 20 finally recalling 6 16 and noting that p x t p sup t s t xt xs x 1 4 1 e sup t s t xt xs x 4 c 1 x 4 we derive from 6 20 that 2 c 2 c 1 x 4 2 but this is obviously impossible when 0 is small enough a contradiction to the assumption 6 17 this completes the proof remark 6 5 i if the value function actually has the regularity v c 1 2 b 0 t o then instead of being a viscosity solution it will be a classical solution to the qvi 6 11 moreover by theorem 7 4 below we see that the classical solution is unique ii we should note that one may try to analyze the uniqueness in the sense of viscosity solutions by following the standard techniques see the classical reference 9 however since our main focus is the dynamic equilibrium model of the limit order book we prefer not to pursue this in this already lengthy paper and will leave it to interested reader 7 description of optimal strategy in this section we give a characterization of the optimal strategy our argument will be based on the assumption that the hjb equation has a classical solution which will not be substantiated 24 in this paper as it is itself a challenging problem our main purpose is to see the possible structure of the optimal strategy and compare it to the usual optimal singular stochastic control in the literature our starting point is the following partial verification theorem proposition 7 1 assume h 1 h 3 and that v c 1 2 b 0 t o is a classical solution to the qvi 6 11 6 12 then v v proof without loss of generality we assume t 0 k 0 by 4 13 it suffices to show that v 0 x 0 q j 1 0 x 0 q for any aad 0 0 q 7 1 we remark that for this proposition we can actually utilize j 0 namely considering only contin uous strategies however to analyze the optimal strategy later we shall use j 1 instead recall that 0 1 2 are the jump times of n denote i i t by the terminal condition 6 12 we have e j 1 0 x 0 q v 0 x 0 q e t 0 u xs q s d c s 0 s t d xs q s s v t xt t q t v 0 x 0 0 q 0 i 0 e i 1 i u xs q s d c s i s i 1 d xs q s s v i 1 x i 1 i 1 q i 1 v i x i i q i by introducing the filtrations l f i fws fys i 0 s t and setting t in 6 4 we obtain e i 0 e i 1 i l v s xs s q s ds i 1 i m v s xs s q s d c s i s i 1 s 0 m v s xs s u q s u du 0 7 2 thanks to 6 11 this completes 7 1 in the rest of the section we shall find an optimal strategy aad 0 0 q such that 7 2 hence 7 1 holds with equality given the existence of the classical solution v of the qvi 6 11 6 12 we shall remark though although it is interesting in theory the is in general not implementable since the costd in the expression j 1 of 4 13 is not the real jump cost however as was pointed out in remark 4 3 this will nevertheless provide us a very good and implementable approximate optimal strategy 25 to help identifying the optimal strategy we first provide some sufficient conditions with out loss of generality we shall only focus on the interval 0 1 corresponding to the term in 7 2 with i 0 to be more precise we want to find aad 0 0 q such that e 0 e 1 0 l v s xs s q s ds 1 0 m v s xs s q s d c s 0 s 1 s 0 m v s xs s u q s u du 0 7 3 to this end for any t x k q 0 t r 0 k r denote o t x q y 0 k q m v t x y q y 0 t k q inf y k y o t xt q k q 7 4 it is clear that o t x q is an open set in 0 k q and is fw progressively measurable non decreasing in k such that t k q k and t k q k for k o t xt q we have the following result proposition 7 2 assume all the conditions of proposition 7 1 hold if aad 0 0 q satisfies 1 0 1 o t xt q t d c t 0 and t t t q t 0 1 p a s 7 5 then 7 3 holds proof first denote oc t x q 0 k q o t x q then the first equality in 7 5 implies d ct 1 o t xt q t 1 oc t xt q t d ct 1 oc t xt q t d c t 0 t 1 note that q t q t 0 t 1 then by the definition of o in 7 4 we have 1 0 m v s xs s q s d c s 1 0 m v s xs s q s 1 oc t xs q s d c s 0 7 6 next when t 0 by the second condition of 7 5 we have t t t q inf y t m v t xt y q y 0 k q this implies that m v t xt y q y 0 for all t y t thus by denoting y t u s 0 m v s xs s u q s u du s 0 m v s xs s u q s u du 0 7 7 finally we claim that l v t xt t q t 0 for t 0 1 such that t 0 7 8 26 we note that if 7 8 is substantiated then since has at most countably many jumps we have e 1 0 l v t xt t q t dt 0 7 9 combining 7 6 7 7 and 7 9 we prove 7 2 it remains to prove 7 8 fix t 0 1 such that t 0 if t q then 7 8 is the third condition of 6 12 if t k then s k for all s t t and thus v s xs s q s 0 thanks to the second condition of 6 12 compare 6 8 and 6 9 one can easily check 7 8 now assume t k q then t t t t q inf y t y o t xt q that is t o t xt q but note that as the solution to the variational inequality 6 11 it is easy to see that l v t xt y q y 0 holds whenever m v t xt y q y 0 namely for any y o t xt q the continuity of v then renders that l v t xt y q y 0 on o t xt q consequently 7 8 holds this proves 7 9 whence the theorem we next show that such indeed exists fix x q in light of proposition 7 2 we introduce a 0 aad 0 0 q 1 0 1 o t xt q t d c t 0 t t t q t 0 1 p a s 7 10 clearly t 0 a 0 thus a 0 6 we shall construct the optimal strategy from this set proposition 7 3 assume all the conditions of proposition 7 1 hold then there exists a 0 aad 0 0 q satisfying 7 5 and consequently 7 3 holds proof we shall prove the existence by using zorn s lemma to this end we introduce a partial order in a 0 1 2 if and only if 1 t 2 t for all t 0 t p a s 7 11 we claim that every totally ordered subset in a 0 has an upper bound in a 0 indeed let i i i a 0 be a totally ordered subset where the index set i could be uncountable denoting qt to be the set of all rationals in 0 t we define r esssup i i ir r qt 7 12 since i is totally ordered by a standard argument we can find a sequence n in in i n 1 2 such that n s are non decreasing in n and lim n nr esssup i i ir r r qt 7 13 27 we then define t limr t r qt r for all t 0 t we shall prove that a 0 and therefore an upper bound of i clearly is f adapted non decreasing left continuous and 0 0 t k moreover since q n 0 clearly q r 0 for all r qt which implies q t 0 for all t 0 t and thus aad 0 0 q we now check that satisfies the two requirements of a 0 since there is no stochastic integral involved in what follows we shall fix modulo a p null set if necessary i we first show that 1 0 1 o t xt q t d c t 0 indeed since has at most countably many jumps it suffices to show that 1 0 1 o t xt q t 1 t 0 d c t 0 now for any t 0 1 such that t 0 and t o t xt q by 7 4 we have m v t xt t q t 0 by the continuity of m v there exists 0 such that a m v s xs y q y 0 for all s t 0 t 1 and b y t 0 t k q since is continuous at t there exists rationals r 1 r 2 such that t 0 r 1 t r 2 t 1 and t 3 r 1 t r 2 t 3 now by the monotone convergence of nr in the spirit of dini s lemma there exists n 0 such that for all n n 0 ns s for s r 1 r 2 this implies m v s xs n s q ns 0 and thus ns o s xs q for all s r 1 r 2 and n n 0 since n a 0 then r 2 r 1 d n ct 0 and n s s xs ns ns that is n is a constant on r 1 r 2 for all n n 0 then is also a constant on r 1 r 2 and therefore r 2 r 1 1 o t xt q t d c t 0 since t is arbitrary we prove the desired property ii we next show that t t t q for t 0 1 for any y t k q such that m v t xt y q y 0 by the continuity of m v there exists 0 1 t such that m v s xs y q y 0 for all s t t we claim that ns y s t t for all n 7 14 note that if 7 14 is true then clearly s y for s t t which implies that t y by the arbitrariness of y we obtain t t t q to see 7 14 suppose in the contrary that t n inf s t ns y t then n t n y n t n since n a 0 we have nt n t n n t n q y and thus n t n y note that m v t n xt n y q y 0 then there exists n 0 such that m v s xs n s q ns 0 for all s t n t n n this implies that ns o s xs q and s ns q ns now recall again that n a 0 then we have d n cs 0 and ns 0 for all s t n t n n therefore ns y for all s t n t n n contradicting with the definition of t n 28 summarizing we have shown that every totally ordered subset of a 0 has an upper bound therefore applying zorn s lemma we conclude that a 0 has a maximal element in a 0 denoted by we claim that does satisfy 7 5 indeed by its construction it suffices to prove t t t q t 0 1 p a s 7 15 suppose not then c t t q t 0 define inf s t s t c 1 s s 1 0 t s t c 1 t s s t c 1 t s s 0 t it is straightforward to check that a 0 and s s for s t this contradicts the fact that is a maximum element of a 0 this proves 7 15 whence the proposition we are now ready to state the man result of this section theorem 7 4 assume all the conditions of proposition 7 1 hold then v v and there exists an optimal strategy a 0 0 q such that v 0 x 0 q j 1 0 x 0 q proof combining propositions 7 2 and 7 3 there exists a 0 0 q such that 7 3 holds repeating the same arguments for each n we may extend appropriately on 0 n such that n 1 i 0 e i 1 i l v s xs i s q i s ds i 1 i m v s xs s q s d c s i s i 1 s 0 m v s xs s u q s u du 0 which following the proof of proposition 7 1 implies that e n 0 u xs q s d cs 0 s n d xs q s s v n x n n q n v 0 x 0 0 q sending n and recalling the terminal condition in 6 12 we see that v 0 x 0 0 q j 1 0 x 0 q v 0 x 0 q this together with proposition 7 1 completes the proof remark 7 5 based on proposition 7 2 we can roughly describe the optimal strategy as follows at each time t i i 1 between the two jump times of n there is an inaction region o t xt q i which is an open set and therefore can be decomposed into open intervals if 29 t i o t xt q i then it stays flat if it is at the boundary of o t xt q i hence the boundary of one of the open intervals then it either jumps to t xt q i i e the boundary of nearest neighboring interval above it if t xt q i t or move along with the boundary of o t xt q i when t xt q i t in particular when o t xt q i is simply connected then essentially behaves like an optimal singular stochastic control however it is not clear to us that o t xt q i will be simply connected and consequently the optimal strategy may jump multiple even infinitely many times between i i 1 references 1 alfonsi a fruth a schied a 2008 constrained portfolio liquidation in a limit order book model advances in mathematics of finance 925 banach center publ 83 polish acad sci inst math warsaw 2 alfonsi a fruth a and schied a 2010 optimal execution strategies in limit order books with general shape functions quant finance 10 no 2 143 157 3 alfonsi a and schied a 2010 optimal execution and absence of price manipulations in limit order book models siam j financial math 1 490 522 4 alfonsi a schied a and slynko a 2012 order book resilience price manipulation and the positive portfolio problem siam j finan math 3 no 1 511 533 5 avellaneda m and stoikov s 2008 high frequency trading in a limit order book quanti tative finance 8 no 3 217 224 6 bayraktar e and ludkovski m 2010 optimal trade execution in illiquid markets mathe matical finance 21 no doi 10 1111 j 1467 9965 2010 00446 x 7 bielecki t jeanblanc m and rutkowski m 2004 hedging of defaultable claims paris princeton lectures on mathematical finance 2003 1 132 lecture notes in math 1847 springer berlin 8 cetin u jarrow r a and protter p 2004 liquidity risk and arbitrage pricing theory finance and stochastics 8 no 3 311 341 9 crandall m g ishii h and lions p l 1992 user s guide to viscosity solutions of second order partial differential equations bull amer math soc ns 27 1 67 30 10 ekren i touzi n and zhang j viscosity solutions of fully nonlinear parabolic path dependent pdes part i preprint arxiv 1210 0006 11 foucault t kadan o and kandel e 2005 limit order book as a market for liquidity review of financial studies 18 4 1171 1217 12 gatheral j schied a and slynko a 2012 transient linear price impact and fredholm integral equations mathematical finance 22 no 3 445 474 13 handa p and schwartz r a 1996 limit order trading journal of finance 51 no 5 1835 1861 14 hollifield b miller r a and sandas p 2004 empirical analysis of limit order mar kets review of economic studies 71 no 4 1027 1063 15 obizhaeva a and wang j 2013 optimal trading strategy and supply demand dynamics journal of financial markets 16 no 1 1 32 16 rosu i 2009 a dynamic model of the limit order book the review of financial studies 22 4601 4641 17 predoiu s shaikhet g and shreve s e 2011 optimal execution in a general one sided limit order book siam j finan math 2 no 1 183 212 31 http arxiv org abs 1210 0006 1 introduction 2 preliminaries 3 equilibrium distribution 4 optimal execution problem 5 dynamic programming principle 6 the hjb equation 7 description of optimal strategy