hestrho tex ar x iv 1 10 4 53 26 v 2 m at h s t 2 4 o ct 2 01 1 density approximations for multivariate affine jump diffusion processes damir filipovic 1 eberhard mayerhofer 2 and paul schneider 3 abstract we introduce closed form transition density expansions for multivariate affine jump diffusion processes the expansions rely on a general approximation theory which we develop in weighted hilbert spaces for random variables which possess all polynomial moments we establish parametric conditions which guarantee existence and differentiability of transition densities of affine models and show how they naturally fit into the approximation framework empirical applications in credit risk likelihood inference and option pricing highlight the use fulness of our expansions the approximations are extremely fast to evaluate and they perform very accurately and numerically stable 1 introduction most observed phenomena in financial markets are inherently multivariate stochastic trends stochastic volatility and the leverage effect in equity markets are well known examples the theory of affine processes provides multivariate stochastic models with a well established theo retical basis and sufficient degree of tractability to model such empirical attributes they enjoy much attention and are widely used in practice and academia among their best known propo nents are vasicek s interest rate model vasicek 1977 the square root model cox et al 1985 heston s model cf heston 1993 and affine term structure models duffie and kan 1996 dai and singleton 2000 collin dufresne et al 2008 affine models owe their popularity and their name to their key defining property their characteristic function is of exponential affine form and can be computed by solving a system of generalized riccati differential equations cf duffie et al 2003 this allows for computing transition densities and transition probabilities 1 e cole polytechnique fe de rale de lausanne and swiss finance institute quartier unil dorigny extranef 218 ch 1015 lausanne switzerland 2 vienna institute of finance heiligensta dter str 46 48 1190 vienna austria 3 warwick business school university of warwick coventry cv 4 7 al united kingdom e mail addresses damir filipovic epfl ch eberhard mayerhofer vif ac at paul schneider wbs ac uk date 13 october 2011 key words and phrases affine processes asymptotic expansion density approximation orthogonal polynomi als we are thankful to yacine a t sahalia michael brandt anna cieslak pierre collin dufresne valentina corradi ron gallant aleksandar mijatovic alessandro palandri benedikt po tscher and gareth roberts for helpful discussions we benefitted from suggestions from participants of the workshop on financial econometrics at the fields institute toronto the internal workshop at warwick business school coventry the econometric research seminar at the ihs vienna and the 2010 meeting of the european finance association frankfurt part of this research has been carried out within the project on dynamic asset pricing of the national centre of competence in research financial valuation and risk management nccr finrisk the nccr finrisk is a research instrument of the swiss national science foundation eberhard mayerhofer gratefully acknowledges support from wwtf vienna science and technology fund 1 http arxiv org abs 1104 5326 v 2 mailto damir filipovic epfl ch mailto eberhard mayerhofer vif ac at mailto paul schneider wbs ac uk 2 density expansions by means of fourier inversion duffie et al 2000 transition densities constitute the likelihood which is an ingredient for both frequentist and bayesian econometric methodologies 1 also they appear in the pricing of financial derivatives however fourier inversion is a very delicate task complexity and numerical difficulties increase with the dimensionality of the process efficient density approximations avoiding the need for fourier inversion are therefore desirable this paper is concerned with directly approximating the transition density without resort ing to fourier inversion techniques we pursue a polynomial expansion approach an idea that has been proposed by schoutens 2000 a t sahalia 2002 and hurn et al 2008 among oth ers for univariate diffusion processes extensions for multivariate jump diffusions do exist in a t sahalia 2008 and yu 2007 but they follow a different route by approximating the kol mogorov forward and backward partial differential equations our approach exploits a crucial property of affine processes under some technical conditions conditional moments of all orders exist and are explicitly given in terms of derivatives of the affine characteristic exponential func tion see duffie et al 2000 this ensures that the coefficients of the polynomial expansions can be computed without approximation error we present a general theory of density approximations with several traits of the affine model class in mind the assumptions made for the general theory are then justified by proving existence and differentiability of the true unknown transition densities of affine models these theoretical results contrary to the density approximations themselves do rely on fourier theory specifically we investigate the asymptotic behavior of the characteristic function with novel ode techniques we improve earlier work along several lines our method i is applicable to multivariate models ii works equally well for reducible and irreducible processes in the sense of a t sahalia 2008 2 in particular stochastic volatility models iii produces density approximations the quality of which is independent of the time interval between observations iv allows for expan sions on the correct state space that is the support of the density approximation agrees with the support of the true unknown transition density as in hurn et al 2008 and schoutens 2000 v produces density approximations that integrate to unity by construction hence are much more amenable to applications that demand the constant of proportionality than the purely polynomial expansions from a t sahalia 2008 3 a specialization on affine models is not a severe limitation since virtually any continuous time multivariate application is based on affine models 4 this includes wishart processes bru 1991 and even general affine matrix valued processes cuchiero et al 2010 a this paper therefore provides a unified framework for 1 various other approaches for parameter estimation for discretely observed markov processes can be found in the literature excellent comprehensive surveys are for example in hurn et al 2007 s rensen 2004 a t sahalia 2007 the approaches range from likelihood approximation using bayesian data augmentation roberts and stramer 2001 elerian et al 2001 eraker 2001 jones 1998 estimating functions bibby et al 2004 up to the efficient method of moment gallant and tauchen 2009 only few of them make use of the properties of affine models however e g singleton 2001 bates 2006 2 a model is said to be reducible a t sahalia 2008 if its diffusion function can be transformed one to one into a constant 3 the markov chain monte carlo sampling schemes from stramer et al 2009 accommodate bayesian likelihood based inference using expansions from a t sahalia 2008 even in absence of the normalizing constant but at a high computational cost 4 in discrete time le et al 2010 show how q affine models may be constructed to exhibit non affine dynamics under p density expansions 3 econometric inference for financial models because in applications one typically needs to eval uate both the transition densities themselves as well as integrals of payoff functions against the transition densities for model based asset pricing this complements the methods recently developed in chen and joslin 2011 and kristensen and mele 2011 which are aimed at asset pricing only 5 the paper proceeds as follows section 2 develops a general theory of orthonormal polynomial density approximations in certain weighted l 2 spaces under suitable integrability and regularity assumptions these may be validated by the sufficient criteria presented subsequently in sec tion 3 the density approximations are then specialized within the context of affine processes section 4 reviews the affine transform formula and the polynomial moment formula for affine processes which in turn allows the aforementioned polynomial approximations the main the oretical contribution constituted by fairly general results on existence and differentiability of transition densities of affine processes is elaborated in section 4 3 in section 5 we introduce candidate weight functions and the gram schmidt algorithm to compute orthonormal polyno mial bases corresponding to these weights along with important examples section 6 relates existing techniques for density approximations to ours an empirical study is presented in sec tion 7 applications in stochastic volatility section 7 2 credit risk section 7 3 likelihood inference section 7 4 and option pricing section 7 5 support the tractability and usefulness of the likelihood expansions section 8 concludes the proofs of our main results are given in appendices a c in the paper we will use the following notational conventions the nonnegative integers are denoted by n 0 the length of a multi index 1 d nd 0 is defined by 1 d and we write 11 d d for any rd the degree of a polynomial p x 0 p x in x rd is defined as deg p x max p 6 0 for the likelihood ratio functions below we define 0 0 0 the class of p times continuously differentiable or continuous if p 0 functions on rd is denoted by cp 2 density approximations let g denote a probability density on rd whose polynomial moments rd g d of every order nd 0 exist and are known in closed form for example g may denote the pricing density in a financial market model typically g is not known in explicit form and needs to be approximated let w be an auxiliary probability density function on rd the aim is to expand the likelihood ratio g w in terms of orthonormal polynomials of w in order to get an explicit approximation for the unknown density function g this can be formalized as follows define the weighted hilbert space l 2 w as the set of equivalence classes of measurable functions f on rd with finite l 2 w norm defined by f 2 l 2 w rd f 2 w d 5 it is of course conceivable to mix the mentioned methods for example one could use transition densities devel oped in this paper while approximating asset prices using the generalized fourier transform in chen and joslin 2011 whenever the payoff function allows it or the error expansion method from kristensen and mele 2011 4 density expansions accordingly the scalar product on l 2 w is denoted by f h l 2 w rd f h w d we will now proceed under the following assumptions sufficient conditions for the assumptions to hold are provided in section 3 below assumption 1 there exists an orthonormal basis of polynomials h nd 0 of l 2 w with degh this implies h 0 1 in particular assumption 2 the likelihood ratio function g w lies in l 2 w this is equivalent to rd g 2 w d consequently the coefficients c g w h l 2 w rd h g d 1 for 0 are well defined and given explicitly 6 in terms of the coefficients of h and the polynomial moments of g moreover according to standard l 2 w theory the sequence of pseudo likelihood ratios 7 1 j 1 c h approximates the likelihood ratio g w in l 2 w for j in fact defining the pseudo density functions 8 2 1 g j x w x 1 j 1 c h x the following properties can be established theorem 2 1 the pseudo density functions g j satisfy rd g j d 1 2 2 lim j g j w g w in l 2 w 2 3 lim j rd g j g 2 d w 0 2 4 property 2 2 proves to be very useful for applications where the constant of proportionality is needed for example option pricing and the computation of bayes factors proof a calculation shows that rd h w d h 1 l 2 w h h 0 l 2 w 0 6 this is an advantage over the method in a t sahalia 2002 which also relies on series expansions where the coefficients are functions of expectations of nonlinear moments and therefore have to be approximated in general 7 see footnote 8 below for an explanation of this terminology 8 theorem 2 1 below states that g j integrates to one but g j may take negative values whence we shall call g j a pseudo density function and g j w a pseudo likelihood ratio density expansions 5 by the orthogonality of h and h 0 1 hence rd g j d rd w d 1 which proves 2 2 properties 2 3 and 2 4 are formal restatements of the discussion preceding the theorem the idea of expanding the likelihood ratio function g w in orthonormal polynomials of w is simple and powerful an overview and discussion of related literature can be found e g in bernard 1995 in particular for the case where w is the standard gaussian density 2 1 is actually the gram charlier expansion of g but note that assumption 2 is very restrictive in this case this is why the gram charlier series diverges in most cases of interest which is sometimes given as an argument against the use of it however the blame is on the choice of the gaussian as auxiliary density the efficiency of the approximation 2 3 or equivalently 2 4 lies in the appropriate choice of the auxiliary density function w and the corresponding orthonormal polynomials h here is a first result towards a good choice of w the intuition is to choose w as close as possible to the unknown density function g in the sense that the pseudo likelihood ratio g w is close to one this should be achieved if many of the coefficients c other than c 0 1 are equal to zero this will also improve the numerical efficiency of the approximation as the respective orthonormal polynomials h need not be computed denote the polynomial moments of w by rd w d lemma 2 2 moment matching principle suppose for some n 1 we have for all n then c 0 for 1 n proof the assumption implies that for 1 n c rd h g d rd h w d h 1 l 2 w h h 0 l 2 w 0 by the orthogonality of h and h 0 1 3 sufficient conditions for assumptions 1 and 2 in this section we provide sufficient conditions for assumptions 1 and 2 to hold the proofs of the following lemmas are postponed to appendix a we first provide sufficient conditions on w that guarantee that assumption 1 is satisfied lemma 3 1 suppose that the density function w has a finite exponential moment 3 1 rd e 0 w d for some 0 0 then the set of polynomials is dense in l 2 w moreover assumption 1 is satisfied in applications the auxiliary density function w on rd will often be given as product of marginal densities wi on r hence the following modification of lemma 3 1 will be useful lemma 3 2 let w 1 wd be density functions on r having finite exponential moments r e i i wi i d i 6 density expansions for some i 0 i 1 d then the product density w w 1 1 wd d on rd admits a finite exponential moment 3 1 for 0 mini i moreover let h ij j n 0 denote the corresponding orthonormal basis of polynomials of l 2 wi r by degh i j j for i 1 d asserted by lemma 3 1 then h h 1 1 1 hd d d defines an orthonormal basis of polynomials of l 2 w with degh and assumption 1 is satisfied assumption 2 is opposite to assumption 1 in the sense that there we have to bound the auxiliary density function w from below the following lemmas provide sufficient conditions for assumption 2 to hold lemma 3 3 assume that g is bounded and has a finite exponential moment rd e 0 g d for some 0 0 if w decays at most exponentially such that 3 2 sup x rd e 0 x w x then assumption 2 is satisfied if the support of w and g is contained in a subset d of rd the situation becomes more difficult as one has to control the rate at which w converges to zero at the boundary of the support set we provide sufficient conditions for the set d rm rn starting with the scalar case d r lemma 3 4 let d 1 and p n assume that g is a bounded density with support in r and has a finite exponential moment 0 e 0 g d for some 0 0 assume further that g is of class c p if w has support in r and decays at most polynomially at zero and exponentially at infinity such that 3 3 sup x 0 1 x 2 p w x and sup x 1 e 0 x w x then assumption 2 is satisfied the case where d rm rn is similar but requires stronger conditions on g and w we respect the product structure of the domain by writing g g x y for x rm and y rn the following tubular neighborhood of the boundary of d i rm 1 m x rm min i xi 1 is the convenient multivariate generalization of the unit interval from the above scalar case density expansions 7 lemma 3 5 let d m n and p n assume that g x y is a bounded density with support in rm rn and has a finite exponential moment rm rn e 1 2 g d d for some 1 2 0 assume further that g x y is of class c p in x and the p th partial derivative p xig x y is bounded on i rn for all i 1 m if w has support in rm rn and decays at most polynomially around the boundary and exponentially at infinity such that 3 4 sup x y i rn mini x p i e 2 y w x y and sup x y 1 m rn e 1 x 2 y w x y then assumption 2 is satisfied we note that the conditions in lemmas 3 3 3 4 and 3 5 can be explicitly verified for transition densities of affine processes see corollary 4 4 below 4 affine models the main application of the polynomial density approximation is for affine factor models in this section we follow the setup of duffie et al 2003 which we now briefly recap let d m n 1 we define the index set j m 1 d and write vj vm 1 vd and mjj mkl k l j for any vector v and matrix m we consider an affine process x on the canonical state space d rm rn with generator af x d k l 1 diag 0 a m i 1 xi i kl 2 f x xk xl b x f x d f x f x j jf x m d d f x f x m i 1 xi i d for some appropriate positive semidefinite n n and d d matrices a and i respectively here with diag 0 a we denote the block diagonal d d matrix with blocks given by the m m zero matrix and a moreover j denotes an r n valued continuous and bounded truncation function with j j in a neighborhood of the origin 0 for detailed parametric restrictions on a i b m i we refer the reader to duffie et al 2003 definition 2 6 we assume for simplicity 9 that the jump measures i are of finite variation type with integrable large jumps d i d i 1 m 9 at the cost of more technical analysis the following results could also be proved for the general case of infinite variation jumps i with infinite tail mean 8 density expansions 4 1 affine transform formula the analytical tractability of affine models stems from the fact that the characteristic function of xt x 0 x is explicitly given by the affine transform formula 4 1 e eiu xt x 0 x e t iu t iu x u rd x d where the c and c m irn valued functions t iu and t iu solve the generalized riccati equations for i 1 m 4 2 t j a j b d e 1 j j m d 0 0 t i i bi d e 1 i d i 0 iui t j bjj j j 0 iuj where we define b and write bi for the ith row vector of b obviously we have j t iu ie bjj t uj and t iu is given by simple integration of the right hand side of its equation 4 2 polynomial moments it is well known that if xt x 0 x has finite k th moment e xt k x 0 x for all x d then t u and t u are of class ck in u moreover the polynomial moments are explicitly given in terms of the respective mixed derivatives of the characteristic function e x t x 0 x i u 1 u d e t iu t iu x u 0 for k see e g duffie et al 2003 lemma a 1 it follows by inspection that the right hand side of this equation is a real polynomial in x of degree less than or equal to re cently generalizing the recursive method used in forman and s rensen 2008 for pearson type diffusions cuchiero et al 2010 b proposed an alternative method to compute the coefficients of this polynomial the idea rests on the insight that the affine generator a formally maps pk into pk where pk denotes the finite dimensional linear space of all polynomials in x rd of degree less than or equal to k 10 the generator a thus restricts to a linear operator ak on pk consequently we obtain the formal representation e x t x 0 x eakt x where eakt j 0 akt j j is the exponential of akt this can be expressed as a matrix we shall illustrate this for d 1 the dimension of pk then equals k 1 and we can pick as canonical 10 this method is not restricted to affine processes but can be defined for any markov process with finite k th moments and whose infinitesimal generator maps pk into itself density expansions 9 basis of pk the set q 1 x xk for every j 0 k we then calculate symbolically the coefficients qij in 4 3 akxj axj k i 0 qijx i hence ak can be represented by the upper triangular matrix q qij with respect to the basis q in other words if we identify a generic polynomial p x k i 0 pix i in pk with the vector of its coefficients p p 0 pk then akp x pk equals the polynomial with coefficient vector qp moreover 4 4 e p xt x 0 x eqt p see examples 7 1 and 7 2 below for some concrete applications for d 1 and d 2 4 3 existence and properties of affine transition densities in this section we present our main theoretical results which establish existence and smoothness of the density of the con ditional distribution of the affine processx moreover we provide explicitly verifiable conditions asserting that lemmas 3 3 3 5 apply our first result provides sufficient conditions for the existence and smoothness of a density of xt x 0 x for some t 0 and x rm rn these easy to check conditions apply in particular to multi factor affine term structure models on rm rn from duffie and kan 1996 and dai and singleton 2000 and heston s stochastic volatility model the proof is given in appendix b theorem 4 1 assume that the d n 1 d matrix 11 4 5 k m i 1 i diag 0 a diag 0 b jja diag 0 bn 1 jj a has full rank further let p be a nonnegative integer with 4 6 p min i 1 m bi i ii 1 then xt x 0 x admits a density g of class cp with support in rm rn and the partial derivatives of g of orders 0 p tend to 0 as we note that condition 4 6 is sharp and cannot be relaxed in general consider for instance the scalar square root diffusion x on r with generator af x xf x bf x it is well known that for any parameter values 0 and b 0 the distribution of 2 xt t x 0 x is noncentral 2 with 2 b degrees of freedom and noncentrality parameter 2 x t see e g filipovic 2009 exercise 10 9 the corresponding density function g satisfies lim 0 g 0 and is therefore of class c 0 if and only if the degrees of freedom 2 b 2 see johnson et al 1995 chap 29 this is exactly what condition 4 6 states for p 0 as regards exponential moments of xt x 0 x we combine and rephrase some results from duffie et al 2003 11 here for given d d matrices b 1 b 2 bn the expression b 1 b 2 bn denotes the d nd block matrix we obtain by putting the matrices next to each other 10 density expansions theorem 4 2 assume that the jump measures admit exponential moments 1 eq m d and 1 eq i d i 1 m for all q in some open neighborhood v of 0 in rd then the right hand side of 4 2 is analytic in v suppose further that 4 2 admits a v valued solution t u with 0 u u for all t 0 t and for all u in 1 1 m 2 2 n for some 1 2 0 then xt x 0 x has a finite exponential moment 4 7 e e 1 yt 2 zt x 0 x for all t 0 t where we denote yt x 1 t xm t and zt xm 1 t xd t proof that the right hand side of 4 2 is analytic in v follows from duffie et al 2003 lemma 5 3 from duffie et al 2003 theorem 2 16 and lemma 6 5 we then infer that e e q xt x 0 x for all t 0 t and for all q 1 1 m 2 2 n combining this with the elementary inequality e 1 yt 2 zt e 1 m i 1 xit 2 d i m 1 xit 1 0 e q xt where we denote q 1 1 1 1 m 1 1 m 1 2 1 d 2 1 1 m 2 2 n proves 4 7 note that if m d and i d have light tails of the order e r 2 d for some r 0 or have compact support in particular then the first assumption of theorem 4 2 is satisfied for v rd even then however the solution t u exists only on a finite time horizon t t for any nonzero u rd in general we refer to the discussion of the diffusion case in filipovic and mayerhofer 2009 see also filipovic 2009 chapter 10 we further present an additional result which concerns the existence of the marginal transition density of integrated affine jump diffusions which are not covered by theorem 4 1 in fact if x is a one dimensional affine process on r then the two dimensional process dx x dt is affine again with state space r 2 however its diffusion matrix is degenerate and thus violates the conditions of theorem 4 1 nevertheless a slight adaption of its proof yields the existence of the marginal transition density of the integrated process x dt under some more stringent conditions the proof of the following theorem is given in appendix c theorem 4 3 let x be an r valued affine process with parameters a 0 b m further let p be a nonnegative integer with 4 8 p b 2 1 then t 0 xsds x 0 x admits a a density g of class cp with support in r and the partial derivatives of g of orders 0 p tend to 0 as from the application point of view we can rephrase the statements of the preceding theorems as follows density expansions 11 corollary 4 4 theorems 4 1 4 3 provide conditions in terms of the parameters of the affine process x such that the assumptions in lemmas 3 3 3 5 and thus eventually the validity of assumptions 1 and 2 can explicitly be verified for the density of the marginal transition dis tributions of x 5 examples of auxiliary density functions for our applications of the polynomial density approximations to affine models we shall make the following specific choices for the auxiliary density function w for positive coordinates we use the gamma density 5 1 d e d 1 d of a 1 d 1 distributed random variable here denotes the gamma function it is easily seen that conditions 3 1 3 4 are satisfied for the appropriate parameters p 0 and 1 respectively for real valued coordinates we employ the bilateral gamma density from ku chler and tappe 2008 a the corresponding family of distributions nests for example the variance gamma distribution as a special case it has very flexible shapes ku chler and tappe 2008 b for the purposes of this paper we make use of a constrained standardized version with mean centered at zero unit variance zero skewness and excess kurtosis c 0 we denote this standardized bilateral gamma distribution with b c its characteristic function is given by b u c 216 1 c 1 6 cu 2 3 c u r c r by ku chler and tappe 2008 b eq 3 6 the bilateral gamma distribution has a density given by 5 2 b c 2 3 c 2 4 c 3 c 6 4 c c c 6 4 c 3 c 1 2 k 3 c 1 2 6 c 3 c where kn denotes the modified bessel function of the second kind it follows from ku chler and tappe 2008 b section 6 that conditions 3 1 3 4 are satisfied for the appro priate parameters 0 and 2 respectively the special case with excess kurtosis c 1 3 leads to the following simple expression for the density b b c 1 3 since for half integer indices the modified bessel functions evaluate to elementary functions 5 3 b 27 e 3 2 1146880 2 7776 2 7 83160 2 5 180180 2 3 75075 2 1296 8 45360 6 207900 4 210210 2 25025 orthonormal polynomial bases can be constructed for any auxiliary density function w which has finite exponential moment 3 1 by the following gram schmidt process which is also used in the proof of lemma 3 1 12 density expansions algorithm 5 1 gram schmidt process h 0 1 h 0 6 h l 2 w h h h h l 2 w normalization notice that degh deg which is due to the linear independence of the set of monomials nd 0 below are the first five orthonormal polynomials for the gamma and the bilateral gamma densities and b introduced above example 5 1 the non normalized orthogonal polynomials for the gamma density are the generalized laguerre polynomials the first five of which are h 0 1 h 1 d 1 h 2 1 2 2 2 d 2 d 2 3 d 2 h 3 1 6 3 3 2 d 3 3 d 2 5 d 6 d 3 6 d 2 11 d 6 h 4 1 24 4 4 d 4 3 6 d 3 d 4 2 4 d 2 d 3 d 4 d 1 d 2 d 3 d 4 n 5 4 the normalization constants are given by 5 5 ho n h n l 2 n i 1 i d n example 5 2 for the standardized bilateral gamma density b in 5 2 the first five non normalized orthogonal polynomials are h b 0 1 h b 1 h b 2 2 1 h b 3 c 3 3 h b 4 2 5 c 2 21 c 18 2 1 3 c 2 c 4 3 5 6 density expansions 13 and the corresponding normalization constants ho b n h bn l 2 b are given by ho b 0 1 ho b 1 1 ho b 2 c 2 ho b 3 7 c 2 3 9 c 6 ho b 4 2 55 c 4 363 c 3 822 c 2 756 c 216 9 c 2 5 7 example 5 3 product measure define the product density w b with support on r r by w b 1 2 c d 1 d b 2 c with gamma density defined in 5 1 and bilateral gamma density b defined in 5 2 com bining lemma 3 2 and examples 5 1 and 5 2 we obtain the corresponding orthonormal basis of polynomials h n 1 h b n 2 n 1 n 2 n 20 6 relation to existing approximations in this section we recall facts about closed form density approximations from previous liter ature and relate them to the density expansions of the present paper a short summary of the capabilities and limitations of the different methods is reported in table 1 the closest methodology to the one introduced in section 2 a t sahalia 2002 one of the key steps is to transform the original process in such a way that a gaussian weighted l 2 expansion converges this is motivated by an analogy to the central limit theorem see also a t sahalia and yu 2005 introduction the sampling interval time between observations plays the role of the sample size n in the central theorem conditional on a correct standardization a n 0 1 density turns out to be the correct limiting distribution as n in the central limit theorem and as 0 for the stochastic process the correcting hermite polynomials the pseudo likelihood ratio then account for the fact that is not 0 a t sahalia 2002 applies two transformations the first change of variables yields a unit diffusion process through the lamperti transform for univariate diffusions it can be shown that such a transformation always exists this step introduces nonlinearities in the drift the resulting process is then centered and scaled in time consequently a gaussian weighted l 2 expansion converges uniformly to the true unknown transition density this strong convergence result which of course exceeds the mere l 2 convergence is proved by using a representation of the true unknown transition density in terms of a brownian bridge functional from rogers 1985 due to the nonlinearities in the drift the coefficients of the a t sahalia 2002 hermite expansion are generally not known in closed form however in practice they are approximated using a taylor expansion in time in terms of the infinitesimal generator of the process this is a key difference to the setting of the present paper where expansions are constructed precisely such that their coefficients are linear in polynomial moments and those are known for affine processes without approximation error in the multivariate case however a lamperti transform is rarely possible since most appli cations call for stochastic volatility models which are irreducible a t sahalia 2008 proposition 14 density expansions approximations as 02 asy 05 y 07 as 08 this paper multivariate no yes yes yes yes everywhere positive no no no yes no integrates to one no no no no yes jumps no yes yes no yes table 1 comparison of closed form transition density approximations as 02 refers to a t sahalia 2002 asy 05 to a t sahalia and yu 2005 y 07 to yu 2007 and as 08 to a t sahalia 2008 1 an entirely different strategy is therefore pursued in a t sahalia 2008 for the irreducible multivariate case where the log likelihood is expanded in both time and space so that the coefficients of the expansion may be computed from the kolmogorov forward and backward equations this approach is adopted by yu 2007 with the difference that he also considers jump diffusions and approximates the transition density itself rather than the log transition density the saddlepoint approach in a t sahalia and yu 2005 is fundamentally different it approx imately solves the fourier inversion problem by expanding the cumulant generating function about the saddlepoint 12 rather than making use of the kolmogorov forward and backward equa tions the maintained assumption here is that the cumulant generating function is available even though for diffusions a t sahalia and yu 2005 section 4 circumvent this problem by us ing a taylor series expansion for small times along the lines of a t sahalia 2002 for nonlinear moments though the saddlepoint approach and this paper both facilitate expansion techniques the objects of the expansion are different and the formulae are unrelated saddlepoint approx imations are extremely accurate even for low orders a t sahalia and yu 2005 fig 2 the price to be paid for this precision is the computational burden of having to solve numerically for the saddlepoint for every pair of forward and backward variables 7 applications in the following we present applications which highlight the usefulness of the transition density approximations developed in this paper for the empirical investigations considered below we find that there is a trade off between numerical accuracy and the order of the expansion higher order expansions may perform worse than low order expansions due to numerical errors that are induced by the limited numeric precision of the computer environment in representing very large or very small numbers as a general guideline we suggest matching as many moments cumulants as possible when choosing l 2 weights and stopping the expansion at a relatively low order such as j 4 for the present section we adopt notation used conventionally in finance and econometrics in particular we deviate from duffie et al 2003 notation the time interval between between observations is generally denoted by 12 for a stochastic process x denote by k t u x 0 loge eu xt x 0 x 0 the cumulant generating function suppose xt x 0 x 0 has an absolutely continuous law for any state x the saddlepoint is defined as the solution u u t x x 0 in u to the implicit equation uk t u x 0 x density expansions 15 we strongly recommend checking the above theoretical foundations for the validation of as sumptions 1 and 2 in numerical applications as outlined in example 7 1 below 7 1 basic affine jump diffusion bajd we first consider a square root process with exponentially distributed jumps this process has been recently used in papers that study portfolio credit risk duffie and garleanu 2001 mortensen 2006 eckner 2009 feldhu tter 2008 where it is termed basic affine jump diffusion bajd and in a bivariate form in single name credit schneider et al 2010 it can be described in sde form 7 1 dyt yt dt ytdwt dkt the intensity of the compound poisson process k is l 0 and the expected jump size of the exponentially distributed jumps is 0 the set of parameters we denote by y l and the domain of the process d r by theorem 4 1 2 2 ensures existence of transition densities example 7 1 developing an l 2 expansion for the bajd to exemplify the necessary steps to develop a density expansion we consider here an explicit example and compute an order j 4 density expansion for the bajd process from eq 7 1 the l 2 weight we use here is a gamma distribution 1 d 1 with density function from eq 5 1 step 1 computing conditional moments the generator of the bajd is af x x f x x 1 2 2 x 2 f x x 2 l r f x f x 1 e d hence the matrix q qij from 4 3 relative to the canonical basis 1 x x 2 x 3 x 4 equals q 0 l 2 l 2 6 l 3 24 l 4 0 2 2 2 l 6 l 2 24 l 3 0 0 2 3 2 3 3 l 12 l 2 0 0 0 3 6 2 4 4 l 0 0 0 0 4 note the upper triangular form a symbolic mathematics software package such as mathematica or maple will be able to compute the matrix exponential eq in closed form the conditional moments n y 0 y e y n y 0 y 0 y may then be obtained by plugging into formula 4 4 we obtain the conditional moments as polynomials of order 4 in the backward variable y 0 below we will suppress dependence of the moments on y 0 y to lighten notation step 2 scaling the process and computing the coefficients having computed the first four conditional moments we now introduce a scaled process y y 1 2 21 and set d 21 2 21 1 note that e y y 0 y 0 y v y y 0 y 0 y d 1 hence in view of lemma 2 2 we match the first two moments of y with the ones of the standardized gamma density w d from eq 5 1 since expectation and variance of d equal d 1 as well by using the corresponding orthogonal polynomials h n from 5 4 along with their normal ization constant ho n from eq 5 5 we obtain the coefficients of the density approximation 16 density expansions 2 1 for each n 0 we have 7 2 cn y 0 y e h n y y 0 y 0 y ho n in particular the first five coefficients are of the following explicit form c 0 y 0 y 1 c 1 y 0 y 0 c 2 y 0 y 0 c 3 y 0 y d 1 d 2 d 3 d 1 2 3 31 6 d 1 d 2 d 3 c 4 y 0 y d 1 4 4 d 4 d 1 1 3 d 2 d 3 31 4 d 1 2 3 2 6 d 1 d 2 d 3 d 4 41 note that due to the chosen scaling the deforming polynomial the pseudo likelihood ratio does not contribute to the density approximation for the first two orders as predicted by lemma 2 2 step 3 verification of assumption 2 we denote by g and g the density of y and y respec tively the existence of g and therefore of g is ensured by requiring 2 2 0 by theorem 4 1 by the same result g and g are of class cp for the greatest nonnegative integer p satisfying 7 3 p 2 2 1 on the other hand using theorem 4 2 one can verify numerically by solving the corresponding riccati differential equations that 7 4 e ey e e d 1 1 y this implies finite polynomial moments of g and g and therefore justifies the calculations in steps 1 and 2 in particular note that the gamma density w d satisfies supx 0 1 x d w x and supx 1 e x w x in view of 7 4 lemma 3 4 implies validity of assumption 2 that is g w l 2 w once d 2 p by 7 3 the latter holds if and only if 13 d 2 2 2 1 which again can easily be checked numerically 13 x denotes the smallest integer which is greater than or equal to x density expansions 17 step 4 putting everything together accounting for the change of variable y y y 1 2 21 the density proxy equals 7 5 g 4 y y y 0 y y y 4 i 0 ci y 0 y h i y y 1 2 21 figure 3 shows how the polynomials ci y 0 y h i y y in the pseudo likelihood ratio deform the auxiliary density w into the right shape 7 2 heston s model the heston 1993 stochastic variance model has been particularly used for the pricing of equity index options the model for the log stock price x and its stochastic variance v can be realized as solution of the following sde dvt v v vt dt vtdw v t dxt x 1 2 vt dt vt dw vt 1 2 dwxt 7 6 with w v wx being a two dimensional standard brownian motion the domain d of the process equals r r with 2 v 2 and 1 theorem 4 1 guarantees existence of transition densities note that it would be perfectly possible to enrich heston s model above with jumps in both factors this has been done for example in duffie et al 2000 eraker et al 2003 and eraker 2004 to multiple variance factors or even a matrix valued variance process as in da fonseca et al 2008 the correlation parameter above is a device to model the leverage effect which is partly responsible for the skew in option prices figure 1 displays using an order 4 expansion how the skew of the density may be altered by decreasing the parameter for the bivariate heston model to compute conditional moments up to order two using formula 4 4 the canonical basis is given by 1 v x v 2 vx x 2 and the correspondingqmatrix analogous to 4 3 is q 0 v x 0 0 0 0 v 12 2 2 v x 1 0 0 0 0 v 2 x 0 0 0 2 v 12 0 0 0 0 0 v 1 0 0 0 0 0 0 example 7 2 standardizing and scaling the heston model our goal is to work within a l 2 space weighted with a product measure w r r 7 r w d d b d composed of d 1 1 and b c densities from definitions 5 1 and 5 2 respectively in this space we may use the polynomials from eqs 5 4 and 5 6 lemma 3 2 ensures that the product of the polynomials forms an onb in the l 2 w space acknowledging lemma 2 2 we want to make sure that we match as many moments as possible to optimize the quality of the approximation below we show how this transformation is composed 18 density expansions 0 200 400 600 800 1000 1200 1400 1600 4 88 4 9 4 92 4 94 4 96 4 98 5 5 02 5 04 5 06 5 08 5 1 g 4 x v x 0 v 0 x 0 0 2 0 4 0 6 0 8 figure 1 the effect of leverage the figure shows the effect on skewness of neg ative correlation between the log stock price and its stochastic variance depicted are approximated transition densities g 4 v x of the heston model for different values of the cor relation parameter for fixed v 0 043 the parameters that generated the picture were 1 52 v 0 04 v 1 0 2 x 0 03 x 0 5 v 0 0 04 we introduce lighter notation by defining ut vt xt and for the first two moments of vt xt e ut u 0 u v x 1 2 and v ut u 0 u v x a 1 b b a 2 for demeaning and block diagonalizing define 1 u 1 u 1 where 1 1 0 b a 1 1 1 0 b 1 a 1 2 then 1 ut has first two moments of the form e 1 ut u 0 u v x 1 0 v 1 ut u 0 u v x a 1 0 0 b 2 a 1 a 2 density expansions 19 the next transformation scales the process into the optimal form according to lemma 2 2 2 u 2 u where 2 1 a 1 0 0 1 b 2 a 1 a 2 then 2 1 ut has first two moments of the form e 2 1 ut u 0 u v x 21 a 1 0 v 2 1 ut u 0 u v x 21 a 1 0 0 1 and choosing d 21 a 1 1 the bivariate orthogonal expansion of the density of 2 2 ut may be performed in terms of the polynomials introduced in 5 4 and 5 6 by the transformation the polynomial moments up to second order induced by w agree with the moments of 2 1 ut and the moment matching lemma 2 2 applies up to order 2 we have used u 7 2 1 u 1 and its inverse is 1 u 7 11 1 2 u 1 1 1 the parameter c in 5 2 is set to the exact excess kurtosis of the transformed log stock process and the expansion may be performed analogously to example 7 1 7 3 cdo pricing in the reduced form credit risk framework lando 1998 we model the stochastic default intensity of a corporation with a positive process such as 7 1 under the pricing measure q the default time of a corporation is then taken to be the first jump of an inhomogeneous poisson process with intensity more formally we write the survival probability of a corporation using the short hand notation et e ft q t ft 11 t et e t t udu all expectations are with respect to the risk neutral pricing measure q for the pricing of port folio credit derivatives to introduce dependence between different obligors duffie and garleanu 2001 and subsequently mortensen 2006 eckner 2009 and feldhu tter 2008 introduce a factor intensity model 7 7 it xit aiyt where xit is a firm specific idiosyncratic intensity factor and yt is a systemic factor common to all obligors i 1 n we model both x and y with independent jump diffusion processes from eq 7 1 for n obligors we must impose n i 1 ai 1 to ensure identifiability see eckner 2009 the survival probability of obligor i according to model 7 7 is then due to independence of the factors 7 8 q i t ft 11 i t et e t t xiu du et e ai t t yu du 20 density expansions defining zt t t t ys ds we may write the default probability of the ith obligor conditional on zt t as 7 9 qi zt t qt t i t zt t 11 i t 1 et e t t xiu du e aizt t and denoting with pnt t k zt t the conditional probability that k of the first n credits in the portfolio default between t and t the recursive algorithm of andersen et al 2003 then develops the number k of defaults conditional on zt t as p 0 t t k zt t 11 k 0 p m 1 t t k zt t qm 1 zt t p m t t k 1 zt t 1 qm 1 zt t p m t t k zt t 7 10 for 0 k n and 0 m n the expressions et e t t xiu du i 1 n are unproblematic but computing the unconditional default probability p n t t k p n t t k zt t dq zt t involves an integration against the density of zt t we can get hold of the distribution of zt t by investigating the joint evolution of y from eq 7 1 and the integral over y we therefore embed y into the two dimensional affine process y z described by dy yt dt ytdwt dkt dzt ytdt 7 11 note that even though the instantaneous covariance matrix of the process 7 11 above is only of rank one this process is a well defined affine process in the sense of duffie et al 2003 as pointed out also in section 4 3 existence of the marginal transition density of zt t yt is shown in theorem 4 3 for 2 in principle the conditional default probabilities from eq 7 10 may be computed using the moment generating function of zt t in real world applications n is typically larger than 100 however and the expressions become intractably large even for small k in practice recursion 7 10 is therefore computed through numerical integration a test of our density expansion in this setting may therefore be reduced to the question of how well we can approximate the true moment generating function below we outline how this approximation can be done in closed form denote by e j t f zt t the expectation of f zt t with respect to a j order expansion instead of the true density considering the functional form of the expansion 2 1 to approximate the expressions et e zt t ai i 1 n we note that we need to perform the computation e j t eazt t r ea w j j 0 cjhj d 7 12 j j 0 ch j r ea jw d 7 13 density expansions 21 1 e 07 8 e 08 6 e 08 4 e 08 2 e 08 0 2 e 08 4 e 08 6 e 08 8 e 08 1 e 07 10 5 0 5 10 lo g e j e a z lo g e e a z a order 2 order 10 figure 2 true vs approximated moment generating function the figure shows the log difference between the true moment generating function et eazt t and the approximated moment generating function e j t eazt t computed for an order 2 and an order 10 expansion of the integrated bajd from 7 11 the parameters that generated the picture were a 1 t t 5 0 00150602 0 4648 0 01 l 1 0 0002 y 0 l results are computed using mathematica and the picture is generated with a numeric precision of 20 digits where ch j is implicitly defined as 14 j j 0 cjhj j j 0 ch j j the chosen l 2 weight w for the approximating transition density is a gamma distribution to compute eq 7 13 for a random variable z that is gamma distributed z we note that e eazzn n n 1 a n n n a r where denotes the gamma function figure 2 shows that for the order 10 expansion the approximation error is numerically zero the order 2 expansion also works well with negligible numeric error 7 4 likelihood based inference in this section we investigate the performance of the poly nomial density expansions in likelihood based inference for discrete equally spaced with time interval observations x 0 x 1 xn x of a markov process xt t 0 x 0 x 0 with domain 14 in practice the coefficients may be collected using a symbolic mathematics package such as mathematica or maple 22 density expansions 0 50 100 150 200 250 300 0 004 0 006 0 008 0 01 0 012 0 014 0 016 0 01 0 008 0 006 0 004 0 002 0 0 002 0 004 0 006 log g 10 z log gz gz g 10 z a order 10 expansion 0 50 100 150 200 250 300 0 004 0 006 0 008 0 01 0 012 0 014 0 016 1 0 8 0 6 0 4 0 2 0 0 2 0 4 0 6 0 8 1 1 2 log g 2 z log gz gz g 2 z b order 2 expansion figure 3 density plots of the integrated bajd the figure shows the density of z 0 y 0 y from specification 7 11 the parameters generating this density are 5 0 00150602 0 4648 0 01 l 1 0 0002 y 0 l the right y axis shows the deviation error to the true density obtained by fourier inversion in percentage terms d and parameters x we may write the likelihood function lx dn x r as 7 14 lx x x x 0 n i 1 gx xi xi 1 x density expansions 23 denote by 7 15 l j x x x x 0 n i 1 g j x xi xi 1 x the approximate likelihood function using a j order expansion developed in this paper the maximum likelihood estimator x is obtained as the global maximizer of the likelihood 7 14 7 16 x argmax x n i 1 gx xi xi 1 x similarly for a maximizer obtained from the approximate likelihood l j x we write 7 17 j x argmax x n i 1 g j x xi xi 1 x the bayesian framework cf robert 1994 for reference and comparison to other methodologies views the parameters themselves as random variables and is aimed at the posterior density p x x lx x x l x d x lx x x x 7 18 the prior density x r expresses the econometrician s personal beliefs and knowledge its specification may be fueled by economic intuition for example that nominal interest rates should be positive and also parameter constraints note that the expression 7 18 invokes bayes theorem and therefore demands that lx and actually are densities in that they are non negative functions on the domain of the random variable and integrate to one this requirement has been challenged to a great extent the most common violation stems from expressing uninformedness by setting the prior for a parameter with positive domain proportional to a constant 7 19 1 prior specifications such as the one mentioned above are called improper priors because their integral does not exist a less common violation arises from the use of closed form likelihood expansions within bayesian inference for markov processes 15 for the univariate likelihood ex pansions from a t sahalia 2002 the normalization constant may be evaluated through numeric integration putting a heavy computational burden on the econometrician for the multivariate expansions for irreducible models from a t sahalia 2008 the normalization constant does not even exist because the expansions are purely polynomial in contrast the expansions devel oped in the present paper integrate to one by construction they share with the expansions from a t sahalia 2002 the unpleasant feature that they may become negative however even though experience shows that this happens very rarely for the empirical studies in this paper for instance it has not happened even once 15 see di pietro 2001 for an introduction to the problem and stramer et al 2009 for mcmc algorithms to overcome it in a very general context 24 density expansions subsequently we will denote posteriors where the likelihood is approximated using the ap proximate likelihood l j x from 7 15 by p j x x l j x x x x to test both methodologies we generate realizations from models 7 1 and 7 6 through exact simulation methods we then perform both frequentist and bayesian inference using our density approximations and the true density obtained through fourier inversion of the characteristic function frequentist inference is performed on 1 000 data sets generated by model 7 6 to acquire information about the sampling distribution of the approximate maximum likelihood estimators bayesian inference is performed on one data set for the bajd eq 7 1 and heston s model eq 7 6 respectively we then compare the posterior distribution originating from true density to the posterior distribution generated by the density approximations from this paper the simulation for each data set is started from the unconditional mean and then propagated forward 600 data points we discard the first 100 observations to eliminate impact of the initial condition to investigate the behavior of our density expansions for different time horizons we choose a monthly observation frequency for the square root jump diffusion 7 1 and weekly observation frequency for the heston model 7 6 to obtain exact draws from the bajd we generate exact draws from yi yi 1 using robert and casella 2004 lemma 2 4 for a uniform random variable u u 0 1 we ex ploit that g 1 y u yi 1 y gy for any distribution function gy we simulate from 7 1 using the parameters 0 04 1 0 2 l 3 0 01 algorithm 7 1 exact draws from bajd process 7 1 we perform the following procedure starting from y 0 e yt the unconditional mean for a realization yi yi 1 i draw u u 0 1 call the realization ui ii use the newton raphson algorithm to compute y gy y y yi 1 y ui in this step we substitute y e w 1 ew c to keep y on the positive domain the floor parameter c we set to 10 6 to avoid numerical difficulties the iteration is then wj 1 wj e wj ewj 1 2 gy y c e wj e wj 1 yi 1 y ui gy c e wj e wj 1 yi 1 y starting from w 0 log yi 1 c c yi 1 1 stop the iteration at w gy y c ew ew 1 yi 1 y ui both gy and gy are obtained through fourier inversion in our implementation the algorithm terminates after 5 to 6 iterations for 10 6 iii set yi c ew ew 1 increment i and go back to step 1 for bayesian inference we specify an uninformative prior 7 20 y 11 2 2 0 l 0 0 1 l density expansions 25 the heston parameters are v 1 v 0 04 0 2 x 0 03 0 8 to obtain exact draws from this model we refer the reader to the algorithm in broadie and kaya 2006 for bayesian inference we specify the prior distribution as 7 21 v x 11 2 v 2 1 1 0 1 v to evaluate the transition density we employ the formulation from lamoureux and paseka 2005 which may be evaluated using a single numerical integral instead of the two dimensional fourier integral this reduction of dimensionality comes at the price of having to evaluate complex valued special functions however with 1 000 datasets of weekly realizations from the heston model for each dataset we obtain parameters v x by maximizing the log likelihood 7 14 respectively the approximate log likeli hood 7 15 we use the optimizer donlp 2 to achieve this task to relate the density expansions of this paper to existing approximations we perform the estimation experiment with the true density obtained through fourier inversion denoted by mle order 4 likelihood expansions developed in this paper using a product measure with a gamma weight for the variance process and for the log stock variable a bilateral gamma weight specifically we employ formulation 5 3 estimates are denoted by bg 4 gaussian weight estimates are denoted by g 4 order 2 closed form likelihood expansions from a t sahalia 2008 denoted by cf 2 gaussian approximation using true conditional moments up to order 2 denoted by qml table 3 reveals that the true likelihood function exhibits problematic behavior for some pa rameterizations only 688 out of 1 000 estimates turned out to be successful this is due to numerical integration problems that occur in particular for low values of that arise in the like lihood search density expansions developed in this paper are also not entirely unproblematic numerical errors from evaluating the pseudo likelihood ratio accumulate and induce spikes that irritate the optimizer s numerical differentiation routines the hermite polynomials used for g 4 appear better behaved than the polynomials associated with the bilateral gamma density used in bg 4 table 3 a reports bias and rmse of the estimators the large bias of 0 2255 for the param eter is a well established phenomenon that has also been reported in a t sahalia and kimmel 2007 as an overall impression the results suggest that the density approximations developed in this paper exhibit parameter estimates with properties similar to the true ml estimates while a t sahalia 2008 expansions interestingly exhibit lower bias with the exception of the parameter but higher rmse in table 3 b the first column mean in mlev x truev x indicates mean deviation from the true ml estimator and the second column sd captures statistical noise in the estimation estimation bias around the mle for all estimators appears very small except for the cf 2 estimator the noise induced through the density approximations is smaller than the estimation noise of the true mle surprisingly the qml estimator a special case of the approximations developed in this paper since it is an order two expansion around a gaussian performs remarkably well all around the bg 4 expansions appear to be the preferable choice in particular bg 4 mle and bg 4 mle point to the right direction the estimators are closer to the true parameters than mle http www mathematik tu darmstadt de 8080 ags ag 8 mitglieder spellucci de html 26 density expansions the results of the bayesian inference study also appear promising inspecting figures 5 we see that an order 2 expansion already delivers reasonable results while the order 4 expansion seems to be even closer to the posterior density obtained from the true density function to assess how close the posteriors p 2 v x and p 4 v x densities are to the posterior obtained through the true transition density pv x we compute kolmogorov smirnov tests the results can be seen in table 2 they suggest that while p 2 v x appears to be quite different from pv x p 4 v x is statistically almost indistinguishable from the true posterior pv x for the majority of the parameters 7 5 option pricing heston s model 7 6 is used for option pricing because it may be con sistent with the implied volatility skew that can be inferred from market prices as such it is much more compatible with real data than say the black scholes model in stock index option pricing the quantity of interest are marginal transition probabilities of the log stock price x we therefore engineer an approximation directly around the marginal density of x x 0 v 0 by expanding gx in l 2 b we set the constant c from 5 2 to the excess kurtosis of x recall that the price of a european call option with maturity and strike price k is given by c k e r e ex k x 0 x v 0 v v x e r logk e gx x v v x d ha k k logk gx x v v x d hb k 7 22 in accordance with the previous sections we will denote c j k and similarly ha j k and hb j k the option price computed with g j x instead of gx denoting q x x the transition probability and accordingly q j x x the j order approximation of the transition probability we have that hb j k 1 q j x logk and using the standardization from example 7 2 and the change of variables formula hb j k 1 logk g j x x v v x d 1 1 a 2 logk b 2 a 2 1 j i 1 ci x v v x h b i 2 a 2 d 1 1 a 2 j i 0 b logk 2 a 2 i i x v v x 7 23 here h b i are from eqs 5 6 and 5 7 and i x v v x are implicitly defined as 1 j i 1 ci x v v x h b i 2 a 2 j i 0 i x v v x i the function b k n k n b d is explicit in terms of the gamma function and regular ized generalized hypergeometric functions the constituent ha j of the approximate call price density expansions 27 0 182 0 184 0 186 0 188 0 19 0 192 0 194 0 196 0 198 0 2 0 202 5 09 5 1 5 11 5 12 5 13 5 14 5 15 5 16 5 17 i v logk iv c 4 1 52 k iv c 1 52 k a option pricing error 0 2 4 6 8 10 12 14 16 4 95 5 5 05 5 1 5 15 5 2 g 4 x x x 0 v 0 v x x b density figure 4 closed form option pricing in heston s model panel 4 a shows implied black scholes volatility of the true option price here computed using the carr and madan 1999 dampened fourier inversion approach and the c 4 k option pricing formula from the approximation of eq 7 22 as a function of strike k the second panel 4 b shows the density function of x x 0 v 0 to indicate the likelihood moneyness trade off the parameters for the model 7 6 behind the pictures are 1 52 v 0 04 v 1 0 2 x 0 03 0 8 x 0 5 1 v 0 0 04 from eq 7 22 can be computed by numeric integration figure 4 shows that option pricing performance is very good remark 7 2 collecting coefficients to compute i from section 7 5 eq 7 23 by hand is very error prone instead we recommend using a symbolic mathematics software package such as mathematica or maple 8 discussion this paper develops a general framework for density approximations for affine processes us ing orthonormal polynomial expansions in well chosen weighted l 2 spaces we provide novel existence and smoothness results for their transition densities in particular the approximations are designed to exploit the explicit polynomial moments of affine pro cesses to compute the coefficients of the expansion without approximation error and in closed form the computational burden is concentrated only in the initial calculation of the coeffi cients of the expansions once they are implemented evaluation is rapid avoiding the heavy computational cost of fourier methods to obtain transition densities empirical applications in credit risk likelihood based parameter inference and option pricing suggest that the density expansions are very accurate the paper leaves a number of open points for future research the first question concerns approximations in higher order weighted sobolev spaces one might suspect that approximation of sufficiently smooth densities in weighted higher order sobolev spaces are superior to l 2 expansions in particular it could be expected that i the quality of approximation might be better ii sobolev embedding theorems could be applied to infer global uniform convergence however quite contrary to the l 2 case it is unknown whether the space of polynomials is dense in weighted sobolev spaces higher order sobolev spaces also impose heavy restrictions on the 28 density expansions functional form of the approximation weights which in turn lead to very slow convergence rates indeed preliminary numerical experiments suggest that the price for global uniform convergence which potentially comes with higher order sobolev spaces is a very slow convergence rate another route worth pursuing is a compact truncation of the state space such that approx imations could be performed in non weighted sobolev spaces for which there is more theory available in the literature suitable approximation weights such as the bilateral gamma weight of this paper are a research topic of its own and they lead to non trivial problems in the theory of special functions also density expansions for processes on state spaces different from the canonical ones would be highly desirable as an example we mention the class of matrix valued processes used in co volatility modeling leippold and trojani 2008 da fonseca et al 2008 buraschi et al 2008 appendix a proofs for section 3 this appendix gathers the proofs of the lemmas in section 3 proof of lemma 3 1 that the set of polynomials is dense in l 2 w is shown in bernard 1995 lemma 1 the assumption made in bernard 1995 that w is strictly positive can easily be omitted by replacing point wise equality 0 by 0 w d a s at the end of the proof of bernard 1995 lemma 1 an orthonormal basis of polynomials h nd 0 of l 2 w with degh is obtained by applying the gram schmidt process to the linearly independent set of monomials nd 0 see algorithm 5 1 proof of lemma 3 2 that the product density w on rd has finite exponential moment 3 1 follows from the elementary inequality d i 1 i for all rd the orthonormality of h follows from the easily verifiable relationship h h l 2 w d i 1 h i i h i i l 2 wi r nd 0 moreover every monomial 1 1 d d can be written as a product of linear combinations of the respective orthonormal polynomials i i i j 0 ijh i j i it follows that the set h nd 0 is dense in l 2 w and hence forms an orthonormal basis of l 2 w this proves the lemma proof of lemma 3 3 the lemma follows from the estimate rd g 2 w d rd g e 0 w e 0 g d sup x rd g x e 0 x w x rd e 0 g d density expansions 29 proof of lemma 3 4 a taylor expansion of g x around 0 gives g x p xg p xp for some x 0 x since pxg is continuous we conclude that there exists some finite constant k such that g x k xp for all x 0 1 we then obtain 0 g 2 w d 1 0 g 2 w d 1 g e 0 w e 0 g d k 2 1 0 2 p w d sup x 1 g x e 0 x w x 1 e 0 g d this proves the lemma proof of lemma 3 5 let x i and let i be such that xi mini xi a taylor expansion of g x y in xi around xi 0 gives g x y p x i g y p xi p for some x y i since p xig x y is bounded on i rn we conclude that there exists some finite constant k such that g x y k mini xpi for all x y i rn we then decompose rm rn g 2 w d d i 1 i 2 with i 1 i rn g 2 w d d k i rn mini p i e 2 w e 2 g d d k sup x y i rn mini x p i e 2 y w x y i rn e 2 g d d and i 2 1 m rn g 2 w d d 1 m rn g e 1 2 w e 1 2 g d d sup x y 1 m rn g x y e 1 x 2 y w x y 1 m rn e 1 2 g d d this proves the lemma appendix b proof of theorem 4 1 first we note that the existence and smoothness properties of a density on rd for xt x 0 x is invariant with respect to non singular linear transformations of the state vector xt in view of filipovic 2009 theorem 10 7 there exists a non singular linear transformation of the state 30 density expansions vector xt mapping d rm rn onto itself and which renders block diagonal matrices i in the form b 1 i diag 0 0 i ii 0 0 0 0 i jj so that x i x i iix 2 i x j i jj xj for all x rd moreover this transformation does not affect the upper diagonal element i ii see the proof of filipovic 2009 lemma 10 5 which is important in view of the criterion 4 6 hence without loss of generality we shall from now on assume that the matrices i are of the block diagonal form b 1 we now recall a classical result on characteristic functions of probability measures see sato 1999 proposition 28 1 lemma b 1 let be a probability measure on rd assume its characteristic function iu rd e iu d satisfies rd iu u k du for some nonnegative integer k then has a density h x of class ck and the partial derivatives of h x of orders 0 k tend to 0 as x it thus remains to prove the appropriate integrability of the affine characteristic function 4 1 that is the appropriate tail behavior in u rd of the functions t iu and t iu the following lemma is our core result which together with lemma b 1 completes the proof of theorem 4 1 lemma b 2 the following properties are equivalent i the d n 1 d matrix k given in 4 5 has full rank ii for any t 0 the d d matrix a t t 0 diag 0 eb jj s a ebjjs ds t i l i is nonsingular iii for any t 0 there exists an 0 such that the cones c 0 u rd u j t 0 eb jj s a ebjjs ds uj u 2 ci u rd u i u u 2 i 1 m cover rd that is m i 0 ci r d moreover any of the above properties i ii or iii implies that b 2 rd e t iu t iu x u p du for all nonnegative numbers p mini 1 m bi i ii 1 the remainder of this section is devoted to the proof of lemma b 2 let t 0 and u rd 0 we first claim that u k 0 if and only if u a t 0 which proves equivalence of i and ii to prove the claim note that since a t is positive semidefinite u a t 0 is equivalent to density expansions 31 u a t u 0 since each of the summands in a t is positive semidefinite this again is equivalent to u m i 1 i 0 and u j e b jj s a 0 for all s 0 t a power series expansion of eb jj s shows that this is equivalent to u m i 1 i 0 and u j bkjj a 0 for all k n 0 the cayley hamilton theorem see horn and johnson 1990 theorem 2 4 2 implies that for all k n bkjj is a linear combination of id bjj b n 1 jj whence the above property is equivalent to u k 0 which proves the claim the equivalence of ii and iii follows from the identity u a t u u j t 0 eb jj s a ebjjs ds uj t i l u i u and the fact that each of the summands is nonnegative this establishes the first part of lemma b 2 as for the second part of lemma b 2 we note that as a consequence of b 1 the real and imaginary parts f t iu t iu and g t iu t iu of satisfy the following system of riccati equations for i 1 m tfi i iif 2 i g i g bi f d ef cos g 1 i d fi 0 0 fj 0 tgi 2 fi i ii gi bi g d ef sin g i d gi 0 ui gj e bjj tuj in the sequel we will make use without further notice of the fact that fi is r valued for all i 1 m and that fj 0 for all j j in particular it follows from above that fi satisfies the following system of differential inequalities tfi i ii f 2 i g i g bii fi i 1 m for any u 6 0 we now define the scaled functions b 3 f t u 1 u f t u iu g t u 1 u g t u iu 32 density expansions then f and g satisfy for i 1 m b 4 tfi i ii f 2 i g ig 1 u bii fi fi 0 0 fj 0 tgi 2 fi i iigi 1 u bi ki g gi 0 ui u gj e bjj t uj u where we define the d d matrix k k t u by its 1 d row vectors ki d 1 0 cos s u g ds e u f i d i 1 m 0 i m 1 d and we have used the simple fact that e u f sin u g e u f 1 0 d ds sin s u g ds u g e u f 1 0 cos s u g ds it follows by the assumptions on i that the matrix k is uniformly bounded sup t u k t u k where the constant k only depends on the measures i the squared norm of g thus satisfies t g 2 2 g tg 4 g diag f g 2 u g b k g 2 u b k g 2 g 0 2 1 we shall now and in the sequel make use of the following comparison result which is a special case of a more general theorem proved by volkmann 1972 lemma b 3 let r t v be a continuous real map on r r and locally lipschitz continuous in v let p t and q t be differentiable functions satisfying d dt p t r t p t d dt q t r t q t p 0 q 0 then we have p t q t for all t 0 density expansions 33 applying lemma b 3 to the above differential inequality for g 2 we obtain b 5 g 2 e 2 u b k t for any i 1 m we then obtain the differential inequality t g ig 2 g i tg 4 g i diag f ig 2 u g i b k g 4 i ii fi i iig 2 i 2 i u b k g 2 4 i ii fig ig 2 i u b k e 2 u b k t g 0 ig 0 u iu u 2 where we have used the fact that i iig 2 i g ig and b 5 for the last inequality lemma b 3 again yields the lower bound g ig e 4 i ii t 0 fi s ds u iu u 2 2 i u b k t 0 e 4 i ii t s fi r dr 1 e 2 u b k t s ds e 4 i ii t 0 fi s ds u iu u 2 i e 2 u b k t 1 combining this with the differential inequality b 4 for f we obtain b 6 tfi i ii f 2 i 1 u bii fi e 4 i ii t 0 fi s ds u iu u 2 i e 2 u b k t 1 f 0 0 we arrive at the following intermediate result lemma b 4 for every 0 and t 0 0 there exists some 0 and r 0 such that fi t 0 iu for all u rd with u r and u i u u 2 for all i 1 m proof the differential inequality b 6 is autonomous and smooth in fi moreover the initial slope satisfies tfi t iu t 0 u iu u 2 34 density expansions uniformly in i and u in the designated set also notice the estimate 1 u bii fi 1 r bii fi and the uniform bound on the last summand on the right hand side of b 6 for t t 0 and u r the claim now follows from lemma b 3 below we shall make use of the following is easy to check auxiliary result on riccati equations lemma b 5 let a 0 b r 0 and t 0 0 and g 0 0 for t t 0 the solution of tg t ag t 2 bg t g t 0 g 0 is of the form g t bg 0 e b t t 0 ag 0 b ag 0 eb t t 0 if b 0 then g t g 0 1 ag 0 t t 0 from b 4 we deduce the trivial differential inequality tfi i ii f 2 i bii u fi by lemma b 5 the solution of th i ii h 2 bii u h with h t 0 0 is explicitly given by h t e bii u t t 0 u i iibii e bii u t t 0 1 1 h t 0 t t 0 together with lemmas b 3 and b 4 and we thus obtain that b 7 fi t iu e bii u t t 0 u i iibii e bii u t t 0 1 1 t t 0 for all u r with u i u u 2 by rescaling we infer fi t iu u fi t u iu u e bii t t 0 u u i iibii e bii t t 0 u 1 1 1 i ii d dt log u i ii bii e bii t t 0 u 1 1 t t 0 u density expansions 35 for all u r with u i u u 2 integrating this inequality yields b 8 t 0 fi s iu ds t t 0 u fi s iu ds 1 i ii log u i ii bii e bii t t 0 u 1 1 log 1 1 i ii log u i ii bii e bii t t 0 u 1 1 t t 0 u for all u r with u i u u 2 we arrive at the following key result which completes the proof of lemma b 2 lemma b 6 let i 1 m for every 0 and t 0 there exists some r 0 and c 0 such that e t iu t iu x c 1 u bi i ii for all u rd with u r and u i u u 2 moreover t iu u j t 0 eb jj s a ebjjs ds uj for all u rd proof integration of 4 2 implies t iu t iu x t iu u j t 0 eb jj s a ebjjs ds uj bi t 0 fi s iu ds together with b 8 this proves the lemma appendix c proof of theorem 4 3 fix some 0 we consider the two dimensional process z x y where yt y t 0 xxs ds with y r it is easy to see that x y is an affine process with state space r 2 in particular if y 0 we have that yt t 0 xxs has an exponentially affine characteristic function of the form e eivyt x 0 x e t iv t iv x v r where the characteristic exponents and satisfy the generalized riccati differential equations t b 0 0 t 2 i v 0 e 1 d 0 0 36 density expansions for any v 6 0 we define the scaled functions 16 f t iv 1 v t v iv g t iv 1 v t v iv then f and g satisfy c 1 tf f 2 g 2 v f 1 v 0 e v f cos v f 1 d f 0 0 tg 2 fg v g v v 1 v 0 e v f sin v f d g 0 0 we now prove a first intermediary result which is analogous to lemma b 4 lemma c 1 there exists some t 0 0 0 and r 0 such that f t 0 iv for all v with v r proof for v the solutions f t iv and g t iv of c 1 converge locally uniformly in t to the solutions f t and g t of the system tf f 2 g 2 f 0 0 tg 2 f g 1 g 0 0 since tg t t 0 1 it follows that there exists some t 1 0 such that g t 6 0 for all t 0 t 1 this again implies that f t 0 0 for some t 0 0 t 1 and the lemma follows from c 1 we deduce the trivial differential inequality f f 2 v f arguing as for the derivation of b 7 we then obtain together with lemmas b 3 and c 1 that f t iv e v t t 0 v e v t t 0 1 1 t t 0 16 note that here we have to scale by v which is in contrast to the proof of theorem 4 1 see b 3 density expansions 37 for all v r with v r by rescaling and integrating we infer arguing as for the derivation of b 8 that t 0 s iv ds t t 0 v s iv ds 1 log v e t t 0 v 1 1 log 1 1 log v e t t 0 v 1 1 t t 0 v for all v r with v r similarly as in lemma b 6 we now infer that e t iv t iv x c 1 v b 2 combining this with lemma b 1 completes the proof of theorem 4 3 appendix d figures and tables heston model bajd ks order 2 order 4 ks order 2 order 4 v 0 0199 0 6654 v 0 0038 0 2360 v 0 0000 0 0693 v 0 0396 0 7658 v 0 0001 0 2574 v 0 0000 0 6754 x 0 0018 0 0348 l 0 0000 0 0571 0 0003 0 3291 0 0000 0 0049 table 2 kolmogorov smirnov test statistics the table displays p values for a two sided kolmogorov smirnov test applied to posterior density pv x to p 2 v x and p 4 v x using prior 7 21 for the heston model in the left panel the right panel displays p values for the test applied to py to p 2 y and p 4 y the bajd model the prior distribution for this model is defined in eq 7 20 the true posterior is defined in eq 7 18 and the approximate posterior densities are defined in eq 7 19 38 density expansions mle bg 4 qml g 4 cf 2 success 688 841 982 949 981 table 3 heston estimation success the table reports the number of estimation successes on 1 000 datasets generated as exact draws from the heston model using the technology from broadie and kaya 2006 estimation success is defined by the optimizer meeting the termination criterion which is a function of the norm of the gradient of the log likelihood function the density approximations used are bg 4 a fourth order expansion using a bilateral gamma weight for the log stock variable and a gamma weight for the variance variable g 4 a fourth order expansion using a gaussian weight for the log stock variable and a gamma weight for the variance variable qml denotes a gaussian approximation using the true conditional moments up to order 2 and cf 2 denotes the second order likelihood expansions from a t sahalia 2008 the optimizer used in the likelihood search is donlp 2 http www mathematik tu darmstadt de 8080 ags ag 8 mitglieder spellucci de html d e n s it y e x p a n s io n s 3 9 a bias truev x mle bg 4 qml g 4 cf 2 bias rmse bias rmse bias rmse bias rmse bias rmse 1 0 2255 0 4253 0 2313 0 4168 0 2324 0 4214 0 2327 0 4187 0 1905 0 5553 v 0 04 0 0093 0 0166 0 0094 0 0164 0 0093 0 0167 0 0095 0 0164 0 0063 0 0179 0 2 0 0009 0 0049 0 0007 0 0047 0 0008 0 0047 0 0009 0 0047 0 0044 0 0117 x 0 03 0 0151 0 0473 0 0145 0 0469 0 0138 0 0483 0 0150 0 0472 0 0050 0 0624 0 8 0 0016 0 0147 0 0001 0 0138 0 0015 0 0140 0 0016 0 0138 0 0003 0 0270 b estimation noise truevx mlevx truev x bg 4 v x mlevx qml vx mlevx g 4 vx mlev x cf 2 v x mlevx mean sd mean sd mean sd mean sd mean sd 1 0 2255 0 3609 0 0057 0 1235 0 0069 0 1313 0 0072 0 1179 0 0350 0 4336 v 0 04 0 0093 0 0137 0 0001 0 0024 0 0001 0 0043 0 0002 0 0025 0 0030 0 0092 0 2 0 0009 0 0048 0 0002 0 0014 0 0001 0 0015 0 0000 0 0014 0 0035 0 0100 x 0 03 0 0151 0 0448 0 0006 0 0121 0 0013 0 0171 0 0001 0 0129 0 0101 0 0390 0 8 0 0016 0 0146 0 0015 0 0049 0 0001 0 0050 0 0001 0 0049 0 0018 0 0255 table 4 heston asymptotic assessment panel a displays bias and rmse of the mle estimator and the approximated mle estimators panel b displays mean and standard deviation of ml estimation bias as well as the first two moments of the difference between the mle estimator and the approximated mle estimators computed over a sample of 1 000 datasets all of which generated as exact draws from the heston model using the technology from broadie and kaya 2006 for a given dataset only parameter estimates were taken into consideration where all five estimators converged out of 1 000 this left 578 samples the number of estimation successes is reported in table 3 above approximate estimators are obtained through bg 4 a fourth order expansion using a bilateral gamma weight for the log stock variable and a gamma weight for the variance variable g 4 a fourth order expansion using a gaussian weight for the log stock variable and a gamma weight for the variance variable qml denotes a gaussian approximation using the true conditional moments up to order 2 and cf 2 denotes the second order likelihood expansions from a t sahalia 2008 40 density expansions 0 0 2 0 4 0 6 0 8 1 1 2 0 0 5 1 1 5 2 2 5 3 pxv p 4 xv p 2 xv a v 0 10 20 30 40 50 60 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 pxv p 4 xv p 2 xv b v 0 10 20 30 40 50 60 70 80 90 0 185 0 19 0 195 0 2 0 205 0 21 0 215 0 22 0 225 0 23 0 235 pxv p 4 xv p 2 xv c 0 2 4 6 8 10 12 14 0 05 0 0 05 0 1 0 15 0 2 0 25 0 3 pxv p 4 xv p 2 xv d x 0 5 10 15 20 25 30 0 86 0 84 0 82 0 8 0 78 0 76 0 74 0 72 pxv p 4 xv p 2 xv e figure 5 posterior densities for heston s model the figure displays the mar ginal posterior distributions of the parameters of heston s model conditional on the data bayesian estimation is performed using prior specification 7 21 with the true transition density gv x obtained through fourier inversion closed form density up to second g 2 v x and fourth order g 4 v x density expansions 41 references a t sahalia y 2002 maximum likelihood estimation of discretely sampled diffusions a closed form approximation approach econometrica 70 223 262 2007 estimating continuous time models using discretely sampled data cambridge university press in richard blundell torsten persson whitney k newey advances in economics and econometrics theory and applications chapter 9 2008 closed form likelihood expansions for multivariate diffusions annals of statistics 36 906 937 a t sahalia y and l p hansen eds 2009 handbook of financial econometrics else vier a t sahalia y and r kimmel 2007 maximum likelihood estimation of stochastic volatility models journal of financial economics 83 413 452 a t sahalia y and j yu 2005 saddlepoint approximations for continuous time markov processes journal of econometrics forthcoming andersen l j sidenius and s basu 2003 all your hedges in one basket risk bates d 2006 maximum likelihood estimation of latent affine processes review of financial studies 19 909 965 bernard p 1995 lecture notes in physics springer vol 451 1995 chap some remarks concerning convergence of orthogonal polynomial expansions 327 334 bibby b m jacobsen and m s rensen 2004 estimating functions for discretely sampled diffusion type models working paper caf centre for analytical finance univer sity of aarhus broadie m and o kaya 2006 exact simulation of stochastic volatility and other affine jump diffusion processes operations research 54 217 231 bru m f 1991 wishart processes journal of theoretical probability 4 725 751 buraschi a a cieslak and f trojani 2008 correlation risk and the term struc ture of interest rates working paper imperial college and university of st gallen carr p and d madan 1999 option valuation using the fast fourier transform journal of computational finance 2 61 73 chen h and s joslin 2011 generalized transform analysis of affine processes and applications in finance working paper sloan school of management and marshall school of business collin dufresne p r s goldstein and c s jones 2008 identification of maxi mal affine term structure models journal of finance 63 743 795 cox j j ingersoll and s ross 1985 a theory of the term structure of interest rates econometrica 53 385 407 cuchiero c d filipovic e mayerhofer and j teichmann 2010 a affine pro cesses on positive semidefinite matrices the annals of applied probability 21 397 463 cuchiero c j teichmann and m keller ressel 2010 b polynomial processes and their application to mathematical finance finance stochastics forthcoming da fonseca j m grasselli and c tebaldi 2008 a multifactor volatility heston model quantitative finance 8 591 604 dai q and k j singleton 2000 specification analysis of affine term structure mod els journal of finance 55 1943 1978 42 density expansions di pietro m 2001 bayesian inference for discretely sampled diffusion processes with financial applications ph d thesis carnegie mellon university duffie d d filipovic and w schachermayer 2003 affine processes and applica tions in finance annals of applied probability 13 984 1053 duffie d and n garleanu 2001 risk and valuation of collateralized debt obliga tions financial analysts journal 57 41 59 duffie d and r kan 1996 a yield factor model of interest rates mathematical finance 6 379 406 duffie d j pan and k singleton 2000 transform analysis and asset pricing for affine jump diffusions econometrica 68 1343 1376 eckner a 2009 computational techniques for basic affine models of portfolio credit risk journal of computational finance 100 1 35 elerian o s chib and n shephard 2001 likelihood inference for discretely ob served nonlinear diffusions econometrica 69 959 993 eraker b 2001 mcmc analysis of diffusion models with application to finance jour nal of business economic statistics 19 177 191 2004 do stock prices and volatility jump reconciling evidence from spot and option prices journal of finance 59 1367 1404 eraker b m johannes and n polson 2003 the impact of jumps in volatility and returns journal of finance 58 1269 1300 feldhu tter p 2008 an empirical investigation of an intensity based model for pricing cdo tranches working paper copenhagen business school filipovic d 2009 term structure models a graduate course springer berlin filipovic d and e mayerhofer 2009 affine diffusion processes theory and applica tions forman j l and m s rensen 2008 the pearson diffusions a class of statistically tractable diffusion processes scandinavian journal of statistics 35 438 465 gallant a r and g tauchen 2009 simulated score methods and indirect inference for continuous time models in a t sahalia and hansen 2009 heston s 1993 a closed form solution for options with stochastic volatility with applica tions to bond and currency options review of financial studies 6 327 343 horn r a and c r johnson 1990 matrix analysis cambridge cambridge university press corrected reprint of the 1985 original hurn a j jeisman and k lindsay 2007 seeing the wood for the trees a critical evaluation of methods to estimate the parameters of stochastic differential equations journal of financial econometrics 5 390 455 2008 horses for courses polynomial based approximations of transitional density working paper queensland university of technology university of glasgow johnson n l s kotz and n balakrishnan 1995 continuous univariate distribu tions vol 2 wiley series in probability and mathematical statistics applied probability and statistics new york john wiley sons inc second ed a wiley interscience publica tion jones c s 1998 bayesian estimation of continuous time finance models working paper university of rochester density expansions 43 kristensen d and a mele 2011 adding and subtracting black scholes a new ap proach to approximating derivativeprices in continuous time models journal of financial economics forthcoming ku chler u and s tappe 2008 a bilateral gamma distributions and processes in financial mathematics stochastic processes and their applications 118 261 283 2008 b on the shapes of bilateral gamma densities statistics and probability letters 78 2478 2484 lamoureux c g and a paseka 2005 information in options and underlying asset dynamics working paper university of arizona lando d 1998 on cox processes and credit risky securities review of derivatives research 2 99 120 le a k singleton and q dai 2010 discrete time affineq term structure models with generalized market prices of risk review of financial studies 23 2184 2227 leippold m and f trojani 2008 asset pricing with matrix jump diffusions tech rep swiss finance institute university of zu rich and university of lugano mortensen a 2006 semi analytical valuation of basket credit derivatives in intensity based models journal of derivatives 13 8 28 robert c and g casella 2004 monte carlo statistical methods new york springer robert c p 1994 the bayesian choice new york springer roberts g o and o stramer 2001 on inference for partially observed nonlinear diffusion models using the metropolis hastings algorithm biometrika 88 603 621 rogers l 1985 smooth transition densities for one dimensional diffusions bull lon don math soc 17 157 161 sato k i 1999 le vy processes and infinitely divisible distributions vol 68 of cambridge studies in advanced mathematics cambridge cambridge university press translated from the 1990 japanese original revised by the author schneider p l so gner and t vez a 2010 the economic role of jumps and recovery rates in the market for corporate default risk journal of financial and quantitative analysis 45 1517 1547 schoutens w 2000 stochastic processes and orthogonal polynomials vol 146 of lecture notes in statistics new york springer singleton k 2001 estimation of affine asset pricing models using the empirical char acteristic function journal of econometrics 102 111 141 s rensen h 2004 parametric inference for diffusion processes observed at discrete points a survey international statistical review 72 337 354 stramer o m bognar and p schneider 2009 bayesian inference for discretely sampled markov processes with closed form likelihood expansions journal of financial econometrics forthcoming vasicek o 1977 an equilibrium characterization of the term structure journal of financial economics 5 177 188 volkmann p 1972 gewo hnliche differentialungleichungen mit quasimonoton wachsenden funktionen in topologischen vektorra umen math z 127 157 164 yu j 2007 closed form likelihood estimation of jump diffusions with an application to the realignment risk of the chinese yuan journal of econometrics 141 1245 1280 1 introduction 2 density approximations 3 sufficient conditions for assumptions 1 and 2 4 affine models 4 1 affine transform formula 4 2 polynomial moments 4 3 existence and properties of affine transition densities 5 examples of auxiliary density functions 6 relation to existing approximations 7 applications 7 1 basic affine jump diffusion bajd 7 2 heston s model 7 3 cdo pricing 7 4 likelihood based inference 7 5 option pricing 8 discussion appendix a proofs for section 3 appendix b proof of theorem 4 1 appendix c proof of theorem 4 3 appendix d figures and tables references