interleaving distance as a limit killian meehan david meyer abstract persistent homology is a way of determining the topological properties of a data set it is well known that each persistence module admits the structure of a representation of a finite totally ordered set in previous work the authors proved an analogue of the isometry theorem of bauer and lesnick for representations of a certain class of finite posets the isometry was between the inter leaving metric of bubenik de silva and scott and a bottleneck metric which incorporated algebraic information the key step in both isometry theorems was proving a matching theorem that an inter leaving gives rise to a matching of the same height in this paper we continue this work restricting to those posets which arise from data while making more general the choice of metrics we first show that while an interleaving always produces a matching for an arbitrary choice of weights it will not produce one of the same height we then show that although the matching theorem fails in this sense one obtains a shifted matching of the correct height from an interleaving by enlarg ing the category we then prove an isometry theorem on this extended category as an application we make precise the way in which representations of finite partially ordered sets approximate persis tence modules specifically given two finite point clouds of data we associate a generalized sequence net of algebras over which the persistence modules for both data sets can be compared we recover the classical interleaving distance uniformly by taking limits 1 introduction 1 1 persistent homology informally a generalized persistence module is a representation of a poset p with values in a categoryd more precisely ifd is a category a generalized persistence module m with values in d assigns an object m x of d for each x p and a morphism m x y in mord m x m y for each x y p with x y satisfying m x z m y z m x y whenever x y z p with x y z perhaps surprisingly the study of such objects is useful in topological data analysis persistent homology uses generalized persistence modules to attempt to discern the topological properties of a finite data set we briefly summarize the algorithm applied to a point cloud of data in the per sistent homology setting this will lead to one dimensional generalized persistence modules where the poset p 0 or r suppose for example we wish to decide whether a data set d r 2 should be more correctly interpreted as an annulus or a disk in order to decide between the two candidates one calcu lates the homology of a filtration of simplicial complexes associated to the data set this uses the vietoris rips complex c 0 specifically for each 0 we let c be the abstract simplicial complex whose k simplices are determined by data points x 1 x 2 xk 1 d where d xi xj for all 1 i j k 1 clearly for in 0 there is an inclusion of simplicial complexes c c thus we obtain a filtration of simplicial complexes indexed by 0 therefore the as signment f c is a representation of the poset 0 taking values in simp the category of abstract simplicial complexes that is to say f is a generalized persistence module for p 0 and d simp since we wish to distinguish between an annulus and a disk we apply the first homology functor h 1 k to f where k is some field to obtain the representation of p with values in k mod h 1 c k 1 ar x iv 1 71 0 11 48 9 v 1 m at h a t 3 0 o ct 2 01 7 thus the assigment h 1 k f given by h 1 c k is a one dimensional persistence module as increases generators for h 1 are born and die as cycles appear and become bound aries in persistent homology one takes the viewpoint that true topological features of the data set can be distinguished from noise by looking for generators of homology which persist for a long period of time informally one keeps an indecomposable summands of the module h 1 k f when it corresponds to a wide interval conversely cycles which disappear quickly after their appearance narrow ones are interpreted as noise and disregarded this technique has been widely successful in topological data analysis see for example car 09 cseh 07 cdo 12 sg 07 cidsz 08 ccr 13 hnh 16 and gpci 15 typically the cate gory of persistence modules with values in k mod is given a metric like structure so called soft stability theorems which involve the continuity from the data to the persistence module have been proven philosophically these results have established the utility of this method from the per spective of data analysis see for example cseh 07 hard stability theorems on the other hand involve comparisons of different metrics on the category of persistence modules 1 2 algebraic stability one special type of hard stability theorem is an algebraic stability theorem in such a theorem one endows a collection of generalized persistence modules with two metric structures and an automorphism j is shown to be a contraction or an isometry of particular interest is the case when j is the identity function and the metrics are an interleaving metric and a bottleneck metric algebraic stability theorems of this type are common see les 11 bl 16 bl 13 and cz 09 while in the literature the word interleaving is frequently used to describe slightly different metrics we believe that the interleaving metric suggested by bubenik de silva and scott see bds 13 has the advantage of being both most general and categorical in nature this in terleaving metric makes sense on any poset p and reduces to the interleaving metric of bl 13 when p 0 alternatively a bottleneck metric is nothing more than a way of extending a metric defined on a set to the collection of all z 0 valued functions with finite support on in this context this is applied to the decomposition of a generalized persistence module into its indecomposable summands with their corresponding multiplicities 1 3 connections to finite dimensional algebras this paper concerns algebraic stability stud ied using techniques from the representation theory of algebras such representations appear because one dimensional persistence modules arising from data always admit the structure of a representation of a finite totally ordered set this fact comes from the simple observation that the generalized persistence module given by f c is necessarily a step function more precisely let pn 1 2 n 0 c 6 lim c by definition f is constant on all intervals of the form i i 1 thus clearly both f and h 1 k f admit the structure of a generalized persistence module for p pn when we restrict the structure of a one dimensional persistence module to pn we say informally that we are discretizing in this sense generalized persistence modules for finite totally ordered sets are the discrete analogue of one dimensional persistence modules while the above description of persistent homology will always discretize to a generalized per sistence module for a finite totally ordered set representations of many other infinite families of finite posets also have a physical interpretation in the literature see bl 16 cz 09 eh 14 for example multi dimensional persistence modules see cz 09 will discretize in an analagous fashion to representations of a different family of finite posets this is relevant because there is a categorical equivalence between the generalized persistence modules for a finite poset p with values in k mod and the module category of the finite dimensional k algebra a p the poset 2 or incidence algebra of p in mm 17 we suggested a template for a representation theoretic algebraic stability theorem and proved the following theorem theorem theorem 1 mm 17 let p be an n vee and let c be the full subcategory of a p modules consisting of direct sums of convex modules let a b n n be a weight and let d denote interleaving distance corresponding to the weight a b restricted to c let w m min hom m m 0 t p h h and let db be the bottleneck distance corresponding to the interleaving distance and w on c then the identity is an isometry from c d id c db this result established an algebraic version of the isometry theorem for a large class of posets our choice of interleaving metric was the metric of bubenik de silva and scott with a slight mod ification the bottleneck metric incorporates algebraic information but corresponds to the bottle neck metric used by bauer and lesnick when applied to one dimensional persistence modules in the above 1 vees are exactly finite totally ordered sets and in the case p is a 1 vee the category c is the full module category once some parameters are chosen the collection of interleavings be tween two modules has the structure of an affine variety the interleaving distance corresponded to the smallest parameter for which the corresponding variety was nonempty while this theorem covered a much more general class of posets than finite totally ordered sets many of which had wild representation type we restricted to metrics coming from a so called democratic choice of weights on the hasse quiver of the poset we now wish to extend this to metrics coming from arbitrary weights in the case of finite totally ordered sets in addition from the perspective of data analysis in mm 17 we pointed out two potential issues which arise when one passes to the jump discontinuities of the vietoris rips complex this paper will address these issues the first issue is that a finite data set d produces not only a generalized persistence module but also to its accompanying algebra because of this a priori two persistence modules may not be able to be compared simply because they are not modules for the same algebra the second issue is that information about the width of the interval i i 1 should be considered but appears lost when one discretizes here we show that both of these concerns can be dealt with successfully after we establish an algebraic stability theorem for pn with an arbitrary choice of weights 1 4 main results in this paper we restrict our attention to the class of posets which arise when one dimensional persistence modules are discretized but extend our analysis to interleaving met rics coming from an arbitrary choice of weights in this situation we show that an interleaving need not produce a matching of the same height indeed when one makes the most natural choice of weights corresponding to the geometry of the data set this is almost certain to be the case even in this situation however we obtain a shifted isometry theorem by extending to an algebra with a larger module category this result is stated in the first main theorem theorem 1 shift isometry theorem let x 1 r be finite and sh x 1 be its shift refinement let px 1 and psh x 1 be the corresponding totally ordered sets let c be the full subcategory of a psh x 1 mod given by c im j x 1 sh x 1 and let dsh x 1 dsh x 1 b be the interleaving metric and bottleneck metric respectively let j j x 1 sh x 1 and id denote the identity then the horizontal arrow is an isometry and the diagonal arrows are contractions 3 j j id a px mod d x c dsh x c dsh x b theorem 1 says that in particular by using the functor j to enlarge the category one obtains the shifted isometry c dsh x 1 id c dsh x 1 b moreover j is fully faithful and is itself a contraction when the choice of weights is general this is a natural extension of the classical isometry theorem we then use the shift isometry theorem to prove our second main result theorem 2 let i m be persistence modules for r whose endpoints lie in l then lim x d dx xi xm d i m theorem 2 says that again with the most natural choice of weights our modification of the interleaving metric of bubenik de silva and scott approximates the classical interleaving metric in the sense that one can take a limit over a directed set to obtain the classical distance this limit is uniform in that the choice of refinement is independent of the modules to be compared in ad dition by the squeeze theorem the discrete bottleneck metric converges to the classical bottleneck metric and therefore the interleaving metric as well this paper will be organized as follows in section 3 we give a brief summary of background information then in section 4 we discuss restriction and inflation in the next two sections we prove our two main results in section 5 we prove theorem 1 and in section 6 we prove theorem 2 then in section 7 we give an analysis of posets in which the original matching theorem fails 2 acknowledgements the authors wish to acknowledge calin chindris both for introducing us to this field of study and for all of his guidance k meehan was supported by the nsa under grant h 98230 15 1 0022 3 preliminaries 3 1 generalized persistence modules recall that if p is a poset and d is a category a general ized persistence module m with values in d assigns an object m x of d for each x p and a morphism m x y in mord m x m y for each x y p with x y that satisfies m x z m y z m x y whenever x y z p and x y z let dp denote the collection of generalized persistence modules for p with values in d if f g dp a morphism fromf tog is a collection of morphisms x with x mord f x g x for all x p such that for all x y we have a commutative diagram below for each x y in p f x f y g x g y f x y x g x y y 4 with such morphisms dp is a category equivalently one could regard the poset p as a thin category then a generalized persistence module will correspond to a covariant functor from p tod and morphisms indp will be natural transformations in this paper p will always be a finite totally ordered set 0 or r d will be either simp or k mod 3 2 representation theory of algebras in this subsection we give a brief summary ofk algebras and their representations modules for a more expansive introduction see ars 97 ben 98 a ben 98 b for more on the connection between finite dimensional algebras and generalized per sistence modules see oud 15 or mm 17 throughout letk denote a field ifr is ak algebra by an r module we mean a finite dimensional unital left r module the category r mod consists of r modules together with r module homomorphisms recall that an r module m is indecomposable if it is not isomorphic to a direct sum of two of its proper submodules the category r mod is an abelian krull schmidt category that is every module can be written as a direct sum of indecomposable modules in a unique way up to order and isomorphism moreover the decomposition of modules is compatible with homomorphisms in the following sense proposition 1 let r be a k algebra and let m n be r modules say m mi and n nj then as vector spaces hom m n i j hom mi nj this says that any module homomorphism f m n can be factored into a matrix of module homorphisms f ij mi nj 3 2 1 quivers and their representations we now define quivers and their representations definition 2 a quiver q q 0 q 1 t h is an ordered tuple where q 0 q 1 are disjoint sets and t h q 1 q 0 we call elements of q 0 vertices and elements of q 1 arrows the functions t and h denote the tail start and head end of the arrows thus clearly q is exactly a directed set we will always suppose the sets q 0 q 1 are finite example 1 below are two quivers 1 2 3 4 5 a b c d a 1 2 3 4 a c b d e f g b quiver a corresponds toq 0 1 2 3 4 5 q 1 a b c d for an appropriate choice of the func tions h t similarly quiver b corresponds to the sets q 0 1 2 3 4 and q 1 a b c d e f g a path is a sequence of arrows p a 1 an where t ai h ai 1 the length of the path is the number of terms in the sequence p in addition at each vertex i there is a lazy path ei of length 0 at the vertex i we extend the functions h t to paths by defining t p t an and h p h a 1 5 in addition t ei h ei i an oriented cycle is a path p of length greater than or equal to one with t p h p definition 3 a representation v of a quiver q is a family v v i i q 0 v a a q 1 where v i is a k vector space for every i q 0 and v a v t a v h a is a k linear map for every a q 1 for a fixed quiver q and field k the collection of all representations of q is a category with morphisms given as follows if v w be representations of q morphism from v to w v w is a collection of linear maps i i q 0 with i v i w i such that the diagam below commutes for all a q 1 v t a v h a w t a w h a v a t a v a h a we denote by rep q the category of k representations of the quiver q when v w is a morphsim from v to w and i is invertible for all i then we say is an isomorphism if this is the case we say that v and w are isomorphic definition 4 if v is a representation of a quiver q we say the support of v supp v is the set of all vertices i q 0 such that v i is not the zero vector space if q is a quiver the path algebra kq is the k vector space with basis consisting of all paths including those of length zero multiplication in kq is defined as the k linear extension of concatenation of paths that is if p q are paths then p q pq if pq is a path and zero otherwise with this multiplicative structur kq is a k algebra when q has no oriented cycles kq is finite dimensional the following proposition shows the connection between quivers and algebras proposition 5 let q be a quiver then there exists a natural equivalence between rep q and kq mod 3 2 2 the poset algebra for pn we will now define the poset algebra a pn of the finite poset pn for a discussion of the poset algebra for an arbitrary finite poset see mm 17 this discussion fits into the framework of mm 17 since the finite totally ordered set pn is exactly a 1 vee definition 6 let p be a finite poset let qp be the quiver with q 0 p there is an a q 1 with t a x h a y if i x y and ii there is no t p with x t y the quiver qp is called the hasse quiver of the poset p by inspection the hasse quiver of p is exactly the lattice of the poset with arrows corresponding to minimal proper relations note that if qp is the hasse quiver of the poset p and there is an arrow that begins at a vertex v and ends at the vertex w it is necessarily unique thus we may omit labeling arrows example 2 the hasse quiver of pn is drawn below 1 2 3 n 1 n this quiver is the so called equioriented an quiver definition 7 let p pn be totally ordered then the incidence algebra a pn of pn is the quiver algebra of an 6 by proposition 5 we may identify every module for the algebra a pn with a representation of the equioriented an quiver and vice versa thus from this point forward we pass freely between generalized persistence modules for pn with values in k mod representations of the quiver an and modules for the algebra a pn definition 8 an indecomposable module m for a pn is convex if it is isomorphic to a module m where m satisfies i for all x y supp m with x y the linear map m x y is given by idk and ii for all vertices x the dimension of the k vector space at m x is at most 1 note that the definition of convex modules makes sense for an arbitrary finite poset in gen eral a poset algebra may have infinitely many isomorphism classes of indecomposable modules but necessarily has only finitely many convex modules for more on convex modules for poset algebras see mm 17 in the algebra a pn however every indecomposable module is convex thus while in mm 17 we restricted to c the category generated by convex modules this in fact corresponds to the full module category for a pn it is well known that the isomorphism classes of convex modules for a pn are in one to one correspondence with the closed intervals in the poset pn that is to say if x y in pn there is a unique isomorphism class of an indecomposable module represented by i with supp i x y moreover all indecomposable modules for a pn are of this form up to isomorphism if i is isomorphic to the convex module with support given by x y we write i x y we now conclude with a statement about homomorphisms between convex modules since pn is a 1 vee we have the following lemma see for example lemma 34 mm 17 let p pn be totally ordered and let i j be convex modules then hom i j k or 0 as a vector space in addition when i j are convex conditions on their supports determine the cardinality of the vector space hom i j lemma see for example lemma 40 mm 17 if i j are convex modules for pn with i x x j y y then hom i j 6 0 if and only if y x y x when hom i j 6 0 let x y denote the characteristic function on the interval x y then the linearization of x y i j is an explicit generator for the vector space hom i j 3 3 interleaving metrics on p and p we begin with the construction of the interleaving metric of bubenik de silva and scott see bds 13 in the interest of generality initially we let p be an arbitrary poset definition 9 let p we a finite poset and t p be the collection of endomorphisms of the poset p with the additional property that p p for all p p we call the elements of t p translations explicitly a function p p is an element of t p if and only if x y x y and p p for all p p it is easy to see that the set t p is itself a poset under the relation if for all p p p p and that t p is a monoid under functional composition we now consider interleaving metric suggested by bds 13 on generalized persistence modules let d be any metric on a finite poset p we define a height function h h d on t p definition 10 for t p set h sup d x x x p of course since p is finite we may replace a supremum with maximum proceeding as in bds 13 let d be any category then t p acts on dp on the right by the formulae f p f p and f p q f p q 7 definition 11 let f g dp and let be translations on p a interleaving between f and g is a pair of morphisms in dp f g g f such that the following diagrams commute f f f g g g the two horizontal maps in the diagram above are given by the formulae for all p p f p p and g p p respectively note that two generalized persistence modules are 1 1 interleaved where 1 is the identity trans lation if and only if they are isomorphic definition 12 bds 13 let m n dp given any metric d on p we define d d d by the formula d m n inf interleaving with supp pd p p supp pd p p inf interleaving with h h from bubenik de silva and scott bds 13 we know that d is a pseudometric on dp and for any category f and functor r d f post composition by r is a contraction from dp to fp with hard stability theorems in mind the fact that post composition by any functor induces a contraction is particularly noteworthy still independent of the choice of metric d on p without modification the resulting metric d d d need not be a proper metric simply because the col lection of translations is not be rich enough to provide interleavings between arbitrary generalized persistence modules this is unfortunate since t p is defined naturally for any poset p the failure comes from the fact that finite posets will always have fixed points we now restrict our attention to the case where d is k mod we say that p p is a fixed point of p if p p for all in t p if p is a fixed point of p and dimk m p dimk n p then the diagram below does not commute for any morphisms and any translations since the composition cannot have full rank as required thus for any choice of metric d d m n n p n p n p m p m p n p p idn p p p p note that finite posets will always have fixed points for a more general discussion on fixed points for arbitrary finite posets see mm 17 in pn the maximal element is necessarily a fixed point in particular if p is a fixed point of p with p supp m p supp n then d m n because of this there is no hope of realizing any honest metric as an interleaving metric on any finite poset with this in mind we make the following slight modification we set p p with added relations p for all p p we may now view a p mod as the full subcategory of a p modules where all objects are supported in p note that the hasse quiver for p is simply the hasse quiver for p with added edges connecting maximal elements of p to the element now there exists an interleaving between any two generalized persistence modules for p that are supported in p 8 we will now define d on pn by attaching positive weights to each edge of the hasse quiver of pn in the so called democratic case below all edges in pn are given the same value while the new edge is given a potentially different value in the second case the choice of weights is arbitrary a 1 a 2 a 3 an 2 an 1 b a a a a a b arbitrary democratic 1 2 3 n 1 n 1 2 3 n 1 n for an analysis of the democratic case for more general posets see mm 17 in this paper we will investigate the arbitrary undemocratic choice of weights for finite totally ordered sets this corresponds to the labeling of the hasse quiver above where ai b 0 when this is the case we say pn has weights given by ai b definition 13 now we let d ai b denote the weighted graph metric on the hasse quiver of pn and let d be a category then d d d ai b is the interleaving metric corresponding to the weights d ai b on d pn now d defines the structure of a finite metric space on the isomorphism classes of elements of d pn we will now write t pn for t pn and from this point forward we only consider d k mod and p pn suspended at infinity by proposition 5 we write a pn mod for dp since pn is a 1 vee we obtain the following two useful lemmas lemma lemma 22 mm 17 consider pn with weights given by ai n i 1 b with ai b 0 in r let d denote the corresponding weighted graph metric on the hasse quiver of p then i for each h t p the set t p h has a unique maximal element ii the set is totally ordered and if and only if iii if t p with h h then there exists a with and h max h h the above lemma justifies the passage from a interleaving to a interleaving where is the maximum of h and h moreover the monoid t p acts on convex modules in the sense below lemma lemma 31 mm 17 let p pn be totally ordered and let i j be convex module and t p then i is either the zero module or convex 3 4 bottleneck metrics a bottleneck metric provides an alternate metric structure on the set of isomorphism classes of a pn modules for a more general discussion of a bottleneck metric on a subcategory of a module category see mm 17 the construction begins with a metric d 2 on the set of isomorphism classes of indecomposable a pn modules additionally we require a function w 0 compatible with d 2 in the sense that for all 1 2 w 1 w 2 d 2 1 2 following bl 13 bl 16 we define a matching between two multisets s t of to be a bijection f s t between multisubsets s s and t t for 0 we say a matching f is an matching if the following conditions hold i for all s s w s s s ii for all t t w t t t and 9 iii d 2 s f s for all s s the intuition is that w measures the size of an element of we call w the width of sigma thus in an matching elements of s and t which are identified are within while all those not identified have width at most for an a pn module m the barcode of m b m is the multiset of isomorphism classes of indecomposable summands ofm with their corresponding multiplicities thus b m is precisely a multiset of elements in definition 14 let s t be two finite multisubsets of suppose d 2 and w are compatible then the bottleneck distance between s and t is defined by db s t inf r there exists and matching between s t now if m n are a pn modules we may identify m n with their barcodes b m b n two multisubsets of this identification is clearly constant on isomorphism classes then we define db m n db b m b n while there are many examples of bottleneck metrics in the literature in this paper we will choose d 2 to be the interleaving metric corresponding to the weight ai b our width will be an algebraic analogue of the width of the support of a one dimensional persistence module our definition will come from the following lemma lemma lemma 23 mm 17 consider pn with weights given by ai n i 1 b with ai b 0 in r let i be convex then the following are equal i w 1 i min t p h h and hom i i 0 ii w 2 i min t p h and hom i i 2 0 iii w 3 i min t p with hom i i 2 0 for i convex set w i w 1 i this will be our definition of the width of i while w is defined algebraically this definition agrees with bauer and lesnick in the case of one dimensional persistence modules 3 5 induced matchings an induced matching is a specific matching produced from an inter leaving triangle the key step in the proof of the isometry theorem of bauer and lesnick bl 13 is that an interleaving between two one dimensional persistence modules produces an induced matching of the same height since our work is an algebraic analogue of the ideas of bauer and lesnick this is also a key step in proving the isometry theorem in mm 17 we will use the following result on injective and surjective morphisms between generalized persistence modules proposition theorem 4 2 bl 13 proposition 25 mm 17 let p pn be totally ordered and let ai n i 1 b be weights let a iai c j cj be a pn modules for any module m let b m denote the barcode of m viewed as a multiset and let t p then i if a f c is an injection then for all d p the set i d is a maximal totally ordered subset of supp ai j d is a maximal totally ordered subset of supp cj and ii if a g c is a surjection then for all b p j b is a maximal totally ordered subset of supp cj i b is a maximal totally ordered subset of supp ai 10 iii if a and c are interleaved and a c is one of the homomorphisms then for all i in b ker w i h iv if a and c are interleaved and a c is one of the homomorphisms then for all j in b cok w j h this was proven by bauer and lesnick and modified to the current context in mm 17 the proposition below is also in the flavor of the work of bauer and lesnick bl 13 this is used to construct canonical injections and surjections proposition proposition 29 mm 17 let pn be totally ordered and let ai n i 1 b be weights let be a interleaving betweem i and m say i m then i i 2 is a quotient of both i and im and ii m 2 is a submodule of both m and im what follows is an adaptation of section 4 of bl 13 for any set an enumeration of is a total ordering on when s is a multisubset of an enumeration of s is an total ordering on s that is consistent with the enumeration of its underlying set that is to say for any s the multiset s s is a segment in the total ordering on s and the segments are arranged relative to each other according to the ordering on finally for two enumerated multisubsets s s 1 sm and t t 1 tn with m n the canonical injection from s to t is the one that sends sj tj for all 1 j m for any multisubset that is not simply a subset there are multiple enumerations we will sometimes find it convenient to choose a particular enumeration see for example the proof of theorem 1 this was unnecessary in bl 13 we first define the induced matching for a surjective morphism q m n withm n a pn mod let be the set of isomorphism classes of indecomposable a pn modules for every x pn define the set x x y for some y p y x enumerate each of the sets x by reverse inclusion now we enumerate both m x b m x and n x b n x as multisubsets of x by the proposition above theorem 4 2 bl 13 proposition 25 mm 17 as q is a surjection m x n x for all x p let q x denote the canonical injection n x m x for each x p clearly the collection x partition by lower endpoints that is x p x and so m x and n x partition the barcodes b m and b n respectively thus we union to get the induced matching of q q x p q x b n b m we similarly define the induced matching for an injective morphism i m n here we use that the set is also partitioned by upper endpoints so y p y y p x y for some x p y x we enumerate m y n y as multisubsets of y by the proposition above m y n y for all y p as i is an injection let i y denote the canonical injection m y n y 11 and take the disjoint union to get the induced matching of i i y p i y b m b n now we define the induced matching given by an interleaving triangle as originally described by bauer and lesnick suppose i m are interleaved by where i m the morphism factors through its image as an injection after a surjection i q im i m it is clear that the composition of induced matchings i 1 q is a matchingb i b m since our goal is a matching between b i and b m we include an additional step note that it may be the case that hom m m is zero thus we define a matching that does not rely on any morphism let b m m b m b m be the function which sends each mt to mt for all t such that mt 6 0 then we define the induced matching b i b m given by the triangle starting at i to be the composition 1 q i b m m b i b im b m b m in bl 13 this final step is unnecessary asb m m is a bijection of barcodes that preservesw note that while strictly speaking an induced matching depends on the enumerations forb i and b m different choices will produce matchings which agree at the level of isomorphism classes of indecomposables 4 restriction and inflation in this section we discuss restricting and inflating the module category for a p we first make a preliminary observation it is easy to see that for every m r and for every n there is a one to one correspondence between the sets pn ai b ai b are weights for pn tm x b x r x n min x m specifically tm sends the tuple pn ai b tm m m a 1 m a 1 a 2 m n 1 i 1 ai b clearly this assignment is invertible that is to say once a left endpoint is fixed the triple pn ai b conveys the same information as the set m k i 1 ai plus the choice of b this is useful as we may assume that our poset is given by the order type of the finite subset x x 1 x 2 xn with weights given by ai xi 1 xi for i n 1 and b of course the latter has a physical interpretation in context of the real line in what follows the points in x will include the jump discontinuities of the vietoris rips complex of a data set when a generalized persistence module comes from the vietoris rips complex of a data set and x is a superset of the jump discontinuities of the complex we will say that tm 1 x is the natural choice of weights on the corresponding pn for n x when this is the case we will write px for pn with this choice of weights definition 15 let p be any poset and let x p suppose i is a generalized persistence module for p with values in the category d let ix be defined by the formulae ix x i x d for all x x and 12 ix x 1 x 2 i x 1 x 2 homd i x 1 i x 2 for all x 1 x 2 x 1 x 2 x then ix is a generalized persistence module for x with restricted ordering with values in the category d moreover it is clear that by restricting morphsims between generalized persistence modules in the obvious way we obtain a functor fromdp dx of particular interest will be the case when p r and x p is a finite subset when this is the case we write x for the functor x dr dx we now discuss from inflating from a px mod to a py mod when x y are finite subsets of r with x y first we work with translations definition 16 let x y be finite subsets of r with x y let t px let be given by y max y max x x x x y if there exists x x x y y otherwise of course there is an assignment on t p for every x y with x y when the context is clear we supress the arguments x y the following lemma shows that is a translation on py of the same height as lemma 17 let x y be finite subsets of r with x y if t px then t py and h h moreover x proof first by inspection for all y y y y it is also easy to see that restricts to on x as a function since its height is attained on x h h now let t 1 t 2 y with t 1 t 2 we must show that t 1 t 2 note that max x x x x y xy where xy max x x x y when they exist let x 1 x 2 be maximal elements of x less than or equal to t 1 t 2 respectively first suppose t 1 x t 2 x then t 1 x 2 so t 1 t 1 x 2 t 2 on the other hand say t 1 x t 2 x if t 1 t 1 then t 1 t 1 t 2 t 2 t 2 otherwise t 1 x 1 then x 1 t 1 t 2 so x 1 t 2 and t 1 x 1 t 2 t 2 the remaining cases are handled similarly we now include the category a px mod inside a py mod when x y and x y are finite subsets of r definition 18 let x y be finite subsets of r with x y let i a px mod define j x y i by the formulae j x y i y i xy xy maximal in x xy y or 0 if no such xy exists 1 j x y i y 1 y 2 i x 1 x 2 where xi is maximal in x xi yi or 0 if either of the above do not exist 2 it is clear that equations 1 2 define a module for the algebraa py note that if i is a convex module for px i a b then j x y i a by where by is maximal in y b b 1 where b 1 is the successor of b in x that is to say the right endpoint of the support of i may move to the right we now discuss how morphisms in a px mod can be extended to the image of j x y 13 definition 19 let x y be finite subsets of r with x y let i m be modules for a px and let hom i m let j x y be defined by the formula j x y y xy where xy is maximal with xy x xy y or the zero homomorphism if no such element exists then j x y defines an a py module homomorphism from j x y i to j x y m the proof follows from the commutativity of the diagrams below i x 1 m x 1 j i y 1 j m y 1 i x 2 m x 2 j i y 2 j m y 2 x 1 i x 1 x 2 x 2 m x 1 x 2 j y 1 j i y 1 y 2 j y 2 j m y 1 y 2 j we are now ready to compare different one dimensional persistence modules letd 1 d 2 dn be finite data sets in some metric space let li be the set of jump discontinuities of the vietoris rips complex ofdi and let l l 1 l 2 ln let d 1 d 2 dn be the collection of all finite supersets of l clearly l is a directed set under the partial ordering given by containment note that for all i the one dimensional persistence modules coming from the data set di admits the structure of an a px module for any x in d 1 d 2 dn thus we may compare discretized persistence modules which are a priori modules for different poset algebras since clearly any finite set of one dimensional persistence modules can be compared in this way from this point forward we write d for d 1 d 2 dn proposition 20 let i be a one dimensional persistence module that comes from data say d 1 dn are such that the jump discontinuities of the vietoris rips complex of i are contained in the corresponding set l let x y d with x y then j x y is a fully faithful functor from a px mod to its image in a py mod moreover j x y commutes with x y in the sense that j x y x i y i proof one easily checks that j x y j x y j x y now say x y d where i is as above we will show the commutativity of the triangle below i xi y i x y j x y first say i is convex with i t t let y y t t then since t x y there exists x x with x y thus let xy be maximal in x with xy y since i is convex it is enough to show that j x y xi y y i y k as y t t t xy y t so j x y xi y xi xy i xy k similarly y i y i y k as required so the result holds for i convex the general case follows since all the above functors distribute through direct sums j x y is fully faithful by the characterization of homomorphisms between convex modules and since j x y is one to one on isomorphism classes of objects moreover the following lemma shows that j x y is compatible with the assignment for x y lemma 21 letx y be finite subsets of r withx y let t px and let i m bea px modules suppose hom i m then 14 i j x y i j x y i and ii j x y j x y proof let y y zy the maximal element of x such that zy y then j x y i y j x y i zy i zy i zy j x y i y similarly j x y y j x y zy zy zy j x y y the results in this section are used in the next section where we prove our algebraic stability theorems 5 the shift isometry theorem in this section we show that an interleaving need not produce on induced matching of the same height since the existence of such a matching is the key step in the proof of an isometry theorem this provides an obstruction to proving an isometry theorem for a pn mod we then prove a shifted isometry theorem by enlarging the category a pn mod we begin with an example illustrating the failure of the matching theorem for a lengthier discussion see subsection 7 example 3 let p p 6 x 1 x 6 with weights a 1 a 3 a 4 1 and a 2 a 5 2 let 2 and consider the convex modules with supports depicted below x 6 x 5 x 4 x 3 x 2 x 1 a a a 2 c c d d im let a d and d a it is immediate that correspond to a 2 2 interleaving however the induced matching pairs a l c which are not 2 2 interleaved as c a 0 thus the induced matching corresponding to does generate a matching of the correct height we can cause both induced matchings to fail by taking i a c d and m c d a to be 2 2 interleaved by morphisms and it is important to note that this does not say that the interleaving distance between a c d is not the bottleneck distance in fact they are the same this simply says that the only known algorithm for producing a matching with the same height as the interleaving fails in this situation we now work towards the proof of the shift isometry theorem first we show that we enlarge the category the functor j is a contraction proposition 22 for x y finite subsets of r x y the functor j x y is a contraction from a px mod equipped with dx to its image in a py mod equipped with dy 15 proof let i m a px mod suppose i m are interleaved in px it suffices to show that j x y i and j x y m are interleaved in py with h by lemma 21 j j x y gives the following progression of diagrams i i 2 j x y i i 2 j x y j x y j i i 2 m j x y i j x y i 2 j x y m the result is now obtained by letting and noting that h by lemma 17 we will now construct a particular refinement of x this will give rise to the appropriate en larged module category let x r be finite let y x x x x n 1 where n 1 denotes the set of all distances between points in x order the finite set y y 1 y 2 yn by greatest to least on the real number line let z 1 y zy 1 for all n 1 with zy 1 maximal in y such that zy 1 y 1 next let z 2 z 1 zy 2 for all n 1 with zy 2 maximal in z 1 such that zy 2 y 2 for the i th step in the process let zi 1 zi zyi 1 for all n 1 with zy 1 1 maximal in zi such that zyi 1 yi 1 since y is finite the process terminates after n steps let sh x be the set zn we will call sh x the shift refinement of the set x lemma 23 let x be a finite subset of r for q sh x let q 1 q 1 denote subsequent and previous elements in sh x respectively where applicable then sh x has the property that for every x x and n 1 x 1 sh x equivalently for every q y and n 1 q 1 is in sh x proof let q y n 1 for any 1 i n and k i 1 by construction the maximal element of zk strictly less than yi is in fact precisely y 1 i sh x hence q yi for some 1 i n and so q 1 sh x we are now ready to prove theorem 1 proof of theorem 1 let x r be finite and sh x be its shift refinement let c be the subcategory given by im j x sh x first by proposition 22 the functor j j x sh x is a contraction from a px mod d x c dsh x thus it suffices to show that the identity is an isometry from c dsh x c dsh x b let i m im j x sh x since an matching immediately produces a diagonal interleav ing of the same height d db to show the other inequality we will prove that for any interleaving the induced matching of the triangle beginning at i is a h matching the proof of this inequality will consist of the following three parts 1 if w is h then is is matched 2 if w mt h then mt is matched 16 3 if is and mt are matched with each other independent of their w values then there is a interleaving between is and mt the proof of 1 2 proceed as in theorem 2 mm 17 with an additional consideration specif ically in the present situation it is possible for non isomorphic convex modules in b i to be matched with isomorphic convex modules in b i 2 thus we will choose a particular enumer ation of each multisubset i 2 x of x see subsection 3 5 if 2 1 2 2 in i 2 x then we set 2 1 2 2 if 1 2 in i x this was not a concern in mm 17 since for the democratic choice of weights 1 2 if and only if 2 1 2 2 in our present situation the above choice of enumeration ensures commutativity of the appropriate triangle for 1 the proof of 2 is similar note that the arguments for 1 2 do not require any special properties of the poset psh x we will now prove 3 we show that if is and mt are matched by the induce matching then they are interleaved let is u u is w w mt z z and mt v v if w i w m then i and m are immediately interleaved by 0 assume that w i or w m then s s or t t using the notation in theorem 2 mm 17 we will show that the following morphisms constitute a interleaving of is and mt let is mt by the linearization of u v and similarly mt is proceeding as in mm 17 we will show that w z w z whenever s s or t t it is enough to show that the following four statements hold i if t t then w z ii if s s then z w and w z iii if s s and t 6 t then w z iv if s 6 s and t t then z w and w z we now prove i through iv first if t t we may define v 0 to be the lower endpoint of m 2 t i e v 0 is minimal such that v 0 2 z as z 2 z by minimality v 0 z furthermore w is minimal such that w u now as u v 0 by properties of induced matchings and v 0 z by above u z and so minimality of w guarantees that w z this proves i for ii note that by hypothesis v is minimal such that v z therefore v u and so v u combining these inequalities z u then s s guarantees that 2 u u as w is maximal such that w u we get that u w combining this with the above inequality it follows that z w to prove the second inequality in ii we first claim that w u 0 where u 0 is the maximal element such that 2 u 0 u once this is established we have that v z and u 0 v so by the properties of induced matchings we obtain w u 0 v z thus let us verify that w u 0 by definition x 0 w to show the opposite inequality we will first show that w im since u u im j x sh x it is immediate that u 1 x and so u 1 y also w u 1 1 since the distance from u 1 to u 1 is precisely w u 1 1 furthermore maximality of w ensures that w 1 u so w 1 u 1 so w u 1 1 this verifies thatw is precisely u 1 1 then by lemma 23 w sh x as w w we have that w is in the image of hence as 2 w w u it must be that u 0 w and so u 0 w combining inequalities w u 0 and so we have proved the desired statement this proves ii we will now prove iii first i w w where w u and so w u since s s we know 2 u u and so 2 w u by the maximality of w under the condition w u we have that 2 w w finally using ii and the fact that t 6 t guarantees that 2 z z we have that 2 w w z 2 z so by monotonicity w z this proves iii 17 for iv one can check that w u 2 u 2 v 0 3 z z so by monoticity w z thus we have shown that mt is 6 0 to finish by corollary 25 in the next section comprise a interleaving between is and mt completing the proof of 3 this finishes the proof of theorem 1 note that the requirement that we work in sh x only appears in the latter half of ii and in iii 6 interleaving distance as a limit we will now use the results from the last section to recover the classical interleaving distance as a limit lemma 24 let i m be convex modules for a px with its natural metric d and say i u u and m z z then d i m min max w i w m max d u z d u 1 z 1 proof let denote the quantity on the right hand side above if max w i w m the result is obvious since 0 constitute a interleaving between i and m on the other hand suppose max w i w m let and let i m and m i let i w w and m v v by choice of it is immediate that v u and v u we will show that u v similarly we know that w z and w z both hold and will show that z w we will then establish the commutativity of both interleaving triangles by assumption at least one of i m has width strictly larger than suppose that w i first we ll show u v which means that i m is non zero since d z 1 u 1 and w i it must be that 2 u u 1 and so d u u 1 this says that u z 1 i e u z by maximality of v u v hence i m the linearization of u v is not identically zero we next show that m i is non zero if w m we are done by symmetry thus assume w m and w i since d u z we have that z u as w i it must be that 2 u u so by maximality of w u w hence combining inequalities we have z w and so m i 6 0 thus we have shown that when max w i w m are both non zero it remains to show that give commutative interleaving triangles suppose that w i to show that the triangle beginning with i commutes we need only show that 6 0 by inspection u 6 0 as required by symmetry if w m we are done thus we need only show the commutativity of the other triangle when w m however since hom m m 2 0 0 as required hence are a interleaving between i and m so d i m corollary 25 let be a maximal translation of height h let i m be convex modules for a px say i u u and m z z if i m and m i are both non zero then i m are interleaved proof let i m and m i are both non zero only if h max d u z d u 1 z 1 by lemma 24 d i m hence i m are interleaved and so they are also interleaved as h the next proposition also follows from lemma 24 proposition 26 let x r be finite i m be indecomposables in a px mod with i u u m z z then d i m min max w i w m max d u z d u 1 z 1 18 proof by lemma 24 we need only show that d i m let d i m and let if 0 is a interleaving between i and m it must be that h max w i w m and so d i m otherwise it must be that without loss of generality i i 2 6 0 hence to have a commutative triangle beginning at i it must be that are both non zero but hom i m and hom m i are both non zero only if h max d u z d u 1 z 1 and so d i m we now connect our work to persistent homology again let d 1 d 2 dn be finite data sets in some metric space and let l r be the corresponding union of the jump discontinuities of their vietoris rips complexes let x d and let dx denote the corresponding interleaving metric and on the category a px mod similarly let wx denote the width of a convex a px module we now work towards the proof of theorem 2 showing that the classical interleaving distance can be recovered as the limit over the directed set x if i is a one dimensional persistence module coming from data we say that i has endpoints in l if the jump discontinuities of the vietoris rips complex of i are contained in l lemma 27 let be any convex one dimensional persistence module for r whose endpoints are contained in l say r r then lim x d 1 d 2 wx x w r r 2 proof let 0 r let y y be any element of d such that i the max y max l and ii the difference between consecutive elements of y m m is less than 1 2 note that any superset of y necessarily satisfies i ii as well let x d with x y then wx x min max x r r x x x r r since r r 2 must be within 1 2 of some x clearly wx x w as required we point out that condition i above removes the consideration of the weight b from the discussion next we will show that if are convex one dimensional persistence modules for r then their interleaving distance can be recovered as a discrete limit as well this establishes theorem 2 for convex modules lemma 28 let be any convex one dimensional persistence modules whose endpoints are contained in l say r r s s then lim x d dx x x d proof proceeding as in the proof of lemma 28 let be positive and set y y d let x d with x y then by proposition 26 dx x x min max wx x wx x max r s r s clearly this is within of d min max w w max r s r s 19 by lemma 27 the result follows now that we have established lemmas 27 28 we are ready to prove theorem 2 proof let i m be one dimensional persistence modules whose endpoints lie in l let 0 and let be such that 1 2 d i m let y d be such that i max y max l and ii yi 1 yi 18 for yi y m m 1 4 let x d with x y we will show that d i m dx x i x m d i m d i m first let x b x i b x m and say wx x 1 2 since d i m there exists a interleaving between i and m but then by the isometry theorem of bauer and lesnick bl 13 there is an matching between b i and b m but then we have that w 1 2 wx x 1 2 so w therefore is matched with some in the opposite barcode so by hypothesis d min max w w max r s r s where r r and s s but max wx x wx x max w 1 2 w 1 2 max w w 1 2 therefore dx x x d 1 4 1 2 d i m so the assignment x l x l defines a diagonal interleaving a matching between x i and x m of height 1 2 thus dx x i x m d i m as required now if dx x i x m d i m we are done thus for a contradiction suppose that dx x i x m d i m then there exists a weight for x with d i m and there exists a x x interleaving between x i and x m where x is the maximal transla tion of height for px then by theorem 1 there is an matching between b j x z x i and b j x z x m for z sh x by proposition 20 j x z xi zi and j x z xm zm thus there is an matching between b zi and b zm now say w 1 2 then wz z w 1 2 therefore z l z for some element z of the opposite barcode with dz z z d i m 20 therefore define the matching l z l z but then d dz z z 1 2 1 2 d i m 1 2 this matching shows that d i m 1 2 d i m 1 2 as this is clearly a contradiction so it must be the case that dx x i x m d i m as required the result is proven 7 regularity as we have seen the poset pn with arbitrary choice of weights has the property that an inter leaving between two modules need not produce an induced matching of barcodes of the same height see example 3 while this does not necessarily mean that the isometry theorem is false in this context it is clearly an obstruction to its proof in this section we show that when we identify pn ai b with px x r unless x satisfies certain regularity conditions there will always exist interleavings whose induced matchings do not have the same height one would not expect such regularity for a poset px which comes from real world data in what follows it is convenient to work with maximal translations we will define what it means for a poset to be regular after examining some conditions on maximal translations let xi xl in x and let xl xi suppose that a xl 1 xi 1 b xl 1 2 xi 1 and c xi 1 xi 1 then one can produce an interleaving whose induced matching has strictly larger height if x is identically the set of jump discontinuities of a data set one would expect the the existence of some xi xl satisfying the above on the other hand if x avoids conditions a or b for all xi xl we say that x will be regu lar property c is a purely technical condition that will not be commented on further roughly speaking a regular set has a periodicity associated both with its elements and the spaces between its elements we now define regularity after the definition we connect regularity to the absence of a maximal translation of the form above definition 29 let x be a finite subset of r and let xi x x 1 x 2 xn then x is regular at xi if for all xl xi either i xl 2 xl xi 1 xi or ii xl 2 xl xi 1 xi and xk 1 xl t xl xi where t be maximal such that xl t xl xi 1 xi and xl xi xl 1 xk we say that the set x is regular if x is regular at every xi x we now explain regularity at xi let xl xi and and note that xi xl and xl 1 xk in addition by the choice of t it is always the case that xi 1 xl t clearly if xi is regular and xi xl exactly one of i ii hold first if i holds at xl the spacing of points in the posetx is uniform in the sense that the length of the edge from xi to xi 1 is surpassed by the sum of the two consecutive edges xl to xl 2 in terms of the translation property i says that 0 t 2 or xi 1 xl 1 this is the negation of a above on the other hand if ii holds at xl the hole inx given by the edge from xi to xi 1 is periodic specifically there are no vertices in x contained in the real interval xl 1 xl t 21 see the figure below in terms of the translation property ii corresponds to the statement that xl 1 xl t of course this is the negation of b above xi xl xi 1 xl t xl 1 xk xl t xk xi xi 1 xl xl 1 xl t xl 1 xl t xk xk 1 xi 1 xi xl t xl 1 xl t xl of course if x is regular it is regular at every xi of particular interest is the case in which xi 1 xi is large then for all xl with xi xl where i is satisfied the sum of the two edges after xl must be long thus since xi 1 xi is large the distances xl 2 xl 1 xl 1 xl taken together must also be large alternatively if ii is satisfied then a hole close to the size of xi 1 xi must be repeated at a distance of exactly away from xl 1 since the distance xi 1 xi is large this says that large holes must be repeated regularly we emphasize that the above statements must hold for all xi x if x is regular alternatively if x fails to be regular with an addition technical condition then there always exist interleavings whose corresponding induced matchings have strictly larger heights proposition 30 if x is not regular at some xi xl where xi 1 is not fixed by xl xi then there exists an interleaving whose induced matching has strictly larger height see example 3 proof by the above remarks let xi xl be such that the translation xl xi has the properties xl 1 xi 1 xl 1 xl t and xi 1 is not fixed by let xl xi and let consider the following convex modules a xi xl 1 c xi xl and d xl xl t where 1 t t is maximal such that xl t xl 1 note that the vertex xl t is also the upper endpoint of a we then define the interleaving between a and c d by the diagonal morphisms a d d a one easily checks that this is indeed an interleaving however the induced matching corresponding to the triangle beginning at matches a with c clearly a and c are not interleaved as w a but c a 0 proceeding as in example 3 by setting i a c d m c d a with and we produce an interleaving where both induced matchings have strictly larger height 22 xl 1 xl t xl 1 xl xi 1 xi xi 1 a a a 2 im c c d d this analysis shows that proof of the matching theorem is likely to fail for the poset px therefore it is necessity at this point to enlarge the category to obtain an isometry on a px mod in the sense of theorem 1 references ars 97 m auslander i reiten and s o smal representation theory of artin algebras cambridge university press 1997 bds 13 p bubenik v de silva and j scott metrics for generalized persistence modules arxiv e prints december 2013 ben 98 a d j benson representations and cohomology volume 1 cambridge university press 1998 ben 98 b d j benson representations and cohomology volume 2 cambridge university press 1998 bl 13 u bauer and m lesnick induced matchings and the algebraic stability of persistence barcodes arxiv e prints november 2013 bl 16 m bakke botnan and m lesnick algebraic stability of zigzag persistence modules arxiv e prints april 2016 car 09 gunnar carlsson topology and data bulletin of the american mathematical society 46 2 255 308 april 2009 ccr 13 joseph minhow chan gunnar carlsson and raul rabadan topology of viral evolution proceedings of the national academy of sciences 110 46 18566 18571 2013 cdo 12 f chazal v de silva and s oudot persistence stability for geometric complexes arxiv e prints july 2012 cidsz 08 gunnar carlsson tigran ishkhanov vin de silva and afra zomorodian on the local behavior of spaces of natural images international journal of computer vision 76 1 1 12 jan 2008 cseh 07 david cohen steiner herbert edelsbrunner and john harer stability of persistence diagrams discrete computational geometry 37 1 103 120 jan 2007 23 cz 09 gunnar carlsson and afra zomorodian the theory of multidimensional persistence discrete computa tional geometry 42 1 71 93 jul 2009 eh 14 e g escolar and y hiraoka persistence modules on commutative ladders of finite type arxiv e prints april 2014 gpci 15 chad giusti eva pastalkova carina curto and vladimir itskov clique topology reveals intrinsic geo metric structure in neural correlations proceedings of the national academy of sciences 112 44 13455 13460 2015 hnh 16 yasuaki hiraoka takenobu nakamura akihiko hirata emerson g escolar kaname matsue and ya sumasa nishiura hierarchical structures of amorphous solids characterized by persistent homology pro ceedings of the national academy of sciences 113 26 7035 7040 2016 les 11 m lesnick the theory of the interleaving distance on multidimensional persistence modules arxiv e prints june 2011 mm 17 k meehan and d meyer an isometry theorem for generalized persistence modules arxiv e prints oc tober 2017 oud 15 steve oudot persistence theory from quiver representations to data analysis american mathematical soci ety 2015 sg 07 vin silva and robert ghrist coverage in sensor networks via persistent homology algebraic and geometric topology 7 339 358 04 2007 24 1 introduction 2 acknowledgements 3 preliminaries 4 restriction and inflation 5 the shift isometry theorem 6 interleaving distance as a limit 7 regularity references