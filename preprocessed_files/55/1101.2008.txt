robustness of topology of digital images and point clouds peter saveliev abstract such modern applications of topology as digital image analysis and data analysis have to deal with noise and other uncertainty in this en vironment the data structures often appear filtered into a sequence of cell complexes we introduce the homology group of the filtration as the group of all possible homology classes of all elements of the filtration without double count the second step of analysis is to discard the features that lie outside the user s choice of the acceptable level of noise 1 introduction since poincare homology has been used as the main descriptor of the topology of geometric objects in the classical context however all homology classes receive equal attention meanwhile applications of topology in analysis of images and data have to deal with noise and other uncertainty this uncertainty appears usually in the form of a real valued function defined on the topological space persistence is a measure of robustness of the homology classes of the lower level sets of this function 6 2 4 3 since it s unknown beforehand what is or is not noise in the dataset we need to capture all homology classes including those that may be deemed noise later in this paper we introduce an algebraic structure that contains without duplication all these classes each of them is associated with its persistence and can be removed when the acceptable threshold for noise is set the last step can be carried out repeatedly in order to find the best possible threshold the approach follows the approach to analysis of digital images presented in 8 2 backgound the topological spaces subject to such analysis are cell complexes a cell complex is a combinatorial structure that describes how k dimensional cells are attached to each other along k 1 dimensional cells cell complexes come from the following two main sources first a gray scale image is a real valued function f defined on a rectangle given a threshold r the lower level set f 1 r can be thought of as a binary image each black pixel of this image is treated as a square cell in the plane these 2 dimensional cells are combined with their edges 1 cells and vertices 0 cells and in the n dimensional case the image is decomposed into a combination of 0 1 1 ar x iv 1 10 1 20 08 v 2 m at h a t 2 8 a pr 2 01 1 2 peter saveliev n cubes this process is called thresholding the result is a cell complex k for each r see 7 second a point cloud is a finite set s in some euclidean space of dimension d given a threshold r we deem any two points that lie within r from each other as close in this case this pair of points is connected by an edge further if three points are close pairwise to each other we add a face spanned by these points if there are four we add a tetrahedron and finally any d 1 close points create a d cell the process is called the vietoris rips construction the result is a cell complex k for each r 6 next we would like to quantify the topology of the cell complex k it is done via the betti numbersof k b 0 is the number of connected components in k b 1 is the number of holes or tunnels 1 for letter o or the donut 2 for letter b and the torus b 2 is the number of voids or cavities 1 for both the sphere and the torus etc the betti numbers are computed via homology theory 1 one starts by con sidering the collection ck k of all formal linear combinations over a ring r of k cells in k called chains combined they form a finitely generated abelian group called the chain complex ck k or collectively c k a k chain can be recorded as an nk vector where nk is the total number of k cells in k the boundary of a k chain is the chain comprised of all k 1 faces of its cells taken with appro priate signs then the boundary operator ck k ck 1 k acts on the chain complex and is represented by a nk nk 1 matrix from the chain complex c k the homology group is constructed by means of the standard algebraic tools to capture the topological features one concentrates on cycles i e chains with zero boundary a 0 further one can verify whether two given k cycles a and b are homologous the difference between them is the boundary of a k 1 chain t a b t such as two meridians of the torus in this case a and b belong to the same homology class h a b the totality of these equivalence classes in each dimension k is called the k th homology group hk k of k collectively h k then betti number bk is the rank of hk k 3 prior work and outline the methods for computing homology groups are well developed in real life applications however both digital images and point clouds may be noisy and one needs to evaluate the significance of their homology classes the approach to this problem has been the following instead of using a single threshold and studying a single cell complex one considers all thresholds and all possible cell complexes since increasing threshold r enlarges the corresponding complex we have a sequence of complexes k 1 k 2 k 3 k 4 ks where the arrows represent the inclusions in n 1 kn kn 1 let inm kn km n m also be the inclusion this structure kn inm is called a filtration now each of these inclusions generates a homomorphism inm h k n h k m called the homology map induced by inm as a result we have a sequence of homology groups connected by these homomorphisms h k 1 h k 2 h ks 0 robustness of topology of digital images and point clouds 3 these homomorphisms record how the homology changes as the complex grows at each step for example a component appears and then merges with another one or a hole is formed and then filled we refer to these events as birth and death of the corresponding homology classes in order to evaluate the robustness of an element of one of these groups the persistence of a homology class is defined as the number of steps it takes for the class to end at 0 in other words persistence death date birth date the p persistent homology group of ki is defined as the image of i i i p it s what s left from h k i after p steps in the filtration now the robustness of the homology classes of the filtration is evaluated in terms of the set of intervals birth death representing the life spans called barcodes of the homology classes 3 our approach is somewhat different it consists of two steps first step we pool all possible homology classes in all elements of the filtration together in a single algebraic structure sections 4 and 5 the presence of noise is ignored the homology group h kn of filtration kn captures all homology classes in the whole filtration without double counting second step for a given positive integer p the p noise group n p kn is comprised of the homology classes in h kn with the persistence less than p next we remove the noise from the homology group of filtration by using the quotient sections 6 and 7 hp k n h kn np k n in other words if the difference between two homology classes is deemed noise they are equivalent the second step can be repeated as needed we also discuss the computational aspects of this approach section 8 and multiparameter filtrations section 9 our approach provides a coarser classification of the homology of filtrations than the one based on barcodes the reason is that all homology classes with long enough life spans i e high persistence have equal place in the homology group h kn of the filtration regardless of the time of birth and death 4 motivation the homology of a gray scale image in this section we will try to understand the meaning of the homology of the gray scale image in figure 1 for simplicity we assume that there are only 2 levels of gray in addition to black and white a visual inspection of the image suggests that it has three connected components each with a hole therefore its 0 and 1 homology groups shouldhave three generators each we now develop an algebraic procedure to arrive at this result figure 1 a gray scale image and the corresponding filtration 4 peter saveliev first the image is thresholded the lower level sets of the gray scale function of the image form a filtration a sequence of three binary images i e cell complexes k 1 k 2 k 3 where the arrows represent the inclusions suppose ai bi ci are the homology classes that represent the components of ki and ai bi ci are the holes clockwise starting at the upper left corner the homology groups of these images also form sequences one for each dimension 0 and 1 suppose f 1 f 2 are the two homology maps i e homomorphisms of the homol ogy groups generated by the inclusions of the complexes with f 3 0 included for convenience these homomorphisms act on the generators as follows a 1 a 2 a 3 0 b 1 b 2 b 3 0 c 2 c 3 0 a 1 a 2 a 3 0 b 1 0 c 3 0 to avoid double counting we want to count only the homology classes that don t reappear in the next homology group as it turns out a more algebraically con venient way to accomplish this is to count only the homology classes that go to 0 under these homomorphisms these classes form the kernels of f 1 f 2 f 3 now we choose the homology group of the original gray scale image to be the direct sum of these kernels h 0 ki a 3 b 3 c 3 h 1 ki b 1 a 3 c 3 thus the image has three components and three holes as expected 5 homology groups of filtrations in the following sections we provide formal definitions all cell complexes are finite suppose we have a one parameter filtration k 1 k 2 k 3 ks here k 1 k 2 ks are cell complexes and the arrows represent the inclusions in n 1 kn kn 1 and so do inm kn km n m we will denote the filtration by kn inm n m 1 2 s n m or simply kn next homology generates a direct system of groups and homomorphisms h k 1 h k 2 h ks 0 we denote this direct system by h kn inm n m 1 2 s n m or simply h kn the zero is added in the end for convenience our goal is to define a single structure that captures all homology classes in the whole filtration without double counting the rationale is that if x h kn y h k m y inm x and there is no other x satisfying this condition then x and y may be thought of as representing the same homology class of the geometric object behind the filtration the homology group of filtration kn is defined as the product of the kernels of the inclusions h kn ker i 1 2 ker i 2 3 ker i s s 1 here from each group we take only the elements that are about to die since each dies only once there is no double counting since the sequence ends with 0 we robustness of topology of digital images and point clouds 5 know that everyone will die eventually hence every homology class appears once and only once these are a few simple facts about this group proposition 5 1 if i n n 1 is an isomorphism for each n 1 2 s 1 then h kn h k 1 proposition 5 2 if i n n 1 is a monomorphism for each n 1 2 s 1 then h kn h ks proposition 5 3 suppose kn inm n m 1 2 s and ln jnm n m 1 2 s are filtrations then h kn t ln h kn h ln proposition 5 4 suppose kn inm n m 1 2 s and ln jnm n m 1 2 s are filtrations and f ks ls is a cell map then the homology map of the ho mology groups of these filtrations f h kn h ln is well defined as f x 1 x 2 xs f 1 x 1 f 2 x 2 f s xs where fn is the restriction of f to kn the stability of the homology group of a filtration follows from the stability of its persistence diagram i e the set of points birth death r 2 for the generators of the homology groups of the filtration plus the diagonal it is proven in 5 that db d f d g f g where db is the bottle neck distance between the persistence diagrams d f d g of two filtrations generated by tame functions f g function f x y y x creates an analogue bottle neck distance for the set of points persistence r and its stability follows from the continuity of f 6 motivation the high contrast homology of a gray scale image to justify our approach to persistence we observe that some of the features in the image in figure 1 are more prominent than others in particular some of the features have lower contrast these are the holes in the second and the third rings as well as the third ring itself by contrast of a lower level set of the gray level function we understand the difference between the highest gray level adjacent to the set and the lowest gray level within the set an easy computation shows that the homology classes with persistence of 3 or higher among the generators are a 1 b 1 a 1 however the set of the classes of high persistence isn t a subgroup of the homology group of the respective complex instead we look at the classes with low persistence i e the noise in particular the classes in h k 1 of persistence 2 or lower form the kernel of f 2 f 1 we now remove this noise from the homology groups of the filtration by considering their quotients over these kernels in particular the 3 persistent homology groups of the image are h 30 k i a 1 b 1 0 a 1 b 1 h 31 k i a 1 b 1 b 1 a 1 observe that the output is identical to the homology of a single complex i e a binary image with two components and one hole the way persistence is defined ensures that we can never remove a component as noise but keep a hole in it 6 peter saveliev observe now that the holes in the second and third rings have the same per sistence contrast and therefore occupy the same position in the homology group regardless of their birth dates gray level second if we shrunk one of these rings its persistence and therefore its place in the homology group wouldn t change these observations confirm the fact that the homology group of the gray scale image unlike the barcodes captures only its topology in the case of a vietoris ripps complex not only the barcode birth death but also the persistence death birth of a homology class contains information about the size of representatives of these classes for example a set of points arranged in a circle will produce a 1 cycle with twice as large birth death and persistence than the same set shrunk by a factor of 2 however persistence defined as death birth will have the desired property of scale independence the same result can be achieved by an appropriate re parametrizing of the filtration 7 persistent homology groups of filtrations in the general context of filtrations the measure of importance of a homology class is its persistence which is the length of its lifespan within the direct system of homology of the filtration given filtration kn we say that the persistence p x of x h kn is equal to p if i n n p x 0 and i n n p 1 x 6 0 our interest is in the robust homology classes i e the ones with high persistence however the collection of these classes is not a group as it doesn t even contain 0 so we deal with noise first given a positive integer p the p noise homology group n p k n of kn is the group of all elements of kn with persistence less than p alternatively we can define these groups via kernels of the homomorphisms of the inclusions n p k n ker i n n p proposition 7 1 n p 1 k n np kn next we remove the noise from the homology group the p persistent ho mology group of kn with respect to the filtration kn is defined as hp k n h k n np k n the point of this definition is that given a threshold for noise if the difference between two homology classes is noise they should be equivalent next just as in the case of noise less analysis we define a single structure to capture all robust homology classes let p be a positive integer suppose x ker ik k p and let y i k k 1 x then ik 1 k 1 p y i k 1 k 1 p i k k 1 x ik k 1 p x i k p k p 1 i k k p x ik p k p 1 0 0 hence y ker ik 1 k 1 p we have proved that ik k 1 ker i k k p ker i k 1 k 1 p it follows that the homomorphism i k k 1 ker i k k p ker i k 1 k 1 p generated by the inclusion is well defined robustness of topology of digital images and point clouds 7 next we use these homomorphisms to define the p noise homology group n p kn of filtration kn as np k n ker i 1 2 ker i s s 1 observe that the formula is the same as the one in the definiton of h p kn since i k k 1 ker i k k p ker i k 1 k 1 p is a restriction of i k k 1 h p k k hp kk 1 each term in the above definition is a subgroup of the corresponding term in the definition of h kn the proposition below follows proposition 7 2 n p kn h kn finally the p persistent homology group of filtration kn is hp k n h kn np k n the results about h p kn analogous to the ones about h kn in section 5 hold 8 computational aspects for 2 dimensional gray scale images this approach to homology and persistence has been used in an image analysis program the algorithm described in 8 has complexity of o n 2 where n is the number of pixels in the image for the general case the analysis algorithm may be outlined as follows 1 the input is a filtration 2 the homology groups of its members and the homomorphisms induced by inclusions are computed 3 the homology group of the filtration is computed 4 the persistence of all elements of the homology groups is computed 5 the user sets a threshold p for persistence and the p noise group of the filtration is computed 6 the p persistent homology group of the filtration is computed and given as output if the user changes the threshold the last step is repeated as necessary without repeating the rest the algorithm above computes the homology group of filtration as defined incrementally this may be both a disadvantage and an advantage in comparison the persistence complex 3 also contains information about all homology classes of the filtration but its computation does not require computing the homology of each complex of the filtration meanwhile the above algorithm may have to compute the same homology over and over if consecutive complexes are identical hence the algorithm has a disadvantage in terms of processing time on the other hand the incremental nature of the algorithm makes its use of memory independent from the length of the filtration another advantage is that multi parameter filtrations are dealt with in the exact same manner see next section the inefficiency of the above algorithm can be addressed with a proper algebraic tool this tool is the mapping cone 9 suppose for simplicity that our filtration has only two elements i k 1 k 2 the mapping cone is in a sense a combination of the kernel and the cokernel of i it captures the difference between k 1 and k 2 on the chain level everything in c k 1 is killed unless it also appears in c k 2 under i then the algorithm is to construct the homology group from the chain 8 peter saveliev complexes c k 1 c k 2 of the elements of the filtration and the chain map i c k 1 c k 2 9 multiparameter filtrations multiparameter filtrations come from the same main sources as one parameter filtrations first color images are thresholded according to their three color chan nels second point clouds are thresholded by the closeness of their points and for example the density of hte points let limit our attention to the two parameter case a finite two parameter filtrations knm is a table of complexes connected by inclusions i n m n p m q knm kn p m q p q 0 these inclusions generate homomorphisms i n m n q m p h k nm h kn q m p with 0 s added in the end of each row and each column define the homology group of the filtration knm as h knm n ker i n m n 1 m ker i n m n m 1 the analogues of the results in section 5 hold there are many ways to define persistence in the multiparameter setting for example we can evaluate the robustness of a homology class x h knm in terms of the pairs p q of positive integers satisfying i n m n p m x 0 and i n m n m q x 0 next just as in section 7 we restrict the homomorphisms generated by the inclu sions to the homology classes of low persistence i n m n 1 m ker i n m n p m ker i n 1 m n 1 p m i n m n m 1 ker i n m n m q ker i n 1 m n m 1 q then the p q noise group of knm is defined via these homomorphisms npq k nm n ker i n m n 1 m ker i n m n m 1 finally the p q persistent homology group of filtration knm is defined as hpq k n h knm npq k nm the results about h pq knm analogous to the ones about h p kn in section 7 hold references 1 g bredon topology and geometry springer verlag 1993 2 g carlsson topology and data bulletin of the amer math soc vol 46 no 2 pp 255 308 2010 3 g carlsson and a zamorodian computing persistent homology discrete and compu tational geometry 2005 20 th acm symposium on computational geometry brook lyn ny 2004 robustness of topology of digital images and point clouds 9 4 g carlsson and a zamorodian the theory of multidimensional persistence 23 rd acm symposium on computational geometry gyeongju south korea 2007 discrete and computational geometry 2009 5 d cohen steiner h edelsbrunner j harer stability of persistence diagrams dis crete and computational geometry vol 37 no 1 pp 103 120 2007 6 h edelsbrunner d letscher and a zomorodian topological persistence and sim plification discrete comput geom 28 2002 pp 511 533 7 t kaczynski k mischaikow and m mrozek computational homology appl math sci vol 157 springer verlag ny 2004 8 p saveliev a graph non tree representation of the topology of a gray scale image proceedings of spie algorithms and systems 2011 volume 7870 o 1 o 19 9 c a weibel an introduction to homological algebra cambridge university press 1994 robustness of topology of digital images and point clouds department of mathematics marshall university one john marshall drive hunt ington wv 25755 http inperc com wiki index php title homology of filtrations 1 introduction 2 backgound 3 prior work and outline 4 motivation the homology of a gray scale image 5 homology groups of filtrations 6 motivation the high contrast homology of a gray scale image 7 persistent homology groups of filtrations 8 computational aspects 9 multiparameter filtrations references