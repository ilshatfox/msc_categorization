an explicit numerical algorithm to the solution of volterra integral equation of the second kind leanne dong behavioural data science group faculty of engineering and it the university of technology sydney ultimo nsw 2007 australia leanne dong uts edu au and john van der hoek school of mathematics and statistics the university of south australia john vanderhoek unisa edu au abstract this paper considers a numeric algorithm to solve the equation yptq fptq t 0 gpt qyp qd with a kernel g and input f for y in some applications we have a smooth integrable kernel but the input f could be a generalised function which could involve the dirac distribution we call the case when f the dirac distribution centred at 0 the fundamental solution e and show that e h where h is integrable and solve hptq gptq t 0 gpt qhp qd the solution of the general case is then yptq fptq ph fqptq which involves the convolution of h and f we can approximate g to desired accuracy with piecewise constant kernel for which the solution h is known explicitly we supply an algorithm for the solution of the integral equation with specified accuracy 1 volterra integral equation of the second kind applications of hawkes process in various grounds such as in quantitative finance and machine learning see for instance 2 4 3 requires one to study volterra equation of the second kind when f where is the dirac distribution centred at 0 we call the solution yptq the fundamental solution of the second order volterra equation using the theory of distributions by schwartz one can show that the fundamental solution have the form h where h is a l 1 function solving the equation h g h g it also follow from this study that the general solution of volterra equation is y f h f and this convolution is well defined for many examples used in the studies of hawkes yptq fptq h p n i 1 wi p tiq f 1 q ptq fptq n i 1 wihptiq ph f 1 qptq date august 9 2019 1 ar x iv 1 90 8 02 86 2 v 1 m at h n a 7 a ug 2 01 9 we seek solution of yptq fptq t 0 yp qgpt qd for t 0 1 1 in the hawkes s setup gptq k ptq 1 2 where is l 1 prq with norm 1 that is ptq 0 if t 0 and ptq 0 if t 0 and 8 0 ptqdt 1 0 k 1 we seek h hptq gptq t 0 hp qgpt qd t 0 1 3 in fact hptq gptq pg gqptq pg g gqptq 8 n 1 gbnptq 1 4 where gbnptq g b g b g b g is n fold convolution gb 1 g remark the n fold convolution always exists in l 1 prq and gbn l 1 prq k n nl 1 prq 1 5 in very few cases analytic expressions for h are available if ptq e t for t 0 then hptq k e p 1 kq t for t 0 analytic expressions are also available for ptq p q t 1 e t for t 0 0 0 ptq 1 0 t 1 0 t 1 for other choices numerical procedure are needed if ga is an approximation of g and g 1 ga 1 k 1 then h ha 1 1 p 1 kq 2 g ga 1 1 6 h ha 8 1 p 1 kq 2 g ga 8 1 7 where h 1 8 0 hptq dt and h 8 supt 0 hptq the proofs of 1 6 and 1 7 are in appendix the key result here would be to find h explicitly where gptq j j t pj 1 q 0 t 0 1 8 and 2 8 0 gptq dt 8 j 0 j 1 1 9 in our explicit calculation here the j 0 we provide an algorithm for h which involves no approximation 2 part i special case we study the case gptq j if j t j 1 0 t 0 2 1 and then derive the case in 1 9 from it define rectptq 1 0 t 1 0 t 1 t 0 2 2 plfqptq fpt 1 q 2 3 when f p l 1 prq in 2 3 we note that plfqptq 0 if t 1 we use the laplace transform yrectpsq 8 0 e strectptqdt 1 e s s ps 0 q 2 4 xlfpsq 8 0 lfptqe st dt 8 0 fpt 1 qe st dt 8 1 fpt 1 qe st dt 8 0 fpuqe spu 1 q du e s f psq xmlpsqf psq 2 5 where xmlpsq is called a multiplier for obvious reasons let us define a 8 j 0 ajlj 2 6 where lj l l l j times and ljfptq fpt jq for t 0 so afptq 8 j 0 ajfpt jq 2 7 3 yafpsq 8 j 0 aje js f psq xmapsqf psq 2 8 where xma is the multiple of a define i l 2 9 so p fqptq fptq fpt 1 q and p fpsq p 1 e sqf psq xm psqf psq define jfptq t 0 fp qd 2 10 hence pjfpsq 1 s f psq xmjpsqf psq lemma 2 1 g arect 2 11 proof arectptq 8 j 0 ajpljrectqptq 8 j 1 ajrectpt jq and rectpt jq 1 if j t j 1 0 otherwise we now compute g b b g gbn we note that ygbnpsq g psqn xmapsqnyrectpsqn 2 12 becomes g psq xmapsqyrectpsq 2 13 4 and yrectpsq 1 e s s xmjpsqxm psq lemma 2 2 let fptq pt aq pt aq if t a 0 otherwise then f psq p 1 q s 1 e sa 2 14 proof we have f psq 8 0 fptqe st dt s 0 8 a pt aq e st dt 8 0 u e spu aq du u t a e sa 8 0 u e su du e sa p 1 q s 1 s 0 where is the usual gamma function namely pxq 8 0 t x 1 e tdt for x 0 using binomial expansion pa bqn an n 1 an 1 b n 2 an 2 b 2 bn we found that yrectpsqn 1 sn p 1 e sqn 1 sn n r 0 n r p 1 qre rs n r 0 p 1 qr n r 1 sn e rs n r 0 p 1 qr n r 1 pn 1 q pn 1 q sn e rs this leads to lemma 2 3 rect rect rectptq n r 0 p 1 qr n r 1 pn 1 q pt rqn 1 2 15 for n 1 proof this is an immediate result from our previous calculation 5 here are some graphics for n 1 2 and 3 in general it can be shown that rectbn are n 1 0 0 0 2 0 4 0 6 0 8 1 0 0 5 1 0 1 5 2 0 n 2 t 2 t 1 t 2 0 5 1 0 1 5 2 0 0 2 0 4 0 6 0 8 1 0 1 2 t 2 3 2 t 1 2 3 2 t 2 2 1 2 t 3 2 0 5 1 0 1 5 2 0 2 5 3 0 0 15 0 20 0 25 0 30 0 35 0 40 0 45 n 3 unimodal functions and have maxima at n 2 and they are pn 2 q times differentiable on p 0 nq for n 3 we can write nptq rect rectlooooooomooooooon n ptq 2 16 and is given by the expression in 2 15 these are universal functions they may have other good applications in numerical analysis we can give an alternative expression for n note that 6 xjnfpsq xmjpsqn f psq 1 sn f psq and by lemma 2 2 with a 0 and n 1 jnfptq t 0 pt qn 1 pn 1 q fp qd 2 17 if we select f 1 then jnfptq t 0 pt qn 1 pn 1 q d and so jn 11 ptq 1 pn 1 q tn 1 2 18 and zjn 1 psq 1 sn 2 19 lemma 2 4 we have nptq n pn 1 q tn 1 2 20 proof this follows from p npsqxm psqn jn 11 psq as i l n 8 r 0 p 1 qr n r lr and so 2 20 is equivalent to 2 15 the last step to gbn is to compute an lemma 2 5 an 8 r 0 nr l r 2 21 where t nr u are calculated as follows 1 r ar r 0 1 2 2 22 n 1 r n 1 l 0 al nr l 2 23 7 proof we start with an 1 a 8 r 0 nr l r 8 j 0 ajlj 8 r 0 nr l r and equate coefficient of lr on both sides corollary corollary to 2 5 we note that nr is the coefficient of xr in pa 0 a 1 x a 2 x 2 qn 8 r 0 nr x r and if we put x 1 8 r 0 nr k n 2 24 theorem 2 6 gbnptq an nptq 8 r 0 nr pl r nqptq 2 25 remark the intuition of theorem 2 6 is that if we want n fold convolution the way to do it is to apply a n times to the then nptq is the n fold convolution of the rectanglular function and itself then the operator a applies to n n times theorem 2 7 hptq 8 n 0 n 1 r 0 nr pl r nqptq 2 26 instead of taking unit interval we approximate in step of if you solve for the case 1 then theorem 2 7 gives us formula for h 3 part ii actual case for part i we now let g ptq j j t pj 1 q 0 otherwise 3 1 let us now define some useful operators first define l 0 pl fqptq fpt q 3 2 ps fqptq 1 f t 3 3 s 1 s 1 3 4 8 lemma 3 1 l s ls 1 3 5 proof for the left hand side l fptq fpt q for the right hand side fptq s 1 fpt q l fp pt 1 qq fp t q s 1 p fp t qq fpt q let g be as in part i then s gptq 1 g t 1 aj if j t j 1 0 otherwise 3 6 so g s g when aj j for j 0 1 suppose we want to find the solution of h ptq g ptq t 0 h p qg pt qd 3 7 we show lemma 3 2 h ptq 1 h 1 for t 0 3 8 proof note that h is the solution of 3 7 but g ptq 1 g t then h ptq 1 g t t 0 h p q 1 g t d 1 g t t 0 h p q 1 g t d 1 g t t 0 h pu q 1 g t u du u 1 g t t 0 h pu qg t u du therefore h pt q 1 gptq t 0 h pu qgpt uqdu 9 or h pt q gptq t 0 h pu qgpt uqdu and by uniqueness of solution of the volterra equation 1 3 h pt q hptq which implies h ptq hpt q or h ptq 1 h t and so h ptq 1 h t s hptq using the definition of s in 3 3 4 applications the solution to equation 1 is yptq fptq ph fqptq 4 1 example 1 suppose fptq n i 1 wi pt tiq f 1 ptq 4 2 where tw 1 wnu are some weights and t 1 t 2 tn is the diract delta function and f 1 p l 1 locpr q this means that f 1 ptq for t 0 and for any t 0 t 0 f 1 ptq dt 8 if f 1 p l 1 pr q that is 8 0 fptq dt 8 then f 1 p l 1 locpr q if fptq 2 sinptq for t 0 and 0 for t 0 then wi 0 i 1 n and f 1 ptq 2 sin t p l 1 locpr q f 1 r l 1 pr q thus yptq fptq h n i 1 wi p tiq f 1 ff ptq fptq n i 1 wihptiq ph f 1 qptq as f 1 p l 1 locpr q then ph f 1 qptq is well defined as h p l 1 pr q and ph f 1 q p l 1 locpr q and t 0 h f 1 ptq dt h l 1 pr q t 0 f 1 ptq dt 4 3 this means that we need a formula for ph f 1 qptq when f 1 p l 1 locpr q lemma 4 1 let f p l 1 locpr q then ph fqptq s ph ps 1 fqqptq t 0 4 4 10 proof let jptq ph fqptq t 0 h p qfpt qd t 0 1 h fpt qd by lemma 7 t 0 hpuqfpt u qdu u t 0 hpuqfpt u qdu so jp tq t 0 hpuqfpt u qdu and so jp tq t 0 hpuq fp pt uqqdu s 1 jptq t 0 hpuqs 1 fpt uqdu and so jptq s ph s 1 fqptq this means that h f can be calculated via h comment we might want to vary 0 we could vary h or we could keep h constant once calculated and vary s f if fptq 2 sin t then s fptq 2 1 sin t t 0 0 t 0 theorem 4 2 if f p l 1 locpr q ph fqptq 8 n 0 8 r 0 nr l r p n fq 11 proof we note that plr nq fpsq zlr npsqf psq xmlpsqr p n fqpsq lrp n fqpsq and the theorem is proved corollary if one requires ph fqptq for t n for some integer n 1 then one may use lr with r n 1 corollary we have ph fqptq s 1 8 n 0 n 1 r 0 nr l r p n s fqptq 4 5 and if we only need values for t n then may use lr with r n 1 lemma 4 3 if f 1 f 2 are in l 1 locpr q then lpf 1 f 2 q plf 1 q f 2 f 1 lf 2 4 6 proof we have lpf 1 f 2 qptq pf 1 f 2 qpt 1 q t 1 0 f 1 p qf 2 pt 1 qd t 1 f 1 pu 1 qf 2 pt uqdu pu 1 q t 0 f 1 pu 1 qf 2 pt uqdu as f 1 pu 1 q 0 for 0 u 1 t 0 plf 1 qpuqf 2 pt uqdu tplf 1 q f 2 uptq as f 1 f 2 f 2 f 1 the theorem follows remark we have lrp n fq plr nq f 4 7 we could have lr n functions tabulated universally calculated for r and n we only need r n 1 in 2 24 and 4 5 as nptq 0 for t n 12 lemma 4 4 let f 1 f 2 p l 1 locpr q l pf 1 f 2 q pl f 1 q f 2 4 8 1 pl f 2 q 4 9 proof we have l pf 1 f 2 qptq pf 1 f 2 qpt q t 0 f 1 p qf 2 pt qd t f 1 pu qf 2 pt uqdu u t 0 f 1 pu qf 2 pt uqdu as f 1 pu q 0 if 0 t pl fq f 2 ptq and as before we now try to simplify 4 5 stated earlier by utilising the operators defined in lemma 3 2 h s h h f ps hq f 4 10 lemma 4 5 let f p l 1 pr q ys fpsq f ps q 4 11 proof we have for s 0 ys fpsq 8 0 1 f t e st dt 8 0 1 fpuqe s u du t u f ps q 5 error analysis we note that the results in 1 6 and 1 7 if f p l 1 pr q then 1 h f h f 1 f 1 p 1 kq 2 g ga 1 5 1 h f h f 8 f 1 p 1 kq 2 g ga 8 5 2 1 see proof in appendix 13 if f p l 1 locpr q then 5 2 becomes sup 0 t t h fptq h fptq t 0 fptq dt 1 k g ga 8 5 3 which was proved in earlier notes 6 examples power law and rayleigh kernel example 2 let gptq k c pc tq 1 if t 0 0 if t 0 we set j gpj q j 0 1 then for j t pj 1 q gptq gpj q t j max j t pj 1 q g 1 ptq g 1 ptq k p 1 q pc tq 2 and so g 1 ptq k p 1 q for all t 0 so gptq gpj q t j k p 1 q k p 1 q so g ptq with this choice of j satisfies 14 g g 8 k p 1 q 6 1 so h h 8 k p 1 q 1 k 6 2 and for t t h fptq h fptq k p 1 q 1 k t 0 fptq dt 6 3 example 3 gptq kt 2 e t 2 2 2 6 4 out 1 2 3 4 5 6 0 2 0 4 0 6 0 8 1 0 1 2 g rayleigh probability density function 0 0 g t dt k 1 g 1 ptq k 2 r 1 t 2 2 se t 2 2 2 so g 1 ptq k 2 1 t 2 2 et 2 2 2 k 2 1 t 2 2 1 t 2 2 2 2 k 2 1 t 2 2 2 t 2 2 2 2 k 2 again choose j gpj q j 0 1 6 5 and then gptq g ptq 2 k 2 6 6 and the error analysis follows the same argument before 15 example 4 let gptq k if 0 k 1 0 otherwise 6 7 thus this is the case where a 0 k aj 0 for j 1 so nr 0 if r 1 and n 0 k n hptq 8 n 0 kn nptq 6 8 as nptq 0 for t n we only need a finite number of terms in 6 8 to calculate hptq for t t in fact for t t hptq rts n 0 kn nptq 7 numerical implementation compute nr coefficients for r n 1 all rest equal 0 for n 1 2 solve the function nptq for each n matlab or c so that their values can be called see equation 2 15 if k is small we can drop out terms in 2 24 with a small error that can be estimated may lead to dropping further terms in calculation no approximation is required because for 0 t t only a finite number of terms of the series are non zero 8 future outlook we will implement our explicit algorithm into software and experiment with its behaviour we will also experiment with real world data by using our generative integral equation model to predict for arbitrary time point see the ode version in 1 this will contribute to not only the current scientific computing literature but also benefit the machine learning community 9 acknowledgments this material was motivated from a problem in computational social science we thank be havioral data science group especially dr marian andrei rizoiu in facilitating discussions and supporting us with research environment 10 appendix we now prove 1 6 and 1 7 if we write 1 1 as hi gi gi hi i 1 2 h 1 h 2 g 1 g 2 g 1 h 1 g 2 h 2 g 1 g 2 pg 1 g 2 q h 1 g 2 ph 1 h 2 q so h 1 h 2 g 1 g 2 h 1 g 1 g 2 g 2 h 1 h 2 16 so h 1 h 2 1 1 g 2 p 1 h 1 q g 1 g 2 1 1 g 2 1 g 1 1 g 1 g 1 g 2 p 4 q g 1 g 2 p 1 g 1 qp 1 g 2 q p 5 q where all norms are l 1 norms for which l 1 l 1 l 1 if g 1 g 2 then h 1 h 2 this implies 1 1 has an unique solution also if gn g in l 1 then hn h in l 1 if we assume gn k 1 for all n 1 which leads to hn h l 1 1 p 1 kq 2 gn g l 2 6 we do not want gn 1 as n 8 we can also show convergence in sup norms let us define t sup 0 s t psq let t 0 and s p r 0 ts then sup 0 s thpsq psq s 0 hp qgps qd g t h t s 0 gps qd g t h t t 0 gp qd g t h t 8 0 gp qd g t k h t as sup 0 s thpsq g t so h t g t k h t or h t 1 1 k g t and also supt 0 hptq 1 1 k supt 0 gptq 7 now we would like to derive 6 under supt or t now for 0 s t we have h 1 psq h 2 psq g 1 psq g 2 psq pg 1 g 2 q h 1 psq g 2 ph 1 h 2 qpsq 17 thus as before h 1 psq h 2 psq g 1 psq g 2 psq g 1 g 2 t s 0 h 1 p qd h 1 h 2 t s 0 g 2 p qd g 1 g 2 tp 1 h 1 l 1 q g 1 g 2 t g 2 l 1 and if g 1 g 2 k 1 then 1 h 1 l 1 1 k 1 k 1 1 k and so h 1 h 2 t g 1 g 2 t 1 1 g 1 l 1 h 1 h 2 t g 2 l 1 and so h 1 h 2 t g 1 g 2 t p 1 g 1 l 1 qp 1 g 2 l 1 q 8 and so h 1 h 2 t 1 p 1 kq 2 g 1 g 2 t 9 and letting t 8 h 1 h 2 8 1 p 1 kq 2 g 1 g 2 8 where f d supt 0 fptq this implies that if gn g in sup norm then so does hn h in sup norm provided gn k 1 for all n 1 10 1 proofs of equations 5 1 and 5 2 h f h f f l 1 h h where is either l 1 and l 8 norm then following the same arguments of proving 1 6 one has h f h f f l 1 p 1 kq 2 g g references 1 ricky t q chen yulia rubanova jesse bettencourt and duvenaud david neural ordinary differential equations in nips 2018 2018 2 d j daley and d vere jones an introduction to the theory of point processes vol i probability and its applications new york springer verlag new york second edition 2003 3 angelos dassios and hongbiao zhao a dynamic contagion process adv in appl probab 43 3 814 846 09 2011 4 marian andrei rizoiu lexing xie scott sanner manuel cebrian honglin yu and pascal van hentenryck expect ing to be hip hawkes intensity processes for social media popularity in world wide web 2017 international conference on pages 1069 1078 perth australia 2017 18 1 volterra integral equation of the second kind 2 part i special case 3 part ii actual case for part i 4 applications 5 error analysis 6 examples power law and rayleigh kernel 7 numerical implementation 8 future outlook 9 acknowledgments 10 appendix 10 1 proofs of equations and references