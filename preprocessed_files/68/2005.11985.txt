stratified formal deformations and intersection homology of data point clouds markus banagl tim ma der and filip sadlo abstract intersection homology is a topological invariant which detects finer informa tion in a space than ordinary homology using ideas from classical simple homotopy the ory we construct local combinatorial transformations on simplicial complexes under which intersection homology remains invariant in particular we obtain the notions of stratified formal deformations and stratified spines of a complex leading to reductions of complexes prior to computation of intersection homology we implemented the algorithmic execution of such transformations as well as the calculation of intersection homology and apply these algorithms to investigate the intersection homology of stratified spines in vietoris rips type complexes associated to point sets sampled near given possibly singular spaces contents 1 introduction 1 2 simplicial collapses expansions and spines 4 3 filtered spaces and intersection homology 5 4 stratified formal deformations and stratified spines 12 5 freely orthogonal deformation retractions 19 6 stratified formal deformations homotopy type and intersection homology 22 7 implementation 24 8 examples and evaluation 27 references 31 1 introduction in 4 bendich and harer proposed the use of intersection homology a finer invariant than ordinary homology in the topological analysis of large data sets in particular they defined persistent intersection homology and described its algorithmic computation bendich and harer conclude by asking whether in addition to persistence considerations and the selection criteria imposed by intersection homology other simplex removal processes might be con ducive to a finer understanding of large data sets in the present paper we adapt ideas from classical simple homotopy theory 22 10 due to j h c whitehead to the stratified setting in order to construct local combinatorial operations on a simplicial complex under which intersection homology provably remains invariant these operations lead in particular to a class of stratified spines of a complex that are algorithmically computable generally not date may 2020 2010 mathematics subject classification 55 n 33 68 key words and phrases intersection homology computational topology algorithms this work is supported by deutsche forschungsgemeinschaft dfg german research foundation under ger many s excellence strategy exc 2181 1 390900948 the heidelberg structures excellence cluster 1 ar x iv 2 00 5 11 98 5 v 1 m at h a t 2 5 m ay 2 02 0 2 markus banagl tim ma der and filip sadlo homeomorphic to each other yet possess isomorphic intersection homology groups spines are well known to carry deep information on the topological complexity of spaces sometimes even allowing for classification results see e g 17 carrying over algorithmic simplicial reduction processes to filtered and stratified settings is in line with the general objective in topological data science of finding ways to reduce the size of complexes while preserving topological invariants before computing homology zomorodian 23 for example under scores the advantage of prior reduction by citing the supercubical complexity in the size of the complex of classical matrix reduction algorithms for computing homology over the inte gers and the quadratic space and cubic time complexity of gaussian elimination over field coefficients the ordinary homology of a topological space is invariant under homotopy equivalences if the space is a closed oriented manifold then the ordinary homology satisfies in addition poincare duality relating the groups in complementary dimensions the homotopy invariance is of course a fundamental general pillar of the theory but allows in particular for applications of homology in data science since the simplicial complexes generated from data point clouds are usually only homotopy equivalent to an underlying space whose structure one hopes to detect general homotopy equivalences in high dimensions are very complicated both con ceptually and algorithmically this was realized early on in the development of topology and prompted research on more combinatorial models of homotopy equivalences in his land mark paper 22 j h c whitehead introduced the notion of simple homotopy equivalence which for simplicial complexes can be described entirely combinatorially in terms of local operations elementary simplicial collapses and expansions this notion together with white head s torsion became very influential in high dimensional manifold topology yielding such results as the s cobordism theorem poincare duality on the other hand is the source of numerous invariants that play im portant roles in understanding and classifying manifolds even within their simple homotopy type however in real world applications spaces often possess strata of non manifold i e singular points simple examples show that the presence of such singularities generally in validates poincare duality several solutions to this problem exist goresky macpherson s intersection homology 13 14 cheeger s l 2 cohomology 6 7 8 and the theory of intersection spaces 2 due to the first named author the present paper is concerned only with intersection homology now contrary to ordinary homology intersection homology is not invariant under arbi trary homotopy equivalences even when these are simple in whitehead s sense on the other hand stratum preserving homotopy equivalences will not alter intersection homology even when they are not simple a natural question is thus do there exist local simplicial moves that are akin to whitehead s but do preserve given strata and intersection homology we report here on the discovery of such moves we call them stratified collapses and expansions in the manifold situation with only one stratum these coincide with whitehead s operations the stratified collapses and expansions defined here may ultimately lead to a concept of strati fied simple homotopy type which we shall not fully develop in the present paper classically finite sequences of elementary collapses and expansions are called formal deformations we thus define stratified formal deformations as finite sequences of stratified collapses and expan sions our central theoretical result theorem 6 2 states that stratified formal deformations assumed to preserve formal codimensions of strata are stratified homotopy equivalences in the classical sense an immediate corollary is that intersection homology remains invariant under such stratified formal deformations corollary 6 4 these results can be reinterpreted as giving conditions under which the intersection homology of a given space can be computed stratified formal deformations and intersection homology of data point clouds 3 directly from a vietoris rips type complex of data points near the space corollary 6 5 but the conditions may be hard to check a priori whitehead s theory implies in particular the concept of a spine of a complex intersection homology satisfies poincare duality for spaces that are so called pseudomanifolds these al low for a notion of orientability it is an easy observation see lemma 4 1 that if in a given complex one looks for pseudomanifolds obtainable by simplicial collapses then one must seek them among the spines of that complex therefore and for reasons mentioned earlier spines constitute a particularly important class of subcomplexes our stratified simple homo topy transformations lead to a notion of a stratified spine of a stratified complex in general a given complex will have nonhomeomorphic stratified spines but our main theorem implies that any two codimension preserving stratified spines have isomorphic intersection homol ogy groups of course a given ordinary i e unstratified expansion of a pseudomanifold x may not possess a stratified spine which is homeomorphic to x or which even just has the same intersection homology as x though it trivially always contains an ordinary spine with that property namely x itself in such cases different methods are required to determine the intersection homology of x from the expansion we have implemented the execution of stratified collapses computation of stratified spines and the calculation of intersection homology with z 2 z coefficients in python and use this implementation to provide various examples of stratified spines and their intersection ho mology of delaunay vietoris rips type complexes associated to data points sampled near various singular spaces from the computational point of view the idea of determining a spine prior to computing homology has the advantage of leading to smaller matrices repre senting chain complex boundary operators vietoris rips and similar complexes generally contain a vast number of topologically insignificant simplices and spines tend to reduce that number substantially in particular the dimension of the spine will often be lower than the dimension of the original complex this also means that in practice the true codimension of a singular point can be better estimated from its geometric codimension in the spine than from its geometric codimension in the original complex interesting questions not treated in this paper concern sampling methods and stratification learning the question for example of describing conditions on point distributions near a singular space x that will ensure that the associated c ech or vietoris rips type complex con tains stratified spines homeomorphic say to x requires quite different methods throughout the paper we assume as do bendich and harer in 4 that for each point it is known whether to deem it regular or singular see however 20 for some suggestions of heuristics the paper is organized as follows section 2 recalls basic material on simplicial complexes and whitehead s classical simple homotopy theory particularly the notions of simplicial col lapses expansions and spines intersection homology is reviewed in section 3 we define it in a rather general setting of filtered spaces and do not limit ourselves to pseudomani folds perversity functions are also allowed to be more general than in the classical papers of goresky and macpherson section 4 develops the central notions of stratified collapses and expansions as well as stratified spines several results are proven that clarify the effect of commuting these operations these results are used in the algorithm design to relate for mal combinatorial collapses to continuous deformations we introduce in section 5 particular representatives of stratified homotopy equivalences called freely orthogonal deformation re tractions the main theoretical results are contained in section 6 while section 7 discusses algorithm design and miscellaneous aspects of our computer implementation we conclude with exemplary executions of these algorithms on various sampled point clouds in section 8 4 markus banagl tim ma der and filip sadlo acknowledgements we would like to thank bastian rieck for early discussions on ordi nary spines and computations using his aleph package 2 simplicial collapses expansions and spines we use the term simplicial complex in the sense of 19 3 p 15 see also 21 2 27 p 26 thus a simplicial complex is a set of finite nonempty sets such that if s k then every nonempty subset face of s is also in k the elements s k of a simplicial complex k are referred to as its closed simplices the dimension of a simplex s is its cardinality minus 1 the 0 dimensional simplices of k will be called vertices the set of vertices of k will be denoted k 0 note that a simplex is thus uniquely determined by its vertices for s t k it will be convenient to write t s if t is a face of s and t s if t is a proper face of s the associated polyhedron or geometric realization of a simplicial complex k is a topological space denoted by k thus we are careful to distinguish between a simplicial complex k and the topological space k if we wish to distinguish denotationally between regarding a simplex s as an element of k or as a closed subset of k given by the convex hull of its vertices then we shall write s for the latter points x k can be described using barycentric coordinates there are unique numbers xu 0 1 for every vertex u k 0 such that x u k 0 xuu and u k 0 xu 1 note that our simplicial complexes are abstract and do not come equipped with an embedding into some euclidean space this is in line with the intended applications in topological data science where simplicial complexes such as the c ech complex or vietoris rips complex of a data point cloud are given as abstract complexes without a preferred embedding in a euclidean space definition 2 1 a simplex in k is called principal in k if it is not a proper face of any simplex in k note that if k is finite dimensional then all top dimensional simplices are principal but there may well be principal simplices that are not top dimensional definition 2 2 a simplex s in k is called free in k if 1 s is a proper face of a principal simplex p in k and 2 s is not a proper face of any simplex in k other than p thus if s is a free simplex then it is the proper face of precisely one simplex p k and this p must be principal we may hence put princk s p if k is understood then we shall also simply write princ s lemma 2 3 if s k is free then dimprinc s dims 1 proof since s princ s we have the bound dims dimprinc s 1 suppose that dims dimprinc s 1 then there is a simplex t k such that s t princ s that is s is a proper face of t but t 6 princ s a contradiction to the freeness of s to define the notion of an elementary collapse of simplices let k be a simplicial complex and s k a free simplex then k k s princk s stratified formal deformations and intersection homology of data point clouds 5 is again a simplicial complex as it is still closed under the operation of taking faces if t is any simplex in k and t 0 is a face of t then t 0 is still in k for otherwise t 0 would have to be equal to s or princ s if t 0 s then s would be a proper face of both t and princ s with t 6 princ s this contradicts the freeness of s in k on the other hand if t 0 princ s then t 0 would be principal in k and so could not be a proper face of t the following definition can be traced back at least to whitehead s paper 22 though precursors date back even further definition 2 4 we say that k has been obtained from k by an elementary collapse of princ s using its free face s we also say that k has been obtained from k by an elementary expansion if k has been obtained from k by an elementary collapse using the free simplex s then we shall also write k ks if s is a free simplex in ks we shall also write ks s as ks s the space ks is a deformation retract of the space k in particular ks and k are homotopy equivalent but more is true ks and k are in fact simple homotopy equivalent in the sense of simple homotopy theory 10 definition 2 5 we say that a simplicial complex k collapses simplicially to a subcomplex l k if l can be obtained from k by a finite sequence of elementary collapses in this case we shall write k l the complex l is then also said to expand to k written l k if k collapses to l then the space l is a deformation retract of the space k and l and k have the same simple homotopy type by its very definition the relation is transitive if k k and k k then k k due to their combinatorial nature collapses can be carried out algorithmically see section 7 definition 2 6 a finite sequence k k 0 k 1 km l where each arrow represents a simplicial expansion or collapse is called a formal deformation from k to l definition 2 7 a subcomplex s k of a simplicial complex k is called a spine of k if 1 k collapses to s and 2 s does not possess a free simplex if s is a spine of k then we shall also refer to the polyhedron s as a spine of the poly hedron k note that condition 2 is an absolute condition on s independent of the ambient complex k so if l k is a subcomplex with k l and s is a spine of l then s is also a spine of k furthermore for such k l if s is a spine of k such that l s then s is a spine of l these observations allow for induction arguments involving spines 3 filtered spaces and intersection homology a filtered topological space has intersection homology groups filtrations arise for exam ple when a space has singular i e non manifold points near which the space does not look like a euclidean space stratification theory then tries to organize the singular points accord ing to their local type into strata which themselves are manifolds of various dimensions the filtration is obtained by taking unions of such strata stratifications can generally be con structed for polyhedra of simplicial complexes orbit spaces of group actions on manifolds real or complex algebraic varieties as well as for many interesting compactifications of non compact spaces e g various moduli spaces a chief motivation for developing intersection homology was to find a theory which satisfies a form of poincare duality for singular spaces 6 markus banagl tim ma der and filip sadlo this duality principle holds for the ordinary homology of closed oriented manifolds but ceases to hold for ordinary homology in the presence of singularities intersection homology was introduced by goresky and macpherson in 13 and 14 a comprehensive treatment can be found in 5 modern resources on intersection homology theory include 15 12 and 1 definition 3 1 a filtered space is a hausdorff topological space x together with a filtration x xn xn 1 x 0 x 1 by closed subsets we call n the formal dimension of x the connected components of the difference sets x j x j 1 are called the strata of formal dimension j of the filtered space if s is a stratum of formal dimension j then codims n j is its formal codimension in x since all strata contained in x j x j 1 have the same formal codimension n j we may call this number the formal codimension of x j x j 1 we write x for the set of strata the strata contained in xn xn 1 are called the regular strata the other strata are called singular the union of the singular strata is called the singular set of x and is denoted by x note that a stratum is singular if and only if its formal codimension is positive in prac tice there are various ways to assign formal codimensions to strata without further a priori knowledge or preprocessing one may simply wish to take the geometric codimension in a given polyhedron better estimates may be obtained by first computing stratified spines and then taking geometric codimension in the spine or by computing persistent local homology groups near singular points we recall the definition of the singular intersection homology groups ih p i x of a filtered space x the basic idea is the following suppose that x is a filtered space for which global orientability can be defined for example a so called pseudomanifold if one defines a chain complex by allowing only chains that are transverse to the strata and computes its i th homol ogy then by a theorem of mccrory see e g 18 theorem 5 2 one obtains the cohomology hn i x of x where n is the dimension of x and x is assumed to satisfy a certain normality condition hence if one could move every chain to be transverse to the stratification then poincare duality would hold if x is orientable however as noted above classical poincare duality fails for general oriented singular spaces thus so does transversality the idea of goresky and macpherson was to introduce a parameter which they called a perversity that specifies the allowable deviation from full transversality and to associate a group to each value of the parameter thereby obtaining a whole spectrum of groups ranging from cohomol ogy to homology the following definition of perversity is somewhat more general than the original definition in 13 definition 3 2 a perversity p is a function associating to each natural number k 0 1 2 an integer p k such that p 0 0 the natural number k is to be thought of as the codimension of a stratum let x be a filtered space and p a perversity recall that a singular i simplex in x is a continuous map i x where i denotes the standard i simplex the degree i singular chain group ci x of x is freely generated by the singular i simplices in x using the alternate sum of the codimension 1 faces of a singular simplex one obtains a boundary map i ci x ci 1 x together with these boundary maps the ci x i 0 1 2 form a chain complex c x the singular chain complex of x its homology is ordinary homology h x stratified formal deformations and intersection homology of data point clouds 7 definition 3 3 a singular i simplex i x is called p allowable if for every stratum s x the preimage 1 s is contained in the union of all i codim s p codims dimensional faces of i a chain ci x is called p allowable if every singular simplex appearing with nonzero coefficient in is p allowable definition 3 4 the group ic p i x of i dimensional singular intersection chains of perver sity p is defined to be the subgroup of ci x given by all chains such that and i is p allowable the boundary map i on ci x restricts to a map i ic p i x ic p i 1 x due to the condition imposed on i thus ic p i x i forms a subcomplex ic p x of the singular chain complex c x definition 3 5 the homology groups of the singular intersection chain complex ih p i x hi ic p x are called the perversity p singular intersection homology groups of the filtered space x the groups thus defined have z coefficients ih p i x ih p i x z groups ih p i x g with coefficients in any abelian group g can also be defined in a straightforward manner for the implementation of our algorithms we chose to work with g z 2 z as did bendich and harer 4 contrary to ordinary homology intersection homology is not invariant under general ho motopy equivalences however if one places suitable filtration conditions on a homotopy equivalence the intersection homology groups do become invariant under such equivalences let us look at such conditions in more detail we shall from now on for simplicity of expo sition and because this context already illustrates all important scientific issues restrict our attention to filtered spaces of the form 1 x xn xn 1 xn k 1 xn k x xn k 1 x 1 which we will briefly denote as pairs x x thus x has formal codimension k the methods introduced in the present paper can without major difficulty be extended to more general filtrations definition 3 6 let x x and y y be filtered spaces a stratified map f x x y y is a continuous map f x y such that f x y and f x x y y such a map is called codimension preserving if codim x codim y let i 0 1 denote the compact unit interval the cylinder on a filtered space x x is the filtered space x i x i i e x i x i we shall also write x x i for the pair x i x i if n is the formal dimension of x then the formal dimension of x i is defined to be n 1 and we set codim x i codim x definition 3 7 a stratified homotopy is a stratified map h x i x i y y thus a stratified homotopy maps h x i y and h x x i y y in particular the tracks of the homotopy remain within the stratum where they start definition 3 8 stratified maps f g x x y y are stratified homotopic if there exists a stratified homotopy h x i x i y y between f and g i e h 0 f and h 1 g note that if f or g is in addition codimension preserving then a stratified homotopy h between f and g is automatically codimension preserving as well 8 markus banagl tim ma der and filip sadlo definition 3 9 a stratified codimension preserving map f x x y y is called a stratified homotopy equivalence if there exists a stratified and then necessarily codimension preserving map g y y x x such that g f and f g are stratified homotopic to the identity it is easy to show that singular intersection homology is invariant under stratified homo topy equivalences see e g friedman 12 prop 4 1 10 p 135 cor 6 3 8 p 271 proposition 3 10 a stratified homotopy equivalence f x x y y of filtered spaces induces isomorphisms f ih p i x ih p i y for all i and all p taking filtered spaces as objects and stratified homotopy equivalences as morphisms yields a category lemma 3 11 the composition of stratified homotopy equivalences is a stratified homotopy equivalence proof let f x x y y and f y y z z be stratified homotopy equiv alences with stratified homotopy inverses g y y x x and g z z y y since f and f are codimension preserving the formal codimensions of the singular sets coincide codimx x codimy y codimz z let h x x i x x be a stratified homotopy between h 0 g f and h 1 idx let h y y i y y be a stratified homotopy between h 0 g f and h 1 idy as h h are stratified the singular sets and their complements are mapped compatibly h x i x h x x i x x h y i y h y y i y y recall that the concatenation f f of two homotopies f f a i b such that f 1 f 0 is the homotopy f f a i b given by f f a t f a 2 t t 0 12 f a 2 t 1 t 12 1 note that if a a b b are subspaces then f f a i b if and only if f a i b and f a i b now let f x i x be the homotopy given by the composition x i f id y i h y g x since f 1 g h 1 f 1 g f h 0 we may concatenate to a homotopy g f h x i x this is then a homotopy between g 1 h 1 idx and g 0 f 0 g h 0 f 0 gg f f it satisfies g x i x since f x i g h f id x i g h y i g y x and h x i x for the complements f x x i g h f id x x i g h y y i g y y x x stratified formal deformations and intersection homology of data point clouds 9 and h x x i x x consequently g x x i x x and g is a stratified homotopy between gg f f and idx note that f f and gg are codimension preserving by symmetry a stratified homotopy g z z i z z between f f gg and idz is obtained by the same method applied to stratified homotopies k y y i y y between k 0 f g and k 1 idy and k z z i z z between k 0 f g and k 1 idz while singular intersection homology is not directly amenable to algorithmic computa tion a simplicial version of intersection homology is it must then be clarified under which conditions these versions are isomorphic we will review this briefly and ask the reader to consult e g friedman s monograph 12 for details suppose that the filtered space x can be triangulated such that the filtration subspaces are triangulated by simplicial subcomplexes let t k x be a choice of such a triangulation the closed subspaces x j x are given by x j t k j for subcomplexes k j k one defines the simplicial intersection chain complex ic p t x as a subcomplex of the simplicial chain complex of k using t and simplices of k that are p allowable with respect to the filtration k j the homology of ic p t x is the simplicial intersection homology ih p t x associated to the triangulation t this is algorithmically computable see section 7 and 4 the dependence on choices of triangulations can be controlled as follows a piecewise linear pl space is a second countable hausdorff space x together with a collection t of locally finite triangulations closed under simplicial subdivision and such that any two trian gulations in t have a common subdivision suppose that the pl space x is pl filtered that is equipped with a filtration by closed subsets x j that are of the form t k j for some trian gulation t in t one then calls t compatible with the filtration taking the direct limit of the simplicial groups ih p t x over the directed set t defines the pl intersection homology ih p pl x of a pl filtered space x when does a particular simplicial intersection homology group compute pl intersection homology a simplicial subcomplex l k is called full if membership of simplices in l can be recognized on the vertex level i e whenever a simplex s k has all of its vertices in l then s itself must be in l a compatible triangulation t t of a pl filtered space x is said to be full if t triangulates the x j as full subcomplexes using finitely many subdivi sions of a compatible triangulation one sees that a pl filtered space always possesses a full triangulation the condition of fullness can of course be checked algorithmically proposition 3 12 goresky macpherson 16 appendix see also 12 thm 3 3 20 p 119 if t is a full compatible triangulation of a pl filtered space x then the canonical map ih p t x ih p pl x is an isomorphism it remains to relate pl intersection homology to singular intersection homology for a compact pl space l let c l denote the open cone 0 1 l 0 l a pl filtered space x is called a pl cs set if it is locally cone like and all filtration differences x j x j 1 are j dimensional pl manifolds points x x j x j 1 must thus have open neighborhoods that are pl homeomorphic to r j c l under a filtration preserving homeomorphism where l is some compact pl filtered space note that this concept creates in particular a logical connection between the topological manifold dimension of strata and the formal dimension of strata in the filtered space given a finite dimensional pl space x there always exists a pl filtration of x such that x becomes a pl cs set with respect to this filtration a given pl filtration may well not satisfy the pl cs condition 10 markus banagl tim ma der and filip sadlo example 3 13 let x k be the polyhedron of the simplicial complex k generated by the 1 simplices v 0 v 1 v 0 v 2 and v 0 v 3 let x x be the closed pl subspace given by the polyhedron of the complex generated by v 0 v 1 v 0 v 2 then x is pl homeomorphic to a compact interval and hence a 1 dimensional pl manifold with boundary the pair x x does not yet constitute a pl filtered space because no formal dimensions have been assigned can we make such an assigment in a way that will make the resulting pl filtered space into a pl cs set if so then we need to assign formal dimension 1 to x i e we are forced to set x 1 x since x is a proper subset of x the formal dimension of x would have to be at least 2 and thus would not agree with the polyhedral dimension of x if such a filtration made x x into a pl cs set then the point v 0 x would have a neighborhood pl homeomorphic to a space of the form r 1 c l for some compact pl space l no such l exists for dimensional reasons l would have to be empty but the neighborhood of v 0 is not homeomorphic to r 1 we conclude that the pl filtered space x x is not a pl cs set if instead one took x x 0 v 0 v 3 and x 1 x then x x would be a pl cs set proposition 3 14 friedman 12 thm 5 4 2 p 229 if x is a pl cs set then there is an isomorphism ih p pl x ih p x between pl and singular intersection homology groups together propositions 3 12 and 3 14 provide sufficient conditions for simplicial intersec tion homology to compute singular intersection homology the upshot is that every pl space x has a pl filtration x j which makes x into a pl cs set and a triangulation whose sim plicial intersection homology computes the singular intersection homology of x x j a particularly important class of singular spaces are pseudomanifolds an n dimensional pl pseudomanifold is a polyhedron x for which some and hence every triangulation has the following property every simplex is the face of some n simplex and every n 1 simplex is a face of exactly two n simplices pseudomanifolds admit a concept of orientability and if a given pseudomanifold is oriented its intersection homology will satisfy a generalized form of poincare duality the following small example shows that direct computation of intersection homology from the vietoris rips complex of a point cloud does not usually yield the correct inter section homology of an underlying space near which the points are sampled even when the points have been sampled well in the sense that the location of the singular set is known and the vietoris rips complex is homotopy equivalent to the underlying space and hence its ordinary homology is correct example 3 15 let 0 denote the zero perversity whose value is 0 on every codimension and let 1 the perversity whose value is 1 on every positive codimension we shall write z 2 for z 2 z the figure eight space s 1 s 1 a wedge of two circles equipped with the obvious filtration with one singular point in codimension 1 has intersection homology ih 0 i s 1 s 1 z 2 z 22 if i 1 z 2 if i 0 0 else ih 1 i s 1 s 1 z 2 z 22 if i 0 0 else figure 1 shows 12 points near an embedding of s 1 s 1 in the plane r 2 as well as an associ ated vietoris rips complex with polyhedron x the singular point s of s 1 s 1 is one of the stratified formal deformations and intersection homology of data point clouds 11 figure 1 vietoris rips polyhedron x of point cloud near s 1 s 1 12 points and is located in the middle of the figure the polyhedron x is 2 dimensional and filtered by s x 0 x 2 x its intersection homology groups are ih 0 i x z 2 ih 1 i x z 2 z 22 if i 0 0 else which are not isomorphic to the above groups of s 1 s 1 a spine x of x is shown in figure 2 it is 1 dimensional and filtered by s x 0 x 1 x a computer calculation of its intersection homology yields ih 0 i x z 2 z 22 if i 1 z 2 if i 0 0 else ih 1 i x z 2 z 22 if i 0 0 else which do agree with the intersection homology of s 1 s 1 of course one may readily deduce this from the fact that in this particular example it so happens that the spine is even stratum preserving homeomorphic to s 1 s 1 which obviously does not always happen we will return to this example in section 8 such examples suggest the idea of using simplicial collapse processes and spines to ex plore the intersection homology of vietoris rips and other simplicial complexes however contrary to ordinary homology intersection homology is not generally invariant under arbi trary simplicial collapses so a second new idea is needed to be developed in the next section the idea of stratified simplicial collapses and expansions 12 markus banagl tim ma der and filip sadlo figure 2 spine x of vietoris rips polyhedron x 4 stratified formal deformations and stratified spines we define stratified simplicial collapses and expansions stratified formal deformations and stratified spines we begin by observing that if in a simplicial complex one looks for pseudomanifolds obtainable by collapses i e the complex is a thickening of an unknown pseudomanifold then one must seek these pseudomanifolds among the spines of that com plex lemma 4 1 let k be a simplicial complex and l k a subcomplex if k l and l is a pseudomanifold then l is a spine of k proof let n be the dimension of l suppose that l is not a spine of k then l possesses a free simplex s let p princl s be the associated principal simplex we have dim p n if dim p n then dims n 1 by lemma 2 3 so s is an n 1 simplex which is the face of precisely one n simplex contradicting the fact that in an n dimensional pseudomanifold every n 1 simplex is the face of precisely two n simplices suppose that dim p n then p not being the face of any simplex in l is in particular not the face of any n simplex contradicting the fact that in an n dimensional pseudomanifold every simplex must be the face of some n simplex definition 4 2 a layered simplicial complex is a triple k c s where k is a simplicial complex and c s are disjoint subcomplexes of k simplices of k which are neither in c nor in s are called intermediate simplices we shall write im k c s for the set of intermediate simplices note that in general im k c s is merely a subset not a subcomplex of k definition 4 3 a divided simplicial complex is a pair k s 0 where k is a simplicial com plex and s 0 k 0 is a set of vertices of k stratified formal deformations and intersection homology of data point clouds 13 a divided simplicial complex k s 0 gives rise to a layered simplicial complex k c s such that the set of vertices of s is s 0 as follows take s to consist of all simplices of k whose vertices lie in s 0 note that this is indeed a subcomplex of k take c to consist of all simplices of k whose vertices lie in the complement c 0 k 0 s 0 again this is a subcomplex of k we call k c s the associated layered complex of the divided complex k s 0 in the associated layered complex the intermediate simplices are those simplices of k that have at least one vertex in s 0 and one vertex in k 0 s 0 hence the dimension of an intermediate simplex in an associated layered complex is at least 1 let k c s be a layered simplicial complex suppose that k k 0 k 1 k 2 km ks is a finite sequence of elementary collapses such that ki 1 ki s p where p is a simplex in s which is principal in ki and s is a face of p which is free in ki note that since s is a subcomplex s is in s since c and s are disjoint neither p nor s can be a simplex of c hence c remains a subcomplex of ki for every i and in particular is a subcomplex of ks set 2 si ki s the intersection a b of two subcomplexes a b l of a simplicial complex l is a subcom plex of a of b and of l hence si 1 is a subcomplex of si for every i the simplices p and s lie in the complex si as p is principal in ki it is in particular principal in the subcomplex si furthermore as s is free in ki it is also free in the subcomplex si this shows that si 1 is obtained from si by an elementary collapse si si 1 hence there is a finite sequence of elementary collapses s s 0 s 1 s 2 sm s since s is obtained by removing simplices of s the subcomplexes c and s of ks are of course still disjoint and hence ks c s is a layered complex definition 4 4 an s collapse of the layered simplicial complex k c s is any layered sim plicial complex ks c s obtained by the collapse process described above if m 1 we shall refer to k 0 k 1 also as an elementary s collapse loosely an s collapse is thus obtained by collapsing only simplices of the subcomplex s since the definition of a layered complex is symmetric in c and s the notion of a c collapse can be defined by interchanging the role of c and s in the above collapse process thus definition 4 5 a c collapse of the layered simplicial complex k c s is any layered sim plicial complex kc c s obtained by the collapse process described above where only sim plices of c are eligible for elementary collapses if m 1 we shall speak of an elementary c collapse now as c has been left intact in any s collapse ks c s k k 0 k 1 k 2 km ks ki 1 ki si pi we may execute a c collapse ks ks 0 ks 1 ks 2 ks r ks c ks i 1 ks i s i p i on ks c s yielding a layered simplicial complex ks c c s is p 0 principal in k the simplex p 0 lies in c and is principal in ks k s 0 p 0 sm 1 pm 1 14 markus banagl tim ma der and filip sadlo so p 0 is not the proper face of any simplex in ks hence if p 0 were not principal in k then p 0 would have to be the face of some pi but this would place p 0 in the complex s which is impossible as s and c are disjoint we conclude that p 0 is principal even in k for the same reason s 0 is free even in k we know s 0 lies in c and is free in ks so s 0 is not the proper face of any simplex in ks other than p 0 if s 0 were not free in k then s 0 would be the proper face of some simplex t in k t 6 p 0 then s 0 would be the proper face of some pi which is again impossible thus the elementary collapse k k 0 k 1 k 0 s 0 p 0 is defined similarly one then sees by an easy induction argument that p i is principal in k i and s i is free in k i whence we may define k i 1 k i s i p i we thus obtain a c collapse kc c s k k 0 k 1 k 2 k r kc it is immediately clear that p 0 is principal in kc since it is so even in k for the same reason s 0 is free in kc thus the elementary collapse kc kc 0 kc 1 kc 0 s 0 p 0 is defined similarly one then sees by an easy induction argument that pi is principal in kc i and si is free in kc i whence we may define kc i 1 kc i si pi we thus obtain an s collapse kc s c s kc kc 0 kc 1 kc 2 kc m kc s now note that kc s ks c c c s s thus s collapses and c collapses are commuting operations on layered simplicial complexes notably with a view towards algorithm design it is important to know that s and c collapses do not affect the set of intermediate simplices lemma 4 6 let k c s be the associated layered complex of a divided complex if k c s has been obtained from k c s by an s collapse then im k c s im k c s if k c s has been obtained from k c s by a c collapse then im k c s im k c s proof by symmetry it suffices to consider s collapses then k k s p s s s p with p s p principal in k s a proper face of p and s free in k the inclusion im k c s im k c s follows from k k and s s conversely suppose that t im k c s then t 6 s and t 6 p since t 6 s while s p s therefore t k s p k since t is intermediate in k c s and k c s comes from a divided complex t has a vertex v c and a vertex w s in particular t has positive dimension we claim that w s as p has positive dimension w 6 p if w were equal to s then s would be a proper face of both t and p with t 6 p this would contradict the freeness of s in k we deduce that w 6 s so that w s s p this proves the claim thus t is a simplex of k which possesses a vertex v c and a vertex w s showing that t is intermediate in k c s stratified formal deformations and intersection homology of data point clouds 15 the most interesting aspect of stratified collapses is the treatment of intermediate sim plices let k c s be a layered simplicial complex and suppose that k k 0 k 1 k 0 s p is an elementary collapse where i p is an intermediate simplex of k c s ii p is principal in k 0 iii s is a face of p which is free in k 0 and iv if t is a simplex of s which is a proper face of p then t is a proper face of s put c 1 k 1 c and s 1 k 1 s then c 1 and s 1 are subcomplexes of k 1 and they are disjoint consequently k 1 c 1 s 1 is a layered simplicial complex lemma 4 7 for any layered simplicial complex and simplices s p as above we have s 1 s proof since p is intermediate in k c s p 6 s hence s 1 s s p s s we claim that s 6 s suppose s were a simplex in s then as s is a proper face of p by freeness we could take t s in condition iv above and conclude that t s is a proper face of itself a contradiction hence s 6 s as claimed lemma 4 8 if k c s is the associated layered complex of a divided simplicial complex k s 0 then c 1 c proof since p is intermediate in k c s p 6 c hence c 1 c s p c s this is true even if k c s does not come from a divided complex we claim that if k c s is associated to k s 0 then s 6 c indeed as p 6 c p must then have at least one vertex v s 0 then t v is a simplex of s and t is a proper face of p note that dim p 1 as p is intermediate in an associated complex by condition iv above v is a face of s but v 6 c 0 k 0 s 0 so s has a vertex which is not in c 0 it follows that s cannot be in c as claimed let us assume that k c s is the associated layered complex of a divided simplicial complex k s 0 then by lemmas 4 7 and 4 8 k 1 c 1 s 1 k 1 c s it follows that im k 1 c 1 s 1 im k 1 c s s k 1 s 6 c and s 6 s s k s 6 c and s 6 s k 1 im k c s k 1 3 thus the notion of intermediacy is preserved under the passage from k to k 1 a simplex in k 1 is intermediate in k 1 c 1 s 1 if and only if it is intermediate in k c s note that neither s nor p can be a vertex for if s were a vertex then s v with v s 0 or v k 0 s 0 c 0 in the case v s 0 we have s s and since s is a proper face of p iv implies that s is a proper face of itself which is impossible on the other hand if v c 0 then p u v with u s 0 since p is intermediate and a free face has codimension 1 in its principal simplex then t u is a simplex of s which is a proper face of p but not a proper face of s v contradicting iv thus s is not a vertex since s is a proper face of p the latter can of course not be a vertex either thus k 1 and k have the same vertex set k 1 0 k 0 in particular the partition of k 0 into s 0 and its complement c 0 can be regarded as a partition of k 1 0 thus we have a well defined divided complex k 1 s 0 lemma 4 9 the layered complex k 1 c s is associated to the divided complex k 1 s 0 proof if s is a simplex of k 1 whose vertices are in s 0 then s is in particular a simplex of k whose vertices are in s 0 and thus s s as k c s is associated to k s 0 conversely suppose that s k 1 is a simplex in s then s is in particular a simplex of k which is in s 16 markus banagl tim ma der and filip sadlo and thus all vertices of s are in s 0 as k c s is associated to k s 0 analogous reasoning applied to c instead of s will show that c consists precisely of those simplices in k 1 whose vertices are in k 0 s 0 definition 4 10 we say that the layered simplicial complex k 1 c s described above has been obtained from the associated layered simplicial complex k c s of a divided complex k s 0 by an elementary intermediate collapse lemma 4 9 allows for an iterative execution of elementary intermediate collapses thus we may define definition 4 11 the layered simplicial complex ki c s has been obtained from the asso ciated layered simplicial complex k c s of a divided complex k s 0 by an intermediate collapse if ki c s is produced by a finite sequence of elementary intermediate collapses starting from k c s remark 4 12 in the context of condition iv let t be a simplex of s which is a proper face of p im k c s then by iv t is a proper face of s which is itself a proper face of p therefore dim t dim p 2 this can be regarded as an echo of the pseudomanifold condition in a triangulation of an n dimensional pseudomanifold a simplex is principal if and only if it has dimension n for if a principal simplex had smaller dimension then it would have to be the face of some n simplex and so could not be principal then if t is any simplex in the singular set dim t dim n 2 dim p 2 we note however that p in the present situation does not actually have a free face s definition 4 13 let k c s k c s be layered complexes associated to divided simpli cial complexes we say that k c s has been obtained from k c s by an elementary layered collapse if there is an elementary c s or intermediary collapse of a simplex in k c s that yields k c s in that case we say that k c s is obtained from k c s by an elementary layered expansion let x k s and x k s be the polyhedral pairs determined by the layered complexes in the above situation we then say that x has been obtained from x by an elementary stratified collapse and x from x by an elementary stratified expansion a layered collapse from k c s to k c s is a finite sequence of elementary layered collapses similarly for layered expan sions for the polyhedral pairs this leads to the notion of stratified collapses and stratified expansions a layered formal deformation from k c s to k c s is a finite sequence of transformations each of which is either a layered collapse or a layered expansion starting from k c s and ending with k c s the associated sequence of polyhedral pairs is called a stratified formal deformation from x to x classical elementary collapses can be executed in any order since a free face cannot ever become non free by performing classical collapses our stratified theory involves three dif ferent types of collapses and we must carefully investigate the effects of sequentially ordering these types particularly as this is relevant for the algorithmic implementation section 7 lemma 4 14 if p is a simplex and q p a face of codimension at least 2 then for any proper face s p with q s there exists a second proper face t p t 6 s such that q t proof the face s is obtained from p by omitting at least one vertex u the face q is obtained from s by omitting at least one vertex v v 6 u then t q u does the job stratified formal deformations and intersection homology of data point clouds 17 proposition 4 15 let k c s be the associated layered complex of a divided simplicial complex if k c s admits no s collapse and k c s is obtained from k c s by an intermediate collapse then k c s still does not admit an s collapse proof the complex k is of the form k k f p where f and p satisfy the conditions i iv of an intermediate collapse in particular p im k c s p is principal in k and f p is free in k we argue by contradiction suppose that k c s does admit an s collapse then there is a simplex q s which is principal in k and has a proper face s q which is free in k since there is no s collapse possible in k c s either q is not principal in k or q has no free face in k suppose first that q is not principal in k then q p or q f if q p then by condition iv for intermediate collapses q f as q s so we may assume q f thus q is a face of codimension at least 2 of p by lemma 4 14 there exists a proper face r p such that r 6 f and q r note that r is a simplex of k thus q is not principal in k a contradiction we conclude that q must already be principal in k and q has no free face in k in particular s is not free in k but is free in k therefore s p or s f if s p then by condition iv for intermediate collapses s f as s s so we may assume s f thus s is a face of codimension at least 2 of p by lemma 4 14 there exists a proper face r p such that r 6 f and s r note that r is a simplex of k if r q then q p so q is not principal in k a contradiction hence r 6 q but then s r k and s q k and r 6 q which contradicts the freeness of s in k thus q and s as above cannot exist and k c s does not admit an s collapse as was to be shown the following example illustrates the process of layered collapses and shows in partic ular that intermediate collapses carried out after all possible s and c collapses have been performed may enable new c collapses though by the proposition they cannot enable new s collapses example 4 16 let p s 0 s 1 c 0 c 1 be a 3 simplex with vertices s 0 s 1 c 0 c 1 and let k be the simplicial complex generated by p let s 0 s 0 s 1 determining a divided complex k s 0 the complex s of the associated layered complex k c s is the simplicial subcom plex generated by the 1 simplex s 0 s 1 and c is the subcomplex generated by the 1 simplex c 0 c 1 see figure 3 no s collapse is possible in k c s since the 1 simplex s 0 s 1 while principal in s is not principal in k similarly no c collapse is possible however there is one possible intermediate collapse the simplex p s 0 s 1 c 0 c 1 is intermediate in k c s principal in k and s s 0 s 1 c 1 is a free face of p we have to verify condition iv the simplices t in s are s 0 s 1 s 0 and s 1 all of these are proper faces of p so the conclusion of iv must be checked indeed all these t are proper faces of s s 0 s 1 c 1 thus there is an admissible intermediate collapse k k 1 k s p the complex k 1 is 2 dimensional with three 2 simplices no c collapse or s collapse is feasible in k 1 c s the simplex p s 1 c 0 c 1 is intermediate in k 1 c s principal in k 1 and s s 1 c 1 is a free face of p we verify condition iv the simplices t s 0 s 1 and t s 0 in s are not faces of p but t s 1 is a proper face of p so the conclusion of iv must be checked for this t indeed t s 1 is a proper face of s s 1 c 1 thus there is an admissible intermediate collapse k 1 k 2 k 1 s p the complex k 2 has precisely two 2 simplices the simplex p s 0 c 0 c 1 is intermediate in k 2 c s principal in k 2 and s s 0 c 1 is a free face of p we verify condition iv the simplices t s 0 s 1 and t s 1 in s are 18 markus banagl tim ma der and filip sadlo s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 1 c 0 s 0 s 1 c 0 figure 3 intermediate and c collapses of k to a layered spine free faces yellow principal cofaces green intermediate free faces not fulfill ing condition iv red not faces of p but t s 0 is a proper face of p so the conclusion of iv must be checked for this t indeed t s 0 is a proper face of s s 0 c 1 thus there is an admissible intermediate collapse k 2 k 3 k 2 s p the complex k 3 has precisely one 2 simplex note that k 3 c s does not admit an intermediate collapse but it does admit a c collapse the 1 simplex c 0 c 1 is in c is principal in k 3 and has the free face c 1 the correspond ing elementary c collapse yields a layered complex k 3 c c s with c c 0 although the complex k 3 c forgetting the layer structure is collapsible to a point the layered complex k 3 c c s admits no c collapse no s collapse and no intermediate collapse proposition 4 17 let k c s be the associated layered complex of a divided simplicial complex k s 0 suppose that k c s does not admit an intermediate collapse if k c s is obtained from k c s by a c collapse then k c s still does not admit an intermediate collapse proof the complex k has the form k k f p p c p principal in k and f p free in k since f and p are in c we have c c f p we argue by contradiction suppose an intermediate collapse in k c s were possible then there would exist simplices g q in k such that a q im k c s b q is principal in k c g q with g free in k d for every t s if t q then t g statement a implies that q 6 s and q 6 c c f p as q lies in k it must be different from f and p thus q 6 c hence is already intermediate in k c s q im k c s stratified formal deformations and intersection homology of data point clouds 19 suppose q were not principal in k then as it is principal in k by b q p or q f if q f then in particular q p so we may assume q p but this places q into c a contradiction to q im k c s therefore q is already principal in k is g free in k if not then since it is free in k g p or g f if g f then g p so we may assume the latter which implies that g c so g has the form g c 0 ck for vertices c 0 ck c 0 k 0 s 0 since g is a codimension one face of q lemma 2 3 q must have the form q c 0 ck s since q is intermediate the vertex s must be in s 0 take t s then t s and t q by d t g and we reach a contradiction we conclude that g is free in k we have seen that q im k c s q is principal in k and g is a free face of q in k but k c s does not admit an intermediate collapse consequently condition iv for intermedi ate collapses must be violated for g q in k c s thus there must exist a t s such that t q but t is not a proper face of g in k such a t must be in k and we arrive at a contradiction to d therefore an intermediate collapse in k c s is not possible definition 4 18 let k c s be the associated layered simplicial complex of a divided complex a layered simplicial complex k c s is called a layered spine of k c s if k c s can be obtained from k c s by a layered collapse and k c s does not ad mit any further layered collapse though it may admit further ordinary collapses in this case we say that the polyhedral pair x k s is a stratified spine of x k s as example 4 16 shows a layered spine of a layered complex k c s need not be a spine in the ordinary sense of the underlying complex k however if the polyhedron of the underlying simplicial complex of a layered spine is a pseudomanifold then it will be a spine by lemma 4 1 note that the polyhedron of kc in example 4 16 is not a pseudomanifold section 8 contains several example calculations of stratified spines and their intersection homology in simplicial complexes coming from point data 5 freely orthogonal deformation retractions the polyhedron of an elementary simplicial collapse is a deformation retract of the poly hedron of the original complex in order to obtain stratified homotopy equivalence the par ticular choice of deformation retraction plays a role we shall here construct suitable explicit retractions called freely orthogonal and investigate their properties this material is needed only in the proofs of our main results in section 6 let k be a simplicial complex p a principal simplex of k and f a free face of p with k denoting the result of the associated elementary collapse we shall construct a particular deformation retraction h k i k onto k essentially the idea is to project orthogonally from the free face let v f 1 fm be the vertices of p where the fi are the vertices of the free face f let ei denote the i th standard basis vector of rm identify v with the origin 0 rm and fi with ei for all i 1 m via barycentric coordinates this identifies p with the convex hull of 0 e 1 em in rm under this identification p is given by x 1 xm rm xi 0 m i 1 xi 1 the polyhedron f of the free face corresponds to the convex hull of e 1 em x 1 xm rm xi 0 m i 1 xi 1 20 markus banagl tim ma der and filip sadlo the affine hyperplane h rm containing the free face is of the form e 1 l where l rm is the linear subspace spanned by the basis e 2 e 1 e 3 e 1 em e 1 let be the line through the origin in rm spanned by the vector n m i 1 ei 1 1 1 which is a normal vector to l with respect to the standard euclidean inner product on rm let p denote the boundary of p i e the union of all proper faces and set p interior f thus is the union of all intersections of p with coordinate hyperplanes x j 0 lemma 5 1 for every point x p the line through x orthogonal to h intersects in a unique point y that is x y proof given x x 1 xm p points on x have the form x tn x 1 t xm t t r a point of p lies in precisely when at least one of its coordinates vanishes so if y is on x and on then one of its coordinates say x j t vanishes so that t x j thus 4 y x 1 x j x 2 x j xm x j but all of these coordinates must be nonnegative hence 5 x j min x 1 xm this shows that y if it exists is unique now for existence define y by 5 and 4 then y is plainly on x and on lemma 5 1 shows that there is a well defined map r p x 7 y explicitly this map is given by r x 1 xm x 1 x j x 2 x j xm x j x j min x 1 xm this shows that r is continuous if x then x j 0 and thus r x x thus r is a retraction onto lemma 5 2 if x p is a point such that r x f then x f proof in terms of coordinates f is characterized by f f x 1 xm xi 0 xi 1 and j x j 0 suppose x p retracts onto the boundary of f i e r x f then the coordinates x 1 x j xm x j x j min xi of r x satisfy m i 1 xi x j 1 that is i xi 1 mx j but x p ensures that xi 1 consequently x j 0 note that m 1 since m dim p and p has a proper face f this implies that x furthermore it follows that xi 1 i e x f we conclude that x f f stratified formal deformations and intersection homology of data point clouds 21 define h p i p to be the straight line homotopy h x t 1 t x tr x this is well defined as p is convex then h is a homotopy from h 0 id to h 1 r such that if x then h x t 1 t x tx x that is h is a deformation retraction onto this can be readily extended to a deformation retraction h k i k of k onto k by setting h x t x for all t i and all x k p we shall refer to this h as the freely orthogonal deformation retraction associated to p and f note that all the proper faces of f are contained in hence ht is the identity on the proper faces of f let k c s be a layered simplicial complex lemma 5 3 let k c s ks c s be an elementary s collapse of a principal simplex p s using the free face f s then the associated freely orthogonal deformation retraction h k i k maps ht k s k s and ht s s for all t i proof if x s p then ht x x s for all t if on the other hand x p s then ht x p s hence ht s s for all t points x k s satisfy x k p so that ht x x this shows that ht k s k s lemma 5 4 let k c s kc c s be an elementary c collapse of a principal simplex p c using the free face f c then the associated freely orthogonal deformation retraction h k i k maps ht k s k s and ht s s for all t i proof as p c and s c the complex s is contained in k p on which ht is the identity for all t we conclude that ht s s if x k s p then again ht x x k s if on the other hand x p k s then ht x p k s lemma 5 5 let k c s be the associated layered complex of a divided complex k s 0 let k c s ki c s be an elementary intermediate collapse of a principal simplex p im k c s using the free face f then the associated freely orthogonal deformation retraction h k i k maps ht k s k s and ht s s for all t i proof we shall first show that 6 s p f indeed given a point x s p there is a unique face s s of p that contains x in its interior this face must be a proper face of p since if s p then p s contradicting p im k c s by condition iv for intermediate collapses s is a proper face of f hence x s f establishing 6 as f and r is a retract onto it follows in particular that r x x for points x s p and hence that ht x 1 t x tr x x for such x and all t so ht s p s for all t if x s p then ht x x s by definition this proves ht s s for all t 22 markus banagl tim ma der and filip sadlo it remains to verify ht k s k s let x be a point in k s if x 6 p then ht x x k s so suppose that x p if r x x then again ht x x and we are done so assume that r x 6 x suppose it were then true that r x s then r x p s and hence r x f by 6 lemma 5 2 implies that x f as f and r is a retract onto we deduce that r x x contradicting r x 6 x therefore r x 6 s thus ht x 6 s for t 0 1 we claim that if t 0 then ht x 6 f by contradiction suppose 1 t x tr x f so that i 1 t xi t xi x j 1 x j min x 1 xm note that x j 0 since we know that x 6 as r x 6 x it follows that i xi 1 mtx j since t 0 m 1 and x j 0 this implies xi 1 contradicting xi 1 x p thus ht x 6 f as claimed now if ht x were in s for t 0 then it would have to be in f f by 6 which we have just proved to be impossible hence ht x 6 s as was to be shown 6 stratified formal deformations homotopy type and intersection homology our main result relates the layered formal deformation type of a complex to the stratified homotopy type of associated filtered spaces as a corollary we conclude that the intersection homology is preserved by layered formal deformations in particular the intersection homol ogy of any two stratified spines which may well not be homeomorphic will be isomorphic recall that for ease of exposition we will illustrate our results only for filtrations of type 1 lemma 6 1 let k c s and k c s be the associated layered simplicial complexes of divided simplicial complexes and suppose that the polyhedra x k and x k are filtered spaces with respective singular sets s s whose formal codimensions coincide codimx codimx if k c s is obtained from k c s by an elementary layered collapse then x and x are stratified homotopy equivalent proof let k c s k c s be an elementary layered collapse of a principal simplex p using the free face f of p let h k i k be the freely orthogonal deformation retraction associated to p and f satisfying h 1 k k on p h 1 is given by the retraction r of section 5 we claim that the inclusion k s i k s is a stratified homotopy equivalence with stratified homotopy inverse k s r k s to prove the claim we establish first that both i and r h 1 are codimension preserving stratified maps first a preliminary remark in the case of an s collapse 7 s k s by 2 in the case of a c collapse s s the latter equality holds also in the case of an intermediate collapse by lemma 4 7 when s s then k s k s s hence 7 holds in all three cases now the inclusion i k k maps s to k s using 7 k s k k s s stratified formal deformations and intersection homology of data point clouds 23 so i maps the singular sets correctly since h 1 k k and ht s s for all t we have r s k s s so r maps the singular sets correctly as well if x k s then 7 shows that x 6 s thus i k s k s as claimed let x be a point in k s and suppose that r x s then 7 shows that r x s but by lemmas 5 3 5 4 and 5 5 r x h 1 x k s a contradiction since s k thus r x 6 s so that r k s k s as required we have shown that i and r are stratified maps they are codimension preserving by assumption since r is a retraction r i id k it remains to be shown that i r is stratified homotopic to the identity on k a stratified homotopy is given by the above freely orthogonal defor mation retraction h by lemmas 5 3 5 4 and 5 5 h maps s i into s and k s i into k s in all three cases s c and intermediate collapse theorem 6 2 let k c s and k c s be the associated layered simplicial complexes of divided simplicial complexes and suppose that the polyhedra x k and x k are filtered spaces with respective singular sets s s whose formal codimensions co incide codimx codimx if there exists a layered formal deformation between k c s and k c s then x and x are stratified homotopy equivalent proof let k c s k 0 c 0 s 0 k 1 c 1 s 1 km cm sm k c s be a layered formal deformation between k c s and k c s where each arrow indi cates an elementary layered collapse or layered expansion the polyhedral pair xi i ki si i 0 m becomes a filtered space by declaring the formal codimensions of the singular sets to be codimxi i codimx then lemma 6 1 is applicable to ki ci si ki 1 ci 1 si 1 and yields a stratified homotopy equivalence xi i xi 1 i 1 for ev ery i 0 m 1 the composition of these stratified homotopy equivalences is a stratified homotopy equivalence x x 0 0 xm m x by lemma 3 11 as a special case of the theorem we deduce that any two stratified spines of a layered complex lie in the same classical stratified homotopy type corollary 6 3 let k c s be the associated layered simplicial complex of a divided simpli cial complex if k c s and k c s are layered spines of k c s whose polyhedra x k and y k are filtered spaces with respective singular sets x s y s whose formal codimensions coincide then the stratified spines x x and y y are strat ified homotopy equivalent theorem 6 2 has the following consequence for the combinatorial deformation stability of singular intersection homology corollary 6 4 let k c s and k c s be the associated layered simplicial complexes of divided simplicial complexes and suppose that the polyhedra x k and x k are filtered spaces with respective singular sets s s whose formal codimensions coincide if there exists a layered formal deformation between k c s and k c s then ih p x ih p y for every p proof this follows from theorem 6 2 in view of proposition 3 10 24 markus banagl tim ma der and filip sadlo to compute the singular intersection homology groups algorithmically via simplicial in tersection chains one may use propositions 3 12 and 3 14 from the point of view of a given filtered vietoris rips type complex k associated to data points near a filtered space x our results lead to conditions under which the complex k itself can be used to compute the intersection homology of x corollary 6 5 let k s 0 be a divided simplicial complex and x a filtered space in practice k could be a vietoris rips c ech etc type complex associated to points near x with points of s 0 near if there exists a layered formal deformation from the associated lay ered complex k c s to a layered complex k c s whose filtered space k s with codim s codimx is stratified homotopy equivalent to x then taking formal codi mension codim k s codim s the intersection homology of the filtered space k s computes the intersection homology of x as pointed out earlier these codimensions are not a priori known but may in fact be revealed by spines the corollary shows in particular that if a vietoris rips type complex k has a stratified spine which is say stratified homeomorphic to x then ih p x may already be computed from ih p k by using the appropriate codimension 7 implementation given a set of data points we used standard delaunay vietoris rips methods to generate simplicial complexes but our stratified collapse methods are applicable to any filtered poly hedron and thus one could in addition investigate the behavior of c ech complexes witness complexes etc the delaunay vietoris rips complex is the restriction of the vietoris rips complex to simplices of the delaunay triangulation using delaunay triangulations to gener ate simplicial complexes from sets of data points is a common approach in topological data analysis see e g 11 9 3 to illustrate stratified formal deformations we focus here on stratified spines a possible pseudocode sequencing of the three types of elementary layered collapse operations is shown in algorithm 7 1 the code blocks 1 3 and 4 6 can be inter algorithm 7 1 layeredspine k c s input k c s layered complex of a divided simplicial complex output k c s layered complex with no further layered collapses possible 1 while s collapse possible in k s do 2 k s collapse k s 3 end while 4 while c collapse possible in k c do 5 k c collapse k c 6 end while 7 im intermediatesimplices k c s 8 while intermediate collapse possible in k im s do 9 k im imcollapse k im s 10 end while 11 while c collapse possible in k c do 12 k c collapse k c 13 end while 14 return k c s stratified formal deformations and intersection homology of data point clouds 25 changed as s collapses and c collapses are commuting operations this shows in particular that after step 6 no new s collapses can become possible after step 10 no s collapses can become possible by proposition 4 15 but c collapses may become possible after intermedi ate collapses as example 4 16 shows hence the code block 11 13 is required after step 13 no s collapse can be possible for if it were then it could be commuted to be executed between line 10 and 11 but we already know that after step 10 no s collapse is possible fur thermore after step 13 no intermediate collapse is possible by proposition 4 17 therefore after step 13 the resulting layered simplicial complex is in fact a layered spine in step 7 the set im of intermediate simplices of k c s is computed which is straightforward include all simplices of k that have at least one vertex in s and at least one vertex in c according to lemma 4 6 im can be computed earlier but it is of course advantageous to compute it as late as possible since the previous collapses reduce the search space the function collapse k l executes elementary collapses in k only of simplices contained in a subcollection l k this is suited for s and c collapses intermediate collapses require a different treatment detailed in algorithm 7 2 we included only the pseudocode for intermediate collapses for s and c collapses the code looks almost identical excluding step 5 which tests condition iv of an intermediate collapse by calling the function isadmissible s s p 0 algorithm 7 2 makes implicit use of the fact established earlier in lemmas 4 7 and 4 8 that a free face of a principal intermediate simplex such that iv holds must itself be intermediate conversely any coface in particular a principal one of an intermediate simplex is obviously interme diate itself the function princ im s k searches for cofaces in im of a simplex s that are principal in k by the previous remark one need not search in all of k only in im if it finds none or more than one it returns the empty list otherwise a list p of length 1 containing the unique principal coface p 0 in which case s is free if desired it is after execution of 7 1 algorithmically possible to check whether the polyhedron of the layered spine is a pseudo manifold let n be the highest dimension of a simplex in the complex then check whether every n 1 simplex is the face of precisely two n simplices and whether every simplex is the face of some n simplex furthermore there exist algorithms to compute simplicial intersection homology even persistent intersection homology 4 20 we followed these to code the calculation of sim plicial intersection betti numbers persistent intersection homology has been implemented by bastian rieck in his aleph package in principle calculating intersection homology groups uses the same matrix operations that may be used to compute ordinary simplicial homology the difference lies in the process that sets up the simplicial intersection chain complex the definition of ic p c requires us to check which simplicial chains are p allowable for a given perversity p note that it is not enough to verify allowability on the simplex level because we want to identify all p allowable simplicial chains we describe an algorithm that can be used to generate the intersection chain complex from a given simplicial chain complex this is taken from 4 in which an algorithm was introduced to compute persistent intersec tion homology with z 2 coefficients we will here only describe those parts of the algorithm that solve the problem of identifying the intersection chains let k be a simplicial complex and p be an arbitrary perversity note that we are over z 2 and thus orientations are not an issue let is p k k denote the collection of all p allowable k simplices of k next for every k we choose an ordering of is p k k such that is p k k k 0 k rk k rk 1 k mk where k 0 k rk are all p allowable k simplices of k 26 markus banagl tim ma der and filip sadlo algorithm 7 2 imcollapse k im s input k simplicial complex s subcomplex of k im intermediate simplices output k simplicial complex im intermediate simplices 1 i im 2 for s in i do 3 p princ im s k 4 if nonempty p then 5 if isadmissible s s p 0 then 6 remove p 0 from k 7 remove p 0 from im 8 remove s from k 9 remove s from im 10 at this point the new im is indeed the set 11 of intermediate simplices of the new k by 3 12 end if 13 end if 14 end for 15 return k im set up an incidence matrix m over z 2 with entries mi j 1 if k 1 i is a face of k j mi j 0 else i 0 mk 1 j 0 rk the columns that have nonzero entries below the r th row rep resent p allowable k simplices whose boundaries contain not p allowable k 1 simplices and therefore do not represent a p allowable elementary chain by elementary column trans formations from left to right we want to reduce as much of the rows below r as possible to form allowable chains this is done by adding up columns with the same value in rows with higher index than r the pseudocode of algorithm 7 3 describes how this reduction can be realized on a computer the function low m j returns the index of the lowest nonzero entry algorithm 7 3 matrixreduction m r input m binary incidence matrix r row index output m matrix in reduced form 1 ncol length m 0 number of columns 2 for j ncol 1 downto 1 do 3 while i j with low m i low m j and low m j r do 4 m j m j m i 5 end while 6 end for 7 return m in the j th column of a given matrix m in case it exists the function returns 1 if the column only contains zeros furthermore it is possible to record the column transformations executed during a reduction process to determine a basis for the intersection chain complex in every degree now deleting all columns i in m with low m i r and all rows below stratified formal deformations and intersection homology of data point clouds 27 r one obtains matrices whose ranks can be used to calculate the intersection betti numbers our python code both for the computation of stratified spines and intersection betti numbers is available at https github com banaglmaeder layered spines git it was not our first priority to optimize the code for efficiency and certainly several refinements in this direction are possible 8 examples and evaluation we illustrate stratified formal deformations and associated intersection homology groups by algorithmically computing several stratified spines of vietoris rips type complexes asso ciated to data point samples near given spaces our first example concerns the cone on a circle such a cone is topologically a 2 disc and thus nonsingular but when filtered by the cone vertex and using appropriate perversities may nevertheless have nonvanishing intersec tion homology in positive degrees example 8 1 as an implicit surface the cone on s 1 is given by cone s 1 x y z r 3 x 2 y 2 c 2 z 1 2 and 0 z 1 with c being the base height ratio of the cone the cone vertex is s 0 0 1 when filtered by the cone vertex of codimension 2 the cone has intersection homology ih 0 i cones 1 z 2 z 2 if i 0 0 else ih 1 i cones 1 z 2 z 2 if i 0 1 0 else recall that we write z 2 z 2 z choosing c 3 we then produced a set of 34 random points in r 3 by rejection sampling in more detail independent sampling of two uniformly distributed points on the interval 1 1 for the x and y coordinate and on the interval 0 1 for the z coordinate yields a triple x y z r 3 if such a point satisfied the equation that de fines the cone up to an error of 0 001 we accepted that point as part of our sample the cone vertex s is part of the sample as well applying vietoris rips type methods we generated a 3 dimensional simplicial complex k with polyhedron x k depicted in figure 4 taking s 0 s endows k with the structure of a divided complex using the natural geometric codimension codim s 3 in the 3 dimensional polyhedron x the intersection homology is given by ih 0 i x z 2 z 2 if i 0 1 0 else ih 1 i x z 2 z 2 if i 0 1 0 else which does not agree with the above intersection homology of the underlying cone a stratified spine x s 0 of x s 0 is shown in figure 5 using the algorithms described in section 7 this stratified spine was obtained on a computer by carrying out 93 el ementary c collapses and 4 elementary intermediate collapses note that the stratified spine is in fact stratum preserving homeomorphic to the cone on s 1 which implies in particular that the intersection homology of the stratified spine agrees with the above intersection homology of cone s 1 which can also be algorithmically verified performing further unrestricted col lapses on the stratified spine would show that an ordinary spine of x is a point this shows https github com banaglmaeder layered spines git 28 markus banagl tim ma der and filip sadlo cone point figure 4 sampled cone x cone point figure 5 stratified spine x that x is simple homotopy equivalent to the cone on s 1 so the ordinary spine does not preserve enough structure to carry the correct intersection homology the stratified spine contains substantially fewer simplices than k and so the linear algebra packages perform ing rank computations to determine the intersection homology can operate on substantially smaller matrices we find that computing spines first is often a way to avoid sparse matrix techniques altogether in light of our invariance results corollaries 6 3 and 6 4 the discrep ancy between the intersection homology of the vietoris rips polyhedron x and the intersec tion homology of the stratified spine is due to the discrepancy between the codimensions of the singular point thus computing stratified spines is in particular a way of obtaining better estimates of correct codimensions the next example deals with a much larger dataset on a pinched torus example 8 2 topologically the pinched torus is the quotient space of the torus t 2 s 1 s 1 obtained by collapsing a circle pt s 1 the image of this circle is the singular point s of the pinched torus points were sampled from an embedded pinched torus we sampled independently a pair of identically uniformly distributed points on the intervall 0 2 then a parametrization of the surface was used to transform the sample to lie on the pinched torus applying vietoris rips methods resulted in a simplicial complex k with 543 0 simplices 2109 1 simplices 2057 2 simplices and 490 3 simplices figure 6 shows the polyhedron x k of this complex figure 7 shows the volume of all 490 3 simplices putting s 0 s endows k with the structure of a divided simplicial complex the polyhedron x of the associated layered complex k c s s 0 is filtered by s a stratified spine x of x was determined algorithmically and is displayed in figure 9 this computation comprised 978 elementary c collapses and 11 elementary intermediate collapses figure 8 shows an intermediate stage in the process of determining the stratified spine at that point all c collapses have been executed and the next step is collapsing all intermediate simplices as far as possible after the whole process all 3 simplices initially present have been removed and the overall size of the simplicial complex has been reduced to 537 0 simplices 1610 1 simplices and 1074 2 simplices the stratified spine x is filtered by s 0 x 0 x 2 x and therefore simplicial intersection homology groups are defined using our implementation we obtain for perversity 0 simplicial intersection homology of the stratified spine ih 0 i x z 2 z 2 if i 0 2 0 else stratified formal deformations and intersection homology of data point clouds 29 s figure 6 simplicial complex from vietoris rips methods these results agree with the singular perversity 0 intersection homology of the actual pinched torus they also agree with the intersection homology of the full vietoris rips polyhedron x both when s is assigned formal codimension 3 the geometric codimension in k and when it is assigned formal codimension 2 the geometric codimension in the stratified spine figure 7 volume extracted from 3 simplices 30 markus banagl tim ma der and filip sadlo s figure 8 intermediate stage in the collapse process s figure 9 stratified spine example 8 3 we may return to the figure eight space s 1 s 1 of example 3 15 and reconsider it from the stratified spinal point of view the ordinary spine x shown in figure 2 is in fact also a stratified spine of x the green 2 simplex in the lower left of figure 1 is removed by an elementary c collapse while the other two green 2 simplices incident to the singular point are removed by elementary intermediate collapses so here the stratified spine happens to be stratified homeomorphic to the ordinary spine and both compute the intersection homology of s 1 s 1 stratified formal deformations and intersection homology of data point clouds 31 s figure 10 tangent circles finally it is clear that the vietoris rips method and similar methods may create local thickenings near the singularities that cannot be removed by stratified collapses to an extent that would make the stratified homotopy type of the original space or at least its intersec tion homology visible an example polyhderon x obtained by sampling two tangent circles topologically comprising s 1 s 1 is shown in figure 10 finding general characterizations of such configurations as well as perhaps even more importantly improving the vietoris rips method in stratified situations is an interesting question that requires methods outside the scope of the present paper it is perhaps interesting to observe that x contains an ordi nary spine x shown in figure 11 which is stratified homeomorphic to s 1 s 1 one could interpret this as an indication that there exist further types of intermediate collapses these may be formulated and explored in future work furthermore if one is merely interested in intersection homology ih p for a particular perversity p then one might expect to obtain a relaxed perversity dependent version of the intermediate collapse condition iv references 1 m banagl topological invariants of stratified spaces springer monographs in math springer verlag 2007 2 m banagl intersection spaces spatial homology truncation and string theory lecture notes in math 1997 springer verlag 2010 3 u bauer and h edelsbrunner the morse theory of c ech and delaunay complexes transactions of the american mathematical soc 369 5 2017 3741 3762 4 p bendich j harer persistent intersection homology foundations of computational mathematics 11 2011 305 336 5 a borel et al intersection cohomology progr math no 50 birkha user verlag boston 1984 6 j cheeger on the spectral geometry of spaces with cone like singularities proc natl acad sci usa 76 1979 2103 2106 32 markus banagl tim ma der and filip sadlo s figure 11 ordinary spine x of x 7 j cheeger on the hodge theory of riemannian pseudomanifolds proc sympos pure math 36 1980 91 146 8 j cheeger spectral geometry of singular riemannian spaces j differential geom 18 1983 575 657 9 h chintakunta topology and geometry of sensor networks a distributed computing approach phd thesis north carolina state university 2013 10 m m cohen a course in simple homotopy theory graduate texts in math vol 10 springer verlag 1973 11 h edelsbrunner d kirkpatrick and r seidel on the shape of a set of points in the plane ieee transac tions on information theory 29 4 551 559 1983 12 g friedman singular intersection homology july 24 2019 cambridge university press to appear oct 2020 13 m goresky and r d macpherson intersection homology theory topology 19 1980 135 162 14 intersection homology ii invent math 71 1983 77 129 15 f kirwan j woolf an introduction to intersection homology theory 2 nd ed chapman hall crc 2006 16 r macpherson k vilonen elementary construction of perverse sheaves invent math 84 1986 403 435 17 s matveev algorithmic topology and classification of 3 manifolds algorithms and computation in math 9 2 nd edition springer verlag 2007 18 c mccrory cone complexes and pl transversality trans amer math soc 207 1975 1 23 19 j r munkres elements of algebraic topology addison wesley publishing company 1984 20 b rieck m banagl f sadlo h leitte persistent intersection homology for the analysis of discrete data to appear in topological methods in data analysis and visualization v springer 2019 21 c p rourke b j sanderson introduction to piecewise linear topology springer verlag 1982 22 j h c whitehead simplicial spaces nuclei and m groups proc london math soc 45 1939 243 327 23 a zomorodian the tidy set a minimal simplicial set for computing homology of clique complexes socg 10 proceedings of the twenty sixth annual symposium on computational geometry june 2010 257 266 stratified formal deformations and intersection homology of data point clouds 33 mathematisches institut universita t heidelberg im neuenheimer feld 205 69120 heidel berg germany e mail address banagl mathi uni heidelberg de mathematisches institut universita t heidelberg im neuenheimer feld 205 69120 heidel berg germany e mail address tmaeder mathi uni heidelberg de institut fu r wissenschaftliches rechnen universita t heidelberg im neuenheimer feld 205 69120 heidelberg germany e mail address sadlo uni heidelberg de 1 introduction 2 simplicial collapses expansions and spines 3 filtered spaces and intersection homology 4 stratified formal deformations and stratified spines 5 freely orthogonal deformation retractions 6 stratified formal deformations homotopy type and intersection homology 7 implementation 8 examples and evaluation references