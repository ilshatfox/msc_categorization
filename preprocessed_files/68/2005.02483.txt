preprint a blockchain architecture for industrial applications lodovica marchesi michele marchesi roberto tonelli dmi university of cagliari abstract the blockchain and the programs running on it called smart contracts are more and more applied in all fields requiring trust and strong certifications in this work we compare public and permissioned blockchains for industrial applications we propose a complete original solution based on ethereum to implement a decentralized application this solution is characterized by a set of validator nodes running the blockchain using proof of authority consensus and including an explorer enabling users to check blockchain state and the source code of the smart contracts running on it from time to time the hash digest of the last mined block is written into a public blockchain to guarantee immutability the right to send transactions is granted by validator nodes to users by endowing them with the local ethers mined overall the proposed approach has the same transparency and immutability of a public blockchain without its drawbacks introduction the blockchain technology is a smart mix of known technologies first intro duced in 2008 with the famous paper by satoshi nakamoto as the enabler of the digital currency known as bitcoin 2 the main requirement of bitcoin as of every currency was trust in fact to put your saving and the efforts of your work into a currency you need to trust that the money will be still expendable for a reasonable number of years secure against counterfeiting theft confiscation double spending and inflation and easily transferable another requirement that diversified bitcoin from any other currency was the absence of a central authority managing it in bitcoin these features were obtained by using a distributed peer to peer network based on open source software running in every node each holding a copy of the transaction database known as blockchain the high number of nodes and the economic incentives given to miners who validate transactions and pack them into blocks guarantees the survival of the network and its robustness the equality and openness of all nodes makes the network decentralized the transparency and immutability of the blockchain enables trust the consensus mechanism used to add new transactions to the blockchain proof of work guarantee against massive sybil attacks the limited number of bitcoins mined guarantees against inflation the success of bitcoin whose market value changed from zero to several thou sands of usd in less than ten years witnesses the success of the bitcoin vision in this paper however we are not interested in preprint published by the ieee computer society c 2020 ieee 1 ar x iv 2 00 5 02 48 3 v 1 cs c r 3 0 a pr 2 02 0 cryptocurrencies but in other applications of the blockchain in fact a few years after the introduc tion of bitcoin in 2009 managers and developers realized that a blockchain can be also used to run a decentralized computer the first successful network able to run turing complete programs called smart contracts scs following an idea of nick szabo 5 was the ethereum blockchain started in 2015 6 uses of dapps and kinds of blockchains the software programs using a blockchain are called decentralized applications or dapps and are one of main new trends of software de velopment they include the scs actually running on a blockchain but also the software managing data outside the blockchain and the user interface to interact with it initially the primary use of scs typically running on ethereum blockchain was to manage second level digital currencies called tokens mainly used to finance the initial coin offers crowfunding operations gathering money in the form of cryptocurrency to finance startups 1 besides tokens dapps are being used for many applications in the fields of data nota rization finance and insurance contracts supply chain management document and workflow man agement gambling gaming voting and many others 7 dapps and scs can be used for au tomated enforcement of contractual obligations without having to trust a central authority and without space and time constraints the features a dapp system must exhibit are reported in table 1 the main one is the fact that a central authority running the system is missed the reasons for this may be various for instance no single organization might be willing to run the system for cost or legal liability reasons or the organizations involved might not wish to let just one of them run the system or having many independent nodes could be a guarantee of persistence and immutability of the system features 2 6 are basically aimed to gain user trust without having to trust all blockchain nodes features 7 9 are desirable for all software sys tems but are especially difficult to obtain in public blockchains developing a dapp system the first issue to address is whether to use a public or a permis sioned blockchain public blockchains are open to everyone and have no central authority the most used blockchains for implementing dapps is ethereum but others are available such as eos neo qtum and others permissioned blockchains often called also distributed ledgers are managed by a consor tium of organizations which run the validator nodes and perform the consensus mechanism further validator nodes can be added only by ob taining the permission of existing ones validators may allow including nodes holding a copy of the blockchain but unable to validate transactions the right to send transactions and thus to change the state of the blockchain can be given to users who are not validators also often everyone can access the blockchain to verify its correctness in other cases also the read only access is granted only to users with the permission to do so to run a permissioned blockchain there are many software systems available most public blockchain software is open source and suitable also to be used to manage a permissioned one a prominent permissioned blockchain aimed mainly to banking applications is ripple de veloped by a private company and presently run by about 150 invited validators there are also projects aimed to build permissioned blockchain software the most popular among these is hy perledger an open source collaborative effort hosted by the linux foundation aimed to build cross industry blockchain technologies table 2 shows a comparison of public and permissioned blockchains with regard to the prop erties shown in table 1 public blockchains look the most stable and easiest to start with but lack performances and scalability their cost is not predictable due to the high volatility in cryptocurrencies values and in transaction validation fees moreover they do not support privacy of data and are thus non compliant with respect to the strict guidelines of modern privacy laws such as european gdpr for these reasons public blockchains are mainly used for applications managing digital money such as the above cited tokens and for the notarization of information in our proposal we will focus on non monetary industrial appli cations and thus on a permissioned blockchain however the proposed solution includes the use 2 preprint table 1 the features needed by a dapp system feature description 1 no central au thority if a central authority can run the application there is no point to use a blockchain 2 persistency the system repositories and apps blockchain included must be kept runnng for a suitable amount of time typically in the range of years or decades with negligible risk of being interrupted or terminated before the time 3 immutability a blockchain is an append only system once written the information cannot be changed or deleted the data and programs running on the blockchain must be verifiably immutable and counterfeit proof 4 transparency the data and the activities performed on the blockchain must be entirely traceable anyone possibly with suitable access rights should be able to easily explore the blockchain to verify this 5 parties identi fication all writing activities performed on the blockchain must come from certified identities 6 privacy the permission to access the blockchain in particular to change its state must be granted only to known users possibly at various access levels 7 low predictable cost the blockchain system should be open source easily deployed and requiring limited hardware and network bandwith resources compatibly with the size of the dapp and the number of transactions per second the cost should not be volatile 8 efficiency the system should be able to bear the required throughput with proper response times even in the case of many users and many transactions per unit of time 9 scalability the system should be able to scale if needed of a public blockchain the proposed dapp architecture we define as dapp a software system that uses distributed ledger technology dlt typically a blockchain as a central hub to store and exchange information through smart contracts scs a dapp is composed of scs running on a blockchain and of applications able to create and send transactions to scs this application typically provides a human interaction interface running on a pc or on a mobile device additional information could be stored on a server and a business logic could be executed on this in our proposal we will use ethereum as a reference blokchain being presently the most used system to develop scs as of december 2019 2717 dapps were running on ethereum public blockchain out of a total of 3236 surveyed dapps 4 another feature of ethereum is that to be able to send transactions users must spend gas that is a fraction of ethers ethereum currency proportional to the resources used the proposed dapp architecture is shown in fig 1 the main component are the p 2 p validator nodes hosting the blockchain shown on the left these should be managed by independent organi zations to avoid that a single organization might try to falsify the blockchain or simply decide to stop supporting the dapp we suggest a minimum number of seven independent nodes the software running in the nodes is ethereum with proof of authority poa consen sus for block validation 3 poa is quicker and more suitable to a permissioned blockchain than pow the validators also create ethers expend able in the permissioned blockchain which we call local ethers loceth a node beside the blockchain itself holds its enabling software which includes the ethereum virtual machine able to run the scs on top of it there is the sc bytecode endowed with its permanent data storage which are read from the blockchain for their execution all the nodes may june 2020 3 table 2 comparison of public and permissioned blockchains feature public blockchain permissioned blockchain no central au thority totally achieved achieved but with much fewer nodes persistency very high high depending on the willingness and convenience of the validators immutability very high high can be very high transparency very high depending on the system can be very high parties identi fication very strong based on private key own ership if the owner wishes to be iden tified strong if based on username and pass word very strong if based on private key ownership privacy non existent can be enforced low predictable cost only software development and execu tion costs the latter costs can be very volatile and unpredictable infrastructural costs are typically low execution costs are low and predictable efficiency the number of transactions per second is quite low the number of transactions per second can be high scalability poor scalability if the number of dapps and users increases high by deploying further blockchains on the same node and or by splitting the nodes execute the scs and the execution result must be the same for all nodes hence the impossibility for the scs to access the external world they can access only their data and other scs stored in the blockchain which are the same in all nodes the other dapp component is a software sys tem running on mobile devices and or on servers possibly on the cloud exchanging information with users and external systems and devices which we call app system its user interface ui typically runs on a web browser the server component stores data and documents that cannot be stored in the blockchain and performs busi ness computations the proposed architecture has three kinds of actors validators that is the nodes running the sys tem and shown in fig 1 they validate trans actions and group them in blocks they also mint loceth operators who are enabled to send transac tions which change the blockchain state external users who can access the system nodes in read only mode other key ideas of the proposed architecture are the following one or more blockchain nodes provide an explorer a software that allows all users to access the blockchain transactions and related addresses and to inspect the source code of scs in this way the transparency of the per missioned blockchain equals that of a public one every 24 hours or so the hash digest of the last block validated in the permissioned blockchain is written into a public blockchain thus making the former as immutable as the latter all users can send view queries which return information from the scs without changing the blockchain and which cost no gas the access control is obtained by validators endowing operators with loceth that is the gas enabling sending transactions further access control can be performed inside scs based on the specific address sending a trans action the operators generate their own private keys and corresponding addresses and declare them to the system in this way they have strong digital identification one can trust that trans actions coming from an address actually are sent by the associated identity 4 preprint figure 1 the proposed architecture of a dapp application if the dapp must hold large amounts of in formation such as documents and images these documents are stored off chain by app system the hash digest of the document and a link to retrieve it is stored in the blockchain guaranteeing the date of the document and its integrity together with our spinoff flosslab ltd we already implemented a prototype of the system aimed to track the provenance and events of a food supply chain in this system external users are the buyers of a product through a qr code in the label and an app they can access the dapp and verify all the transformations and relevant events related to the product and registered by identified actors of the supply chain the actors are the firms which produced or transformed the product and the independent certifiers of its quality an advanced user can also independently access the permissioned blockchain and verify the data conclusion and future work the key reason to use a blockchain is trust the described approach guarantees the same level of trust and transparency of the public blockchain it is anchored to allowing much better perfor mances and scalability and at low predictable cost presently we are working with a set of sardinian institutions to start a permissioned blockchain as described above with the aim to certify the provenance and quality of local prod ucts references 1 gianni fenu lodovica marchesi michele marchesi and roberto tonelli the ico phenomenon and its relation ships with ethereum smart contract environment in blockchain oriented software engineering iwbose 2018 international workshop on pages 26 32 ieee 2018 2 s nakamoto bitcoin a peer to peer electronic cash may june 2020 5 system 2008 url https bitcoin org bitcoin pdf last accessed april 30 2020 3 proof of authority github website 2020 url https github com paritytech parity wiki proof of authority chains last accessed april 30 2020 4 state of the dapps website 2019 url https www stateofthedapps com stats last accessed april 30 2020 5 n szabo smart contracts formalizing and securing relationships on public networks first monday 2 1997 url https ojphi org ojs index php fm article view 548 6 g wood ethereum a secure decen tralised generalised transaction ledger 2014 url https ethereum github io yellowpaper paper pdf last accessed updated version april 30 2020 7 x xu i weber and m staples architecture for blockchain applications springer 2019 6 preprint uses of dapps and kinds of blockchains the proposed dapp architecture conclusion and future work references