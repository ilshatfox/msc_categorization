dynamic hedging using genetic programming 1 dynamic hedging using generated genetic programming implied volatility models fathi abid fathi abid fsegs rnu tn ru modesfi faculty of economics and business road of the airport km 4 3018 sfax tunisia wafa abdelmalek wafa abdelmalek fsegs rnu tn ru modesfi faculty of economics and business road of the airport km 4 3018 sfax tunisia sana ben hamida bhsana yahoo fr ru laboratory of intelligent it engineering higher school of technology and computer science charguia tunisia abstract the purpose of this paper is to improve the accuracy of dynamic hedging using implied volatilities generated by genetic programming using real data from s p 500 index options the genetic programming s ability to forecast black and scholes implied volatility is compared between static and dynamic training subset selection methods the performance of the best generated gp implied volatilities is tested in dynamic hedging and compared with black scholes model based on mse total the dynamic training of gp yields better results than those obtained from static training with fixed samples according to hedging errors the gp model is more accurate almost in all hedging strategies than the bs model particularly for in the money call options and at the money put options keywords genetic programming implied volatility forecast dynamic hedging forecasting errors hedging errors 1 introduction one challenge posed by financial markets is to correctly forecast the volatility of financial securities which is a crucial variable in trading and risk management of derivative securities traditional parametric methods have limited success in estimating and forecasting volatility as they are dependent on restrictive assumptions and difficult to estimate several machine learning techniques have been recently used to overcome these difficulties such as artificial neural networks and evolutionary computation algorithms in particular genetic programming gp which is considered a promising approach to forecast financial time series tsang et al 2004 kaboudan 2005 it has been successfully applied to forecast historical volatility chen and yeh 1997 zumbach et al 2001 neely and weller 2002 ma et al 2006 2007 and implied volatility abdelmalek et al 2009 this paper makes an initial attempt to test whether the hedger can benefit more by using generated gp implied volatilities instead of black scholes implied volatilities in conducting dynamic hedging strategies changes in asset prices is not the only risk faced by market participants instantaneous changes in market implied volatility can also bring a hedging portfolio significantly out of balance extensive research during the last two decades has demonstrated that the volatility of stocks is not constant over time bollerslev et al 1992 engle 1982 and bollerslev 1986 introduced the family of arch and garch models to describe the evolution of the volatility of the asset price in discrete time econometric tests of these models clearly reject 2 the hypothesis of constant volatility and find evidence of volatility clustering over time in the financial literature stochastic volatility models have been proposed to model these effects in a continuous time setting hull and white 1987 scott 1987 wiggins 1987 heston 1993 although these models improve the benchmark black scholes model they are complex because they require strong assumptions and computational effort to estimate parameters and stochastic process as mentioned in ma et al 2004 traditional financial engineering methods based on parametric models such as the garch model family seem to have difficulty to improve the accuracy in volatility forecasting due to their rigid as well as linear structure using its basic and flexible tree structured representation gp is capable of solving non linear problems with little input or external knowledge it has been successfully applied to forecast historical volatility chen and yeh 1997 zumbach et al 2001 neely and weller 2002 ma et al 2006 2007 and implied volatility abdelmalek et al 2009 the first thrust of this paper deals with generation of implied volatility from option markets using genetic programming this volatility forecasting method should be free of strong assumptions regarding underlying price dynamics and more flexible than parametric methods derivative asset prices are affected by new information and changes in expectations as much as they are by changes in the value of the underlying index if traders have perfect foresight on forward volatility then dynamic hedging would be essentially riskless in practice continuous hedging is impossible but the convexity of derivative security allows for adjustments in the exposure to higher order sensitivities of the model such as gamma vega most of the extant literature on hedging a target contract using other exchange traded options focuses on static strategies motivated at least in part by the desire to avoid the high costs of frequent trading the goal of static hedging is to construct a buy and hold portfolio of exchange traded claims that perfectly replicates the payoff of a given over the counter product derman ergener and kani 1995 carr ellis and gupta 1998 the static hedging strategy does not require any rebalancing and therefore it does not incur significant transaction costs unfortunately the odds of coming up with a perfect static hedge for a given over the counter claim are small given the limited number of exchange listed option contracts with sufficient trading volume in other words the static hedge can only be efficient if traded options are available with sufficiently similar maturity and moneyness as the over the counter product that has to be hedged under a stochastic volatility a perfect hedge can in principle be constructed with a dynamically rebalanced portfolio consisting of the underlying and one additional option in practice the dynamic replication strategy for european options will only be perfect if all of the assumptions underlying the black scholes formula hold for general contingent claims on a stock under market frictions the delta might still be used as first order approximation to set up a riskless portfolio however if the volatility of the underlying stock varies stochastically then the delta hedging method might fail severely a simple method to limit the volatility risk is to consider the volatility sensitivity vega of the contract the portfolio will have to be rebalanced frequently to ensure delta vega neutrality with transaction costs frequent rebalancing might result in considerable losses in practice investors can rebalance their portfolios only at discrete intervals of time to reduce transactions costs non parametric hedging strategies as an alternative to the existing parametric model based strategies have been proposed by hutchinson et al 1994 and a t sahalia and lo 1998 those studies estimated pricing formulas by nonparametric or semi parametric statistical methods such as neural networks and kernel regression and they measured their performance in terms of delta hedging few researches have focused on the dynamic hedging using genetic programming however chen et al 1999 have applied genetic programming to price and hedge s p 500 index options by distinguishing the case in the money from the case out of 3 the money the performance of gp is compared with the black scholes model in terms of its hedging accuracy based on the post sample performance it is found that in approximately 20 of the 97 test paths gp has lower tracking error than the bs formula the second thrust of this paper is to study the accuracy of the generated gp implied volatility models in terms of dynamic hedging since the true volatility is unobservable it is impossible to assess the accuracy of any particular model forecasts can only be related to realized volatility the strategy adopted in this paper is to assume that the implied volatility is a reasonable proxy for realized volatility to generate forecasting implied volatility models using genetic programming and then to analyze the implications of this predictability for hedging purposes the rest of the paper is organized as follows section 2 provides background information regarding genetic programming approach section 3 describes research design and methodology used in this paper section 4 reports experimental results and finally section 5 concludes 2 genetic programming background genetic programming koza 1992 is an evolutionary algorithm that attempts to evolve a population of solutions to a problem according to the darwinian principles of natural evolution it is an extension of the basic genetic algorithms as introduced by holland 1975 the major difference between genetic programming and genetic algorithms is the representation of the solution candidates a hierarchical tree structure represents the solution candidates in genetic programming while a string of characters with a fixed length called chromosome represents the solution candidates in genetic algorithms this makes the gp a flexible technique as the solutions can vary in size and shape an interesting feature of gp is its ability to perform optimization at a structural level this is an attractive prospect as the algorithm can simultaneously evolve a model s function form and numerical parameter values the genetic programming s algorithm structure consists of the following elements nodes definition initialization fitness evaluation selection genetic operators crossover and mutation and termination condition nodes definition the nodes in the tree structure of genetic programming can be classified into terminal leaf nodes and function non terminal nodes the terminal set which corresponds to the inputs of the program is determined according to the domain of problems and the elements can be constants or variables the function set may be standard arithmetic operations standard programming operations standard mathematical functions logical functions or domain specific functions the terminal set and the function set are used to construct trees which are solutions to the problem initialization genetic programming starts with an initial population which is a set of randomly generated trees fitness function the evolutionary process is driven by a fitness that evaluates how well each individual performs in the problem environment selection the selection method determines how to select individuals from the population to be parents for next generation based on fitness function parents with better quality are usually selected with the hope that they can produce better offspring with larger chance crossover the crossover operation creates new offspring trees from two selected parents by exchanging their sub trees mutation the mutation operator randomly changes a tree by randomly altering nodes or sub trees to create a new offspring termination condition the termination conditions for genetic programming usually include the convergence level of evolution process or the maximum number of generations 4 3 research design and methodology dynamic hedging is very sensitive to volatility forecast and good hedges require accurate estimate of volatility implied volatilities generated from option markets can be particularly useful in such contents as they are forward looking measures of the market s expected volatility during the remaining life of an option blair et al 2001 bush et al 2007 this paper proposes a non parametric approach based on gp algorithm to improve the accuracy of the implied volatility forecast and consequently the dynamic hedging in the standard gp the entire population of gp function trees is evaluated against the entire training data set so the number of function tree evaluations carried out per generation is directly proportional to both the population size and the size of the training set gp can encounter the problem of managing training sets which are too large to fit into the memory of computers and then the realization of predictors in this case data reduction through the partitioning of the data set into smaller subsets seems a good approach in this paper sample data are split into times series and moneyness time to maturity classes gp learns from the training set test set is used to evaluate its performance during and after training as data are divided in several sub samples two training subset selection methods are used abdelmalek et al 2009 proposed a static training approach allowing the gp to learn separately on different training sub samples such approach might provide local solutions not adaptive to the entire enlarged data set alternatively a dynamic training approach is developed it allows gp to learn simultaneously on all training sub samples and it implies a new parameter added to the basic gp algorithm which is the number of generations to change sample this approach lightens the training task for the gp and favors the discovery of solutions that are more robust across different learning data samples and seem to have better generalization ability comparative experiments are provided to show how successfully dynamic training subset selection methods are applied to improve the robustness of gp to generate general models relative to static training subset selection method the best forecasting implied volatility models are selected according to total mean squared error mse criterion accurate volatility forecasting is an essential element in conducting good dynamic hedging strategies the best generated gp implied volatilities are used to compute hedge factors and implement delta neutral delta gamma neutral and delta vega neutral strategies according to the average hedging error the gp hedging performance is compared to that of black scholes model and the main results are reported figure 1 illustrates the operational procedure to implement the proposed approach figure 1 description of the proposed approach s implementation the operational procedure consists of the following steps the first step is devoted for the data division schemes the second step deals with the implementation of gp 1 the application 1 gp system is built around the evolving object library which is an ansi c evolutionary computation framework eo library times series data moneyness and time to maturity data gp static subset selection gp dynamic subset selection selection of the best forecasting implied volatility models dynamic hedging results data division schemes implied volatility forecasting dynamic hedging index option data 5 of training subset selection methods and the selection of the best forecasting implied volatility models the last step is dedicated to dynamic hedging results 3 1 data division schemes data used in this study consist of daily prices for the european style s p 500 index calls and puts options traded on the chicago board of options exchange from 02 january to 29 august 2003 the data base include the time of the quote the expiration date the exercise price and the daily bid and ask quotes for call and put options similar information for the underlying s p 500 index is also available on a daily basis s p 500 index options are among the most actively traded financial derivatives in the world the minimum tick for series trading below 3 is 1 16 and for all other series 1 8 strike price intervals are 5 points and 25 for far months the expiration months are three near term months followed by three additional months from the march quarterly cycle march june september and december following a standard practice we use the average of an option s bid and ask price as a stand in for the market value of the option the risk free interest rate is approximated by using 3 month us treasury bill rates it is assumed that there are no transaction costs and no dividend to reduce the likelihood of errors data screening procedures are used harvey and whaley 1991 1992 we apply four exclusion filters to construct the final option sample first as implied volatilities of short term options are very sensitive to small errors in the option price and may convey liquidity related biases options with time to maturity less than 10 days are excluded second options with low quotes are eliminated to mitigate the impact of price discreteness on option valuation third deep itm and deep otm option prices are also excluded due to the lack of trading volume finally option prices not satisfying the arbitrage restriction merton 1973 r kesc are not included the final sample contains 6670 daily option quotes with atm itm and otm options respectively taking up 37 34 and 29 of the total sample in this paper two data division schemes are used the full sample is sorted first by time series ts and second by moneyness time to maturity mtm for time series data are divided into 10 successive samples s 1 s 2 s 10 each contains 667 daily observations the first nine samples are used as training sub samples for moneyness time to maturity data are divided into nine classes with respect to moneyness and time to maturity criteria according to moneyness criterion a call option is said otm if 98 0 ks atm if 03 1 98 0 ks and itm if 03 1 ks according to time to maturity criterion a call option is short term st if 60 days medium term mt if 180 60 days and long term lt if 180 days each class ci is divided on training set ci l and test set ci t which produces respectively nine training and nine test moneyness time to maturity sub classes figure 2 illustrates the two division schemes figure 2 data division schemes second division scheme first division scheme input data time series ts 1 s 2 s 10 s moneyness time to maturity mtm atmmt c 5 atmlt c 6 atmst c 4 otmlt c 3 itmst c 7 otmmt c 2 itmmt c 8 otmst c 1 itmlt c 9 l 1 c t 1 c l 2 c t 2 c l 4 c t 4 c l 6 c t 6 c l 7 c t 7 c l 8 c t 8 c l 9 c t 9 c l 3 c t 3 c c 5 l t 5 c 6 3 2 implied volatility forecasting using gp the implied volatility is defined as the standard deviation which equates the model option price to the observed market option price since there is no explicit formula available to compute directly the implied volatility the latter can be obtained by inverting the option pricing model on the contrary the gp offers explicit formulas which can compute directly the implied volatility therefore the gp is applied to forecast implied volatility from the s p 500 index options this subsection will describe the experiments that have been accomplished using the gp algorithm to forecast implied volatility in the first experiment the gp is trained using static training subset selection method in the second one we used dynamic training subset selection methods we will describe training and test samples that were used in the experiments and the gp parameters setting 3 2 1 training subset selection methods in this paper static and dynamic training subset selection approaches are used first the gp is trained independently on each sub sample relative to each data division scheme abdelmalek et al 2009 this approach is called static training subset selection method the following flow chart summarizes the gp s algorithm structure using static training subset selection method initialize population while termination condition not satisfied do begin evaluate the performance of each individual according to the fitness criterion select individuals in the population using the selection algorithm perform crossover and mutation on the selected individuals replace the existing population by the new population endwhile report the best solution found end algorithm 1 a flow chart summarizing the gp s algorithm structure using static training subset selection method second the gp is trained simultaneously on the entire data sub samples relative to each data division scheme rather than just a single subset by changing the training sub sample during the run process this approach is called dynamic training subset selection method the main goal of this method is to make gp adaptive to all training samples and able to generate general models and solutions that are more robust across different learning data samples four dynamic training subset selection methods are applied random subset selection method rss sequential subset selection method sss adaptive sequential subset selection method asss and adaptive random subset selection method arss the rss and sss allow the gp to learn on all training samples in turn sss or randomly rss however with these methods there is no certainty that gp will focus on the samples which are difficult to learn then the asss and the arss which are variants of the adaptive subset selection ass are introduced to focus the gp s attention onto the difficult samples i e having the greatest mse and then to improve the learning algorithm the following flow chart summarizes the gp s algorithm structure using dynamic training subset selection method 7 initialize population t 1 t current generation while termination condition not satisfied do begin select the first training sample si according to the selection method rss sss arss asss until the generations number to change sample is reached select individuals in the population using the selection algorithm perform crossover and mutation operations on the selected individuals evaluate the performance of individuals according to the fitness criterion select next training sample si end while report the best solution end algorithm 2 a flow chart summarizing the gp s algorithm structure using dynamic training subset selection method let s s 1 s 2 sk be the set of training samples si i 1 k where k is the total number of samples a selection probability p si is allocated to each sample si from s the training sample si is changed each g generation g is the number of generations to change sample according to this selection probability and the dynamic training subset selection method used this procedure is repeated until the maximum number of generations is reached this permits gp to adapt its generating process to changing data in response to feedback from the fitness function a random training subset selection method rss it selects randomly the training samples with replacement at each g generation all the samples from s have the same probability to be selected as the current training sample p si 1 k 1 i k b sequential training subset selection method sss it selects all the training samples in the order all the learning subsets are used during the evolution in an iterative way if at generation g 1 the current training sample is si then at generation g 1 avec j i 1 si i k ou j 1 si i kjp s c adaptive training subset selection method ass instead of selecting a training subset data in a random or sequential way one can use an adaptive approach to dynamically select difficult training subsets data which are frequently misclassified this approach is inspired from the dynamic subset selection method proposed by gathercole and ross 1994 which is based on the idea of dynamically selecting instances not training samples which are difficult and or have not been selected for several generations selection is made according to a weight computed proportionally to the sample s average fitness each g generations the weights are updated as follows gm xf sw g t m j j i 1 1 3 where m is the size of si ij sx g is the number of generations to change sample and jxf is the mse of the individual j x 8 selection of the training sample for the next run is made according to its misclassification measured by its higher fitness error at each g generations training samples are re ordered so that the most difficult training samples which have higher fitness errors will be moved to the beginning of the ordered training list and the easiest training samples which have smaller fitness errors will be moved to the end of the ordered training list c 1 adaptive sequential training subset selection method asss the initial weights are initialized with a constant and the selection of samples is made in an iterative way w si c 1 i k c 2 adaptive random training subset selection method arss the initial weights are generated randomly in the start of running rather than initialized with a constant kippsw iii 1 1 0 for t 1 3 2 2 training and test samples different forecasting gp volatility models are estimated from the training set and judged upon their performance on the test set table 1 summarizes the training and test data samples used for static and dynamic training subset selection methods respectively subset selection learning data sample test data sample static subset selection 1 si ts samples s 1 s 9 1 subset for a run the successive ts sample sj j i 1 2 ci l mtm training samples c 1 l c 9 l 1 subset for a run the corresponding mtm test samples ci t dynamic subset selection rss sss asss arss 1 ts samples s 1 s 9 9 subsets for a run the last subset in ts samples set s 10 2 mtm training samples c 1 l c 9 l 9 subsets for a run the nine mtm test samples c 1 t c 2 t c 9 t 3 ts samples mtm samples s 1 s 9 c 1 l c 9 l 18 subsets for a run the last ts sample with the nine mtm test samples s 10 c 1 t c 2 t c 9 t table 1 definition of training and test data samples for static and dynamic training subset selection methods in static training subset selection approach first the genetic program is trained separately on each of the first nine time series sub samples s 1 s 9 using ten different seeds and is tested on the subset data from the immediately following date s 2 s 10 second using the same genetic parameters and random seeds applied for time series data the gp is trained separately on each of the first nine moneyness time to maturity sub classes c 1 l c 9 l and is tested on the second nine moneyness time to maturity sub classes c 1 t c 9 t in dynamic training subset selection approach first the genetic program is trained on the first nine time series sub samples simultaneously s 1 s 9 using ten different seeds and it is tested only on the tenth sub sample data s 10 second the gp is trained on the first nine moneyness time to maturity sub classes simultaneously c 1 l c 9 l and it is tested on the second nine moneyness time to maturity sub classes regrouped in one test sample data c 1 t c 2 t c 9 t third the gp is trained on both the nine time series sub samples and the nine moneyness time to maturity sub classes simultaneously s 1 s 9 c 1 l c 9 l and it is tested on one test sample data composed of the time series and moneyness time to maturity test data s 10 c 1 t c 2 t c 9 t 9 3 2 3 parameters setting our gp software is referred to as symbolic regression written in c language it is designed to find a function that relates a set of inputs to an output without making any assumptions about the structure of that function symbolic regression was one of the earliest applications of gp koza 1992 and has continued to be widely studied cai et al 2006 gustafson et al 2005 keijzer 2004 lew et al 2006 the terminal and function sets used are described in table 2 the terminal set includes the inputs variables notably the option price divided by strike price k c for calls and k p for puts the index price divided by strike price k s and time to maturity the function set includes unary and binary nodes unary nodes consist of mathematical functions notably cosinus function cos sinus function sin log function ln exponential function exp square root function and the normal cumulative distribution function binary nodes consist of the four basic mathematical operators notably addition subtraction multiplication and division 0 0 the basic division operation is protected against division by zero and the log and square root functions are protected against negative arguments table 2 terminal set and function set the black scholes implied volatility bst is used as target output it is defined as the standard deviation which equates the bs model price bs c 2 to the market option price tc tkctkksc tk t bs ttbs bs t 0 1 the generated gp trees provide at each time t the forecast value t and the fitness function used to measure the accuracy of forecast is the mean squared error mse computed as follows 2 1 1 n t t bs t n mse 2 where n is the number of data sample 2 21 dnkedsnc r bs 2 1 5 0 ln r k s d 12 dd expression definition terminal set c k call price strike price s k index price strike price time to maturity function set addition subtraction multiplication 0 0 y otherwise 0 0 y x 0 0 y 1 if y 0 x 0 0 division xprotected ln xx lnln protected natural log exp xex exp exponential function sqrt xx protected square root ncdf normal cumulative distribution function 10 the implementation of genetic programming involves a series of trial and error experiments to determine the optimal set of genetic parameters which is listed in table 3 table 3 summary of gp parameters the generated gp volatility models are performed using a ramped half and half as initialization method koza 1992 this method involves generating an equal number of trees using a maximum initial depth that ranges from 2 to 6 for each level of depth 50 of the initial trees are generated via the full method and the other 50 are generated via the grow method a maximum size of tree measured by depth is 17 this is a popular number used to limit the size of tree koza 1992 it is large enough to accommodate complicated formulas and works in practice based on the fitness criterion the selection of the individuals for reproduction is done with the tournament selection algorithm a group of individuals is selected from the population with a uniform random probability distribution the fitness values of each member of this group are compared and the actual best is selected the size of the group is given by the tournament size which is equal here to 4 the crossover operator is used to generate about 60 of the individuals in the population while the mutation operator is used to generate about 40 of the population different mutation operators are used point mutation operator consists of replacing a single node in a tree with another randomly generated node of the same arity branch mutation operator randomly selects an internal node in the tree and then it replaces the subtree rooted at that node with a new randomly generated subtree expansion mutation operator randomly selects a terminal node in the tree and then replaces it with a new randomly generated subtree branch mutation is applied with a rate of 20 point and expansion mutations are applied with a rate of 10 each the method of replacing parents for the next generation is comma replacement strategy which selects the best offspring to replace the parents it assumes that offspring size is higher than parents size the stopping criterion is the maximum number of generations it is fixed at 400 and 1000 for static and dynamic training subset selection respectively in the dynamic training subset selection approach the maximum number of generations is increased to allow the gp to train on the maximum of samples simultaneously the number of generations to change sample varied between 20 and 100 generations based on the training and test mse the best generated gp volatility models relative to static and dynamic training subset selection methods respectively are selected these models are then compared with each other according to the mse total and the best ones are used to implement the dynamic hedging strategies as described in the following section population size offspring size maximum number of generations for static method maximum number of generations for dynamic method generations number to change sample maximum depth of new individual maximum depth of the tree tournament size crossover probability mutation probability branch mutation point mutation expansion mutation 100 200 400 1000 20 100 6 17 4 60 40 20 10 10 11 3 3 dynamic hedging to assess the accuracy of selected generated gp volatility models in hedging with respect to black scholes model three dynamic hedging strategies are employed notably delta neutral delta gamma neutral and delta vega neutral strategies for delta hedging at date zero a delta hedge portfolio consisting of a short position in one call or put option and a long short position in the underlying index is formed at any time t the value of the delta hedge portfolio t is given by ttsttvtp v 4 where tp tv ts t v and t denote the values of the portfolio hedging option call or put underlying delta hedge factor and bond money market account respectively the portfolio is assumed self financed so the initial value of the hedge portfolio at the beginning of the hedge horizon is zero 0 0 0 0 0 0 sv v 5 0 0 0 0 vsv 6 a dynamic trading strategy is performed in underlying and bond to hedge the option during the hedge horizon the portfolio rebalancing takes place at intervals of length t during the hedge horizon 0 to where t is the maturity of the option at each rebalancing time it the hedge factor iv t is recomputed and the money market account is adjusted 11 ivivii tr i tttstet 7 the delta hedge error is defined as the absolute value of the delta hedge portfolio at the end of the hedge horizon of the option p for delta gamma hedging a new position in a traded option is required then the delta gamma hedge portfolio is formed with 1 tbtvtytstxtvtp 8 where tv 1 is the value of an additional option which depends on the same underlying with the same maturity but different strike price than the hedging option tv tx and ty are the proportions of the underlying and the additional option respectively they are chosen such that the portfolio t is both delta and gamma neutral 0 neutral 0 neutral 1 1 ttytgamma ttytxtdelta vv vv 9 1 1 ttyttx t t ty vv v v 10 where the values of t v and t v are the delta and gamma factors for the option tv the values t v 1 and t v 1 are the delta and gamma factors for the option tv 1 at the beginning of the hedge horizon the value of the hedge portfolio is zero 0 0 0 0 0 0 0 0 1 bvysxvp 11 0 0 0 0 0 0 1 vysxvb 12 12 at each rebalancing time it both delta and gamma hedge factors are recomputed and the money market account is adjusted 1111 iiiiiii tr i tvtytytstxtxtbetb 13 the delta gamma hedge error is defined as the as the absolute value of the delta gamma hedge portfolio at the end of the hedge horizon of the option p for delta vega hedging a new position in a traded option is required as in the delta gamma hedging the proportions of the underlying tx and the additional option ty are chosen such that the portfolio t is both delta and vega neutral 0 neutral ega 0 neutral 1 1 ttytv ttytxtdelta vv vv 14 1 1 ttyttx t t ty vv v v 15 where t v and 1 t v are the vega factors for the options tv and tv 1 respectively as in delta gamma hedging at each rebalancing time it both delta and vega hedge factors are recomputed and the money market account is adjusted the delta vega hedge error is defined as the as the absolute value of the delta vega hedge portfolio at the end of the hedge horizon of the option p 35 option contracts are used as hedging options and similarly 35 contracts which depend on the same underlying with the same maturity but different strike prices than the hedging options are used as additional options contracts used to implement the hedging strategies are divided according to moneyness and time to maturity criteria which produces nine classes the delta gamma and vega hedge factors are computed using the bs formula by taking the derivative of option value with respect to index price the derivative of delta with respect to index price and the derivative of option value with respect to volatility respectively for the gp models the hedge ratios are computed using the same formulas replacing the bs implied volatilities with the generated gp volatilities two rebalancing frequencies are considered 1 day and 7 days revision the average hedging error is used as performance measure for a particular moneyness time to maturity class the tracking error is given by 0 1 vn p e n irt i n i i m 16 where n is the number of options corresponding to a particular moneyness time to maturity class and i is the present value of the absolute hedge error of the portfolio p over the observation path n as a function of rebalancing frequency divided by the initial option price 0 v 13 4 result analysis and empirical findings 4 1 selection of the best genetic programming implied volatility forecasting models selection of the best generated gp volatility model relative to each training set for time series moneyness time to maturity and both time series and moneyness time to maturity classifications is made according to the training and test mse for static training subset selection method nine generated gp volatility models are selected for time series m 1 s 1 m 9 s 9 and similarly nine generated gp volatility models are selected for moneyness time to maturity classification m 1 c 1 m 9 c 9 the performance of these models is compared according to the mse total computed using the same formula as the basic mse for the enlarged data sample table 4 reports the mse total and the standard deviation in parentheses of the generated gp volatility models using static training subset selection method relative to the time series samples ts and the moneyness time to maturity classes mtm ts models mse total mtm models mse total m 1 s 1 0 002723 0 004278 m 1 c 1 256 656757 20606 1723 m 2 s 2 0 005068 0 006213 m 2 c 2 0 006921 0 03220954 m 3 s 3 0 003382 0 004993 m 3 c 3 0 030349 0 07619638 m 4 s 4 0 001444 0 002727 m 4 c 4 0 001710 0 0046241 m 5 s 5 0 002012 0 003502 m 5 c 5 1 427142 33 3651158 m 6 s 6 0 001996 0 003443 m 6 c 6 0 002357 0 0040963 m 7 s 7 0 001901 0 003317 m 7 c 7 0 261867 0 30325633 m 8 s 8 0 002454 0 004005 m 8 c 8 0 004318 0 0084793 m 9 s 9 0 002419 0 004095 m 9 c 9 0 002940 0 01049067 table 4 performance of the generated gp volatility models using static training subset selection method according to mse total for the time series samples ts and the moneyness time to maturity classes mtm table 4 shows that for the time series samples the generated gp model m 4 s 4 has the smallest mse in enlarged sample for the moneyness time to maturity classes the generated gp volatility models m 4 c 4 and m 6 c 6 seem to be more accurate in forecasting implied volatility than the other models as they present near mse on the enlarged sample according to the mse total the time series model m 4 s 4 seems to be more performing than moneyness time to maturity models m 4 c 4 and m 6 c 6 for the enlarged sample for dynamic training subset selection methods rss sss asss and arss four generated gp volatility models are selected for time series classification msr mss msas and msar similarly four generated gp volatility models are selected for moneyness time to maturity classification mcr mcs mcas and mcar and four generated gp volatility models are selected for global classification both time series and moneyness time to maturity classes mgr mgs mgas and mgar table 5 reports the best generated gp volatility models using dynamic training subset selection relative to ts samples mtm classes and both ts and mtm data 14 table 5 performance of the generated gp volatility models using dynamic training subset selection method according to mse total for the ts samples the mtm classes and both ts and mtm samples based on the mse total as performance criterion the generated gp volatility models mss mcar and mgar are selected they seem to be more accurate in forecasting implied volatility than the other models because they have the smallest mse in enlarged sample table 5 shows that the time series model mss presents the highest mse relative to the other models it seems to be less performing than the moneyness time to maturity model mcar and the time series and moneyness time to maturity model mgar the best generated gp volatility models selected relative to dynamic training subset selection method are compared to the best generated gp volatility model relative to static training subset selection method results are reported in table 6 models mse total m 4 s 4 0 001444 0 002727 mcar 0 001424 0 003527 mgar 0 001599 0 003590 table 6 comparison between best models generated by static and dynamic selection methods for call options comparison between models reveals that the best models generated respectively by static m 4 s 4 and dynamic selection methods mcar and mgar present total mse small and very close while the generated gp volatility models m 4 s 4 and mcar have total mse smaller than the mgar model the latest seems to be more accurate in forecasting implied volatility than the other models this can be explained by the fact that on one hand the difference between forecasting errors is small and on the other hand the mgar model is more general than mcar and m 4 s 4 models because it is adaptive to all time series and moneyness time to maturity classes simultaneously in fact the mgar model generated using adaptive random training subset selection arss method is trained on all time series and moneyness time to maturity classes simultaneously whereas the mcar model generated using adaptive random training subset selection arss method is trained only on moneyness time to maturity classes simultaneously and the m 4 s 4 model generated using static training subset selection method is trained separately on each subset of time series as the adaptive random training subset selection method is considered the best one to generate implied volatility model for call options it is applied to put options the decoding of volatility forecasting formulas generated for call and put options as well as their forecasting errors are reported in table 7 ts models mse total mtm models mse total global models mse total msr 0 002367 0 003934 mcr 0 002427 0 0037777 mgr 0 002034 0 003501 mss 0 002076 0 004044 mcs 0 007315 0 025811 mgs 0 002492 0 003013 msas 0 002594 0 003796 mcas 0 002831 0 004662 mgas 0 001999 0 003587 msar 0 002232 0 003782 mcar 0 001424 0 003527 mgar 0 001599 0 003590 15 models formula mse total gp call gp put k s k s k c 56 gp k s exp k p ln 2 sincossincossin gp 0 001599 0 003590 0 001539 0 002158 table 7 performance of the best generated gp volatility models for call and put options and their decoding formulas a detailed examination of the trees shows that the implied volatilities generated by gp are function of all the inputs used namely the option price divided by strike price k c for calls and k p for puts the index price divided by strike price k s and time to maturity furthermore the implied volatilities generated by the mgar call and mgar put models can t be negative since they are computed using the square root and the normal cumulative distribution functions as the root nodes furthermore the performance of models is uniform as they present near mse on the enlarged sample 4 2 dynamic hedging results the performance of the best gp forecasting models is compared to the black sholes model in delta gamma and vega hedging strategies table 8 reports the average hedging errors for call options using bs and gp models at the 1 day and 7 days rebalancing frequencies table 8 average hedge errors of dynamic hedging strategies relative to bs and gp models for call options rebalancing frequency 1 day 7 days s k hedging strategy model 60 60 180 180 60 60 180 180 0 98 delta hedging bs 0 013119 0 001279 0 000678 0 057546 0 010187 0 005607 gp 0 009669 0 001081 0 000662 0 053777 0 009585 0 005594 gamma hedging bs 0 000596 0 000732 0 000061 0 003026 0 007357 0 000429 gp 0 000892 0 002040 0 000075 0 003855 0 001359 0 000153 vega hedging bs 0 000575 0 000050 0 000039 0 000525 0 000226 0 000099 gp 0 000473 0 002035 0 004518 0 000617 0 004642 0 040071 0 98 1 03 delta hedging bs 0 002508 0 000717 0 000730 0 019623 0 005416 0 002283 gp 0 002506 0 0007 0 001725 0 020 0 0054 0 0022 gamma hedging bs 0 000069 0 000018 0 000006 0 000329 0 000169 0 000027 gp 0 000377 0 000040 0 000029 0 000727 0 000155 0 000059 vega hedging bs 0 000066 0 000373 0 003294 0 000527 0 023500 0 031375 gp 0 000281 0 000013 0 000207 0 001102 0 000147 0 000134 1 03 delta hedging bs 0 000185 0 000906 0 001004 0 001602 0 006340 0 006401 gp 0 000184 0 000905 0 001 0 000840 0 005789 0 0064 gamma hedging bs 0 000323 0 000047 0 000028 0 001546 0 000386 0 000157 gp 0 000028 0 000057 0 000036 0 000227 0 000429 0 000175 vega hedging bs 0 000362 0 000060 0 000052 0 001757 0 002015 0 000247 gp 0 000067 0 000057 0 00005 0 000831 0 000864 0 000186 16 results show that the delta hedging performance improves for out of the money call options at longer maturities for at the money call options at medium maturities and for in the money call options at shorter maturities regardless of model used at daily hedge revision frequency the best delta hedging performance is achieved using in the money short term call options for all moneyness and time to maturity classes regardless of option model used the delta gamma hedging performance improves for all moneyness classes of call options at longer maturities regardless of model used at daily hedge frequency except in the money call options using the gp model the best delta gamma hedging performance is achieved for bs model using at the money long term call options for all moneyness and time to maturity classes however the best delta gamma hedging performance is achieved for gp model using in the money short term call options for all moneyness and time to maturity classes the delta vega hedging performance improves for out of the money and in the money call options at longer maturities and for at the money call options for shorter maturities for bs model at daily hedge revision frequency however the delta vega hedging performance improves for out of the money call options at shorter maturities for at the money call options at medium maturities and for in the money call options at longer maturities for gp model at daily hedge revision frequency the best delta vega hedging performance is achieved for bs model using out of the money long term call options for all moneyness and time to maturity classes however the best delta gamma hedging performance is achieved for gp model using at the money medium term call options for all moneyness and time to maturity classes the percentage of cases where the hedging error of the gp model is less than the bs hedging error is around 59 in particular the performance of gp model is better than the bs model on in the money call options class further the total of hedging errors relative to gp model is about 21 percent slightly lower than 19 percent relative to bs model table 9 displays the average hedge errors for put options using bs and gp models at the 1 day and 7 days rebalancing frequencies rebalancing frequency 1 day 7 days s k hedging strategy model 60 60 180 180 60 60 180 180 0 98 delta hedging bs 0 007259 0 002212 0 001189 0 015453 0 013715 0 007740 gp 0 064397 0 002270 0 001256 0 016872 0 013933 0 007815 gamma hedging bs 0 000107 0 000043 0 000705 0 000383 0 000253 0 013169 gp 0 000177 0 000351 0 000676 0 000990 0 000324 0 009201 vega hedging bs 0 000051 0 000715 0 000612 0 000174 0 002995 0 008527 gp 0 002800 0 000345 0 000625 0 018351 0 000184 0 008979 0 98 1 03 delta hedging bs 0 007331 0 002267 0 001196 0 170619 0 009875 0 004265 gp 0 0073 0 002219 0 001185 0 170316 0 009715 0 004260 gamma hedging bs 0 003750 0 000049 0 000027 0 032725 0 000119 0 000119 gp 0 003491 0 000031 0 000024 0 029792 0 000113 0 000103 vega hedging bs 0 035183 0 000052 0 000044 0 037082 0 000329 0 000043 gp 0 004343 0 000038 0 000043 0 037045 0 000190 0 000041 1 03 delta hedging bs 0 007680 0 004469 0 000555 0 037186 0 017322 0 011739 gp 0 006641 0 004404 0 0005 0 037184 0 017076 0 011733 gamma hedging bs 0 000262 0 000204 0 000079 0 001196 0 001319 0 000369 gp 0 000548 0 000287 0 000166 0 002034 0 001323 0 001059 vega hedging bs 0 000232 0 000108 0 000025 0 000488 0 000644 0 000270 gp 0 000312 0 000080 0 00002 0 001047 0 001186 0 000244 table 9 average hedge errors of dynamic hedging strategies relative to bs and gp models for put options 17 results show that the delta gamma hedging performance improves for all moneyness classes of put options except in the money put options at longer maturities for bs model at daily hedge frequency however the delta gamma hedging performance improves for in the money put options and at the money put options at medium maturities and for out of the money put options at longer maturities for gp model at daily hedge revision frequency the best delta gamma hedging performance is achieved for bs model using at the money long term put options for all moneyness and time to maturity classes however the best delta gamma hedging performance is achieved for gp model using out of the money long term put options for all moneyness and time to maturity classes the delta vega hedging performance improves for bs using at the money and out of the money put options at longer maturities and in the money put options for shorter maturities for bs model at daily hedge revision frequency however the delta vega hedging performance improves for all moneyness classes of put options except in the money put options at longer maturities for gp model at daily hedge frequency the best delta vega hedging performance is achieved for bs model using out of the money long term put options for all moneyness and time to maturity classes however the best delta vega hedging performance is achieved for gp model using at the money long term put options for all moneyness and time to maturity classes the percentage of cases where the hedging error of the gp model is less than the bs hedging error is around 57 in particular the performance of gp model is better than the bs model on at the money put options class but the total of hedging errors relative to gp model is about 50 percent slightly higher than 46 percent relative to bs model in summary the gp model is more accurate in all hedging strategies than the bs model for in the money call options and at the money put options the performance of gp is pronounced essentially in terms of delta hedging for call and put options the percentage of cases where the delta hedging error of the gp model is less than the bs delta hedging error is 100 for out of the money and in the money call options as well as for at the money and out of the money put options the percentage of cases where the delta vega hedging error of the gp model is less than the bs delta vega hedging error is 100 for in the money call options as well as for at the money put options the percentage of cases where the delta gamma hedging error of the gp model is less than the bs delta gamma hedging error is 100 for at the money put options furthermore results exhibit that as the rebalancing frequency changes from 1 day to 7 days revision as the hedging errors increase and vice versa the option value is a nonlinear function of the underlying therefore hedging is instantaneous and hedging with discrete rebalancing gives rise to error frequent rebalancing can be impractical due to transactions costs in the literature consequences of discrete time hedging have been considered usually in conjunction with the existence of transaction costs that s why hedgers would like to trade at least frequently as possible pioneered by leland 1985 asymptotic approaches as are well utilized kabanov and safarian 1997 ahn et al 1998 grandits and schachinger 2001 for most moneyness time to maturity classes delta gamma and delta vega hedging strategies are shown to perform better in dynamic hedging when compared with delta hedging strategy regardless of model used the delta gamma strategy enables the performance of a discrete rebalanced hedging to be improved the delta vega strategy corrects partly for the risk of a randomly changing volatility 5 conclusion this paper is concerned with improving the dynamic hedging accuracy using generated genetic programming implied volatilities firstly genetic programming is used to predict implied volatility from index option prices dynamic training subset selection methods are 18 applied to improve the robustness of gp to generate general forecasting implied volatility models relative to static training subset selection method secondly the implied volatilities derived are used in dynamic hedging strategies and the performance of genetic programming is compared to that of black scholes in terms of delta gamma and vega hedging results show that the dynamic training of gp yields better results than those obtained from static training with fixed samples especially when applied on time series and moneyness time to maturity samples simultaneously based on the mse total as performance criterion three generated gp volatility models are selected m 4 s 4 mcar and mgar however the mgar seems to be more accurate in forecasting implied volatility than mcar and m 4 s 4 models because it is more general and adaptive to all time series and moneyness time to maturity classes simultaneously the main conclusion concerns the importance of implied volatility forecasting in conducting hedging strategies genetic programming forecasting volatility makes hedge performances higher than those obtained in the black scholes world the best gp hedging performance is achieved for in the money call options and at the money put options in all hedging strategies the percentage of cases where the hedging error of the gp model is less than the bs hedging error is around 59 for calls and 57 for puts the performance of gp is pronounced essentially in terms of delta hedging for call and put options the percentage of cases where the delta hedging error of the gp model is less than the bs delta hedging error is 100 for out of the money and in the money call options as well as for at the money and out of the money put options the percentage of cases where the delta vega hedging error of the gp model is less than the bs delta vega hedging error is 100 for in the money call options as well as for at the money put options the percentage of cases where the delta gamma hedging error of the gp model is less than the bs delta gamma hedging error is 100 for at the money put options finally improving the accuracy of implied volatility forecasting using genetic programming can lead to well hedged options portfolios relative to the conventional parametric models references abdelmalek w ben hamida s and abid f 2009 selecting the best forecasting implied volatility model using genetic programming journal of applied mathematics and decision sciences hindawi publishing corporation www hindawi com journals jamds 2009 179230 html ahn h dalay m grannan e and swindle g 1998 option replication with transactions costs general diffusion limits ann appl prob vol 8 n 3 pp 676 707 a t sahalia y and lo a 1998 nonparametric estimation for state price densities implicit in financial asset prices the journal of finance vol 53 n 2 pp 499 547 black f and m scholes 1973 the pricing of options and corporate liabilities journal of political economy vol 81 637 659 bollerslev t 1986 generalized autoregressive conditional heteroscedasticity journal of econometrics vol 31 pp 307 327 bollerslev t chou r y and kroner k f 1992 arch modelling in finance a review of the theory and empirical evidence journal of econometrics vol 52 pp 55 59 carr p ellis k and gupta v 1998 static hedging of exotic options journal of finance vol 53 pp 1165 1190 chen s h and yeh c h 1997 using genetic programming to model volatility in financial time series genetic programming 1997 proceedings of the second annual conference morgan kaufmann publishers pp 288 306 chen s h lee w c and yeh c h 1999 hedging derivative securities with genetic programming international journal of intelligent systems in accounting finance and management vol 4 n 8 pp 237 251 http www hindawi com journals jamds 2009 179230 html 19 derman e ergener d and kani i 1995 static options replication the journal of derivatives vol 2 78 95 edirisinghe c naik v and uppal r 1993 optimal replication of options with transaction costs and trading restrictions journal of financial and quantitative analysis vol 28 117 139 engle r f 1982 autoregressive conditional heteroscedasticity with estimates of the variance of u k inflation econometrica vol 50 987 1008 grandits p and schachinger w 2001 leland s approach to option pricing the evolution of discontinuity math finance vol 11 n 3 pp 347 355 heston s l 1993 a closed form solution for options with stochastic volatility review of financial studies vol 6 pp 327 344 holland j h 1975 adaptation in natural and artificial systems university of michigan press ann arbor hull j and white a 1987 the pricing of options on assets with stochastic volatilities journal of finance vol 42 pp 218 300 hutchinson j m lo a w and poggio t 1994 a nonparametric approach to pricing and hedging derivative securities via learning network journal of finance vol 49 n 3 pp 851 889 kabanov y m and safarian m m 1997 on leland strategy of option pricing with transaction costs finance stochastic vol 1 n 3 pp 239 250 kaboudan m 2005 extended daily exchange rates forecasts using wavelet temporal resolutions new mathematics and natural computing vol 1 pp 79 107 koza j r 1992 genetic programming on the programming of computers by means of natural selection cambridge massachusetts the mit press leland h e 1985 option pricing and replication with transaction costs journal of finance vol 40 1283 1301 ma i wong t sankar t and siu r 2004 volatility forecasts of the s p 100 by evolutionary programming in a modified time series data mining framework wac 2004 conference seville ma i wong t and sanker t 2006 an engineering approach to forecast volatility of financial indices international journal of computational intelligence vol 3 n 1 pp 23 35 ma i wong t and sanker t 2007 volatility forecasting using time series data mining and evolutionary computation techniques proceedings of the 9 th annual conference on genetic and evolutionary computation gecco 07 england acm press neely c j and weller p a 2002 using a genetic program to predict exchange rate volatility in genetic algorithms and genetic programming in computational finance chapter 13 edited by chen s h kluwer academic publishers pp 263 279 scott l 1987 option pricing when the variance changes randomly theory estimation and an application journal of financial and quantitative analysis vol 22 pp 419 438 tsang e yung p and li j 2004 eddie automation a decision support tool for financial forecasting decision support systems vol 37 n 4 pp 559 565 wiggins j 1987 option values under stochastic volatility theory and empirical evidence journal of financial economics vol 19 pp 351 372 zumbach g pictet o v and masutti o 2001 genetic programming with syntactic restrictions applied to financial volatility forecasting technical report goz 2000 07 28 olsen associates research institute pp 1 22