on board monitoring of 2 d spatially resolved temperatures in cylindrical lithium ion batteries part ii state estimation via impedance based temperature sensing robert r richardson shi zhao and david a howey 1 department of engineering science university of oxford oxford uk abstract impedance based temperature detection itd is a promising approach for rapid estimation of internal cell temperature based on the correlation between temperature and electrochemical impedance previously itd was used as part of an extended kalman filter ekf state estimator in conjunction with a thermal model to enable estimation of the 1 d temperature distribution of a cylindrical lithium ion battery here we extend this method to enable estimation of the 2 d temperature field of a battery with temperature gradients in both the radial and axial directions an ekf using a parameterised 2 d spectral galerkin model with itd measurement input the imaginary part of the impedance at 215 hz is shown to accurately predict the core temperature and multiple surface temperatures of a 32113 lifepo 4 cell using current excitation profiles based on an artemis hev drive cycle the method is validated experimentally on a cell fitted with a heat sink and asymmetrically cooled via forced air convection a novel approach to impedance temperature calibration is also presented which uses data from a single drive cycle rather than measurements at multiple uniform cell temperatures as in previous studies this greatly reduces the time required for calibration since it overcomes the need for repeated cell thermal equalization keywords lithium ion battery impedance temperature kalman filter state estimation highlights demonstration of impedance based temperature sens ing for 2 d problems imaginary part of impedance at 215 hz used as mea surement input to ekf state estimator low order 2 d spectral galerkin method used for ef ficient thermal modelling experimental validation against internal and surface thermocouple measurements impedance temperature calibration achieved using drive cycle data 1 introduction monitoring the temperature of li ion batteries during operation is critical for safety and control purposes the conventional approach to temperature estimation is to use numerical electrical thermal models coupled with online measurements of the cell surface temperature and or the temperature of the heat transfer medium 1 figure 1 a 1 e mail robert richardson shi zhao david howey eng ox ac uk using this approach in conjunction with state estimation techniques such as kalman filtering the cell internal tem perature may be estimated with high accuracy 2 3 4 5 however large battery packs may contain several thou sand cells 6 and so the requirement for surface tem perature sensors on every cell represents substantial in strumentation cost as a result ev manufacturers often use fewer temperature sensors than are required to achieve full observability of the pack 7 moreover rapid fluctua tions in internal temperature may not be registered by sur face mounted temperature sensors regardless of the sam pling frequency this may mean thermal runaway cannot be detected since associated timescales are often shorter than those associated with heat conduction through the cell 8 consequently surface mounted temperature sen sors even when used with a thermal model may be insuf ficient to track internal temperature or predict thermal runaway one approach to overcome these problems is to embed flexible thin film micro temperature sensors within the cell to enable in situ internal temperature measure ment 9 10 11 12 13 whilst this has some obvious advantages the additional manufacturing and instrumen tation requirements would significantly increase the cost and complexity of the system an alternative approach to temperature estimation uses electrochemical impedance spectroscopy eis measure preprint submitted to journal of power sources april 18 2018 ar x iv 1 60 6 01 78 6 v 1 cs s y 6 j un 2 01 6 model tsensor eis eis model a b c conventional method model temperature sensor output 1 d t r 2 d t r z impedance based method itd sensor only output hybrid method model itd sensor output 1 d t r 2 d t r z t figure 1 schematic of approaches to battery temperature monitor ing a conventional approach b impedance based approach and c the hybrid approach used in the present study ments at one or several frequencies to directly infer the internal cell temperature 14 15 16 17 18 19 20 21 22 figure 1 b this exploits the fact that impedance is a function of the cell internal temperature for brevity we refer to the use of impedance to infer information about the internal temperature as impedance temperature detec tion itd itd has promise for practical applications since methods capable of measuring eis spectra using ex isting power electronics in a vehicle or other applications have been developed 23 most itd studies assume the internal temperature is uniform 14 15 or explicitly ac knowledge that the impedance measurement alone only predicts the average internal temperature 16 our re cent work showed that itd could be used in conjunction with a thermal model in a hybrid itd based state esti mation scheme to enable estimation of the temperature distribution of the cell 19 figure 1 c the method is therefore analogous to the conventional state estimation method but the measurement input consists of itd rather than a surface temperature measurement however that work relied on the assumption of 1 d conditions which are unlikely to arise in all in situations in the present paper we extend the itd approach to problems involving 2 d thermal dynamics using the low order thermal model presented in part i 2 impedance based temperature sensing the electrochemical impedance z z jz of lithium ion cells is a function of temperature state of charge soc and state of health soh within an appro priate frequency range however the dependence on soc and soh is negligible and the impedance can thus be used to infer information about the cell temperature previous itd studies have used as a temperature dependent param eter tdp the real part of the impedance at a specific frequency 19 16 the imaginary part of the impedance at a specific frequency 21 the phase shift at a specific fre quency 14 15 and the intercept frequency 18 the issue of which tdp and excitation frequency are most suitable for temperature inference is still an open question with various arguments in favour of each 22 24 in the present study we use the imaginary part of the impedance at f 215 hz as the tdp since this was found to give supe rior results to the real part for the studied cell however in principle the method is not limited to this option and could also be applied using any tdp the principle of operation of itd is to relate the cell impedance to the mean 2 cell temperature by a polynomial fit z a 1 a 2 t a 3 t 2 1 where a 1 a 2 and a 3 are the constant polynomial coeffi cients in our previous work the coefficients of the polynomial fit were identified via offline impedance measurements at multiple uniform temperatures 19 however here we introduce an improved calibration technique which uses data from a single drive cycle see section 6 3 this greatly reduces the time required for calibration since it overcomes the need for cell thermal equalization at multi ple temperatures finally the principle of operation of the hybrid itd based state estimation method is to use itd as the mea surement input to a state estimator in conjunction with the 2 d thermal model presented in the part i of this pa per 26 3 overview of hybrid method an overview of the process is shown in figure 2 and described below offline the cell dimensions jelly roll inner radius rin outer radius rout and height h are measured and there fore known a priori the thermal properties density specific heat capacity cp and radial conductivity kr are available from the literature 27 and therefore known a priori the remaining thermal properties axial conduc tivity kz and the convection coefficients on the left end hl right end hr and curved surface ht are then esti mated using a recursive least squares fitting algorithm see section 6 2 specifically the thermal model is simulated using experimental current and voltage data vexp iexp from a parameterization drive cycle and the temperatures at four locations t 1 t 2 t 3 and t 4 are compared with their corresponding thermocouple measurements the pa rameterised model is then used to fit the impedance coef ficients see section 6 3 specifically the predicted mean 2 note that since the impedance temperature relationship is non linear as demonstrated in 25 the impedance is not strictly indica tive of the volume average temperature but rather it is related to an eis based volume average temperature as defined in 19 however our results 19 and those of others 16 showed that the error intro duced by the assumption that the impedance is directly related to t is negligible provided the temperature gradients are not too large hence for simplicity this non linearity is neglected in this case 2 lsq fit impedance offline online z exp 2 d thermal model v i eis z predictlsq fit thermal meas update kz hl hr ht rin rout h cp kr z meas t 1 exp t 2 exp t 3 exp t 4 exp kz init hl init hr init ht init vexp iexp t r z kz hl hr ht a 1 a 2 a 3 figure 2 process flowchart of the itd based state estimation method temperature t from the model is paired with the corre sponding measured impedance value z at each sample a second order polynomial fit is then applied to the re sulting impedance temperature data thus identifying co efficients a 1 a 2 a 3 finally the known and identified thermal parameters and the identified impedance coeffi cients are provided to the online thermal model online the thermal model section 4 2 uses online measurements of the voltage and current v i to predict the heat generation 2 d temperature distribution and cell imaginary impedance at each time step this is compared to the measured imaginary impedance which is used to update the state estimate of the model via an extended kalman filter algorithm ekf section 4 3 4 theory 4 1 problem definition the model consists of the transient 2 d energy conserva tion equation in cylindrical coordinates heat generation is assumed to be uniform in space but time dependant the multi layer structure of the battery is treated as a ho mogeneous solid with anisotropic thermal conductivity in the radial and axial directions the temperature variation in the azimuthal direction is neglected convective heat transfer is assumed to occur at the outside surfaces and there is zero convection at the inner annulus of the jelly roll i e at the central mandrel the convection coefficient of the ambient air may be different at each sur face although its free stream temperature is assumed to be uniform throughout the chamber a schematic of the model is shown in figure 3 the model is governed by the following 2 d boundary value problem 28 cp t t kr 2 t r 2 kr r t r kz 2 t z 2 q 2 where t is time and r and z are the position coordinates in the radial and axial directions respectively the functions r r out r in h t r z q t ht t hr t hl z t 1 t 2 t 3 t 4 figure 3 schematic of cylindrical cell geometry for the thermal model showing red different convection coefficients at each surface and blue locations of model outputs corresponding to thermocouple sensor locations t r z t and q t are the temperature distribution and volumetric heat generation rate respectively the param eters and cp are the density and specific heat capacity respectively and kr and kz are the anisotropic thermal conductivities in the r and z directions the boundary conditions are given by t r hr kr t t at r rout 3 a t r 0 at r rin 3 b t z ht kz t t at z h 3 c t z hb kz t t at z 0 3 d where t is the free stream air temperature of the cham ber and h t r and l are the convection coeffi 3 cients at the top right and left surfaces note that the convection coefficient at the bottom surface is set to zero since this corresponds to the inner radius of the cell jelly roll which is not exposed to cooling ht corresponds to the curved surface of the cell whilst hl and hr correspond to left and right ends of the cell note that the placement of the heat sink see later results in an increased value of hl as in our previous work 19 we consider only ohmic heat generation given by q i v uocv 4 the entropic heat is neglected because i the net reversible heat would be close to zero when the cell is operating in hev mode and ii the hev drive cycles employed in this study operate the cell within a small range of soc 47 63 and hence the entropic heat is small 1 the heat generation is assumed to be uniformly distributed throughout the cell volume hence the volumetric heat gen eration is given by q q vb 5 where vb is the cell volume 4 2 spectral galerkin model the above problem can be simulated using the spectral galerkin approach described in part i of this paper the model can be expressed in state space form ex ax bu 6 y cx te 7 where the states and the state matrices are as defined in part i and the model input is u q t 1 t four tem perature outputs are chosen corresponding to the positions t 1 t r rin z h 2 t 2 t r rout z 0 t 3 t r rout z h 2 and t 4 t r rout z h see figure 3 these outputs were chosen to match the thermocouple measurements in the experimental setup as described in the following section lastly the cell imaginary impedance at the selected fre quency is also calculated as an output this is obtained from the mean temperature using eq 1 t is itself a func tion of the model states x as described in the companion paper hence an expression for the impedance as a func tion of the cell states is obtained z f x 8 the computed impedance is used as the measurement in put in the state estimation algorithm described next 4 3 state estimation the state estimation consists of an extended kalman filter ekf for estimating the temperatures at each of the four thermocouple locations with the cell impedance as measurement input the ekf is equivalent to that employed in 19 for the 1 d case except that here it is applied to the 2 d sg model we firstly modify eq 6 by rewriting it as an explicit state space model in discrete time xk 1 a xk b uk vk 9 where a and b are system matrices in the discrete time domain given by a e e 1 a t 10 b e 1 a 1 a i e 1 b 11 where t is the sampling time of 1 s we then set the impedance as the model output yk f xk nk 12 where f xk is the non linear function relating the state vector to the impedance measurement i e eq 8 and vk and nk are the process and measurement noise respec tively their corresponding covariance matrices are rv and rn note that although the impedance is the model output for the purpose of the ekf algorithm the temper atures at each of the four thermocouple locations are also computed from the identified states at each time step for validation against the thermocouple measurements the time update processes are then given by x k a x k 1 b uk 1 13 pxk a pxk 1 a t rv 14 where x k and x k are the a priori and a posteriori es timates of the state and pxk and pxk 1 are the corre sponding error covariances since the relationship between impedance and the cell state is non linear the measure ment model must be linearised about the predicted obser vation at each measurement the measurement update equations are kxk p x k hxk t hxk p x k h x k t rn 1 15 x k x k k x k zk f x k 16 pxk i k x kh x k p x k 17 where kxk is the kalman gain for the state and h x k is the jacobian matrix of partial derivatives of f with respect to x hxk f xk xk xk x k 18 the above algorithm can be simplified to a standard kalman filter kf by omitting the linearisation step eq 18 and replacing f in eqs 12 and 16 with an appro priate linear operator such a kf is applied later using the surface temperature t 3 as measurement input for com parison with the ekf using z 4 5 experimental 5 1 setup experiments were carried out with a 4 4 ah cylindrical cell a 123 model ahr 32113 ultra b with lifepo 4 pos itive electrode and a graphite negative electrode a large form factor cell was used in order to ensure measurable 2 d effects the properties of the cell are given in ta ble 1 the cell was fitted with four thermocouples three on the surface and another inserted into the core via a hole which was drilled in the positive electrode end the thermocouple locations correspond to the model output lo cations described previously cell cycling and impedance measurements were carried out using a biologic hcp 1005 potentiostat booster the impedance was measured us ing galvanostatic impedance spectroscopy geis with a 200 ma peak to peak perturbation current the environ mental temperature was controlled with a votsch vt 4002 thermal chamber the chamber includes a fan which runs continuously at a fixed speed during operation photos of the test equipment and a schematic of the experimental setup are shown in figure 4 two different cooling configurations were tested see figure 4 d in config 1 the right end and entire curved surface of the cell are thermally insulated and a heat sink fixed to the left end an additional auxiliary fan is placed inside the chamber as shown in figure 4 b in this case both the built in chamber fan and the auxiliary fan run continuously throughout the duration of the experiments this setup is designed to achieve maximum cooling from the left end of the cell heat sink whilst minimising radial heat transfer in config 2 only the right end of the cell is insulated and the auxiliary fan is switched off this setup allows for greater radial heat flux table 1 properties of the lithium ion cell used for validation model a 123 ahr 32113 anode material graphite cathode material lifepo 4 nominal voltage 3 3 v nominal capacity 4 4 ah jelly roll length h 100 mm jelly roll outer radius rout 16 mm jelly roll inner radius rin 1 mm 5 2 procedure full spectrum impedance the procedure described here applies to the results pre sented in section 6 1 in order to verify that the impedance at the selected frequency was independent of soc full spectrum impedance measurements were carried out at a uniform cell temperature of 10 c over a range of 10 90 soc in intervals of 20 3 the eis frequency range 3 the setup of config 2 was used for the full spectrum impedance measurements although note that the choice between config 1 and spanned 5 khz to 0 1 hz with 10 frequencies per decade and 3 x averaging the cell capacities at each tempera ture were first determined with a constant current constant voltage cccv charge discharge the soc was then ad justed to the required values by drawing a 1 c current at each soc the cell was allowed to rest to ensure its temperature had equilibrated which typically occurred in less than 2 hrs this was verified when the temperatures registered by the internal and surface thermocouples were within 0 2 c and repeated impedance measurements over a 20 minute period yielded identical results 5 3 procedure validation experiments the procedure described here applies to the results pre sented in sections 6 2 6 4 dynamic experiments were conducted using three different current excitation profiles denoted hev i hev ii and hev iii each cycle was gen erated by looping over different portions of an artemis hev drive cycle and scaling the applied currents to the range 50 a hev i was used to parameterise the thermal model and hev ii and hev iii were used to validate the identified parameters and to demonstrate the temperature estimation technique see section 6 2 the procedure for the experiments was as follows impedance measurements at 215 hz were carried out every 24 s with 4 s pauses before each impedance measurement and the four thermocouple temperatures were also moni tored before each experiment the soc was adjusted to 50 by drawing a 1 c current the temperature of the thermal chamber was set to 8 c in order to maintain the cell within a typical operating range cell temperatures of 20 to 30 c are generally optimal 29 the cell was al lowed to rest until its temperature equilibrated before each test began 6 results and discussion 6 1 full spectrum impedance our earlier work demonstrated independence of the impedance at 215 hz with respect to soc for a 26650 lifepo 4 cell a 123 anr 26650 m 1 a over a range of temperatures from 20 to 45 c since the cell used in the present study is from the same manufacturer and has the same chemistry it was deemed sufficient to verify soc in dependence at a single temperature close to the middle of this range hence the full spectrum impedance tests were carried out at a uniform cell temperature of 10 c over a range of 10 90 soc in intervals of 20 the results are provided in the supplementary material they confirm that the impedance at 215 hz is approximately indepen dent of soc as required 2 for this step is somewhat arbitrary since the chamber and cell temperatures are allowed to equilibrate before each measurement 5 internal thermocouple copper plate heat sink surface thermocouples auxilary fan chamber fan thermal insulation power supply heat sink a b c k 5 kk 1 kkk 15 kk 2 kkk x 4 k x 2 k k 2 k 4 k td su id a u k 5 kk 1 kkk 15 kk 2 kkk 1 k 3 k 2 k td su t powerdsupplyd dimpedance datadacquisitiondmodule core thermocoupled tdu surface thermocouplesd tdndtdndtddu 1 2 3 4 configurationd 2 duninsulated configurationd 1 dinsulated insulation insulation chamber fand onu chamber fand onu auxiliary fand offu auxilary fand onu thermal chamber heatdsink copperdplateu d figure 4 experimental setup a cell drilling procedure b insulated cell config 2 inside thermal chamber c uninsulated cell with heat sink showing thermocouple locations d schematic diagram showing left cell in chamber with cutaway view showing core and jelly roll right the two cooling configurations 6 2 parameterisation and validation the full set of thermal parameters include cp kr kz and the three convection coefficients one on each end and one on the cell curved surface denoted by hl hr and ht see fig 3 however three of these parameters were known a priori from the literature fleckenstein et al 27 identified values for the density the specific heat ca pacity cp and the radial thermal conductivity kr for an identical cell using thermal impedance spectroscopy and so these values are used in the present case hence pa rameterisation is only required to estimate the remaining four parameter values the axial thermal conductivity kz and the three convection coefficients hl hr and ht the measurements from hev i comprising cell current voltage and surface and core temperatures and the cham ber temperature were used for the parameter estimation for both cooling configurations hev i was deliberately chosen for the parameterization since it results in slightly higher cell temperatures than hev ii or hev iii and hence ensures that the polynomial fit is applied using the largest temperature range possible for config 1 all four parameters were identified for config 2 the axial ther mal conductivity kz was assumed known a priori using the identified value from config 1 since kz is the same in each case and hence it was only necessary to identify the three convection coefficient parameters the parameterisation was carried out using fmincon in matlab to minimise the magnitude of the euclidean dis tance between the measured and estimated temperatures for each of the four thermocouples concretely the error between the measured subscript exp and model predic tions subscript m at each time step k is given by k t 1 m k t 2 m k t 3 m k t 4 m k t 1 exp t 2 exp t 3 exp t 4 exp 19 6 and the parameters are identified by arg min nf k 1 k 2 20 where nf is the number of time steps in the cycle table 2 presents the thermal parameters including those known a priori and those identified via parameter isation the convection coefficient values are within the range expected of forced convection air cooling 30 the left coefficient is greatest in both cases as expected due to the presence of the copper heat sink the values of hr and hl are greater in config 1 due to the presence of the auxiliary fan whereas the value of ht is greater in config 2 since the curved surface is uninsulated the value of kz is 55 times greater than kr this is typical of cylin drical cells with wound jelly roll constructions 27 un certainty in the parameter estimation may be attributed to manufacturing variability error in the heat generation calculation due to the omission of entropic heating heat generation in the contact resistances between the cell and connecting wires and or measurement uncertainty in the temperature table 2 thermal parameters for configs 1 and 2 including those known a priori from the literature 27 and those identified using the parameterisation cycle param units config 1 config 2 known id known id kg m 3 2680 2680 cp j kg 1 k 1 958 958 kr w m 1 k 1 0 35 0 35 kz w m 1 k 1 19 3 19 3 hl w m 2 155 98 2 hr w m 2 23 3 7 2 ht w m 2 16 9 56 2 the measured core and surface temperatures subscript exp and the corresponding model predictions subscript m for the parameterised model for config 1 are shown in fig 5 a the model with identified parameters was vali dated against the second current excitation profile hev ii fig 5 b for config 2 hev i was used as the param eterisation cycle and hev iii for validation these results are shown in figures 5 c and 5 d respectively note that for clarity t 4 is omitted from these and subsequent plots since it is very close in value to t 3 the root mean square errors rmse in each case are shown in table 3 the errors in the validation tests are only marginally greater than those in the parameterisation tests indicating that the estimation is satisfactory 6 3 impedance calibration the calibration of the impedance temperature polyno mial coefficients a 1 a 2 and a 3 is achieved as follows the table 3 rms errors in the parameterisation and validation cycles for the two cooling configurations units c sensor config 1 config 2 param validation param validation t 1 0 353 0 659 0 384 0 458 t 2 0 255 0 448 0 213 0 282 t 3 0 245 0 434 0 209 0 279 t 4 0 188 0 310 0 176 0 234 t e m p e ra tu re c 10 15 20 validation t 2 t 3 t 1 time s 0 1000 2000 3000 i a 50 0 50 10 15 20 validation t 3 t 2 t 1 time s 0 1000 2000 3000 50 0 50 10 15 20 25 parameterisation t 1 t 3 t 2 experimental open loop 0 500 1000 1500 2000 2500 50 0 50 t e m p e ra tu re c 10 15 20 25 parameterisation t 1 t 3 t 2 0 500 1000 1500 2000 2500 i a 50 0 50 a b c d figure 5 comparison between measured and predicted temperatures at the thermocouple locations for the parameterisation and valida tion cycles a config 1 parameterisation with hev i b config 1 validation with hev ii c config 2 parameterisation with hev i d config 2 validation with hev iii for clarity t 4 is omitted from these and subsequent plots since it is very close in value to t 3 current voltage data from config 1 hev i is applied to the parameterised model fig 6 a a kf is applied to the model using the surface temperature t 3 as measure ment input 4 the predicted tm output from the kf at each measurement step is paired with the measured z exp value from the hev i experimental data a second or der polynomial fit is then applied to the z exp vs tm data fig 6 b fig 6 shows that a second order fit is capable of closely approximating the measured data it should be noted that an arrhenius fit could also be obtained but the polynomial fit is sufficiently accurate and facilitates faster online computation 6 4 state estimation we now compare the performance of the ekf with that of a kf based on the same thermal model but with t 3 as the measurement input rather than z we chose t 3 for comparison since this is the location of the measurement input used in earlier studies 2 3 19 the initial state 4 note that the open loop model could alternatively have been used here and is sufficient for the purpose of impedance calibration however the kf was applied since it further increases the model accuracy 7 t e m p e ra tu re c 10 15 20 25 hev i insulated t 2 t 3 t 1 experimental kf with t 3 time s 0 500 1000 1500 2000 2500 z m 0 0 5 1 t a temperature c 10 12 14 16 18 20 22 im z 10 4 3 4 5 6 7 8 9 data polynomial fit b figure 6 identification of impedance temperature polynomial fit a parameterisation drive cycle results b resulting polynomial fit of z against t estimate provided to the battery is a uniform tempera ture distribution at 25 c whereas the true initial bat tery state is a uniform temperature distribution at 8 c the covariance matrices are calculated as rn 2 n and rv 2 vdiag 2 2 the first tuning parameter for the ekf is chosen as n 3 10 5 based on the es timated standard deviation of the imaginary impedance measurement the second tuning parameter was chosen as v 5 10 3 by trial and error for the kf with t 3 as measurement input the tuning parameters were chosen as n 5 10 4 c and n 0 05 which are the same values as those used in our previous work 19 figs 7 a c and d f show the results for config 1 and config 2 respectively for each configuration the core and surface temperatures quickly converge to the correct values and are accurately estimated throughout the rest of the excitation profile fig 7 b shows that for the hev iii cycle the ekf and kf underestimate the true temper ature in particular during periods with very low or zero applied currents this error may be a result of a limitation in the thermal model the heat generation term eq 4 only accounts for ohmic heating whereas additional elec trochemical heating may occur due to the relaxation of concentration gradients which would result in continued internal heating after the removal of an applied load 29 this error may be mitigated by the inclusion of an electro chemical heat generation model although this is beyond the scope of the current work figs 7 c and f show 2 d contour plots of the cell at the end of the hev i cycle and hev ii cycle respectively these contour plots are generated by the evaluating the cell temperature on a fine grid throughout the entire r z domain using the thermal model described in part i they show that in each case a significant radial temperature distribution develops within the cell but in configuration 2 a larger axial temperature gradient arises as expected fig 8 shows histogram plots of the errors in the esti mates of t 1 and t 3 in each drive cycle for the ekf with z and the kf with t 3 plots a d apply to config 1 and plots e h apply to config 2 although the errors may include contributions from various sources such as measurement uncertainty variations in ambient temper ature or fan flow rate etc we can distinguish between impedance related and model related errors by consider ing the difference in error arising from the method using impedance measurement input versus surface temperature measurement input in each case the errors are mostly peaked around a zero mean with a standard deviation in the range 0 2 c 0 7 c the rms error in each case is displayed in the top right corner of the plot it can be seen that the kf with t 3 performs slightly better in most cases with a lower offset from the zero mean and a nar rower distribution this is to be expected given the higher accuracy of the thermocouple measurement in particular the kf performs better in the estimate of t 3 which is un surprising since it uses t 3 as a measurement input how ever in general the performance of the ekf is satisfactory and comparable with that of the kf fig 8 e shows that the error distribution for the estimate of t 1 for the hev iii cycle is multi modal there are peaks at 0 2 and 0 5 c this is a manifestation of the errors discussed previously arising from the limitation of the purely ohmic heat generation term we note that the rmse of t 1 in table 3 is larger than that of the other three sensors t 2 t 3 and t 4 this is per haps explained as follows i the parameterization scheme minimizes the error over all four sensors but ii the error in each of the three surface temperatures may be strongly correlated since the temperature gradient in the radial di rection is greater than that in the axial and hence iii the parameterization may be biased towards minimizing the error in the three surface temperatures at the expense of the error in the core it should also be noted that since the uncertainty of the impedance measurement increases as impedance de creases the temperature estimates become more uncer tain at higher temperatures hence the implementation of this technique could be more challenging at higher ambi ent temperature conditions than those studied here this issue was addressed by spinner et al 21 who applied a secondary empirical fit for the upper temperature range to improve accuracy a similar approach could be applied 8 t e m p e ra tu re sh c m 10 15 20 25 30 hev iii hconfigurations 1 m 1350 1400 1450 1500 17 17 5 18 timeshsm 0 500 1000 1500 2000 2500 3000 z wws hm m 0 0 5 1 experimental ekfswithszww ekfswithszww kfswithst 3 measured t e m p e ra tu re sh c m 10 15 20 25 30 hev iishconfigurations 2 m 1900 2000 2100 17 18 timeshsm 0 500 1000 1500 2000 2500 3000 z wws hm m 0 0 5 1 experimental ekfswithszww measured ekfswithszww kfswithst 3 t e m p e ra tu re sh c m 10 15 20 25 30 hev ishconfigurations 2 m 1400 1500 1600 19 20 21 timeshsm 0 500 1000 1500 2000 2500 z wws hm m 0 0 5 1 experimental ekfswithszww measured kfswithst 3 ekfswithszww 10 15 20 25 30 t e m p e ra tu re sh c m hev ishconfigurations 1 m 1400 1450 1500 23 24 0 500 1000 1500 2000 2500 timeshsm 0 0 5 1 z wws hm m experimental ekfswithszww measured kfswithst 3 ekfswithszww a b d e t 1 2 t 3 t t 1 2 t 3 t t 1 2 t 3 t t 1 2 t 3 t t 3 t 1 t 2 t 4 t e m p e ra tu re c 12 14 16 c t 3 t 1 t 2 t 4 f t e m p e ra tu re c 18 20 22 24 figure 7 comparison of temperature measurements against ekf using z and kf using t 3 config 1 a and b time evolution of temperature outputs for hev i and hev iii respectively c 2 d contour plot at the end of the hev i cycle t 2550 s config 2 d and e time evolution of temperature outputs for hev i and hev ii respectively f 2 d contour plot at the end of the hev ii cycle t 3440 s configuration 1 1 0 1 n u m b e r o f p o in ts 0 200 400 600 ekf 0 4 c kf 0 3 c error c 1 0 1 n u m b e r o f p o in ts 0 200 400 600 ekf 0 7 c kf 0 4 c error c 1 0 1 0 200 400 600 800 1000 ekf 0 5 c kf 0 2 c kf with t 3 ekf with z 1 0 1 0 200 400 600 ekf 0 3 c kf 0 2 c b a c d 1 0 1 n u m b e r o f p o in ts 0 100 200 300 400 500 ekf 0 4 c kf 0 4 c error c 1 0 1 n u m b e r o f p o in ts 0 200 400 600 ekf 0 4 c kf 0 4 c error c 1 0 1 0 200 400 600 800 ekf 0 2 c kf 0 2 c kf with t 3 ekf with z configuration 2 1 0 1 0 200 400 600 800 ekf 0 2 c kf 0 1 c f e h g figure 8 error analysis showing the number of errors in the core temperature t 1 or surface temperature t 3 as denoted later in this caption using the kf with surface temperature measurement blue and the ekf with z measurement orange the overal rmse value for each method is shown in the top corner of each plot configuration 1 a hev i t 1 b hev iii t 1 c hev i t 3 d hev iii t 3 configuration 2 e hev i t 1 f hev ii t 1 g hev i t 3 h hev ii t 3 9 using the hybrid method presented here for applications involving higher temperature 7 conclusions itd can be used in conjunction with a thermal model to enable estimation of the spatially resolved temperature distribution of lithium ion battery cells the extension of this method to 2 d conditions represents a significant im provement over earlier work and opens up the possibility of applying this approach to a more general set of condi tions than previously possible for instance the method could be used to monitor the internal temperature of cells in ev hev battery packs which may have various dif ferent cooling configurations moreover it could also be applied using alternative thermal models and or battery geometries to provide robust estimation of the spatially resolved temperature field of batteries in a range of ap plications the calibration of the impedance coefficients using data from a single drive cycle is also a significant improvement over earlier methods the reduced time and effort required for the calibration step makes practical im plementation a feasible goal the accuracy of itd is still slightly inferior to that of conventional methods based on surface thermocouples however the reduction in accuracy may be justified by the concurrent reduction in instrumentation cost complexity the application of this method online in a vehicle is per haps the most important area of future work a recent study has already demonstrated itd for average internal temperature estimation in a vehicle 31 an interesting area for future work could involve applying the hybrid itd approach presented here in an on board setting an important consideration for the practical imple mentation of this approach is the independence of the impedance response to soh whilst such independence has been verified for certain cell chemistries 18 verification for each specific use case would be necessary moreover the accuracy and precision of the impedance measurement will be a crucial factor in on board applications and de vices capable of achieving high accuracy using low cost equipment will become increasingly important acknowledgements this work was funded by a nui travelling scholarship a uk epsrc doctoral training award the foley bejar scholarship from balliol college university of oxford and the rcuk energy programmes s stable net project ref ep l 014343 1 appendix a matlab code for the model described in this pa per is available online at www github com robert richardson ekf impedance 2 d temperature references references 1 c forgez d vinh do g friedrich m morcrette c dela court thermal modeling of a cylindrical lifepo 4 graphite lithium ion battery journal of power sources 195 9 2010 2961 2968 doi 10 1016 j jpowsour 2009 10 105 url http linkinghub elsevier com retrieve pii s 037877530901982 x 2 y kim j b siegel a g stefanopoulou a computationally efficient thermal model of cylindrical battery cells for the estimation of radially distributed temperatures in american control conference acc 2013 washington dc 2013 pp 698 703 url http ieeexplore ieee org xpls abs all jsp arnumber 6579917 3 y kim s mohan s member j b siegel a g ste fanopoulou y ding the estimation of temperature distri bution in cylindrical battery cells under unknown cooling conditions ieee transactions on control system technology 2014 1 10 4 x lin h e perez j b siegel a g stefanopoulou r d anderson m p castanier online parameterization of lumped thermal dynamics in cylindrical lithium ion batteries for core temperature estimation and health monitoring ieee trans control syst technol 21 5 2013 1745 1755 doi 10 1109 tcst 2012 2217143 5 x lin h e perez s mohan j b siegel a g stefanopoulou y ding m p castanier a lumped parameter electro thermal model for cylindrical batteries journal of power sources 257 2014 1 11 doi 10 1016 j jpowsour 2014 01 097 url http linkinghub elsevier com retrieve pii s 0378775314001244 6 a pesaran g h kim m keyser integration issues of cells into battery packs for plug in and hybrid electric vehicles in evs 24 international battery hybrid and fuel cell electric vehicle symposium stavanger norway 2009 7 x lin a g stefanopoulou j b siegel s mohan temper ature estimation in a battery string under frugal sensor allo cation in asme 2014 dynamic systems and control con ference american society of mechanical engineers 2014 pp v 001 t 19 a 006 v 001 t 19 a 006 8 s santhanagopalan p ramadass j z zhang analysis of internal short circuit in a lithium ion cell journal of power sources 194 1 2009 550 557 9 c y lee s j lee m s tang p c chen in situ monitor ing of temperature inside lithium ion batteries by flexible micro temperature sensors sensors 11 10 2011 9942 9950 10 m s k mutyala j zhao j li h pan c yuan x li in situ temperature measurement in lithium ion battery by transferable flexible thin film thermocouples journal of power sources 260 2014 43 49 11 c y lee h c peng s j lee i hung c t hsieh c s chiou y m chang y p huang et al a flexible three in one microsensor for real time monitoring of internal temperature voltage and current of lithium batteries sensors 15 5 2015 11485 11498 12 c y lee s m chuang s j lee i m hung c t hsieh y m chang y p huang flexible micro sensor for in situ monitoring temperature and voltage of coin cells sensors and actuators a physical 232 2015 214 222 13 n martiny a rheinfeld j geder y wang w kraus a jossen development of an all kapton based thin film thermo couple matrix for in situ temperature measurement in a lithium ion pouch cell sensors journal ieee 14 10 2014 3377 3384 14 r srinivasan b g carkhuff m h butler a c bais den instantaneous measurement of the internal temperature in lithium ion rechargeable cells electrochimica acta 56 17 2011 6198 6204 doi 10 1016 j electacta 2011 03 136 15 r srinivasan monitoring dynamic thermal behavior of the car bon anode in a lithium ion cell using a four probe technique j 10 http linkinghub elsevier com retrieve pii s 037877530901982 x http linkinghub elsevier com retrieve pii s 037877530901982 x http dx doi org 10 1016 j jpowsour 2009 10 105 http linkinghub elsevier com retrieve pii s 037877530901982 x http linkinghub elsevier com retrieve pii s 037877530901982 x http ieeexplore ieee org xpls abs all jsp arnumber 6579917 http ieeexplore ieee org xpls abs all jsp arnumber 6579917 http ieeexplore ieee org xpls abs all jsp arnumber 6579917 http ieeexplore ieee org xpls abs all jsp arnumber 6579917 http ieeexplore ieee org xpls abs all jsp arnumber 6579917 http dx doi org 10 1109 tcst 2012 2217143 http dx doi org 10 1109 tcst 2012 2217143 http linkinghub elsevier com retrieve pii s 0378775314001244 http linkinghub elsevier com retrieve pii s 0378775314001244 http dx doi org 10 1016 j jpowsour 2014 01 097 http linkinghub elsevier com retrieve pii s 0378775314001244 http linkinghub elsevier com retrieve pii s 0378775314001244 http dx doi org 10 1016 j electacta 2011 03 136 power sources 198 2012 351 358 doi 10 1016 j jpowsour 2011 09 077 16 j p schmidt s arnold a loges d werner t wetzel e ivers tiffe e measurement of the internal cell temperature via impedance evaluation and application of a new method j power sources 243 2013 110 117 doi 10 1016 j jpowsour 2013 06 013 17 r r richardson p t ireland d a howey battery internal temperature estimation by combined impedance and surface temperature measurement journal of power sources 265 2014 254 261 doi 10 1016 j jpowsour 2014 04 129 url http linkinghub elsevier com retrieve pii s 0378775314006302 18 l raijmakers d danilov j van lammeren m lammers p notten sensorless battery temperature measurements based on electrochemical impedance spectroscopy j power sources 247 2014 539 544 doi 10 1016 j jpowsour 2013 09 005 19 r r richardson d a howey sensorless battery internal temperature estimation using a kalman filter with impedance measurement ieee transactions on sustainable energy 6 4 url http ieeexplore ieee org xpls abs all jsp arnumber 7097077 tag 1 20 j zhu z sun x wei h dai a new lithium ion battery internal temperature on line estimate method based on elec trochemical impedance spectroscopy measurement journal of power sources 274 2015 990 1004 doi 10 1016 j jpowsour 2014 10 182 21 n s spinner c t love s l rose pehrsson s g tuttle expanding the operational limits of the single point impedance diagnostic for internal temperature monitoring of lithium ion batteries electrochimica acta 174 2015 488 493 22 r koch a jossen temperature measurement of large format pouch cells with impedance spectroscopy evs 28 international electric vehicle symposium and exhibition 2015 1 9 23 d a howey p d mitcheson s member v yufit g j of fer n p brandon on line measurement of battery impedance using motor controller excitation ieee trans veh technol 63 6 2014 2557 2566 doi 10 1109 tvt 2013 2293597 24 h beelen l raijmakers m donkers p notten h bergveld an improved impedance based temperature estimation method for li ion batteries ifac papersonline 48 15 2015 383 388 25 y troxler b wu m marinescu v yufit y patel a j mar quis n p brandon g j offer the effect of thermal gradients on the performance of lithium ion batteries journal of power sources 247 2014 1018 1025 26 r r richardson s zhao d a howey on board monitoring of 2 d spatially resolved temperatures in cylindrical lithium ion batteries part i low order thermal modelling arxiv preprint 2016 27 m fleckenstein s fischer o bohlen b ba ker thermal impedance spectroscopy a method for the thermal characteri zation of high power battery cells journal of power sources 223 2013 259 267 28 d w hahn m n ozisik heat conduction john wiley sons 2012 29 t m bandhauer s garimella t f fuller a critical review of thermal issues in lithium ion batteries journal of the elec trochemical society 158 3 2011 r 1 r 25 30 f p incropera d p de witt fundamentals of heat and mass transfer 6 th edition wiley 2007 31 l h raijmakers d l danilov j p van lammeren t j lammers h j bergveld p h notten non zero intercept fre quency an accurate method to determine the integral tem perature of li ion batteries ieee transactions on industrial electronics 63 5 2016 3168 3178 11 http dx doi org 10 1016 j jpowsour 2011 09 077 http dx doi org 10 1016 j jpowsour 2011 09 077 http dx doi org 10 1016 j jpowsour 2013 06 013 http dx doi org 10 1016 j jpowsour 2013 06 013 http linkinghub elsevier com retrieve pii s 0378775314006302 http linkinghub elsevier com retrieve pii s 0378775314006302 http linkinghub elsevier com retrieve pii s 0378775314006302 http dx doi org 10 1016 j jpowsour 2014 04 129 http linkinghub elsevier com retrieve pii s 0378775314006302 http linkinghub elsevier com retrieve pii s 0378775314006302 http dx doi org 10 1016 j jpowsour 2013 09 005 http ieeexplore ieee org xpls abs all jsp arnumber 7097077 tag 1 http ieeexplore ieee org xpls abs all jsp arnumber 7097077 tag 1 http ieeexplore ieee org xpls abs all jsp arnumber 7097077 tag 1 http ieeexplore ieee org xpls abs all jsp arnumber 7097077 tag 1 http ieeexplore ieee org xpls abs all jsp arnumber 7097077 tag 1 http dx doi org 10 1016 j jpowsour 2014 10 182 http dx doi org 10 1016 j jpowsour 2014 10 182 http dx doi org 10 1109 tvt 2013 2293597 1 introduction 2 impedance based temperature sensing 3 overview of hybrid method 4 theory 4 1 problem definition 4 2 spectral galerkin model 4 3 state estimation 5 experimental 5 1 setup 5 2 procedure full spectrum impedance 5 3 procedure validation experiments 6 results and discussion 6 1 full spectrum impedance 6 2 parameterisation and validation 6 3 impedance calibration 6 4 state estimation 7 conclusions