event selected vector field discontinuities yield piecewise differentiable flows samuel a burden s shankar sastry daniel e koditschek shai revzen contents 1 introduction 3 2 preliminaries 4 2 1 notation 4 2 2 piecewise differentiable functions and nonsmooth analysis 5 3 local and global flow 5 3 1 event selected vector fields discontinuities 5 3 2 construction of the piecewise differentiable flow 6 3 2 1 budgeted time to boundary 6 3 2 2 budgeted flow to boundary 7 3 2 3 composite of budgeted time to and flow to boundary 9 3 2 4 construction of flow via composition 10 3 3 piecewise differentiable flow 11 4 time to impact poincar impact map and flowbox 12 4 1 piecewise differentiable time to impact 12 4 2 piecewise differentiable poincar impact map 13 4 3 piecewise differentiable flowbox 14 5 perturbed flow 15 5 1 perturbation of vector fields 15 5 2 perturbation of event functions 17 6 computation 19 6 1 variational equations and saltation matrices 19 6 1 1 cr vector field 19 6 1 2 event selected cr vector field 20 ee dept university of washington seattle wa usa sburden uw edu eecs dept university of california berkeley ca usa sastry eecs berkeley edu ese dept university of pennsylvania philadelphia pa usa kod seas upenn edu eecs dept university of michigan ann arbor mi usa shrevzen eecs umich edu 1 ar x iv 1 40 7 17 75 v 3 m at h d s 2 2 a pr 2 01 5 6 1 3 sampled vector field associated with event selected cr vector field 20 6 1 4 saltation matrix for multiple transition surfaces 21 6 1 5 flow between tangent transition surfaces 22 6 1 6 variational equation for event selected cr vector field 22 6 2 stability of a periodic orbit 23 7 applications 25 7 1 synchronization of first order phase oscillators 25 7 1 1 b derivative of flow in euclidean covering space via saltation matrices 25 7 1 2 b derivative of flow in euclidean covering space via flowbox 26 7 1 3 synchronization via piecewise constant feedback 28 7 2 synchronization of second order phase oscillators 28 7 2 1 b derivative of flow in euclidean covering space 29 7 2 2 synchronization via piecewise constant feedback 30 8 discussion 31 a f derivative formulae for piecewise differentiable flow 33 a 1 budgeted time to boundary 33 a 2 budgeted flow to boundary 34 a 3 composite of budgeted time to and flow to boundary 34 b periodic orbits and b derivative formulae for phase oscillators 35 b 1 synchronization of first order phase oscillators 35 b 2 synchronization of second order phase oscillators 37 c global piecewise differentiable flow 44 d perturbation of differential inclusions 46 abstract we study a class of discontinuous vector fields brought to our attention by multi legged animal locomotion such vector fields arise not only in biomechanics but also in robotics neuroscience and electrical engineering to name a few domains of application under the conditions that i the vector field s discontinuities are locally confined to a finite number of smooth submanifolds and ii the vector field is transverse to these surfaces in an appropriate sense we show that the vector field yields a well defined flow that is lipschitz continuous and piecewise differentiable this implies that although the flow is not classically differentiable nevertheless it admits a first order approximation known as a bouligand derivative that is piecewise linear and continuous at every point we exploit this first order approximation to infer existence of piecewise differentiable impact maps including poincar maps for periodic orbits show the flow is locally conjugate via a piecewise differentiable homeomorphism to a flowbox and assess the effect of perturbations both infinitesimal and non infinitesimal on the flow we use these results to give a sufficient condition for the exponential stability of a periodic orbit passing through a point of multiply intersecting events and apply the theory in illustrative examples to demonstrate synchronization in abstract first and second order phase oscillator models 2 1 introduction we study a class of discontinuous vector fields brought to our attention by multi legged animal locomotion parsimonious dynamical models for diverse physical phenomena are governed by vec tor fields that are smooth except along a finite number of surfaces of discontinuity examples include integrate and fire neurons that undergo a discontinuous change in membrane voltage during a threshold crossing kee 81 hh 95 biz 13 legged locomotors that encounter discon tinuities in net forces due to intermittent interaction of viscoelastic limbs with terrain ale 84 gol 99 hol 06 electrical power systems that undergo discontinuous changes in network topol ogy triggered by excessive voltages or currents his 95 in each of these examples behaviors of interest phase locking kee 81 or local synchronization hh 95 simultaneous touchdown of two or more legs ale 84 gol 99 hol 06 voltage collapse phenomena dl 92 his 95 section ii a 2 occur at or near the intersection of multiple surfaces of discontinuity although analyti cal tools exist to study orbits that pass transversely through non intersecting switching surfaces e g to assess stability ag 58 gri 02 compute first order variations hp 00 wa 12 and re duce dimensionality bur 15 b piecewise defined or hybrid systems that admit simultaneous discrete transitions generally exhibit branching wherein the flow depends discontinuously 1 on initial conditions sim 05 definition 3 11 for instance in the mechanical setting the flow of a lagrangian dynamical system subject to unilateral constraints is generically discontinuous near simultaneous impact events bal 00 section 7 in the case where a vector field is discontinuous across two transversally intersecting surfaces others have established continuity and derived first order approximations of the flow iva 98 db 08 dl 11 biz 13 techniques applicable to arbitrary numbers of surfaces have been derived for the case of pure phase oscillators with perpendicular transition surfaces ms 90 we generalize these approaches to accommodate an arbitrary number of nonlinear transition surfaces that are not required to be transverse and extend a suite of analytical and computa tional techniques from classical smooth dynamical systems theory to the present non smooth setting under the conditions that i the vector field s discontinuities are locally confined to a finite collection of smooth submanifolds and ii the vector field is transverse to these surfaces in an appropriate sense we show that the vector field yields a well defined flow that is lipschitz continuous and piecewise differentiable the definition of piecewise differentiability we employ introduced in rob 87 roc 03 sch 12 implies that although the flow is not classically differen tiable nevertheless it admits a first order approximation the so called bouligand derivative or b derivative sch 12 chapter 3 that is piecewise linear and continuous at every point we exploit this first order approximation to infer existence of piecewise differentiable impact maps includ ing poincar maps for periodic orbits assess the effect of perturbations on the flow and derive a straightforward procedure to compute the b derivative we use these results to give a sufficient condition for the exponential stability of a periodic orbit passing through a point of multiply in tersecting events and apply the theory in illustrative examples to demonstrate synchronization in abstract first and second order phase oscillator models the paper is organized as follows following a brief review of relevant technical background in section 2 we define the discontinuous but piecewise smooth vector fields of interest and show that they yield continuous b differentiable flows in section 3 in section 4 we demonstrate that such flows are continuously conjugate to classical flows leading to results in section 5 establishing their persistence under small perturbations section 6 develops stability results and their applica 1 we note that hybrid state spaces do not possess a natural metric and continuity of the flow depends on the chosen metric this issue is discussed in detail elsewhere bur 15 a sec v a 3 tion to simple oscillator models is given in section 7 the paper concludes with a brief summary in section 8 suggesting the relevance of these results to biological and engineered systems of prac tical interest 2 preliminaries the mathematical constructions we use are standard in the sense that they are familiar to practitioners of applied dynamical systems or optimization theory or both but since this paper represents to the best of our knowledge the first application of some techniques from non smooth analysis to the present class of dynamical systems the reader may be unfamiliar with some of the more recently developed devices we employ thus in this section we briefly review mathematical concepts and introduce notation that will be used to state and prove results throughout this paper and suggest textbook references where the interested reader could obtain a complete exposition 2 1 notation to simplify the statement of our definitions and results we fix notation of some objects in rn 1 rn denotes the vector of all ones and 1 its negative ej is the j th standard euclidean basis vector bn 1 1 n rn is the set of corners of the n dimensional cube we let sign rn 1 1 n be the vectorized signum function taking its values in the euclidean cube s corners i e x rn j 1 n e j sign x 1 xj 0 1 xj 0 1 to fix notation in the following paragraphs we will briefly recapitulate standard constructions from topology differential topology and dynamical systems theory and refer the reader to lee 12 for details if u x is a subset of a topological space then intu x denotes its interior and u denotes its boundary let f x y be a map between topological spaces if u x then f u u y denotes the restriction if v y then f 1 v x x f x v denotes the pre image of v under f given cr manifolds d n we let cr d n denote the set of cr functions from d to n h d is a cr codimension k submanifold of the d dimensional manifold d if every x h has a neighborhood u d over which there exists a cr diffeomorphism h u rd such that h u h 1 y rd yk 1 yd 0 if f cr d n then at every x d there exists an induced linear map df x txd tf x n called the pushforward in coordinates df x is the jacobian linearization of f at x d where txd denotes the tangent space to the manifold d at the point x d globally the pushforward is a cr 1 map df td tn where td is the tangent bundle associated with the manifold d we recall that td is naturally a 2 d dimensional cr manifold when n r we will invoke the standard identification tyn r for all y n and regard df x as a linear map from txd i e an element of the cotangent space t xd into r for every x d we recall that the cotangent bundle t d is naturally a 2 d dimensional cr manifold if u d and f u n is a map then a map f d n is a cr extension of f if f is cr and f u f following lee 12 chapter 8 a possibly discontinuous or non differentiable map f d td 4 is a rough 2 vector field if f idd where td d is the natural projection and idd is the identity map on d a vector field may under appropriate conditions yield an associated flow f d defined over an open subset f r d called a flow domain in this case for every x d the set fx f r x is an open interval containing the origin the restriction fx fx d is absolutely continuous and the derivative with respect to time is dt t x f t x for almost every t fx a flow is maximal if it cannot be extended to a larger flow domain an integral curve for f is an absolutely continuous function i d over an open interval i r such that t f t for almost all t i it is maximal if it cannot be extended to an integral curve on a larger open interval 2 2 piecewise differentiable functions and nonsmooth analysis the notion of piecewise differentiability we employ was originally introduced by robinson rob 87 since the recent monograph from scholtes sch 12 provides a more comprehensive exposition we adopt the notational conventions therein let r n and d rd be open a continuous function f d rn is called piecewise cr if for every x d there exists an open set u d containing x and a finite collection fj u rn j j of cr functions such that for all x u we have f x fj x j j the functions fj j j are called selection functions for f u and f is said to be a continuous selection of fj j j a selection function fj is said to be active at x u if f x fj x we let pcr d rn denote the set of piecewise cr functions from d to rn note that pcr is closed under composition and pointwise maximum or minimum of a finite collection of functions any f pcr d rn is locally lipschitz continuous and a lipschitz constant for f is given by the supremum of the induced norms of the fr chet derivatives of the set of selection functions for f piecewise differentiable functions possess a first order approximation df td trn called the bouligand derivative or b derivative sch 12 chapter 3 this is the content of lemma 4 1 3 in sch 12 we let df x v denote the b derivative of f evaluated along the tangent vector v txd the b derivative is positively homogeneous i e v txd 0 df x v df x v 3 local and global flow in this section we rederive in our present nonsmooth setting the erstwhile familiar fundamental construction associated with a vector field its flow we begin in section 3 1 by introducing the class of vector fields under consideration namely event selected cr vector fields subsequently in section 3 2 we construct a candidate flow function via composition of piecewise differentiable functions finally in section 3 3 we show this candidate function is indeed the flow of the event selected cr vector field 3 1 event selected vector fields discontinuities the flow of a discontinuous vector field f d td over an open domain d rd can exhibit pathological behaviors ranging from nondeterminism to discontinuous dependence on initial con ditions we will investigate local properties of the flow when the discontinuities are confined to a 2 we will constrain the class of vector fields under consideration in section 3 1 but for expediency drop the rough modifier in the sequel 5 finite collection of smooth submanifolds through which the flow passes transversally as formalized in the following definitions definition 1 given a vector field f d td over an open domain d rd and a function h cr u r defined on an open subset u d we say that h is an event function for f on u if there exists a positive constant f 0 such that dh x f x f for all x u a codimension 1 embedded submanifold u for which h is constant is referred to as a local section for f note that if h is an event function for f on a set containing d then necessarily dh 6 0 we will show in section 3 3 that vector fields that are differentiable everywhere except a finite collection of local sections give rise to a well defined flow that is piecewise differentiable this class of event selected vector fields is defined formally as follows definition 2 given a vector field f d td over an open domain d rd we say that f is event selected cr at d if there exists an open set u d containing and a collection hj nj 1 cr u r such that 1 event functions hj is an event function for f on u for all j 1 n 2 cr extension for all b 1 1 n bn with db x u bj hj x hj 0 f intdb admits a cr extension fb u tu note that for any b bn such that intdb the latter condition is satisfied vacuously we let ecr d denote the set of vector fields that are event selected cr at every x d for illustrations of event selected cr vector fields in the plane d r 2 refer to figures 1 and 2 3 2 construction of the piecewise differentiable flow the following constructions will be used to state and prove results throughout the chapter suppose f d td is event selected cr at d by definition there exists a neighborhood u d and associated event functions hj nj 1 cr u r that divide u into regions db b bn by defined by db x u hj x hj bj 0 the boundary of each db is contained in the collection of event surfaces hj nj 1 defined for each j 1 n by hj x u hj x hj for each j 1 n and b bn we refer to the surface hj as an exit boundary in positive time for db if hj db 0 we refer to hj as an exit boundary in negative time if hj db 0 in addition the definition of event selected cr implies that there is a collection of cr vector fields fb u tu b bn c r u tu such that f intdb fb intdb for all b bn 3 2 1 budgeted time to boundary for each b bn with intdb 6 let b fb u be a flow for fb over a flow domain fb r u containing 0 recall that b cr fb u since fb cr u tu each h hj nj 1 is a local section for f and therefore a local section for fb as well this implies fb is transverse to h more precisely fb 6 t h thus the implicit function theorem lee 12 theorem c 40 implies there exists a cr time to impact map hb u h b r defined on an open set uhb d containing such that x uhb hb x x fb and b hb x x h 2 6 the collection of maps hb b bn are jointly defined over the open set ub n j 1 u hj b note that ub is nonempty since ub any x ub can be taken to any h hj nj 1 by flowing with the vector field fb for time hb x r a useful fact we will recall in the sequel is that if y b b x x then d hb x dh y dx b t x dh y fb y 3 this follows from hs 74 11 2 we now define functions b b r ub r that specify the time required to flow to the exit boundary of db in forward or backward time respectively without exceeding a given time budget t x r ub b t x max 0 min t hj b x bj 0 n j 1 t x r ub b t x min 0 max t hj b x bj 0 n j 1 4 since b b are obtained via pointwise minimum and maximum of a finite collection of c r func tions we conclude b b pcr r ub r see figure 1 for an illustration of the component functions of b in a planar vector field in the sequel we will require the derivative of b with respect to t and x in general this can be obtained via the chain rule sch 12 theorem 3 1 1 if we define b ub r using the convention min by x ub b x min hj b x bj 0 n j 1 5 then we immediately conclude that for all t x r ub such that b x 6 t 6 0 the forward time budgeted time to boundary b is classically differentiable and d b t x 0 0 d t 0 1 0 d 0 t b x 0 d hb x b x t 6 where in the third case h hj nj 1 is such that hb x b x to compute d b t x one may simply use the formula in 6 applied to the vector field f full details are provided in appendix a 1 3 2 2 budgeted flow to boundary by composing the flow b with the budgeted time to boundary functions b b we now construct functions that flow points up to the exit boundary of db in forward or backward time over domains v b t x r ub b t x x fb v b t x r ub b t x x fb note that v b v b are open since b b are continuous and nonempty since 0 v b v b for each b bn define the functions b v d b v d by t x v b b t x b b t x x t x v b b t x b b t x x 7 7 f x h 1 h 2 x f 1 1 x x f 1 1 x x f 1 1 x x f 1 1 x 1 0 00 0 800 0 600 0 60 0 0 400 0 200 0 000 0 200 0 4000 6000 800 1 000 h 1 1 1 x h 1 h 2 1 200 1 000 0 800 0 600 0 400 0 200 0 000 0 200 0 400 0 600 0 800 1 000 h 2 1 1 x h 1 h 2 1 200 1 0 00 0 8 00 0 600 0 600 0 400 0 200 0 0000 200 0 4000 6000 800 1 000 min h 1 1 1 x h 2 1 1 x h 1 h 2 figure 1 illustration of a vector field f d td that is event selected cr at d r 2 the functions hj 1 1 2 j 1 specify the time required to flow via the vector field f 1 1 to the surface hj the pointwise minimum min hj 1 1 x 2 j 1 is used in the definition of 1 1 in 4 clearly b pcr v b d and b pcr v b d since they are obtained by composing pcr functions sch 12 4 1 loosely speaking the function b coincides with b for pairs t x that do not cross the forward time exit boundary of db yet unlike b it is the identity stationary flow over the remainder of its domain more precisely for t 0 and for values of t b x the function b t x is constant and hence the derivative with respect to time dt b t x 0 while for t 0 b x we have b t x b t x and hence dt b t x fb b t x now fix x db choose a bn b and for t r define t a t min hja b t x aj 0 n j 1 applying the conclusions from the preceding paragraph with t r the composition a t b t x is classically differentiable with respect to both t and t almost everywhere furthermore we can deduce that the derivative of the composition with respect to t is fb b t x when t 8 0 b x and zero where it is otherwise defined similarly the derivative with respect to t is fa a t b t x when t 0 t a t and zero where it is otherwise defined if we impose the relationship t t b t x we have t 0 for any t 0 b x the composition a t b t x b t x follows the flow for fb from x toward but never passing the exit boundary of db then follows the flow of fa from b t x toward the exit boundary of da in the sequel we will require the derivative of b with respect to t and x in general this can be obtained via the chain rule sch 12 theorem 3 1 1 if we define b ub r as in 5 then we immediately conclude that for all t x r ub such that b x 6 t 6 0 the forward time flow to boundary b is classically differentiable and d b t x 0 d 0 d d t 0 fb b t x dx b t x 0 t b x 0 d t x b x t 8 where in the third case t x 0 fb b b t x x d h b x dx b b t x x and h hj nj 1 is such that hb x b x to compute d b t x one may simply use the formula in 8 applied to the vector field f full details are provided in appendix a 2 3 2 3 composite of budgeted time to and flow to boundary define b v b r d b v b r d by t x v b b t x t b t x b t x t b t x b b t x x t x v b b t x t b t x b t x t b t x b b t x x 9 clearly b pcr v b r d and b pcr v b r d intuitively the second component of the b b functions flow according to fb up to exit boundaries of db in forward or backward time respectively while the first component deducts the flow time t b t x from the total time budget t these functions satisfy an invariance property t x v b 0 ub b t x t x t x v b 0 ub b t x t x 10 we now combine 6 and 8 to obtain the derivative of b for all t x r ub such that b x 6 t 6 0 d b t x 1 0 d 0 d id t 0 0 0 d fb b t x dx b t x 0 t b x 1 d hb x 0 d t x b x t 11 where in the third case t x fb b b t x x d h b x dx b b t x x and h hj n j 1 is such that hb x b x to compute d b t x one may simply use the formula in 8 applied to the vector field f full details are provided in appendix a 3 9 d 1 1 x f 1 1 x d 1 1 x f 1 1 x d 1 1 x f 1 1 x h 1 h 2 y y 1 1 y 1 1 y 1 1 t y z z 1 1 z 1 1 t z figure 2 illustration of a vector field f d td that is event selected cr near d r 2 the vector field is discontinuous across the cr codimension 1 submanifolds h 1 h 2 d for each b bn 1 1 1 1 1 1 1 1 if intdb 6 then the vector field restricts as f intdb fb intdb where fb ub tub is a smooth vector field over a neighborhood ub d an initial condition z d 1 1 flows in forward time to t y d 1 1 through z 1 1 h 1 h 2 an initial condition y d 1 1 flows in backward time to t y d 1 1 through y 1 1 h 1 and y 1 1 h 2 3 2 4 construction of flow via composition consider now the formal composition 2 1 b 1 b 1 b 1 b 12 where 2 r d d is the canonical projection and 1 b 1 denotes composition in lexicographic order similarly 1 b 1 denotes composition in reverse lexicographic order the set 1 d r d is open since is continuous and nonempty since combining 10 and 12 implies 0 therefore there exist open neighborhoods j r of 0 and v d of such that f j v 1 d clearly pcr f d since it is obtained by composing pcr functions its derivative can be computed by applying the chain rule sch 12 theorem 3 1 1 alternatively it can be obtained for almost all t x f as a product of the appropriate matrices given in 11 91 the derivative with respect to time has a particularly simple form almost everywhere as we demonstrate in the following lemma lemma 1 time derivative of flow if the vector field f d td is event selected cr at d then for almost all t x f the flow pcr f d defined by 12 is differentiable with respect to time and dt t x f t x 13 proof choose x d such that 0 x f we will show that fx is classically differentiable for almost all times t fx let t inf fx t supfx so that 0 fx t t we construct a partition of 0 t as follows for each b bn let t b x b a b a t x where the composition is over all a bn that occur before b lexicographically refer to figure 2 for an illustration of the sequence yb b bn generated by an initial condition y d 1 note that 10 t t b b bn is lexicographically non decreasing and t 1 1 t 1 x 1 defining the interval jb t t b t t b b t b x b we have 0 t b bn j b and int j a int j b for all a bn b observe that t int j b t x 2 b t t t b x b intdb where the condition is vacuously satisfied if int j b therefore for all t int j b the piecewise differentiable function is classically differentiable with respect to time at t x and we have dt t x d 2 dt b t t t b x b fb 2 b t t t b x b f 2 b t t t b x b f t x applying an analogous argument in backward time we conclude that dt t x f t x for almost all t t t fx since 0 x f was arbitrary the lemma follows 3 3 piecewise differentiable flow we now show that the piecewise differ entiable function pcr f d defined in 12 is in fact a flow for the discontinuous vector field f see figure 2 for an illustration of this flow theorem 1 local flow suppose the vector field f d td is event selected cr at d then there exists a flow f d for f over a flow domain f r d containing 0 such that pcr f d and t x f t x x t 0 f s x ds 14 proof we claim that pcr f d from 12 satisfies 14 applying the fundamental theorem of calculus sch 12 proposition 3 1 1 in conjunction with lemma 1 and positive homogeneity of the derivative 13 we find t x 0 x 1 0 d tu x t 0 du x t 0 d s x t 0 1 t ds x t 0 dt s x ds x t 0 f s x ds if the vector field f d td is event selected cr at every point in the domain d we may stitch together the local flows obtained from theorem 1 local flow to obtain a global flow 11 corollary 1 global flow if f ecr d then there exists a unique maximal flow pcr f d for f this flow has the following properties a for each x d the curve x fx d is the unique maximal integral curve of f starting at x b if s fx then f s x fx s t s t fx c for each t r the set dt x d t x f is open in d and t dt d t is a piecewise cr homeomorphism with inverse t proof this follows from a straightforward modification of the analogous theorem 9 12 in lee 12 simply replace all occurrences of the word smooth with pcr we recapitulate the argument in appendix c if a vector field is event selected cr at every point along an integral curve the following lemma shows that it is actually cr at all but a finite number of points along the curve lemma 2 ecr implies cr almost everywhere suppose the vector field f d td is event selected cr at every point along an integral curve i d for f over a compact interval i r then there exists a finite subset i such that f is cr on i proof let i be the set of points where f fails to be cr if then since i is compact there exists an accumulation point i since f is event selected cr at there exists 0 such that f is cr at every point in the set b i but this violates the existence of an accumulation point therefore remark 1 one of the major values of theorem 1 local flow lies in the fact that piecewise differentiable functions possess a first order approximation called the bouligand derivative as de scribed in section 2 2 this bouligand derivative or b derivative is weaker than the classical fr chet derivative but significantly stronger 3 than the directional derivative the b derivative of the composition 12 can be computed by applying the chain rule sch 12 theorem 3 1 1 4 time to impact poincar impact map and flowbox we now leverage the fact that event selected cr vector fields yield piecewise differentiable flows to obtain useful constructions familiar from classical smooth dynamical systems theory using an inverse function theorem rs 97 corollary 20 we construct time to impact maps for local sections in section 4 1 we then apply this construction to infer the existence of piecewise differentiable poincar impact maps associated with periodic orbits in section 4 2 and piecewise differentiable flowboxes in section 4 3 4 1 piecewise differentiable time to impact we begin in this section by constructing piecewise differentiable time to impact maps 3 for instance the b derivative enables constructions like the fundamental theorem of calculus sch 12 propo sition 3 1 1 and inverse function theorem rs 97 corollary 20 not enjoyed by the directional derivative 12 theorem 2 time to impact suppose the vector field f d td is event selected cr at d if cr u r is an event function for f on an open neighborhood u d of then there exists an open neighborhood v d of and piecewise differentiable function pcr v r such that x v x x 15 where pcr f d is a flow for f and 0 f proof theorem 1 local flow ensures the existence of a flow pcr f d such that f r d contains 0 let and note that there exist open neighborhoods t r of 0 and w d of such that pcr t w r we aim to apply an implicit function theorem to show that s x has a unique piecewise differentiable solution s x near 0 to do so we need to establish the function is completely coherently oriented with respect to its first argument specializing definition 16 in rs 97 a sufficient condition for to be completely coherently oriented with respect to its first argument at 0 is that the scalar derivatives d j 0 1 0 of all essentially active selection functions j j ie 0 have the same sign lemma 1 implies the time derivatives of all essentially active selection functions for at 0 are contained in the collection fb b bn db 6 where fb b bn are the cr vector fields that define f near since is an event function for f there exists f 0 such that b bn d fb f 0 this implies is completely coherently oriented with respect to time at 0 therefore we may apply corollary 20 in rs 97 to obtain an open neighborhood 0 v r and a piecewise differentiable function pcr v r such that 15 holds corollary 2 time to impact suppose the vector field f d td is event selected cr at every point along an integral curve 0 t d for f if cr u r is an event function for f on an open set u d containing t then there exists an open neighborhood v d of 0 and piecewise differentiable function pcr v r that satisfies 15 proof corollary 1 ensures the existence of a flow pcr f d such that f r d contains 0 t 0 let pcr v r be the time to impact for obtained by applying corollary 2 at t t 0 then with v x d t x v noting that v is nonempty since 0 v and open since is continuous the function v r defined by x t t x is piecewise cr and satisfies 15 4 2 piecewise differentiable poincar impact map we now apply theorem 2 time to impact in the important case where the integral curve is a periodic orbit to construct a piecewise differentiable poincar impact map definition 3 an integral curve r d is a periodic orbit for the vector field f d td if there exists t 0 such that t 0 and dt s 6 0 for all s 0 t the minimal t 0 for which t 0 is referred to as the period of and we say that is a t periodic orbit for f we let r denote the image of 13 suppose the vector field f d td is event selected cr at every point along a t periodic orbit for f then given a local section d for f that intersects r at corollary 2 implies there exists a piecewise differentiable time to impact pcr v r defined over an open neighborhood v d of such that t with v we let v be the piecewise differentiable impact map defined by x v x x x 16 theorem 3 poincar map suppose the vector field f d td is event selected cr at every point along a periodic orbit for f then given a local section d for f that intersects r at there exists an open neighborhood v d of such that the impact map 16 restricts to a piecewise differentiable poincar map p pcr s on s v proof without loss of generality assume 0 let t be the period of apply theorem 2 time to impact to 0 t to obtain an open set v d containing 0 and a piecewise cr impact time map pcr v r and define v as in 16 then with s v the restriction p s is a piecewise cr poincar map for since the poincar map p s yielded by theorem 3 poincar map is piecewise differentiable it admits a first order approximation its bouligand derivative dp ts t that can be used to assess local exponential stability of the fixed point p this topic will be investigated in more detail in section 6 2 4 3 piecewise differentiable flowbox theorem 2 time to impact enables us to easily derive a canonical form for the flow near an event selected vector field discontinuity theorem 4 flowbox suppose the vector field f d td is event selected cr at d and let f d be the flow obtained from theorem 1 local flow then there exists a piecewise differentiable homeomorphism pcr v w between neighborhoods v d of and w rd of 0 such that x v t fx t x x te 1 where e 1 rd is the first standard euclidean basis vector proof let cr u r be an event function for f on a neighborhood u d that is linear 4 theorem 2 time to impact implies there exists a piecewise differentiable time to impact map pcr v r on a neighborhood v d of such that x v x x i e x x lies in the codimension 1 subspace 1 define v r by x v x x x x 17 clearly pcr v r and hence is continuous furthermore it is clear that is injective since i x y implies x and y lie along the same integral curve and ii distinct points 4 existence of a linear event function is always guaranteed for instance take the linear approximation at of any nonlinear event function for f 14 along an integral curve pass through at distinct times it follows from brouwer s open mapping theorem bro 11 hat 02 that the image w v is an open subset of rd this implies is a homeomorphism between v andw with r r d denoting the canonical inclusion the inverse of pcr v w is w pcr w v thus is a pcr homeomorphism finally using the semi group property of the flow and the fact that t x x t for all x v t fx x v t fx t x t x t x t x t x x t t x t x x x x te 1 thus the flow is conjugate via a piecewise differentiable homeomorphism to a flowbox hs 74 11 2 lee 12 theorem 9 22 5 perturbed flow in this section we study how the flow associated with an event selected cr vector field varies under perturbations to both the smooth vector field components in section 5 1 and the event functions in section 5 2 5 1 perturbation of vector fields suppose f d td is event selected cr at d with respect to the components of h cr d rn then by definition 2 there exists u d containing such that for each b bn either intdb or db u and f intdb admits a cr extension fb u tu we note that f is determined on u up to a set of measure zero from h and the function f cr b bn u b bn tu defined by f b u fb u note that we regard cr b bn u b bn tu as a vector space under pointwise addition of tangent vectors and the norm f cr b bn f b u cr 18 thus in the sequel we consider perturbations to event selected cr vector fields in the space cr b bn u b bn tu theorem 5 vector field perturbation let f cr b bn d b bn td h cr d rn deter mine an event selected cr vector field at d r 1 then for all 0 there exists 0 such that for all f bcr f a pairing h with the perturbed vector field f determines an event selected cr vector field at b the perturbed flow f d obtained by applying theorem 1 local flow to this perturbed vector field satisfies bc 0 on f f and 0 f f 15 c there exists a piecewise differentiable homeomorphism pcr u u defined between neigh borhoods u u d of such that b bc 0 idb and we have t x t x 19 for all t x r rd such that x u t fx f x and t x u proof since f is event selected cr with respect to h at there exists f 0 such that for all x sufficiently close to every component of dh x f x is bounded below by f then so long as 0 f every component of dh x f x is bounded below by f 0 establishing claim a we claim that b follows from fil 88 theorem 1 in 8 of chapter 2 which we repro duce as theorem 8 differential inclusion perturbation in appendix d indeed given any g cr b bn d b bn td for which g h determines an event selected c r vector field define a set valued map g d 2 td as follows x d g x conv g b d x b bn x db 20 at any x d it is clear that g x is nonempty bounded closed and convex furthermore it is clear that g is upper semicontinuous at x in the sense defined in section 2 2 therefore the map g satisfies assumption 1 differential inclusion basic conditions over the domain of the flow for g it is straightforward to verify that solutions to the differential inclusion x g x coincide with those of the differential equation x g x since the derivatives of the absolutely continuous solution functions agree almost everywhere claim b then follows by applying theorem 8 differential inclusion perturbation to f determined from f by 20 and f determined from f bcr f by 20 for claim c apply corollary 4 flowbox to and to obtain pcr v w and pcr v w such that x v v t fx f x t x x t e 1 t x x t e 1 21 then with u 1 w u 1 u both sets are nonempty since u u and open since and are homeomorphisms the piecewise differentiable homeomorphism 1 u pcr u u provides conjugacy between and for all t x r rd such that x u t fx f x and t x u t x 1 t x 1 x t e 1 1 1 x t e 1 1 x t e 1 t x 22 we now wish to choose 0 sufficiently small to ensure b bc 0 idb recalling from 17 x v x x x x 23 16 where pcr v r is the time to impact map for the event surface used to define we have x x x x x x x x x x x x x x x x x x 1 l x x 24 where l 0 is a lipschitz constant for on b 0 claim b ensures bc 0 for any desired 0 and we have restricted to x v v b for which x x f and x x f applying rs 97 lemma 9 theorem 11 to we conclude that 0 can be chosen sufficiently small to ensure bc 0 for any desired 0 therefore 1 l can be made arbitrarily small in 24 hence we may apply rs 97 theorem 11 to choose 0 sufficiently small to ensure 1 bc 0 1 for any desired 0 thus 0 may be chosen sufficiently small to ensure b u and x x 1 x 1 x 25 whence b bc 0 idb this completes the proof of claim c 5 2 perturbation of event functions it is a well known fact that the solution of n equations in n unknowns generically varies con tinuously with variations in the equations this observation provides a basis for studying struc tural stability of the flow associated with event selected cr vector fields when there are exactly n d dimd event functions since for a collection of event functions hj dj 1 cr d r whose composite h cr d rd satisfies detdh 6 0 the existence of a unique intersection point and the set of possible transition sequences undertaken by nearby trajectories are unaffected by a suf ficiently small perturbation h of h we now combine this observation with the previous theorem subsequently we will present an embedding technique that enables immediate generalization to cases where dh is not invertible whether because n d n d or n d and detdh 0 theorem 6 event function perturbation let f cr b bn d b bn td h cr d rd determine an event selected cr vector field at d and suppose dh is invertible r 1 then for all 0 sufficiently small there exists 0 such that for all f bcr f h bc r h a there exists a unique b such that h 0 and h x 6 0 for all x b b pairing h with the perturbed vector field f determines an event selected cr vector field at c the perturbed flow yielded by theorem 1 local flow f d satisfies bc 0 on f f 6 d there exists a piecewise differentiable homeomorphism pcr u u defined between neigh borhoods u u d containing such that b bc 0 idb and we have t x t x 26 for all t x r rd such that x u t fx f x and t x u 17 proof of theorem 6 event function perturbation smooth dependence of the intersection point follows from the implicit function theorem abr 88 theorem 2 5 7 since cr functions over compact domains comprise a banach space hir 76 chapter 2 1 specifically if h cr d rn satisfies h 0 for some d and dh is invertible 5 then there exists 0 and cr b h b such that for all h b h the point h is the unique zero of h on b i e h h 0 and for all x b h we have h x 6 0 this establishes a b follows from continuity for any 0 we can choose 0 sufficiently small to ensure that f bcr f h bc r h implies dh 1 f bcr dh 1 f let f dh 1 f f dh 1 f with f rd f rd denoting the flows for f f theorem 5 vector field perturbation implies that 0 can be chosen sufficiently small to ensure bc 0 for any 0 since h provides conjugacy between and and similarly h provides conjugacy between and we conclude that 0 can be chosen sufficiently small to ensure bc 0 on f f this establishes c let pcr u u be the conjugacy from theorem 5 vector field perturbation relating to then h h 1 provides conjugacy between and since t x h h 1 t x h t h 1 x h t h 1 x t h h 1 x t x 27 for all t x r rd such that x h u t fx f x and t x u furthermore given 0 we may choose 0 sufficiently small to ensure h 1 bc 0 h 1 and bc 0 id whence x x h h 1 x x h h 1 x h h 1 x h h 1 x x l h y y 1 l h 28 for all x b 0 thus 1 lh ensures b bc 0 idb this completes the proof of claim d remark 2 now consider the case where f d td is event selected cr at d with respect to the composite event function h cr d rn but dh rn d is not invertible because either n d n d or n d and detdh 0 we will embed this d dimensional system into a d n dimensional system to obtain an event selected cr vector field with respect to an invertible composite event function this will enable application of the preceding theorem to the degenerate system determined by f and h for each b bn let sb x r 1 d x fb 0 be the open half space of row vectors that have a positive inner product with fb the set s b bnsb is open since each sb is open and nonempty since in particular dh 1 s let a rd d be an 5 note that necessarily n dimd 18 invertible matrix whose rows are selected from s such a matrix always exists since s is open and nonempty now let d d rn and define f d td and h cr d rd n as follows x y d rn f x y f x 0 h x y ax h x y 29 clearly f is event selected cr at 0 and dh is invertible since dh a 0 dh x in r d n d n 30 has linearly independent columns therefore theorem 6 event function perturbation may be applied to study the effect of perturbations on the flow f d for f the conclusions of the theorem can be specialized to the original flow f d for f as follows with v t x f t x 0 f let v f denote the embedding defined by t x t x 0 for all t x v and let d d denote the projection defined by x y x for all x y d with these definitions we have v v 31 6 computation in this section we apply the theoretical results from sections 3 4 and 5 to derive procedures to compute the b derivative of the flow and assess stability of a periodic orbit for an event selected cr vector field f we begin in section 6 1 by developing a concrete procedure to compute the b derivative of the piecewise differentiable flow yielded by f subsequently in section 6 2 we provide sufficient conditions ensuring exponential stability of a periodic orbit that passes through the intersection of multiple surfaces of discontinuity for f 6 1 variational equations and saltation matrices in this section we compute the b derivative of the piecewise differentiable flow by solving a jump linear time varying ordinary differential equation ode along a trajectory at trajectory points where the vector field is cr we recall in section 6 1 1 that the derivative is obtained by solving a time varying ode the so called variational equation with no jumps at points where the vector field is discontinuous along one or two transverse event surface s in section 6 1 2 we note as others have before us that the ode must be updated discontinuously via a so called saltation matrix in the remainder of the section we exploit properties of the piecewise differentiable flow to derive a generalization of this procedure applicable in the presence of an arbitrary number of surfaces of discontinuity that are not required to be transverse 6 1 1 cr vector field let d rd be an open domain and f cr d td a smooth vector field on d it is a classical result hs 74 theorem 1 in 15 2 that the derivative of the flow f d associated with f with respect to state can be obtained by solving a linear time varying differential equation the so called variational equation along a trajectory i e if t x f and x 0 t rd d satisfies u 0 t x u dxf u x x u x 0 i 32 19 then the derivative of the flow with respect to time and state is given by dt t x f t x dx t x x t 33 here and in the sequel we assume without loss of generality that t 0 the t 0 case can be addressed by applying the same reasoning to the vector field f 6 1 2 event selected cr vector field if the vector field is instead event selected cr f ecr d adjustments must be made to 32 wherever a trajectory crosses a surface of discontinuity let f d denote the global flow of f yielded by corollary 1 global flow and let t x f as shown in ag 58 equation 1 4 and subsequently hp 00 equations 57 60 if for some s 0 t the vector field f is event selected cr at s x with respect to a single surface of discontinuity h then the variational equation 32 must be updated discontinuously via multiplication by a so called saltation matrix x s i f 1 f 1 dh dh f 1 x s 34 where x s limu s x u x s limu s x u and h h 1 0 near as claimed in iva 98 equation 2 4 and subsequently db 08 theorem 7 5 dl 11 equa tion 46 and biz 13 equation 27 if for some s 0 t the vector field f is event selected cr at s x with respect to multiple surfaces of discontinuity then the variational equation 32 must be updated discontinuously via multiplication by one saltation matrix for each surface un like the preceding cases the flow will generally not possess a classical derivative with respect to state after time s previous authors compute the first order effect of the flow using crossing times of perturbed trajectories due to the combinatorial complexity of this approach these authors only derive the first order approximation for two intersecting surfaces though they claim that the approach readily extends to arbitrary numbers of intersecting surfaces they leave the details to the reader the development in section 3 enables us to directly compute the derivative of the flow along trajectories passing through an arbitrary collection hj nj 1 of surfaces across which f is discon tinuous without loss of generality 6 we assume f is cr at every point in 0 t s x and we let s x as before 6 1 3 sampled vector field associated with event selected cr vector field we begin by noting that the b derivative calculation in 11 depends only on first order approxi mations of the flow and event functions hj nj 1 for all b bn let d b x d bj dhj x 0 35 and consider the flow f d of the piecewise constant vector field f d td defined by b bn x d b f x fb 36 6 lemma 2 ensures there are a finite number of discontinuities along any integral curve of a vector field f ecr d therefore to evaluate the b derivative of the flow after any number of discontinuities one may iteratively apply the procedure described in the sequel to a finite number of trajectory segments and combine the result using the chain rule sch 12 theorem 3 1 1 20 applying 11 together with the chain rule sch 12 theorem 3 1 1 we conclude that v w t 0 f d 0 v w d 0 v w 37 in other words by sampling the event selected cr vector field f across its tangent planes we obtain a piecewise constant event selected c vector field f whose flow agrees with the flow for f to first order in this sense we regard the piecewise constant sampled vector field f as the analogue of the linearization of a smooth vector field in our nonsmooth setting note that since the flow of the sampled system is obtained in 12 by composing a sequence of piecewise affine functions it is piecewise affine v w t 0 f v w 0 d 0 v w 38 these observations enable us in the remainder of this section to derive several properties of the b derivative that will prove useful in the applications presented in section 7 6 1 4 saltation matrix for multiple transition surfaces suppose v w t t x f r rd is such that 7 for all c 0 sufficiently small the trajectory initialized at x cw i passes through a unique sequence of m region interiors on its way to t cv x cw d 1 and ii does not pass through the intersection of non tangent surfaces let 1 m bn specify the sequence of region interiors excluding d 1 and let 1 m 1 n specify the corresponding sequence 8 of surfaces crossed the b derivative of the flow evaluated in the v w direction is d t x v w d t s m j 1 d j 0 0 d s x v w 39 where d t s d s x are obtained as in 33 by solving the classical variational equation since f is smoothly extendable to a neighborhood of those segments of the trajectory and for each j 1 m the derivative d j 0 is given by the matrix in the third case in 11 with the simplifications j 0 0 j 0 substituting f f j g dh j for clarity yields d j 0 1 1 g f g 0 i 1 g f f g i 1 g f 1 f 0 g 40 since 3 simplifies to d h j j 1 g f g thus the b derivative in 39 is obtained by compos ing rank 1 updates of the identity with solutions to classical variational equations in the sequel we will make use of the saltation matrix r d 1 d 1 given by m j 1 d j 0 41 7 since the flow for the sampled vector field 36 is piecewise affine the set of tangent vectors that fail to satisfy the two specified conditions has measure zero since the b derivative is a continuous function of tangent vectors it is determined by its values on the dense subset of tangent vectors that satisfy the condition 8 if hj is tangent to hi at then either hj or hi may be indexed by the choice will have no effect on the subsequent calculation 21 6 1 5 flow between tangent transition surfaces if the surfaces are tangent at the point s x n j 1 hj 6 of intersection with the trajectory a perturbed trajectory is not affected to first order by flow through the interior of a region between surfaces that are tangent this follows from the equality in 37 relating the b derivative of the original system to that of its sampled version indeed consider the vector field illustrated in figure 2 where the surfaces h 1 and h 2 are tangent at evaluating the derivative d t z 0 0 for any 0 requires composition of d 1 d 1 1 and d 1 d t z 0 0 d t s d 1 1 0 d 1 0 d s z 0 0 since the perturbed trajectory t z 0 passes through the interior of d 1 1 combin ing 3 39 and 40 after some algebra we obtain d 1 1 0 d 1 0 d 1 0 in other words d t z 0 0 is unaffected by flow through d 1 1 intuitively the time spent flowing through any region between surfaces that meet at a tangency at d depends quadratically on the distance from therefore it does not affect the first order approximation of the flow through if r 1 b derivatives of the flow are desired then it would be necessary to take these higher order effects into account when evaluating the desired higher order derivative 6 1 6 variational equation for event selected cr vector field by synthesizing the preceding observations we now provide a generalization of the variational equation in 32 applicable to the piecewise differentiable flow yielded by an event selected cr vector field we wish to evaluate d t x v w where f is event selected cr at s x for some s 0 t and f is cr at every point in 0 t s x and where v w t t x f by 39 the desired derivative can be obtained by solving a jump linear time varying differential equation with 1 m bn denoting the word associated with the tangent vector v w from 39 and letting r d 1 d 1 be the saltation matrix from 41 if 0 t r rd satisfies u 0 t s u u 0 dxf u x u 0 0 v w s s s s 42 the b derivative of the flow is given by d t x v w f t x t t 43 more generally 39 indicates the selection functions for the piecewise differentiable flow are indexed by the set of words i e functions from 1 m into bn that specify the sequence of regions a perturbed trajectory could pass through when flowing from d 1 to d 1 1 m bn m n is injective and increases from 1 to 1 44 here the phrase increases from 1 to 1 means that 1 1 m 1 and for each j 1 m 1 there exists ij 1 n such that j 1 j 2 i ij ei to evaluate 22 the fr chet derivative for the selection function indexed by we solve a matrix valued jump linear time varying differential equation to obtain x 0 t r d 1 d via u 0 t s u x u 0 dxf u x x u 0 x 0 0 id s x s s x s 45 then the b derivative of the selection function with respect to state is given by dx t x f t x t x t 46 as we demonstrate in the following section evaluating 46 for all words provides a straight forward computational procedure 9 to check contractivity of a poincar map associated with a periodic orbit 6 2 stability of a periodic orbit we assume given an event selected cr vector field f ecr d over an open domain d rd containing a periodic orbit r d theorem 1 local flow and corollary 1 global flow together yield a maximal flow pcr f d for f theorem 3 poincar map yields a poincar map p pcr s over any local section d that intersects r at the bouligand derivative dp ts t of this piecewise differentiable poincar map can be used to assess local exponential stability of the fixed point p as the following corollary shows this generalizes proposition 3 in iva 98 to stability of fixed points for arbitrary pcr functions proposition 1 contractivity test for stability of a periodic orbit suppose p pcr s where s has a fixed point p and dp is a contraction over tangent vectors near i e there exists c 0 1 0 and rd 1 rd 1 r such that x b s v tx dp x v c v 47 then is an exponentially stable periodic orbit proof by the fundamental theorem of calculus sch 12 proposition 3 1 1 x y b p x p y 1 0 dp y s x y x y ds c x y we conclude that p is a contraction over the compact ball b whence by the banach contraction mapping principle ban 22 lee 12 lemma c 35 its unique fixed point p is exponentially stable in the remainder of this section we consider the case where p is a poincar map associated with a periodic orbit in an event selected cr vector field and demonstrate how the b derivative of p can be obtained from the b derivative of the flow this provides a straightforward computational 9 though straightforward this procedure can be laborious since the number of elements in grows factorially with the number n of surfaces of discontinuity 23 procedure to determine whether the contraction hypothesis in the above proposition is satisfied using the variational equation developed in section 6 1 let cr v r be the time to impact map for on a neighborhood v d containing note that v can be chosen sufficiently small to ensure is continuously as opposed to piecewise differentiable since f is cr at let cr v be the impact map given by x x x for all x v again note that is continuously differentiable by continuity of the flow there exists a neighborhood u s of sufficiently small to ensure t x x u v whence we have the equality x u p x t x 48 applying the chain rule sch 12 theorem 3 1 1 we find that w t dp w d d t 0 w 49 where d r d 1 d is the fr chet derivative of following the conventions from sec tion 6 1 let denote the set of selection functions for the flow now satisfying the contractivity condition 47 from proposition 1 contractivity test for periodic orbit stability namely that dp is a contraction over tangent vectors near is clearly equivalent to finding c 0 1 and rd 1 rd 1 r such that w t d dx t 0 w c w 50 we emphasize that a single norm must be found relative to which the inequality in 50 is satisfied for all it would not suffice for instance to merely ensure that all the eigenvalues of d dx t reside in the open unit ball the condition in 50 is equivalent to requiring that the induced norm of the linear operator d dx t satisfy the bound d dx t i c 51 these observations are summarized formally in the following proposition proposition 2 induced norm test for periodic orbit stability let d be an open domain suppose r d is a t periodic orbit for f ecr d let pcr f d denote the maximal flow for f and let denote a set of selection functions for let d be a local section for f such that f is cr at where r and let cr v r be the impact map for over a neighborhood v d containing such that f v is cr if there exists c 0 1 and rd rd such that 51 holds then is an exponentially stable periodic orbit remark 3 as noted above 51 is equivalent to stipulating that dp is a contraction over tangent vectors near which is the contractivity condition from proposition 1 contractivity test for periodic orbit stability in iva 98 ivanov considered the stability of a fixed point of a piecewise defined map it is clear from his exposition that iva 98 proposition 3 is intended to apply to the poincar map p associated with a periodic orbit that passes through multiple surfaces of discontinuity we demonstrate that p has the piecewise defined form assumed in iva 98 3 1 and formally derive a stability condition in proposition 2 induced norm test for periodic orbit stability that is equivalent to that in iva 98 proposition 3 remark 4 in proposition 2 induced norm test for periodic orbit stability the problem of finding the norm that ensures 51 holds is equivalent to that of finding a common quadratic lyapunov function for a switched linear system which remains an open problem in the theory of switched systems we refer the interested reader to la 09 section ii a for a survey of state of the art approaches to this problem 24 7 applications we now illustrate the applicability of these results by appeal to a very simple family of event selected cr fields that abstractly captures the essential nature of the discontinuities arising in the physical settings mentioned in section 1 for instance integrate and fire neuron models consist of a population of n subsystems that undergo a discontinuous change in membrane volt age and synaptic capacitance triggered by crossing a voltage threshold kee 81 hh 95 biz 13 since the discontinuities in state are confined to independent reset translations in membrane voltages kee 81 equation 2 these transitions can be modeled locally as a first order dis continuity in an event selected cr vector field as another example legged animals and robots with four six and more limbs exhibit gaits with near simultaneous touchdown of two or more legs ale 84 gol 99 hol 06 since each touchdown introduces a discontinuity in the forces act ing on the body these transitions give rise to second order discontinuities in an event selected cr vector field in the context of electrical power networks when constituent elements lines cables and transformers encounter excessive voltages or currents they trip fail safe mechanisms that discontinuously change connectivity between elements his 95 section ii a 2 motivated by these applications in neuroscience biological and robotic locomotion and elec trical engineering we now apply the results derived in the previous sections to analyze the effect of flowing near the intersection of multiple surfaces of discontinuity generated by a very simple but illustrative family of step functions as noted in section 6 1 to describe this effect in gen eral one must solve a collection of variational equations that grows factorially with the number of surfaces of discontinuity thus for clarity in section 7 1 and section 7 2 we focus on a simple family of examples arising from the presence of a generalized signum function we demonstrate that populations of phase oscillators in both first and second order versions of this setting can be synchronized via piecewise constant feedback 7 1 synchronization of first order phase oscillators in this section we study synchronization in a system consisting of d first order phase oscillators i e a control system of the form q 1 u q 52 where q q s 1 d r is a constant and u q tq is a state dependent feedback law the state space is the d dimensional torus q s 1 d rd zd we let rd q denote the canonical quotient projection considered as a covering map lee 12 appendix a in this section we propose a piecewise constant form for u and prove that it renders the synchronized orbit q q i j 1 d qi qj 53 locally exponentially stable for 52 7 1 1 b derivative of flow in euclidean covering space via saltation matrices first we work in the euclidean covering space considering the vector field f rd trd defined by x rd f x 1 sign x 54 25 where 0 is a given constant and sign rd bd is the vectorized signum function defined as in 1 10 clearly f is event selected c on rd since the event surfaces coincide with the d standard coordinate planes for clarity we let 0 d rd denote the intersection point i e the origin let f rd be the global flow for f yielded by corollary 1 we aim to compute the b derivative of the flow with respect to state along the trajectory passing through 0 d for clarity we outline the computation here and relegate a detailed derivation to appendix b 1 for any word we can obtain the derivative of the selection function with respect to state from 46 dx 0 0 d f 0 x 0 x 0 0 d id 55 since 0 0 d and x 0 id the saltation matrix given in general by 41 simplifies in this example to 96 whence we conclude as in 100 that dx 0 0 d id 56 this shows that is in fact c 1 with respect to state at 0 0 d f and hence w t 0 drd d 0 0 d 0 w w 57 i e the first order effect of the nonsmooth flow associated with this piecewise constant vector field is linear contraction at rate independent of the direction w t 0 drd 7 1 2 b derivative of flow in euclidean covering space via flowbox before continuing with the task at hand namely applying feedback of the form in 54 to demonstrate synchronization of the first order phase oscillators in 52 we digress momentar ily to provide an alternate derivation of the result in 57 that yields additional intuition let 0 1 0 r r be the piecewise linear homeomorphisms defined by s r 0 s s s 0 s s 0 s r 10 s s s 0 s s 0 58 and let 1 rd rd be the piecewise linear homeomorphisms defined by x rd x 0 x 1 0 xd x rd 1 x 10 x 1 1 0 x d 59 note that 0 10 idr and hence 1 idrd since furthermore pcr rd rd there is no ambiguity in the definition of the pushforward f d f 1 rd trd in fact the vector field f is constant x rd f x 1 60 and hence its flow r rd rd has the simple form t x r rd t x x t 1 61 10 we note that there are three common definitions for the scalar signum function depending on what value one chooses to assign to 0 r and hence 3 d candidate definitions for a vectorized version since integral curves for f spend zero time at the signum s zero crossing there is no loss of generality in our choice 26 h 1 h 2 x t x x w t x w x w t x w h 1 h 2 x t x x w t x w x w t x w a x f x h 1 h 2 x t x x w t x w x w t x w h 1 h 2 x t x x w t x w x w t x w b x d f 1 x figure 3 a illustration of the vector field f r 2 tr 2 from 54 in the planar case d 2 b pushforward of f via the piecewise linear flowbox homeomorphism d d from 59 since the homeomorphism provides conjugacy between the flows we have t x f t x t x x t 1 62 this relationship is illustrated in figure 3 if t r and x w rd are such that x x w x w d 1 and t x t x w t x w d 1 as in figure 3 the conjugacy in 62 can be used to evaluate the b derivative of the flow d since t x sw 1 x sw t 1 x sw t 1 x sw t 1 63 and hence lim s 0 1 s t x sw t x w 64 whence 57 follows directly we emphasize that this outcome the piecewise differ entiable flow is c 1 with respect to state will not arise in general but note that other examples in this vein can be obtained by applying other piecewise linear homeomorphisms to a constant vector field i e a flowbox so long as the constant vector field is transverse to surfaces of non smoothness for the homeomorphism needed to ensure the vector field is event selected cr we conclude by noting that this approach to computing d required a closed form expression for the flowbox homeomorphism and its inverse 1 which is equivalent to possessing a closed form expression for the flow since such expressions are rarely available in applications of interest in general we expect to rely on the technique developed in section 6 1 to compute the b derivative of the flow 27 7 1 3 synchronization via piecewise constant feedback now returning to the state space of interest let u q be the following open set parameterized by 0 u q tq x 1 q x 1 d 65 for 0 sufficiently small u is evenly covered in the sense that 1 u is a homeomor phism lee 12 appendix a consider the effect of applying feedback of the form q q u q sign 1 q q u 0 q q u 66 to 52 it is straightforward to show as we do in appendix b 1 that the synchronized orbit defined in 53 is a periodic orbit for 52 under this feedback we note that the closed loop dynamics determine an event selected c vector field on a neighborhood of now we choose a local section q u for the closed loop dynamics that is perpendicular to and let p pc s denote a poincar map for over a neighborhood s containing to compute dp we employ 49 which involves solving the jump linear time varying differential equation 45 with the saltation matrix update given by 57 note that away from discontinuities introduced by the feedback 66 the vector field in 52 does not depend on the state this implies that dxf 0 hence the continuous time portion of the variational dynamics 45 does not alter the derivative computation focusing our attention to the discrete time saltation matrix portion of the variational dy namics 45 the closed loop dynamics are discontinuous at three points in 1 0 d 1 at 0 d the saltation matrix is given by 57 at 1 the update is determined by a single event surface that we chose to be perpendicular to although these updates affect d they have no effect on dp since they lie in the kernel of d in 49 we conclude that p is c 1 and dp id 1 67 therefore the induced norm contraction hypothesis of proposition 2 induced norm test for periodic orbit stability is satisfied with the standard euclidean norm and c we conclude that is exponentially stable whence the state feedback in 66 synchronizes the first order phase oscillators in 52 at an exponential rate 7 2 synchronization of second order phase oscillators in this section we study synchronization in a system consisting of d second order phase oscillators i e a control system of the form q 1 q u q q 68 where q q rd zd r are constants and u tq t q is a state dependent feedback law the state space is the tangent bundle tq of the d dimension al torus q rd zd we let r 2 d tq denote the canonical quotient projection if u 1 where r is a constant then 68 reduces to d decoupled cascades of a pair of scalar affine time invariant systems thus it is clear that q 0 and hence q 1 as t this convergence is exponential with rate in this section we propose a piecewise constant form for the feedback u and prove that for all sufficiently large there exists an exponentially stable periodic orbit that passes near 0 1 tq 28 7 2 1 b derivative of flow in euclidean covering space first consider the vector field f r 2 d tr 2 d defined by x x r 2 d f x x x 1 x sign x 69 where 0 is a given constant clearly f is event selected c on the open set d x x r 2 d j 1 d x j 6 0 r 2 d 70 since the event surfaces coincide with the first d standard coordinate planes in r 2 d since f fails to be event selected cr at points with zero velocity we exclude them from our analysis let f d denote the global flow for f yielded by corollary 1 we begin by computing the b derivative of the flow with respect to state along the trajectory passing through a point 0 1 d where 0 for clarity we outline the computation here and relegate a detailed derivation to appendix b 2 for any word we can obtain the derivative of the selection function with respect to state from 46 dx 0 0 1 f 0 x 0 x 0 0 2 d i 2 d 71 since 0 0 2 d and x 0 i 2 d the saltation matrix given in general by 41 simplifies in this example to 109 whence we conclude as in 113 that dx 0 0 1 id 0 2 id id 72 this shows that is in fact c 1 with respect to state at 0 0 1 f and hence p p t 0 1 d d 0 0 1 0 p p id 0 2 id id p p p p 73 i e the first order effect of the nonsmooth flow associated with this piecewise constant vector field is a change in velocity p 7 p 2 p that is proportional to the error in position p solving the variational equation as in section 6 1 a straightforward calculation given for completeness in appendix b 2 yields p s p s id 1 1 e s id 0 e sid p 0 p 0 x s p 0 p 0 74 where p 0 p 0 is determined from p 0 p 0 t 0 1 d by applying 73 combining 73 with 74 we conclude that the b derivative with respect to state at time s is given by p s p s d s x 0 x 0 0 p 0 p 0 x s p 0 p 0 id 1 1 e s id 0 e sid id 0 2 id id p 0 p 0 id 2 1 e s id 1 1 e s 2 e sid e sid p 0 p 0 75 29 taking the limit as s p p lim s p s p s 1 2 p 0 0 76 in plain language 76 indicates that to first order the nonsmooth flow associated with the vector field 69 asymptotically i drives the initial velocity error p 0 to zero and ii multiplies the initial position error p 0 by a factor of c 1 2 if we ensure then c 1 2 1 2 1 2 1 1 achieving contraction in positions finally we note that the convergence in 76 is exponential with rate 7 2 2 synchronization via piecewise constant feedback we now apply a construction analogous to that of section 7 1 to define a piecewise constant feedback law that results in an exponentially stable periodic orbit that passes near 0 1 tq to that end consider the following form for the control neighborhood u tq parameterized by 0 u q q tq x x 1 q q x 1 d j 1 d q j 0 77 for 0 sufficiently small u is evenly covered in the sense that 1 u is a homeomor phism lee 12 appendix a furthermore synchronized points of the form 1 1 where 0 are in the boundary u we study the effect of applying feedback of the form q q tq u q q sign 1 q q q q u 0 q q tq u 78 to 68 it is straightforward to show as we do in appendix b 2 that for all 0 sufficiently large there exists such that the trajectory initialized at 0 1 is periodic for the dynamics in 68 subject to the piecewise constant forcing 78 we let tq denote the image of the periodic orbit and let resp 0 denote the speed of the orbit when the position is equal to 1 resp 1 so that 1 1 resp 1 1 note that by increasing can be made arbitrarily close to and can be made arbitrarily close to whence further note that the closed loop dynamics determine an event selected c vector field on a neighborhood of now we choose a local section tq u for the closed loop dynamics whose normal vector is parallel to 1 0 at the point 1 1 note that by construction u is an open set containing let p pc s denote a poincar map for over a neighborhood s containing to compute dp we employ 49 which involves solving the jump linear time varying differential equation 45 with the saltation matrix update given by 73 away from discontinuities introduced by the feedback 78 the state dependence of the vector field in 68 is confined to viscous drag on velocities this implies that the continuous time portion of the variational dynamics 45 is given by 74 i e the first order effect of the flow contracts velocity error at an exponential rate and amplfies position error by an amount proportional to 1 30 focusing our attention now on the discrete time saltation matrix portion of the variational dynamics 45 the closed loop dynamics are discontinuous at three points in 1 1 0 1 and 1 1 at 0 1 the saltation matrix is given by 73 at 1 the saltation matrix is determined by a single event surface whose normal vector is parallel to 1 0 although these updates affect d they have no effect on dp since they lie in the kernel of d in 49 we conclude that p is c 1 and dp 1 2 id 1 0 0 0 e 79 where the induced norm of the error term e i decreases exponentially with increasing there fore for all 0 sufficiently large the induced norm contraction hypothesis of proposition 2 induced norm test for periodic orbit stability is satisfied with the standard euclidean norm and c 1 2 1 2 1 2 1 1 we conclude that is exponentially stable for all 0 sufficiently large whence the state feedback in 78 synchronizes the second order phase oscillators in 68 at an exponential rate 8 discussion in this paper we studied local properties of the flow generated by vector fields with event selected discontinuities that is vector fields that are i smooth except along a finite collection of smooth submanifolds and ii transverse to these submanifolds in the sense that integral curves intersect them at isolated points in time we emphasize that the vector field transversality condition ii excludes sliding modes utk 77 jef 14 from our analysis basic properties of discontinuous vec tor fields have been studied in a more general setting for instance yielding sufficient conditions ensuring existence of a continuous flow see fil 88 chapter 2 generally and fil 88 theorem 3 in 8 specifically our chief contribution is the introduction of techniques from non smooth analysis sch 12 to show that a vector field with event selected discontinuities yields a continuous flow that admits a strong first order approximation the so called rob 87 bouligand deriva tive we employed this b derivative to obtain fundamental constructions familiar from classical smooth dynamical systems theory including impact maps flowboxes and variational equations and to study the effect of perturbations both infinitesimal and non infinitesimal in the classical setting these constructions are obtained using the classical alternately called fr chet sch 12 sec tion 3 1 or jacobian gh 83 section 1 3 derivative of the smooth flow our construction of the non smooth object proceeded analogously to that of its smooth counterpart after replacing the classical derivative of the flow with our b derivative thus the piecewise differentiable dynamical systems we study bear a closer resemblance to classically differentiable dynamical systems than to discontinuous dynamical systems considered for instance in pb 10 jim 13 in future work we expect to obtain generalizations of other techniques from the classical theories of dynamical and control systems that depend primarily on the existence of first or higher order approximations of the flow for instance stability analysis via control lyapunov functions art 83 son 89 or infinitesimal contractivity ls 98 son 10 conditions for controllability based on the inverse function theorem ln 93 theorem 8 car 09 section ii c or necessary and sufficient conditions for optimality in nonlinear programs involving dynamical systems pol 97 chapter 4 more broadly we believe our results support the study of a class of discontinuous vector fields that arise in neuroscience kee 81 biological and robotic locomotion hol 06 and 31 electrical engineering his 95 in each of these disparate domains behaviors of interest occur near the intersection of surfaces of discontinuity hence the techniques we developed in this paper may be brought to bear thus we conclude with brief remarks about the formal applicability and practical relevance of our results in these applications integrate and fire neuron models consist of a population of n subsystems that undergo a dis continuous change in membrane voltage triggered by crossing a voltage threshold kee 81 v v u v t 0 if v t v 80 where v r is the membrane voltage r is a dissipation constant u r is an exogenous input and v r is the firing threshold when driven by a periodic exogenous input integrate and fire neuron populations can exhibit phase locking kee 81 or local synchronization hh 95 behavior resulting in simultaneous or near simultaneous firing of interest in applications is the computation of so called 11 lyapunov exponents using variational equations we showed in section 6 1 that the variational equation must be supplemented by discontinuous updates via saltation matrices near such simultaneous firing events as noted in biz 13 section 4 1 neglecting this non smooth effect can result in erroneous conclusions legged locomotion of animals and robots involves intermittent interaction of limbs with terrain their dynamics are given by joh section ii m q q f q q q q da q q t r q t q t if aj t 0 81 where q q is a vector of generalized coordinates for the body and limbs m is the inertia tensor f tq t q contains internal applied and coriolis forces a q rn specifies n unilateral constraints of the form j 1 n aj q 0 82 tq t q denotes the reaction forces that ensure 82 are satisfied by 81 for all time the update q t r q t q t is triggered when one of the unilateral constraints aj would be violated by a penetrating velocity it causes a discontinuity in both the velocity and the forces acting on the system legged animals and robots with four six and more limbs exhibit gaits with near simultaneous touchdown of two or more legs ale 84 gol 99 hol 06 steady state gaits are commonly modeled as periodic orbits in the body reference frame sk 88 kb 91 kf 99 in practice gait stability is assessed using the linearization of the first return or poincar map since if the eigenvalues of the linearization the so called floquet multipliers gh 83 section 1 5 lie within the unit disk then the gait is exponentially stable ag 58 gri 02 we showed in section 4 2 that the poincar map associated with a periodic orbit passing through the intersection of multiple surfaces of discontinuity is generally non smooth this implies that it is not possible to assess stability of such orbits using the f derivative since the f derivative of the map does not exist in section 6 2 we showed how the b derivative of the poincar map can be employed instead to assess stability of such orbits electrical power systems undergo discontinuous changes in network topology triggered by ex cessive voltages or currents leading to differential algebraic models of the form his 95 2 4 11 in practice one computes singular values of finite time sensitivity matrices rather than the formal asymptotic lyapunov exponent as defined for instance in sas 99 section 3 4 1 32 x f x y z p 0 g x y z p z t h x t y t z t p if yj t 0 83 where x rd contains dynamic states y rn contains algebraic states z rm contains discrete states p r contains parameters f rd n m rd is a smooth vector field g rd n m rk is a smooth constraint function and h rd n m rm is a smooth reset function the update z t h x t y t z t p is applied when one of the algebraic states yj crosses a prespecified threshold e g a bus voltage limit causing a discontinuity in the vector field governing the time evolution of x in electrical power networks discrete switches triggered by over excitation limits can occur at arbitrary times with respect to one another when the switches occur at distinct time instants the trajectory sensitivity matrix i e the f derivative the flow computed as in hp 00 can provide quantitative insights for design and control however as noted in hp 00 section viii these calculations lose accuracy when event times become coincident this is due to the fact that the flow is not classically differentiable along trajectories that undergo simultaneous discrete transitions the procedure we developed in section 6 1 can be employed to compute a collection of trajectory sensitivity matrices i e the b derivative of the flow that generalize the approach advocated in hp 00 to be applicable in power networks that undergo an arbitrary but finite number of simultaneous discrete transitions support this research was supported in part by an nsf graduate research fellowship to s a burden aro young investigator award 61770 to s revzen arl cooperative agreements w 911 nf 08 2 0004 and w 911 nf 10 2 0016 and nsf award 1028237 the views and conclusions contained in this document are those of the authors and should not be interpreted as representing the official policies either expressed or implied of the army research laboratory or the u s government the u s government is authorized to reproduce and distribute for government purposes notwith standing any copyright notation herein a f derivative formulae for piecewise differentiable flow a piecewise differentiable function is differentiable almost everywhere roc 03 theorem 2 and hence its b derivative at any point is contained in the convex hull of the limit of f derivatives of its selection functions sch 12 4 3 for completeness and to aid the reader s comprehension we now derive explicit formulae for f derivatives of the piecewise differentiable objects used in section 3 3 to construct the piecewise differentiable flow in general the b derivative can be obtained via the chain rule sch 12 theorem 3 1 1 a 1 budgeted time to boundary we adopt the notational conventions from section 3 2 1 define b ub r using the convention min by x ub b x min hj b x bj 0 n j 1 84 33 then for all t x r ub such that b x 6 t 6 0 the forward time budgeted time to boundary b is classically differentiable and d b t x 0 0 d t 0 1 0 d 0 t b x 0 d hb x b x t 85 where in the third case h hj nj 1 is such that hb x b x 0 define b ub r using the convention max by x ub b x min hj b x bj 0 n j 1 86 then for all t x r ub such that b x 6 t 6 0 the backward time budgeted time to boundary b is classically differentiable and d b t x 0 0 d t 0 1 0 d b x t 0 0 d hb x t b x 87 where in the third case h hj nj 1 is such that hb x b x 0 a 2 budgeted flow to boundary we adopt the notational conventions from section 3 2 2 define b ub r as in 84 then for all t x r ub such that b x 6 t 6 0 the forward time flow to boundary b is classically differentiable and d b t x 0 d 0 d d t 0 fb b t x dx b t x 0 t b x 0 d t x b x t 88 where in the third case t x fb b b t x x d h b x dx b b t x x and h hj n j 1 is such that hb x b x define b ub r as in 86 then for all t x r ub such that b x 6 t 6 0 the backward time flow to boundary b is classically differentiable and d b t x 0 d 0 d d t 0 fb b t x dx b t x b x t 0 0 d t x t b x 89 where in the third case t x fb b b t x x d h b x dx b b t x x and h hj n j 1 is such that hb x b x a 3 composite of budgeted time to and flow to boundary we adopt the notational conventions from section 3 2 3 34 combine 6 and 8 to obtain the derivative of b for all t x r ub such that b x 6 t 6 0 d b t x 1 0 0 i t 0 0 0 fb b t x dx b t x 0 t b x 1 d hb x 0 t x b x t 90 where in the third case t x fb b b t x x d h b x dx b b t x x and h hj n j 1 is such that hb x b x combine 87 and 89 to obtain the derivative of b for all t x r ub such that b x 6 t 6 0 d b t x 1 0 0 i t 0 0 0 fb b t x dx b t x b x t 0 1 d hb x 0 t x t b x 91 where in the third case t x fb b b t x x d h b x dx b b t x x and h hj n j 1 is such that hb x b x b periodic orbits and b derivative formulae for phase os cillators in the following subsections we provide detailed derivations that were deemed too laborious to include in the main text b 1 synchronization of first order phase oscillators we adopt the notational conventions of section 7 1 and derive several useful properties of closed loop dynamics obtained by applying the piecewise constant feedback in 66 to the system in 52 first we argue that the synchronized set 53 is a periodic orbit for the closed loop dynamics since 52 consists of d identical subsystems and the feedback in 66 encounters discontinuities synchronously i e all coordinates of the vector field change discontinuously at the same time at points 1 0 d 1 and at every other point in time the vector field coordinates are identical we conclude that the trajectory initialized at 0 d remains synchronized for all time we now explicitly derive the b derivative in 57 fixing a word 1 d bd with corresponding sequence of surfaces crossed 1 d 1 d we know from section 6 1 that for all 0 the f derivative of the selection function at 2 0 d is given by 39 d 2 0 d d 0 d d j 1 d j 0 0 d 0 d 0 d 92 here d 0 d d 0 d are obtained as in 33 by solving the classical variational equa tion since f rd trd is smoothly extendable to a neighborhood of those segments of the 35 trajectory noting that for all s 0 we have f s 0 d f 1 0 d dxf s 0 d 0 and for all s 0 we have f s 0 d f 1 0 d dxf s 0 d 0 we conclude that d s 0 d f 1 0 d id d s s 0 d f 1 0 d id 93 for each j 1 d the derivative d j 0 0 d is given by the matrix in the third case in 11 with the simplifications j 0 0 d 0 j 0 0 d 0 d setting fj f j 0 d g j dh j 0 d for each j 1 d by 40 we have d j 0 0 d id 1 1 g j fj 1 fj 0 g j 94 now for all j 1 d we have fj f j 0 d 1 j rd and g j dh j 0 d e j r 1 d hence g j fj since for all i 1 d with i j the vector i is lexicographically greater than j we also have g i fj these simplifications yield for all j 1 d 1 d j 1 0 0 d d j 0 0 d id 1 1 1 fj 1 0 e j 1 id 1 1 1 fj 0 e j id 1 1 1 fj 1 0 e j 1 1 0 fj 1 fj 0 e j 95 noting that fj 1 fj 2 e j we conclude that e i fj 1 fj 0 for all i j 1 d this implies that d j 1 d j 0 0 d id 1 1 1 fd 0 e d 1 d 1 j 1 0 2 e j 0 e j 96 noting for any f rd with 0 d 0 1 d rd that 0 0 d f id id 1 1 f 1 0 d 97 defining f f 1 0 d and noting that f fd 2 e d we have 0 0 d f id d j 1 d j 0 0 d id 1 1 f 1 0 d 1 0 f fd 0 e d 1 d 1 j 1 0 2 e j 0 e j id 1 2 0 0 d 0 d id 1 f 1 0 d 98 36 finally defining f f 1 0 d we have d 0 0 d 0 0 d f id d j 1 d j 0 0 d 0 0 d f id id 1 2 0 0 d 0 d id 1 f 1 0 d f id 99 restricting to the derivative with respect to state we find for all words that dx 0 0 d id 100 thus the piecewise differentiable flow is c 1 with respect to state at 0 0 d and 57 follows restricting instead to the derivative with respect to time we find as expected that dt 0 0 d f f f 1 0 d 101 b 2 synchronization of second order phase oscillators we adopt the notational conventions of section 7 2 and derive several useful properties of closed loop dynamics obtained by applying the piecewise constant feedback in 78 to the system in 68 first we argue that for any 0 there exists such that the trajectory initialized at 0 1 is a periodic orbit for the closed loop dynamics since 68 consists of d identical subsystems and the feedback in 78 encounters discontinuities synchronously i e all coordinates of the vector field change discontinuously at the same time at points of the form 1 1 where 0 and 0 and at every other point in time the vector field coordinates are identical we conclude that a trajectory initialized at 0 1 remains synchronized for all time so the asymptotic behavior of this trajectory can be studied by restricting our attention to the scalar case i e d 1 wherein the dynamics take the simple form d 1 q q q 0 q q 0 q else 102 here we adopt the abuse of notation that q 0 if there exists x 0 r such that x q and similarly for q 0 clearly if the initial velocity q 0 0 then q t 0 for all t 0 since 0 this implies that q t crosses the thresholds 0 in sequence the impact map p 1 2 0 0 obtained by integrating the flow of 102 between any sequential pair of event surfaces 1 2 0 0 is a contraction over velocities with a lipschitz constant that decreases exponentially with increasing thus the composition p p 0 p 0 p is a contraction for all sufficiently large since furthermore for all sufficiently large the compact set is mapped to itself under p the banach contraction mapping principle ban 22 lee 12 lemma c 35 implies there exists such that p in other words the trajectory initialized at 0 lies on a periodic orbit for 102 and hence 0 1 lies on a periodic orbit for the closed loop dynamics 37 obtained by applying the feedback in 78 to the system in 68 it is straightforward to verify in this scalar system that solving the variational equation as in section 6 1 yields p s p s 1 1 1 e s 0 e s p 0 p 0 x s p 0 p 0 103 since the saltation updates are synchronous along the periodic orbit 74 follows we now explicitly derive the b derivative in 73 fixing a word 1 d bd with corresponding sequence of surfaces crossed 1 d 1 d we know from section 6 1 that for all 0 the f derivative of the selection function at 2 0 1 is given by 39 d 2 0 1 d 0 1 d j 1 d j 0 0 1 0 d 0 1 here d 0 1 d 0 1 are obtained as in 33 by solving the classical varia tional equation since f r 2 d tr 2 d is smoothly extendable to a neighborhood of those segments of the trajectory we conclude that lim s 0 d s 0 1 f 1 0 1 id lim s 0 d s s 0 1 f 1 0 1 id 104 for each j 1 d the derivative d j 0 0 1 is given by the matrix in the third case in 11 with the simplifications j 0 0 1 0 j 0 0 1 0 1 setting fj f j 0 1 g j dh j 0 1 for each j 1 d by 40 we have d j 0 0 1 id 1 1 g j fj 1 fj 0 g j 105 for convenience we let i 2 d e 1 ed e 1 e d 106 i e for all j 1 d we let ej r 2 d denote the j th standard euclidean basis vector and let e j ed j r 2 d denote the d j th such vector though a mild abuse of the dot notation this convention simplifies the subsequent exposition now for all j 1 d we have fj f j 0 1 1 1 1 j r 2 d g j dh j 0 1 e j r 1 2 d 107 and hence for any i 1 d we have g i fj these simplifications yield for all j 1 d 1 d j 1 0 0 1 d j 0 0 1 i 2 d 1 1 1 fj 1 0 g j 1 i 2 d 1 1 1 fj 0 g j i 2 d 1 1 1 fj 1 0 g j 1 1 0 fj 1 fj 0 g j 108 38 noting that fj 1 fj 2 e j we conclude that e i fj 1 fj 0 for all i j 1 d this implies that d j 1 d j 0 0 1 i 2 d 1 1 1 fd 0 e d 2 d 1 j 1 0 e j 0 e j 109 noting for any f r 2 d with 02 d 0 12 d r 2 d that 0 0 2 d f i 2 d i 2 d 1 1 f 1 0 2 d 110 defining f f 1 0 1 and noting that f fd 2 e d we have 0 0 2 d f i 2 d d j 1 d j 0 0 1 i 2 d 1 1 f 1 0 2 d 1 0 f fd 0 e d 2 d 1 j 1 0 e j 0 e j i 2 d 1 2 d j 1 0 e j 0 e j 1 f 1 0 2 d 111 finally defining f f 1 0 1 we have d 0 0 1 0 0 2 d f i 2 d d j 1 d j 0 0 1 0 0 2 d f i 2 d i 2 d 1 2 0 0 d 0 d 0 d 0 0 0 d id 0 1 f 0 0 d 2 1 1 0 d 0 d 112 restricting to the derivative with respect to state we find for all words that dx 0 0 1 id 0 2 id id 113 thus the piecewise differentiable flow is c 1 with respect to state at 0 0 1 and 73 follows restricting instead to the derivative with respect to time we find as expected that dt 0 0 1 f 0 d 2 1 f f 1 0 1 114 39 references ag 58 m a aizerman and f r gantmacher determination of stability by linear ap proximation of a periodic solution of a system of differential equations with dis continuous right hand sides in the quarterly journal of mechanics and applied mathematics 11 4 1958 pp 385 398 doi 10 1093 qjmam 11 4 385 cit on pp 3 20 32 abr 88 r abraham j e marsden and t s ratiu manifolds tensor analysis and appli cations vol 75 springer 1988 cit on p 18 ale 84 r m alexander the gaits of bipedal and quadrupedal animals in the inter national journal of robotics research 3 2 1984 pp 49 59 doi 10 1177 0278364 98400300205 cit on pp 3 25 32 art 83 z artstein stabilization with relaxed controls in nonlinear analysis theory methods applications 7 11 1983 pp 1163 1173 doi 10 1016 0362 546 x 83 9 0049 4 cit on p 31 bal 00 p ballard the dynamics of discrete mechanical systems with perfect unilateral constraints in archive for rational mechanics and analysis 154 3 2000 pp 199 274 doi 10 1007 s 002050000105 cit on p 3 ban 22 s banach sur les op rations dans les ensembles abstraits et leur application aux quations int grales in fundamenta mathematicae 3 1 1922 pp 133 181 cit on pp 23 37 biz 13 f bizzarri a brambilla and g storti gajani lyapunov exponents computation for hybrid neurons in journal of computational neuroscience 35 2 2013 pp 201 212 doi 10 1007 s 10827 013 0448 6 cit on pp 3 20 25 32 bro 11 l brouwer beweis der invarianz desn dimensionalen gebiets german in math ematische annalen 71 3 1911 pp 305 313 doi 10 1007 bf 01456846 cit on p 15 bur 15 a s a burden h gonzalez r vasudevan r bajcsy and s s sastry metrization and simulation of controlled hybrid systems in ieee transactions on automatic control 2015 to appear arxiv 1302 4402 url http arxiv org abs 1302 4402 cit on p 3 bur 15 b s a burden s revzen and s s sastry model reduction near periodic orbits of hybrid dynamical systems in ieee transactions on automatic control 2015 to appear arxiv 1308 4158 url http arxiv org abs 1308 4158 cit on p 3 car 09 s g carver n j cowan and j m guckenheimer lateral stability of the spring mass hopper suggests a two step control strategy for running in chaos an in terdisciplinary journal of nonlinear science 19 2 2009 pp 026106 026106 doi 10 1063 1 3127577 cit on p 31 cla 90 f h clarke optimization and nonsmooth analysis vol 5 society for industrial and applied mathematics 1990 cit on p 46 db 08 m di bernardo c j budd p kowalczyk and a r champneys piecewise smooth dynamical systems theory and applications springer 2008 cit on pp 3 20 40 http dx doi org 10 1093 qjmam 11 4 385 http dx doi org 10 1177 027836498400300205 http dx doi org 10 1177 027836498400300205 http dx doi org 10 1016 0362 546 x 83 90049 4 http dx doi org 10 1016 0362 546 x 83 90049 4 http dx doi org 10 1007 s 002050000105 http dx doi org 10 1007 s 10827 013 0448 6 http dx doi org 10 1007 bf 01456846 http arxiv org abs 1302 4402 http arxiv org abs 1302 4402 http arxiv org abs 1308 4158 http dx doi org 10 1063 1 3127577 dl 11 l dieci and l lopez fundamental matrix solutions of piecewise smooth differential systems in mathematics and computers in simulation 81 5 2011 pp 932 953 doi 10 1016 j matcom 2010 10 012 cit on pp 3 20 dl 92 i dobson and l lu voltage collapse precipitated by the immediate change in stabil ity when generator reactive power limits are encountered in ieee transactions on circuits and systems i fundamental theory and applications 39 9 1992 pp 762 766 doi 10 1109 81 250167 cit on p 3 fil 88 a f filippov differential equations with discontinuous righthand sides springer 1988 cit on pp 16 31 46 gh 83 j guckenheimer and p holmes nonlinear oscillations dynamical systems and bi furcations of vector fields springer 1983 cit on pp 31 32 gol 99 m golubitsky i stewart p l buono and j j collins symmetry in locomotor central pattern generators and animal gaits in nature 401 6754 1999 pp 693 695 doi 10 1038 44416 cit on pp 3 25 32 gri 02 j w grizzle g abba and f plestan asymptotically stable walking for biped robots analysis via systems with impulse effects in ieee transactions on auto matic control 46 1 2002 pp 51 64 doi 10 1109 9 898695 cit on pp 3 32 hh 95 j j hopfield and a v herz rapid local synchronization of action potentials toward computation with coupled integrate and fire neurons in proceedings of the national academy of sciences 92 15 1995 pp 6655 6662 url http www pnas org content 92 15 6655 abstract cit on pp 3 25 32 hp 00 i a hiskens and m a pai trajectory sensitivity analysis of hybrid systems in ieee transactions on circuits and systems i fundamental theory and applications 47 2 2000 pp 204 220 doi 10 1109 81 828574 cit on pp 3 20 33 hs 74 m w hirsch and s smale differential equations dynamical systems and linear algebra academic press 1974 cit on pp 7 15 19 hat 02 a hatcher algebraic topology cambridge university press 2002 cit on p 15 hir 76 m hirsch differential topology springer verlag 1976 cit on p 18 his 95 i a hiskens analysis tools for power systems contending with nonlinearities in proceedings of the ieee 83 11 1995 pp 1573 1587 doi 10 1109 5 481635 cit on pp 3 25 32 hol 06 p holmes r j full d e koditschek and j guckenheimer the dynamics of legged locomotion models analyses and challenges in siam review 48 2 2006 pp 207 304 doi 10 1137 s 0036144504445133 cit on pp 3 25 31 32 iva 98 a ivanov the stability of periodic solutions of discontinuous systems that intersect several surfaces of discontinuity in journal of applied mathematics and mechanics 62 5 1998 pp 677 685 doi 10 1016 s 0021 8928 98 00087 2 cit on pp 3 20 23 24 jef 14 m r jeffrey dynamics at a switching intersection hierarchy isonomy and multi ple sliding in siam journal on applied dynamical systems 13 3 2014 pp 1082 1105 doi 10 1137 13093368 x cit on p 31 41 http dx doi org 10 1016 j matcom 2010 10 012 http dx doi org 10 1109 81 250167 http dx doi org 10 1038 44416 http dx doi org 10 1109 9 898695 http www pnas org content 92 15 6655 abstract http www pnas org content 92 15 6655 abstract http dx doi org 10 1109 81 828574 http dx doi org 10 1109 5 481635 http dx doi org 10 1137 s 0036144504445133 http dx doi org 10 1016 s 0021 8928 98 00087 2 http dx doi org 10 1137 13093368 x jim 13 n d jimenez s mihalas r brown e niebur and j rubin locally contractive dynamics in generalized integrate and fire neurons in siam journal on applied dynamical systems 12 3 2013 pp 1474 1514 doi 10 1137 120900435 cit on p 31 joh a m johnson s a burden and d e koditschek a hybrid systems model for simple manipulation and self manipulation systems arxiv 1502 01538 url http arxiv org abs 1502 01538 cit on p 32 kb 91 d e koditschek and m b hler analysis of a simplified hopping robot in the international journal of robotics research 10 6 1991 pp 587 605 doi 10 1177 0 27836499101000601 cit on p 32 kf 99 t m kubow and r j full the role of the mechanical system in control a hypoth esis of self stabilization in hexapedal runners in philosophical transactions of the royal society of london series b biological sciences 354 1385 1999 pp 849 861 doi 10 1098 rstb 1999 0437 cit on p 32 kee 81 j keener f hoppensteadt and j rinzel integrate and fire models of nerve mem brane response to oscillatory input in siam journal on applied mathematics 41 3 1981 pp 503 517 doi 10 1137 0141042 cit on pp 3 25 31 32 la 09 h lin and p j antsaklis stability and stabilizability of switched linear systems a survey of recent results in ieee transactions on automatic control 54 2 2009 pp 308 322 doi 10 1109 tac 2008 2012009 cit on p 24 ln 93 a u levin and k s narendra control of nonlinear dynamical systems using neural networks controllability and stabilization in ieee transactions on neural networks 4 2 1993 pp 192 206 doi 10 1109 72 207608 cit on p 31 ls 98 w lohmiller and j j slotine on contraction analysis for non linear systems in automatica 34 6 1998 pp 683 696 doi 10 1016 s 0005 1098 98 00019 3 cit on p 31 lee 12 j m lee introduction to smooth manifolds springer verlag 2012 cit on pp 4 6 12 15 23 25 28 30 37 44 45 ms 90 r e mirollo and s h strogatz synchronization of pulse coupled biological oscil lators in siam journal on applied mathematics 50 6 1990 pp 1645 1662 doi 10 1137 0150098 cit on p 3 pb 10 s r pring and c j budd the dynamics of regularized discontinuous maps with applications to impacting systems in siam journal on applied dynamical systems 9 1 2010 pp 188 219 doi 10 1137 080743123 cit on p 31 pol 97 e polak optimization algorithms and consistent approximations springer verlag 1997 cit on p 31 rs 97 d ralph and s scholtes sensitivity analysis of composite piecewise smooth equa tions in mathematical programming 76 3 1997 pp 593 612 doi 10 1007 bf 02 614400 cit on pp 12 13 17 rob 87 s m robinson local structure of feasible sets in nonlinear programming part iii stability and sensitivity in nonlinear analysis and optimization vol 30 math ematical programming studies springer berlin heidelberg 1987 pp 45 66 doi 10 1007 bfb 0121154 cit on pp 3 5 31 42 http dx doi org 10 1137 120900435 http arxiv org abs 1502 01538 http arxiv org abs 1502 01538 http dx doi org 10 1177 027836499101000601 http dx doi org 10 1177 027836499101000601 http dx doi org 10 1098 rstb 1999 0437 http dx doi org 10 1137 0141042 http dx doi org 10 1109 tac 2008 2012009 http dx doi org 10 1109 72 207608 http dx doi org 10 1016 s 0005 1098 98 00019 3 http dx doi org 10 1137 0150098 http dx doi org 10 1137 080743123 http dx doi org 10 1007 bf 02614400 http dx doi org 10 1007 bf 02614400 http dx doi org 10 1007 bfb 0121154 roc 03 r rockafellar a property of piecewise smooth functions in computational op timization and applications 25 1 3 2003 pp 247 250 doi 10 1023 a 102292162 4832 cit on pp 3 33 sk 88 g schoner and j a kelso dynamic pattern generation in behavioral and neural systems in science 239 4847 1988 pp 1513 1520 doi 10 1126 science 32812 53 cit on p 32 sas 99 s s sastry nonlinear systems analysis stability and control springer 1999 cit on p 32 sch 12 s scholtes introduction to piecewise differentiable equations springer verlag 2012 doi 10 1007 978 1 4614 4340 7 cit on pp 3 5 7 12 20 21 23 24 31 33 44 sim 05 s n simic k h johansson j lygeros and s s sastry towards a geometric theory of hybrid systems in dynamics of continuous discrete and impulsive systems b applications algorithms 12 5 6 2005 pp 649 687 cit on p 3 son 10 e d sontag contractive systems with inputs in perspectives in mathematical system theory control and signal processing vol 398 lecture notes in control and information sciences springer berlin heidelberg 2010 pp 217 228 doi 10 10 07 978 3 540 93918 4 20 cit on p 31 son 89 e d sontag a universal construction of artstein s theorem on nonlinear stabiliza tion in systems control letters 13 2 1989 pp 117 123 doi 10 1016 0167 6 911 89 90028 5 cit on p 31 utk 77 v utkin variable structure systems with sliding modes in ieee transactions on automatic control 22 2 1977 pp 212 222 doi 10 1109 tac 1977 1101446 cit on p 31 wa 12 e d wendel and a d ames rank deficiency and superstability of hybrid systems in nonlinear analysis hybrid systems 6 2 2012 pp 787 805 doi 10 1016 j nahs 2011 09 002 cit on p 3 43 http dx doi org 10 1023 a 1022921624832 http dx doi org 10 1023 a 1022921624832 http dx doi org 10 1126 science 3281253 http dx doi org 10 1126 science 3281253 http dx doi org 10 1007 978 1 4614 4340 7 http dx doi org 10 1007 978 3 540 93918 4 20 http dx doi org 10 1007 978 3 540 93918 4 20 http dx doi org 10 1016 0167 6911 89 90028 5 http dx doi org 10 1016 0167 6911 89 90028 5 http dx doi org 10 1109 tac 1977 1101446 http dx doi org 10 1016 j nahs 2011 09 002 http dx doi org 10 1016 j nahs 2011 09 002 c global piecewise differentiable flow this section contains a proof of corollary 1 global flow that consists of a straightforward adap tation of the proof of lee 12 theorem 9 12 obtained by replacing all instances of the modifier smooth with piecewise smooth lemma 3 translation lemma let d rd be open f ecr d j r be an interval and j d an integral curve for f for any b r the curve j d defined by t t b is also an integral curve for f where j t t b j proof clearly pcr j d whence the fundamental theorem of calculus sch 12 proposi tion 3 1 1 in conjunction with lemma 1 implies is an integral curve for f theorem 7 fundamental theorem on flows if f ecr d then there exists a unique max imal flow pcr f d for f this flow has the following properties a for each x d the curve x fx d is the unique maximal integral curve of f starting at x b if s fx then f s x fx s t s t fx c for each t r the set dt x d t x f is open in d and t dt d t is a piecewise cr homeomorphism with inverse t proof this proof is a straightforward adaptation of the proof of theorem 9 12 in lee 12 theorem 1 local flow shows that there exists an integral curve for f starting at each point x d suppose j d are two integral curves for f defined on the same open interval j such that t 0 t 0 for some t 0 j let s s j s s clearly s 6 since t 0 s and s is closed in j by continuity of integral curves on the other hand suppose t 1 s applying theorem 1 local flow near x t 1 we see that there exists an interval t 1 i r such that i i this implies s is open in j since j is connected s j which implies j j thus any two integral curves that agree at one point agree on their common domain for each x d let fx be the union of all domains of integral curves for f originating at x at time 0 define x fx d by letting x t t where is any integral curve starting at x and defined on an open interval containing 0 and t since all such integral curves agree at t by the argument above x is well defined and is obviously the unique maximal integral curve starting at p now let f t x r d t fx and define f d by t x x t we also write t x t x by definition satisfies property a in the statement of the fundamental theorem for each x d x is the unique maximal integral curve for f starting at x to verify the group laws fix any x d and s fx and write y s x x s the curve fx s d defined by t x t s starts at y and lemma 3 shows that is an integral curve for f since is a function agrees with y on their common domain which is equivalent to s fx t f s x s t fx t s x t s x 115 the fact that 0 x x for all x d is obvious by maximality of x the domain of cannot be larger than fy which means that fx s fy since 0 fx this implies s fy and the 44 group law 115 implies that y s x applying the same argument with s y in place of s x we find that fy s fx which is the same as fy fx s this proves b next we show that f is open in r d so it is a flow domain and that f d is pcr define a subset w f as the set of all t x f such that is defined and pcr on a product neighborhood of t x of the form j u f where j r is an open interval containing 0 and t and u d is a neighborhood of x then w is open in r d and the restriction w pcr w d so it suffices to show that w f suppose this is not the case then there exists some point x 0 f w for simplicity assume 0 the argument for 0 is similar and can be obtained for instance by considering the flow for f let t 0 inf t r t x 0 6 w see fig 9 6 in lee 12 by theorem 1 local flow is defined and pcr in some product neighborhood of 0 x 0 so t 0 0 since t 0 and fx 0 is an open interval containing 0 and it follows that t 0 fx 0 let y 0 x 0 t 0 by theorem 1 local flow again there exists 0 and a neighborhood u 0 of y 0 such that u 0 w we will use the group law 115 to show that admits a pcr extension to a neighborhood of t 0 x 0 which contradicts our choice of t 0 choose some t 1 t 0 such that t 1 t 0 and x 0 t 1 u 0 since t 1 t 0 we have t 1 x 0 w so there is a product neighborhood t 1 t 1 u 1 w for some 0 by definition of w this implies is defined and pcr on 0 t 1 u 1 because t 1 x 0 u 0 we can choose u 1 small enough that maps t 1 u 1 into u 0 define 0 t 1 u 1 d by t x 0 t 1 u 1 t x t x x u 1 0 t t 1 t t 1 t 1 x x u 1 t 1 t t 1 the group law for guarantees that these definitions agree where they overlap and our choices of u 1 t 1 and ensure that this defines a pcr map by lemma 3 each map t 7 t p is an integral curve of f so is a pcr extension of to a neighborhood of t 0 x 0 contradicting our choice of t 0 this completes the proof that w f finally we prove c the fact that dt is open is an immediate consequence of the fact that f is open from part b we deduce that x dt t fx f t x fx t t f t x t x d t which shows that t maps dt to d t moreover the group laws then show that t t is equal to the identity on dt reversing the roles of t and t shows that t t is the identity on d t which completes the proof 45 d perturbation of differential inclusions in the proof of the perturbation results of section 5 we relied on a result due to filippov for completeness we reproduce the statement of the result we required assumption 1 fil 88 chapter 2 8 theorem 1 in the domain f a set valued function f t x satisfies the basic conditions if for all t x f the set f t x is nonempty bounded closed and convex and furthermore the function f is upper semicontinuous in t x here f is understood to be a subset of r rd and f is upper semicontinuous as a multifunction f f 2 rd cla 90 2 1 i e for all t x f 0 there exists 0 such that s y t x b 0 f s y f t x b 0 116 where we adopt the usual notation in a banach space x x x b x x b x y y b 117 as in fil 88 chapter 2 8 for any f f 2 rd we define the deviation df f f as df f f inf 0 t x f f t x cof t b 0 x b 0 b 0 118 where for any u rd the set cou denotes the convex hull of points in u theorem 8 fil 88 chapter 2 8 theorem 1 let f t x satisfy assumption 1 differential inclusion basic conditions in the open domain f t 0 a b t 0 x 0 f let all the solutions of the problem x f t x x t 0 x 0 119 exist for all t a b and their graphs lie in f then for any 0 there exists a 0 such that for any t 0 a b x 0 and f t x satisfying the conditions t 0 t 0 x 0 x 0 df f f and assumption 1 differential inclusion basic conditions each solution of the problem x f t x x t 0 x 0 120 exists for all t a b and differs from some solution of 119 by not more than here a solution of the problem 119 on the interval a b r is an absolutely continuous function y a b rd its graph lies in f if t y t t a b f 46 1 introduction 2 preliminaries 2 1 notation 2 2 piecewise differentiable functions and nonsmooth analysis 3 local and global flow 3 1 event selected vector fields discontinuities 3 2 construction of the piecewise differentiable flow 3 2 1 budgeted time to boundary 3 2 2 budgeted flow to boundary 3 2 3 composite of budgeted time to and flow to boundary 3 2 4 construction of flow via composition 3 3 piecewise differentiable flow 4 time to impact poincar impact map and flowbox 4 1 piecewise differentiable time to impact 4 2 piecewise differentiable poincar impact map 4 3 piecewise differentiable flowbox 5 perturbed flow 5 1 perturbation of vector fields 5 2 perturbation of event functions 6 computation 6 1 variational equations and saltation matrices 6 1 1 cr vector field 6 1 2 event selected cr vector field 6 1 3 sampled vector field associated with event selected cr vector field 6 1 4 saltation matrix for multiple transition surfaces 6 1 5 flow between tangent transition surfaces 6 1 6 variational equation for event selected cr vector field 6 2 stability of a periodic orbit 7 applications 7 1 synchronization of first order phase oscillators 7 1 1 b derivative of flow in euclidean covering space via saltation matrices 7 1 2 b derivative of flow in euclidean covering space via flowbox 7 1 3 synchronization via piecewise constant feedback 7 2 synchronization of second order phase oscillators 7 2 1 b derivative of flow in euclidean covering space 7 2 2 synchronization via piecewise constant feedback 8 discussion a f derivative formulae for piecewise differentiable flow a 1 budgeted time to boundary a 2 budgeted flow to boundary a 3 composite of budgeted time to and flow to boundary b periodic orbits and b derivative formulae for phase oscillators b 1 synchronization of first order phase oscillators b 2 synchronization of second order phase oscillators c global piecewise differentiable flow d perturbation of differential inclusions