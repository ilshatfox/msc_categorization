ar x iv 1 80 7 05 26 5 v 2 q fi n p m 2 1 a ug 2 01 8 rebalancing frequency considerations for kelly optimal stock portfolios in a control theoretic framework chung han hsieh 1 john a gubner 2 and b ross barmish 3 abstract in this paper motivated by the celebrated work of kelly we consider the problem of portfolio weight selection to maximize expected logarithmic growth going beyond existing literature our focal point here is the rebalancing frequency which we include as an additional parameter in our analysis the problem is first set in a control theoretic framework and then the main question we address is as follows in the absence of transaction costs does high frequency trading always lead to the best performance related to this is our prior work on betting also in the kelly context which examines the impact of making a wager and letting it ride our results on betting frequency can be interpreted in the context of weight selection for a two asset portfolio consisting of one risky asset and one riskless asset with regard to the question above our prior results indicate that it is often the case that there are no performance benefits associated with high frequency trading in the present paper we generalize the analysis to portfolios with multiple risky assets we show that if there is an asset satisfying a new condition which we call dominance then an optimal portfolio consists of this asset alone i e the trader has all eggs in one basket and performance becomes a constant function of rebalancing frequency said another way the prob lem of rebalancing is rendered moot the paper also includes simulations which address practical considerations associated with real stock prices and the dominant asset condition i introduction the main results of this paper pertain to the effect of rebal ancing frequency for portfolio weight selection problems with performance measured using kelly s celebrated ex pected logarithmic growth criterion which was first used for a variety of sequential betting problems 1 see also 2 7 where further results along these lines are given in this regard the work reported in this paper is part of a line of research using this criterion in the context of portfolio optimization in the stock market e g see 8 and 9 for a good introduction 10 for a rather comprehensive exposi tion on the properties of solutions obtained using expected logarithmic growth and 11 17 for a sampling of some more recent developments initial results about rebalancing frequency are reported in 11 and 12 for the case when the stock prices follow a continuous time geometric brownian motion additionally a drawback in 12 is that the betting 1 chung han hsieh is a graduate student working towards to his ph d degree in the department of electrical and computer engineering university of wisconsin madison wi 53706 e mail hsieh 23 wisc edu 2 john a gubner is a faculty member in the department of electrical and computer engineering university of wisconsin madison wi 53706 e mail john gubner wisc edu 3 b ross barmish is a faculty member in the department of electrical and computer engineering university of wisconsin madison wi 53706 e mail barmish engr wisc edu fraction k is chosen without regard to the frequency at which the portfolio is rebalanced subsequently when this same fraction k is used to find an optimal rebalancing period the resulting levels of logarithmic growth are suboptimal to complete this overview we single out 17 for emphasis since it provides a comprehensive survey covering many of the most important papers in this line of research most closely related to this paper is our recent work 21 which considers a repeated betting game and the impact on expected logarithmic growth resulting from making a wager and letting it ride for several steps in lieu of updating this can be interpreted as weight selection for a two asset portfolio and letting it ride to capture the effect of the frequency of rebalancing with this as background this paper is aimed at generalizing these initial results on frequency dependence to trading a multi stock portfolio the appeal of this research to the control community is based on the fact that the kelly based rebalancing problem can be formulated as a stochastic control problem with a linear feedback and randomly varying inputs corresponding to the vector of stagewise returns x k on portfolio assets see 15 16 18 20 and 22 where a similar control theoretic set up is considered for finance problems in con tinuous time to study the effect of rebalancing frequency for portfolio problems let t be the time between portfolio updates with n being the number of steps between rebal ancings the frequency is f 1 n t subsequently for each n the expected logarithmic growth using optimal portfolio weights is denoted by g n which we study as a function of n the main questions we address in this paper are as follows does high frequency trading corresponding to n 1 always lead to the best performance under what conditions can a low frequency trader using n 1 match or exceed the optimal high frequency performance level g 1 indeed in the presence of transaction costs our previous work mentioned above carried out in the context of sequential betting includes a demonstration that g n g 1 is possible when transaction costs are in play that is the prohibitive costs associated with trading too often may render high frequency trading suboptimal however for the zero transaction cost case we also showed that it is possible to obtain g 1 g n http arxiv org abs 1807 05265 v 2 for all n 1 although it is still an open question whether g n g 1 is possible for this case in the sequel we generalize these results in 21 to the multiple risky asset case and prove that there are many scenarios where the low frequency trader s performance can actually match that of the high frequency trader the extreme case with n very large corresponding to buy and hold this performance matching is proven when at least one of the assets in the portfolio is dominant in the sense that it is relatively more attractive than every other potential asset under consideration in this case it becomes arguable that dynamic portfolio rebalancing is a waste of time to even consider to complete this overview we should also mention an other result in the literature involving rebalancing frequency considerations in 11 the returns are assumed to follow a continuous time geometric brownian motion and two extreme cases are considered when the time between rebalancing is either very large or very small in contrast to 11 we consider the entire range of frequencies from low to high to this end our objective here is to analyze in discrete time the more general case when both the probability distribution of the returns and the time interval between updates are arbitrary preview of main result for the case when the portfolio is comprised of two or more potentially investable assets with each having i i d returns xi k and possibly correlated asset j is said to be dominant if e 1 xi 0 1 xj 0 1 holds for all i 6 j in this case our main result which we call the dominant asset theorem tells us that when this condition is satisfied an optimal strategy is obtained by investing all of the trader s funds in asset j figuratively speaking this result says that an optimal portfolio is obtained by putting all eggs in one basket of equal importance as a consequence of the theorem it is seen that the performance of the high frequency trader and the buy and holder are identical that is g n g 1 for all n 1 thus performance is invariant to the rebalancing frequency and it follows that there is no benefit associated with trading often it suffices to buy and hold said another way if all funds are invested in a single asset which could be cash then rebalancing is rendered moot equivalently the performance must be a constant function of n theoretical versus practical considerations consistent with the vast preponderance of results in the literature our approach is model based in the sense that the probability distribution for the asset returns is known see section ii for details the reader is also referred to 8 and 24 where binomial lattice models are used to approximate geometric brownian motion in practice the probability distribution of the returns is typically estimated from historical data in view of the fact that real world stock returns are generally nonstationary in practice frequent updates of the model accompanied by portfolio rebalancing are in order that is at best model based results should be viewed as useful only for a limited amount of time in section v the reader is provided with the flavor of these practical issues in the context of the dominance result described above ii control theoretic formulation in this section we begin with a trader who is forming a portfolio and considering m 2 potential assets for inclu sion we now formulate the frequency dependent portfolio problem in control theoretic terms indeed the system output at stage k is taken to be the trader s time varying account value v k for k 0 1 n 1 and for i 1 2 m we use feedback gains 0 ki 1 to represent the fraction of this amount allocated to the i th asset the inequal ity ki 0 means that the trader is going long and short selling is disallowed in addition ki 1 forces the amount invested to be no more than the account value v k in other words this disallows the use of leverage and possible margin costs this no leverage requirement applied to the portfolio in its entirety leads to the constraint k k k rm ki 0 m i 1 ki 1 that is with k k we have a guarantee that no more than 100 of the account value v k is invested see the conclusion for further discussion now the i th control signal is a linear feedback of the form ii k kiv k which is called the i th investment function the asset returns if asset i is a stock whose price at time k is si k then its return is xi k si k 1 si k si k in the sequel we assume a perfect model for the stochastic process driving the stock prices that is for risky assets we assume that the return vectors x k have a known distribution with components xi k which can be arbitrarily correlated it is also assumed that these vectors are inde pendent and identically distributed i i d with components satisfying xmin i xi k xmax i with known bounds above and with xmax i being finite and xmin i 1 this means that the loss per time step is limited to less than 100 and is interpreted to mean that the price of a stock cannot drop to zero to avoid triviality we assume that at least one of the m assets is riskless with nonnegative rate of return ri 0 that is if asset i is riskless its return is deterministic and is treated as a degenerate random variable xi k ri for all k with probability one the quantity ri is called an interest rate and it is noted that this formulation also allows for the trader to maintain cash in the account by taking ri 0 1 fig 1 feedback configuration for trading dynamics and trading frequency considerations the update in account value from stage k to k 1 for the resulting closed loop system depicted in figure 1 is v k 1 1 ktx k v k letting n be the number of steps between rebalancings at time k 0 the trader begins with investment i 0 kv 0 and waits n steps in the spirit of buy and hold then when k n the investment is updated to be i n kv n continuing in this manner a waiting period of n stages is enforced between each rebalance now to study performance as a function of frequency we use the compound returns xn i n 1 k 0 1 xi k 1 which are readily seen to satisfy xn i 1 for all n and i 1 2 m in the sequel we work with the random vector xn having i th component xn i then for any fixed rebalancing period n and initial account value v 0 0 the corresponding account value at stage n is given by v n 1 ktxn v 0 the frequency dependent optimization problem as a function of n 1 we study the problem of maximizing the expected logarithmic growth gn k 1 n e log v n v 0 1 n e log 1 ktxn 1 there are rare cases when the best possible riskless asset has negative returns and the optimal portfolio which will be discussed in section iv might be one which involves losing money as slowly as possible which is concave in k the associated optimal expected logarithmic growth is obtained as g n max k k gn k and any k n k satisfying gn k n g n is called an optimal kelly fraction for the rebalancing period of length n iii relative attractiveness and dominance as discussed in section i in our prior work 21 the kelly betting problem results can be interpreted in the context of weight selection for a two asset portfolio consisting of one risky asset and one riskless asset we proved that under a simple condition which we called sufficient attractive ness g n is a constant function of n thus when this condition holds trading faster does not lead to performance improvement over a simple buy and hold strategy to extend these results to the case of a portfolio of arbitrary size m we generalize the notion of sufficient attractiveness with the definition below definition relative attractiveness and dominance given a collection of m assets we say that asset j is relatively more attractive than asset i if e 1 xi 0 1 xj 0 1 equivalently asset j is relatively more attractive than asset i if the correlation between 1 xj 0 1 and 1 xi 0 is at most one asset j is said to be dominant if it is relatively more attractive than every other asset i 6 j remarks i when m 2 we note that asset j is dominant if and only if it is relatively more attractive than asset i ii if m 2 and asset i is riskless with xi 0 0 then the dominance of asset j is equivalent to its sufficient attractiveness as defined in 21 iii if m 2 a riskless asset j with interest rate r is easily seen to be relatively more attractive than risky asset i if and only if e xi 0 r iv for a risky asset j to be relatively more attractive than the riskless asset i we require more than just e xj 0 r for example consider returns xj k 1 2 1 2 with p xj k 1 2 0 6 then with xi k r 0 05 a straightforward calculation leads to e xj 0 r but e 1 xi 0 1 xj 0 1 26 which violates the relative attractiveness inequality v al though the condition e xj 0 r is not sufficient for a risky asset j to be relatively more attractive than a riskless asset i the condition is necessary this can be seen by applying jensen s inequality to obtain 1 r e 1 xj 0 e 1 r 1 xj 0 if asset j is relatively more attractive than riskless asset i then the right hand side above is one at most and we obtain 1 r e 1 xj 0 1 from which it follows that e xj 0 r thus e xj 0 r is necessary but not sufficient for risky asset j to be relatively more attractive than riskless asset i v the reader should not confuse the definition of dominant asset with the definition of stochastic dominance recall that stochastic dominance involves only the marginal distributions of two random variables while the dominant asset definition involves the correlation between 1 xj 0 1 and 1 xi 0 which depends on the joint distribution of xj 0 and xi 0 iv dominant asset theorem the theorem below tells us that the satisfaction of the dominant asset inequality leads to an optimal portfolio which involves investing 100 of available funds in a single asset in other words if an asset is dominant bet the farm on it dominant asset theorem given a collection of m assets if asset j is dominant then for all n 1 gn k is maximized by k n ej where ej is the unit vector in the j th coordinate direc tion furthermore the resulting optimal expected logarithmic growth rate is given by g n g 1 e log 1 xj 0 proof in order to prove k n ej it suffices to show that gn k gn ej for k k for notational convenience we work with the random vector rn xn 1 representing the total return with i th component rn i let ting 1 1 1 1 t rm since kt 1 1 for k k it follows that gn k 1 n e log 1 ktxn 1 n e log ktrn hence by applying jensen s inequality to the concave loga rithm function above we obtain a chain of inequalities gn k gn ej 1 n e log ktrn rn j 1 n loge ktrn rn j 1 n log m i 1 kie rn i rn j 1 n log m i 1 kie n 1 k 0 1 xi k 1 xj k 1 n log m i 1 ki e 1 xi 0 1 xj 0 n 1 n log 1 where the last inequality follows from the dominance of asset j and the fact that k k now since log 1 0 it follows that gn k gn ej and g n gn ej to complete the proof it remains to show that g n g 1 this is easily obtained by recalling that the xi k are i i d and observing that g n gn ej 1 n e logrn j 1 n e log n 1 k 0 1 xj k 1 n n 1 k 0 e log 1 xj k e log 1 xj 0 g 1 ej g 1 v application to stock market data per discussion in the introduction in this section our objec tive is to illustrate some of the practical issues which arise when studying asset domination using historical data to this end we consider three assets as portfolio candidates asset 1 is netflix ticker nflx asset 2 is facebook ticker fb and asset 3 is a riskless asset with daily interest rate r 0 we consider the problem of rebalancing our positions in these assets over a four year period beginning on january 24 2013 we work with the adjusted daily closing prices for this period and demonstrate how the dominant asset theorem might apply in practice the price plot for the two stocks in figure 2 begins with the 126 day period prior to the start of trading this data was used as a training set to initialize the analysis to follow 0 200 400 600 800 1000 1200 number of days 0 20 40 60 80 100 120 140 160 180 200 s to ck p ri ce s facebook netflix fig 2 stock prices of facebook and netflix given the fact that a practitioner should rightfully view the stochastic process model for the stock returns xi k as nonstationary when testing for satisfaction of the relative attractiveness inequality we work with a sliding window consisting of the most recent n trading days hence at day k we use an empirical estimate of the expected value for the attractiveness ratio involving the i th and j th assets which is given by rij k 1 n n 1 0 1 xi k 1 xj k the simulations to follow use a window size of n 126 which corresponds to about six months beginning with the initial condition rij 0 established using the training set we generate the rij k over the period of interest in view of the nonstationarity of the returns as seen in the simulation to follow the rij k are time varying hence an asset which is dominant at some point in time may no longer be dominant at a later time with the considerations above we begin our analysis with r 0 and consider the following two questions question 1 in a zero interest rate environment over what time periods is netflix the dominant asset during such periods in accordance with the theorem the trader is non diversified with the entire portfolio in netflix question 2 at stage k how large must the interest rate r be so that the riskless asset is dominant that is when the interest rate is suitably high our theory dictates that the trader has a portfolio which is 100 in fixed income with no positions in netflix and facebook to answer the first question we provide a plot of r 1 k max r 21 k r 31 k versus k in figure 3 and consistent with the theorem we deem netflix to be dominant over the subset of time periods for which r 1 k 1 over the periods when r 1 k 1 there are various additional scenarios which can be studied with the given data for example sometimes there is no dominant asset and at other times either facebook or the riskless asset is dominant 0 200 400 600 800 1000 1200 number of days 0 992 0 994 0 996 0 998 1 1 002 1 004 1 006 r 1 k fo r n e tf lix fig 3 the relative attractiveness plot for netflix to answer the second question we begin with the following observation the theorem tells us that asset 3 the riskless asset is dominant if and only if max e x 1 0 e x 2 0 r again taking the nonstationarity of the data into account we let r k denote the estimated value of the left hand size above based on the most recent n day window that is we take r k 1 n max n 1 0 x 1 k n 1 0 x 2 k in figure 4 we see that there are time periods when the market is performing quite well and it takes a remarkably high interest rate in order to forego investing in the stocks vi conclusion and future work in this paper we showed that if an asset is dominant an optimal trading strategy is to invest all available funds into it for such cases rebalancing becomes moot and the trading performance namely g n is a constant it is also worth 0 200 400 600 800 1000 1200 number of days 2 0 2 4 6 8 10 12 in te re st r a te r k 10 3 fig 4 interest rate for dominance of riskless asset mentioning that the paradigm presented in this paper remains valid for a wide variety of other choices for the admissible feedback gain set k associated with leveraged investments with some components ki 1 for example in 16 this is achieved by imposing a survival constraint which disallows any trade that can potentially lead to v k 0 regarding further research one obvious continuation would be to study the case when ki 0 is allowed as mentioned in section ii this corresponds to short selling in this situa tion we envision a similar definition of dominant asset and results along the lines of those given here a second direction for further work involves the case when no dominant asset exists might it ever be true that g n g 1 we believe that an affirmative answer to this question would be important it would tell us that a low frequency trader such as a buy and holder might strictly outperform the high frequency trader finally it would be important to develop new results on kelly based trading which do not rely knowledge of a perfect stochastic model for the returns xi k for cases when the model is either partially known or completely unknown we plan to investigate the extent to which the theory in this paper can be extended our preliminary work along these lines suggests that there may be a more general version of the dominant asset theorem which is established using asymptotic analysis to obtain performance guarantees for n suitably large references 1 j l kelly a new interpretation of information rate bell system technical journal vol 35 4 pp 917 926 1956 2 h a latane criteria for choice among risky ventures journal political economy vol 67 pp 144 155 1959 3 l breiman optimal gambling systems for favorable games proceedings of the 4 th berkeley symposium on mathematical statistics and probability vol 1 pp 63 68 1961 4 n h hakansson on optimal myopic portfolio policies with and without serial correlation journal of business vol 44 pp 324 334 1972 5 e o thorp optimal gambling systems for favorable games review of the international statistical institute vol 37 pp 273 293 1969 6 p h algoet and t m cover asymptotic optimality and asymptotic equipartition properties of log optimum investment the annals of probability vol 16 pp 876 898 1988 7 t m cover and j a thomas elements of information theory john wiley and sons 2012 8 d g luenberger investment science oxford university press new york 2011 9 e o thorp the kelly criterion in blackjack sports betting and the stock market handbook of asset and liability management theory and methodology vol 1 pp 385 428 elsevier science 2006 10 l c maclean e o thorp and w t ziemba long term capital growth the good and bad properties of the kelly and fractional kelly capital growth criteria quantitative fi nance vol 10 pp 681 687 2010 11 d kuhn and d g luenberger analysis of the rebalancing frequency in log optimal portfolio selection quantitative fi nance vol 10 pp 221 234 2010 12 s r das d kaznachey and m goyal computing optimal rebalance frequency for log optimal portfolios quantitative fi nance vol 14 pp 1489 1502 2014 13 v nekrasov kelly criterion for multivariate portfolios a model free approach social science research network 2014 14 a w lo h a orr and r zhang the growth of relative wealth and the kelly criterion social science research network 2017 15 c h hsieh and b r barmish on kelly betting some limitations proceedings of the allerton conference on communication control and computing pp 165 172 monticello 2015 16 c h hsieh b r barmish and j a gubner kelly betting can be too conservative proceedings of the ieee conference on decision and control pp 3695 3701 las vegas 2016 17 l c maclean e o thorp and w t ziemba the kelly capital growth investment criterion theory and practice world scientific publishing company 2011 18 g c calafiore and b monastero triggering long short trades on indexes international journal of trade economics and fi nance vol 1 pp 289 296 2010 19 c h hsieh and b r barmish on drawdown modulated feedback in stock trading ifac papersonline vol 50 no 1 pp 952 958 2017 20 c h hsieh and b r barmish on inefficiency of markowitz style investment strategies when drawdown is important proceedings of the ieee conference on decision and control pp 3075 3080 mel bourne australia 2017 21 c h hsieh b r barmish and j a gubner at what frequency should the kelly bettor bet proceedings of the ieee american control conference pp 5485 5490 milwaukee 2018 22 b r barmish and j a primbs on a new paradigm for stock trading via a model free feedback controller ieee transactions on automatic control ac 61 pp 662 676 2016 23 j a gubner probability and random processes for electrical and computer engineers cambridge university press 2006 24 j cox s ross and s rubinstein option pricing a simplified approach journal of financial economics vol 7 pp 229 263 1979 i introduction ii control theoretic formulation iii relative attractiveness and dominance iv dominant asset theorem v application to stock market data vi conclusion and future work references