1 sensorless battery internal temperature estimation using a kalman filter with impedance measurement robert r richardson and david a howey member ieee abstract this study presents a method of estimating battery cell core and surface temperature using a thermal model coupled with electrical impedance measurement rather than using direct surface temperature measurements this is advantageous over previous methods of estimating temperature from impedance which only estimate the average internal temperature the performance of the method is demonstrated experimentally on a 2 3 ah lithium ion iron phosphate cell fitted with surface and core thermocouples for validation an extended kalman filter consisting of a reduced order thermal model coupled with current voltage and impedance measurements is shown to accurately predict core and surface temperatures for a current excitation profile based on a vehicle drive cycle a dual extended kalman filter dekf based on the same thermal model and impedance measurement input is capable of estimating the convection coefficient at the cell surface when the latter is unknown the performance of the dekf using impedance as the measurement input is comparable to an equivalent dual kalman filter using a conventional surface temperature sensor as measurement input index terms lithium ion battery impedance temperature thermal model kalman filter state estimation i introduction the sustainable development of transportation relies onthe widespread adoption of electric vehicle ev and hybrid electric vehicle hev technology lithium ion bat teries are suitable for these applications due to their high specific energy and power density however their widespread deployment requires reliable on board battery management systems to ensure safe and optimal performance in partic ular accurate on board estimation of battery temperature is of critical importance under typical operating conditions such as a standard vehicle drive cycle cells may experience temperature differences between surface and core of 20 c or more 1 high battery temperatures could trigger thermal runaway resulting in fires venting and electrolyte leakage while such incidents are rare 2 consequences include costly recalls and potential endangerment of human life the conventional approach to temperature estimation is to use numerical electrical thermal models 3 4 5 6 7 such models rely on knowledge of the cell thermal proper ties heat generation rates and thermal boundary conditions models without online sensor feedback are unlikely to work in practice since their temperature predictions may drift from the true values due to small uncertainties in measurements and the authors are with the department of engineering science uni versity of oxford oxford uk e mail robert richardson david howey eng ox ac uk copyright c 2015 ieee parameters however using additional online measurements typically of the cell surface temperature and of the temperature of the cooling fluid coupled with state estimation techniques such as kalman filtering the cell internal temperature may be estimated with high accuracy 4 5 6 7 however large battery packs may contain several thousand cells 8 and so the requirement for surface temperature sensors on every cell represents substantial instrumentation cost an alternative approach to temperature estimation uses electrochemical impedance spectroscopy eis measurements at one or several frequencies to directly infer the internal cell temperature without using a thermal model 9 10 11 12 13 this exploits the fact that impedance is related to a type of volume averaged cell temperature which we define later in this article for brevity we refer to the use of impedance to infer such a volume averaged temperature as impedance temperature detection itd this has promise for practical application since methods capable of measuring eis spectra using existing power electronics in a vehicle or other application have been developed 14 15 16 how ever just like conventional surface temperature sensors itd alone does not provide a unique solution for the temperature distribution within the cell our previous work showed that by combining itd with surface temperature measurements the internal temperature distribution could be estimated 17 however this approach still requires each cell to be fitted with a surface temperature sensor moreover whilst the itd technique was validated under constant coolant temperature conditions the accuracy of the technique may be reduced if the temperature of the cooling medium is varied rapidly as discussed in section iv thus if the cell electrical thermal properties are known or can be identified this information can be exploited to improve the estimate of the thermal state of the cell or reduce the number of sensors required in this study we demonstrate that itd can be used as the measurement input to a thermal model in order to estimate the cell temperature distribution first an extended kalman filter ekf is used to estimate the cell temperature distribu tion when all the relevant thermal parameters including the convection coefficient are known the thermal model consists of a polynomial approximation pa to the 1 d cylindrical heat equation the measurement input consists of the cell current and voltage along with periodic measurements of the real part of the impedance at a single frequency second a dual ex tended kalman filter dekf is used to identify the convection coefficient online when the latter is not known the predicted core and surface temperatures in each case are validated against core and surface thermocouple measurements with ar x iv 1 50 1 06 16 0 v 1 cs s y 2 5 ja n 20 15 2 agreement to within 0 47 c 2 4 of the core temperature increase the performance of the combined thermal model plus itd estimator is comparable to the performance of the same thermal model coupled with conventional surface temperature measurements table i shows the present study in the context of existing temperature estimation techniques which highlights that this is the first study to use impedance as the measurement input to a thermal model study model measurement tsurf itd forgez et al 3 x x lin et al 5 7 x x kim et al 6 4 x x srinivasan et al 12 9 x raijmakers et al 11 x richardson et al 17 x x present study x x table i comparison of online temperature estimation techniques ii measurement principle the electrochemical impedance z z jz of lithium ion cells is a function of temperature state of charge soc and state of health soh within an appropriate frequency range however the dependence on soc and soh is negligible and the impedance can thus be used to infer information about the cell temperature 12 previous itd studies have used as a temperature dependent parameter the real part of the impedance at a specific frequency 10 the phase shift at a specific frequency 12 9 and the intercept frequency 11 to demonstrate our technique we use the real part of the impedance at f 215 hz our previous work showed that the real part of the cell admittance the inverse of the cell impedance at 215 hz can be related to the temperature distribution using a second order polynomial fit for an annular cell with inner radius ri and outer radius ro the real part of the admittance is given by 17 y 2 r 2 o ro ri r a 1 a 2 t r a 3 t 2 r dr 1 where a 1 a 2 and a 3 are the 1 st 2 nd and 3 rd coefficients of the polynomial relating impedance to uniform cell temperature y a 1 a 2 tuniform a 3 t 2 uniform provided that the admittivity varies in the radial direction only this assumption is valid if the heat transfer from the top and bottom ends of the cell is negligible which is approximately true for cylindrical cells connected in series with identical cells on either end 18 a configuration which may apply to the majority of cells in a large battery pack however the application of this approach to cooling configurations involving substantial end cooling would require a more involved expression for the admittance than eq 1 as well as an appropriate modification to the 1 d thermal model described in the following section moreover although the method is applied to a cylindrical cell the proposed approach could be applied to other geometries in a similar fashion the polynomial fit fig 1 was obtained 0 10 20 30 40 100 200 300 400 500 600 700 t c y 1 data fit a 1 t 2 a 2 t a 3 figure 1 polynomial fit to experimental data of admittance at f 215 hz vs uniform cell temperature by offline impedance measurements on the cell at multiple uniform temperatures 17 itd can be viewed as identifying an eis based volume average temperature teis which is defined as the uniform cell temperature that would give rise to the measured eis 1 thus the impedance input is similar to a conventional temper ature measurement since it is a scalar function of the internal temperature distribution but does not uniquely identify the temperature distribution either measurement can therefore be used in conjunction with a thermal model as shown in fig 2 to estimate core temperature a b figure 2 schematic of a the conventional approach to temperature estimation and b the proposed approach based on itd iii thermal impedance model a thermal model the cell thermal model consists of the heat equation for 1 d unsteady heat conduction in a cylinder given by the following boundary value problem bvp 2 cp t r t t kt 2 t r t r 2 kt r t r t r q t vb 2 a where cp and kt are the density specific heat capacity and thermal conductivity respectively vb is the cell volume and q is the heat generation rate the boundary conditions are given 1 note that since the impedance temperature relationship is non linear as demonstrated in 19 the eis based volume average temperature teis is not necessarily equal to the volume average temperature t although it should also be noted that the two are typically close in value particularly if the temperature variation within the cell is small 3 by t r t r r ro h kt t ro t t t 2 b t r t r r 0 0 2 c where t is the temperature of the heat transfer fluid and h is the convection coefficient a commonly employed expression for the heat source in a lithium ion battery is q i v uocv it uocv t 3 which is a simplified version of the expression first proposed by bernardi et al 20 the first term is the heat generation due to ohmic losses in the cell charge transfer overpotential and mass transfer limitations the current i and voltage v for this expression are measured online the open circuit voltage uocv is a function of soc but is approximated here as a constant value measured at 50 soc since the hev drive cycles employed in this study operate the cell within a small range of soc 47 63 and therefore ocv variation if necessary an estimator of uocv could also be constructed for example using a dynamic electrical model 21 but for clarity and brevity we neglect this here the second term the entropic heat is neglected in this study because i the term uavg t is small 0 uavg t 0 1 mvk 1 within the operated range of soc 3 and ii the net reversible heat would be close to zero when the cell is operating in hev mode b polynomial approximation a polynomial approximation pa is used to approximate the solution of eq 2 a the approximation was first introduced in 6 and is described in detail in that article although the essential elements are repeated here for completeness the model assumes a temperature distribution of the form t r t a t b t r ro 2 d t r ro 4 4 the two states of the model are the volume averaged temper ature t and temperature gradient t 2 r 2 o ro 0 rtdr 2 r 2 o ro 0 r t r dr 5 the temperature distribution is expressed as a function of t and the cell surface temperature tsurf t r t 4 tsurf 3 t 15 ro 8 18 tsurf 18 t 15 ro 2 r ro 2 15 tsurf 15 t 45 ro 8 r ro 4 6 using 2 b the surface temperature can be expressed as tsurf 24 kt 24 kt roh t 15 ktro 48 kt 2 roh roh 24 kt roh t 7 by obtaining the volume average of eq 2 a and of its partial derivative with respect to r a two state thermal model consisting of two odes is obtained x ax bu y cx du 8 where x t t u q t t and y tcore tsurf t are state inputs and outputs respectively the system matrices a b c and d are defined as a 48 h ro 24 kt roh 15 h 24 kt roh 320 h r 2 o 24 kt roh 120 4 kt roh r 2 o 24 kt roh b ktvb 48 h ro 24 kt roh 0 320 h r 2 o 24 kt roh c 24 kt 3 roh 24 kt roh 120 rokt 15 r 2 oh 8 24 kt roh 24 kt 24 kt roh 15 rokt 48 kt 2 roh d 0 4 roh 24 kt roh 0 roh 24 kt roh 9 where kt cp is the cell thermal diffusivity c impedance measurement eq 1 applies to an annulus with inner radius ri and outer radius ro if the inner radius is sufficiently small the cell may be treated as a solid cylinder and eq 1 becomes y 2 r 2 o r 0 0 r a 1 a 2 t r a 3 t 2 r dr 10 substituting eq 6 in eq 10 the real admittance can be expressed as a function of of tsurf t and y a 1 a 2 t 3 a 3 t 2 2 a 3 t 2 surf 4 a 3 ttsurf 15 a 3 r 2 o 2 32 15 a 3 rot 8 15 a 3 rotsurf 8 11 noting from eq 7 that tsurf is itself a function of t and t and the cell parameters admittance is ultimately a function of t and along with the known thermal parameters and environmental temperature in other words for known values of ro kt cp and h the impedance is a function of the cell state and t thus z f t t 12 iv frequency domain analysis in this section we analyze the error associated with the polynomial approximation by comparing the frequency re sponse of the pa model to the frequency response of a full analytical solution of eq 2 a we also examine the approximation employed in 17 which used a combination of impedance and surface temperature measurements but no thermal model to achieve a unique solution in that case it was necessary to impose the assumption of a quadratic solution to the temperature distribution and so we refer to this here as the quadratic assumption qa solution 4 as in 6 the frequency response function of the pa thermal system h s is calculated by h s d c si a 1 b 13 where s j and i is the identity matrix the frequency response of the analytical model is derived in 22 and that of the qa solution is derived in appendix a 60 30 0 30 m a g n it u d e d b 10 4 10 2 10 0 2 0 2 e rr o r d b 15 10 5 0 m a g n it u d e d b 10 4 10 3 10 2 10 0 10 e rr o r d b 40 20 0 20 m a g n it u d e d b 10 4 10 2 10 0 0 5 0 0 5 frequency hz e rr o r d b 10 5 0 m a g n it u d e d b 10 4 10 3 10 2 0 5 0 0 5 frequency hz e rr o r d b analytical polynomial approx qaudratic assumption h 21 s t surf s q s h 11 s t core s q s h 12 t core s t s h 22 s t surf s t s figure 3 comparison of frequency responses of i analytical solution to the 1 d cylindrical heat transfer problem ii the polynomial approximation used in the current study and iii the quadratic assumption used in 17 fig 3 shows the impact of changes in heat generation on tcore and tsurf h 11 and h 21 respectively and the impact of changes in cooling fluid temperature t on tcore and tsurf h 12 and h 22 respectively for each model along with the error relative to the analytical solution the results in these plots were obtained using the thermal parameters of the 26650 cell used in the present study table ii the response of h 11 and h 21 for both the pa and qa models are in good agreement with the analytical solution note that the error in the response of h 21 and h 22 for the qa model is 0 since it takes the measured surface temperature as one of its inputs however the responses for both cases to changes in t are less satisfactory in particular the response h 12 for the qa model shows a rapid increase in error relative to the analytical solution at frequencies above 10 3 hz the pa performs well up to higher frequencies although its error in h 21 and h 22 become unsatisfactory above 10 2 hz however the frequency range at which the pa agrees with the analytical solution is broader than that of the qa model and is considered satisfactory given the slow rate at which the cooling fluid temperature fluctuates in a typical battery thermal management system v experimental experiments were carried out with a 2 3 ah cylindrical cell a 123 model anr 26650 m 1 a length 65 mm diameter 26 mm with lifepo 4 positive electrode and graphite negative electrode the cell was fitted with two thermocouples one on the surface and another inserted into the core via a hole which was drilled in the positive electrode end fig 4 cell cycling and impedance measurements were carried out using a biologic hcp 1005 potentiostat booster the impedance was measured using galvanostatic impedance spectroscopy with a 200 ma peak to peak perturbation current the environmental temperature was controlled with a votsch vt 4002 thermal chamber the chamber includes a fan which operates contin uously at a fixed speed during operation in order to calibrate the impedance against temperature eis measurements were first conducted on the cell in thermal equilibrium at a range of temperatures these experiments and the subsequent identification of the polynomial coefficients a 1 a 2 and a 3 are described in 17 dynamic experiments were then conducted using two 3500 s current excitation profiles the first to parameterise the thermal model and the second to validate the identified parameters and to demonstrate the temperature estimation technique the profiles were generated by looping over different portions of an artemis hev drive cycle the applied currents were in the range 23 a to 30 a for the duration of the experiments single frequency 215 hz impedance measurements were carried out every 24 s and the surface and internal temperatures were also monitored in order to minimise heat loss through the cell ends these were insulated using styrofoam fig 4 before each experiment the soc was adjusted to 50 by drawing a 0 9 c current the temperature of the thermal chamber was set to 8 c and the cell was allowed to rest until its temperature equilibrated before experiments began besides being a function of temperature and soc the impedance is also a function of dc current mainly due to the charge transfer polarization decreasing with increasing current 23 previous results confirmed that when the eis perturbation current is superposed over an applied dc current the impedance measurement is altered 17 to overcome this the cell was allowed to rest briefly for 4 s before each eis measurement was taken i e 20 s periods of the excitation current followed by 4 s rests the duration of this rest period was kept as short as possible to ensure that the thermal response of the cell to the applied cycle was not significantly altered and it was found that the core cell temperature dropped by at most 0 25 c during these rest periods the issue of impedance measurement under dc current warrants further investigation vi model parameterisation validation parameterisation is performed to estimate the values of kt cp and h the density was identified in advance by measuring the cell mass and dividing by its volume the values from the first excitation profile comprising cell current voltage plus surface core and chamber temperatures were used for the estimation the parameterisation was carried out offline using fmin search in matlab to minimise the magnitude of the euclidean distance between the measured and estimated core and surface 5 a 0 500 1000 1500 2000 40 20 0 20 40 td s id a 0 500 1000 1500 2000 10 30 20 td s t thermaldchamber powerdsupplydvdimpedance datadacquisitiondmodule tcore tsurf e temperaturedsensors fordvalidation b c d figure 4 experimental setup for parameter identification and validation a schematic diagram with cutaway view showing cell core and jelly roll b cell drilling procedure c prepared cell inside thermal chamber d power supply thermal chamber temperatures as in 4 table ii compares the identified parameters with the initial guesses and parameters for the same cell from the literature the estimated parameters are close to those reported in the literature the deviations may be attributed to manufacturing variability error in the heat gen eration calculation due to the omission of entropic heating in all of these studies heat generation in the contact resistances between the cell and connecting wires and or measurement uncertainty in the temperature the convection coefficient is within the range expected of forced convection air cooling 24 parameter units reference initial identified kg m 3 2047 2118 4 25 26 2107 cp j kg 1 k 1 1004 9 1109 2 3 7 4 1050 1171 6 kt w m 1 k 1 0 488 0 690 22 25 4 0 55 0 404 h w m 2 20 39 3 table ii comparison of reference estimated parameters the measured core and surface temperatures subscript exp and the corresponding model predictions subscript m for the parameterised model are shown in fig 5 the root mean square errors rmse in the surface and core temperatures are 0 19 c and 0 18 c respectively 0 500 1000 1500 2000 2500 3000 3500 5 10 15 20 25 30 time s t c t core m t surf m t core exp t surf exp figure 5 model parameterisation comparison between measured and predicted core and surface temperatures in the parameterised model the model with identified parameters was validated against the second current excitation profile fig 6 the rmses in the core and surface temperatures were 0 21 c and 0 16 c respectively in this case these errors are only marginally greater than those in the parameterisation test indicating that the estimation is satisfactory 0 500 1000 1500 2000 2500 3000 3500 5 10 15 20 25 30 time s t c t core m t surf m t core exp t surf exp figure 6 model validation comparison between measured and predicted core and surface temperatures in the parameterised model applied to the second current excitation profile vii state estimation kim et al 6 showed that the effect of changes to the value of h on the predicted surface and core temperatures is greater 6 than the effect of changes to the other thermal parameters moreover h depends strongly on the thermal management system settings and its calculation often relies on empirical correlations between coolant flow rates and heat transfer thus there is a need to identify the convection coefficient online during operation this section outlines the use of a dual extended kalman filter dekf 27 for estimating the core and surface temperatures and the convection coefficient the dekf reduces to an ekf if the convection coefficient is assumed known and provided to the model in advance we firstly modify eq 9 by rewriting it as a discrete time model setting the impedance as the model output and explicitly including the dependency on the parameter hk xk 1 a hk xk b hk uk vk 14 yk f xk hk nk 15 hk 1 hk ek 16 where yk z and f xk hk is the non linear function relating the state vector to the measurement i e eq 12 and vk nk and ek are the noise inputs of the covariance matrices rv rn and re the states inputs and measured outputs are thus x t t u q t t and y z note that although the impedance is now the model output the core and surface temperatures are also computed from the identified states and parameter at each time step using eq 8 for validation against the thermocouple measurements a and b are system matrices in the discrete time domain given by a e a t b a 1 a i b 17 where t is the sampling time of 1 s the update processes are then given as follows the time update processes for the parameter filter are h k h k 1 18 phk phk 1 r e 19 where h k and h k are the a priori and a posteriori estimates of the parameter h and phk and phk 1 are the corresponding error covariances the time update processes for the state filter are x k a k 1 x k 1 b k 1 uk 1 20 pxk a k 1 p x k 1 a t k 1 r v 21 where x k and x k are the a priori and a posteriori estimates of the state and pxk and pxk 1 are the corresponding error covariances the matrices a k 1 and b k 1 are calculated by a k 1 a h h h k b k 1 b h h h k 22 since the relationship between impedance and the cell state is non linear the measurement model must be linearised about the predicted observation at each measurement the measurement update equations for the state filter are kxk p x k hxk t hxk p x k h x k t rn 1 23 x k x k k x k zk f x k h k 24 pxk i k x kh x k p x k 25 where kxk is the kalman gain for the state and h x k is the jacobian matrix of partial derivatives of f with respect to x hxk f xk hk xk xk x k 26 the measurement update processes for the parameter filter are khk p h k hhk t hhk p h k hhk t rn 1 27 h k h k k h k zk f x k h k 28 phk i k h kh h k p h k 29 where hhk is the jacobian matrix of partial derivatives of f with respect to h hhk f xk hk hk hk h k 30 the above algorithm can be simplified to a standard ekf by omitting the parameter update processes eqs 16 18 19 and 27 30 and assuming the convection coefficient is fixed in the following section we investigate the performance of both the baseline ekf and the full dekf algorithm viii results we first investigate the performance of an ekf estimator whereby the convection coefficient is provided and assumed fixed we then compare the performance of the dekf algo rithm with that of the baseline ekf when an incorrect initial estimate of the convection coefficient is provided lastly we compare the performance of the dekf with that of a dual kalman filter dkf based on the same thermal model but with tsurf as the measurement input rather than z a convection coefficient known the initial state estimate provided to the battery is x 0 25 0 i e the battery has a uniform temperature distribution at 25 c the true initial battery state is a uniform temperature distribution at 8 c the covariance matrices are calculated as rn 2 n and r v 2 vdiag 2 2 the first tuning parameter is chosen as n 1 10 4 which is a rough estimate of the standard deviation of the impedance measurement the second tuning parameter was chosen as v 0 1 by trial and error fig 7 shows that using the ekf the core and surface temperatures quickly converge to the correct values and are accurately estimated throughout the entire excitation profile the rmses of core and surface temperature are 1 35 c and 1 34 c respectively in contrast the rmses for the open loop model subscript m with no measurement feedback are 6 66 c and 4 42 c respectively it should be noted that since the uncertainty of the impedance measurement typically increases as impedance decreases the temperature estimates could be more uncertain at higher temperatures hence the implementation of this technique could be more challenging at higher ambient temperature conditions than those studied here it should be noted that we also achieved similar performance using a simpler ekf based on z with the assumption that 7 0 500 1000 1500 2000 2500 3000 3500 5 10 15 20 25 30 35 40 45 time s t c 15 16 17 25 27 t core exp t surf exp t core m t surf m t core ekf t surf ekf t core m t surf m figure 7 temperature results for ekf using z as measurement input the impedance is related directly to t rather than to teis however this assumption may lead to unsatisfactory results for cells with a larger radius or when larger temperature gradients exist within the cell moreover since this approach assumes that the impedance is a function of the state only and not the parameter h it is not suitable for the application of the dekf discussed in the following section b convection coefficient unknown next we investigate the performance of the dekf the same incorrect initial state estimate is provided to the battery x 0 25 0 moreover an incorrect initial estimate for the convection coefficient is provided h 0 2 htrue this value of h is also provided to the ekf the error covariance matrix for the parameter estimator is re 2 e where the tuning parameter is chosen as e 2 5 fig 8 compares the results of both of these cases against the thermocouple measurements the ekf is shown to overestimate the core temperature and underestimate the surface temperature for the duration of the experiments this is expected since the impedance measurement ensures the accuracy of the volume averaged cell temperature but the model assumes that the convection coefficient is higher than in reality and therefore the temperature difference across the cell is overestimated in contrast the dekf corrects the convection coefficient and thus improves the accuracy of the subsequent temperature pre dictions this is evident from the errors in the core temperature estimate top plot of fig 8 which initially are similar in both cases but drop to much smaller values for the dekf once the correct convection coefficient is identified the rmses of core and surface temperature in each case are shown in table iii along with the values for the time period 1200 t 3500 s i e after the convection coefficient value has converged finally we investigate the case where tsurf is used as the measurement y tsurf to the estimator rather than z this results in a linear kf and dkf exactly equivalent to that studied in 4 the tuning parameters for the covariance matrices are also chosen to be the same as those employed in 4 the same initial state and parameter estimates are provided as for the dekf fig 9 shows that the standard 0 500 1000 1500 2000 2500 3000 3500 0 2 4 e rr o r c 0 500 1000 1500 2000 2500 3000 3500 5 10 15 20 25 30 35 40 45 t c 16 18 20 22 0 500 1000 1500 2000 2500 3000 3500 20 40 60 80 100 t s h w m 2 k 1 t core exp t surf exp t core ekf t surf ekf t core dekf t surf dekf t core ekf t core exp t core dekf t core exp h true h ekf h dekf figure 8 temperature results for dekf using z as measurement input ekf in this case overpredicts the core temperature by a greater margin than the ekf based on z although the surface temperature estimate is much more accurate this is because the surface thermocouple ensures an accurate surface temper ature estimate and to reconcile this with the overestimated convection coefficient the core temperature estimate is forced to be much greater the dkf correctly identifies the correct convection coefficient in the same way as the dekf since the thermocouple measurement exhibits less noise than the impedance measurement the model converges to the correct estimate for h more quickly than in the defk case as shown by the rmse values in table iii method 0 t 3500 s 1200 t 3500 s tcore tsurf tcore tsurf ekf z 2 04 2 06 1 79 1 98 kf tsurf 2 49 1 44 2 90 1 58 dekf z 1 43 1 24 0 47 0 42 dkf tsurf 0 36 0 33 0 16 0 14 table iii comparison of rmses for core and surface temperatures c with unknown convection coefficient in conclusion the temperature and convection coefficient estimators using z as measurement input are capable of ac curately estimating the core and surface temperatures and the convection coefficient the performance is comparable to that of an estimator using the same thermal model coupled with surface temperature measurements moreover the performance of the present method is superior to that of previous methods based on impedance measurements alone which only provide an estimate of the average internal temperature of the cell 8 0 500 1000 1500 2000 2500 3000 3500 2 0 2 4 6 8 e rr o r c 0 500 1000 1500 2000 2500 3000 3500 5 10 15 20 25 30 35 40 45 t c 16 18 20 22 0 500 1000 1500 2000 2500 3000 3500 20 40 60 80 100 t s h w m 2 k 1 t core exp t surf exp t core ekf t surf ekf t core dekf t surf dekf t core ekf t core exp t core dekf t core exp h true h ekf h dekf figure 9 dkf using tsurf as measurement input ix conclusions impedance temperature detection enables both core and sur face temperature estimation without using temperature sensors in this study the use of itd as measurement input to a cell thermal model is demonstrated for the first time previously we estimated cell temperature distribution by combining itd with a surface temperature measurement and imposing a quadratic assumption on the radial temperature profile frequency domain analysis shows that the qa solution may be inaccurate if the temperature of the cooling fluid has fluctuations on the order of 10 3 hz or higher the pa thermal model used in the present study is robust to higher frequency fluctuations 10 2 hz an ekf using a parameterised pa thermal model with itd measurement input is shown to accurately predict core and surface temperatures for a current excitation profile based on an artemis hev drive cycle a dekf based on the same thermal model and measurement input is capable of accurately identifying the convection coefficient when the latter is not provided to the model in advance the performance of the dekf using impedance as measurement input is comparable to an equivalent dkf estimator using surface temperature as measurement input although the latter is slightly superior due to the higher accuracy of the thermocouple future work will investigate the application of itd to multiple cells in a battery pack as well as investigating methods of combining impedance with conventional sensors to enable more robust temperature monitoring and fault detection and self calibration acknowledgements this work was funded by a nui travelling scholarship a uk epsrc doctoral training award and the foley bejar scholarship from balliol college university of oxford this publication also benefited from equipment funded by the john fell oxford university press oup research fund finally the authors would like to thank peter ireland and adrien bizeray for valuable comments and robin vincent for the facilities to prepare the instrumented battery appendix a frequency domain analysis of quadratic assumption the analysis leading to the frequency response plots of the qa model in fig 3 is outlined in this section the qa model was used in 17 to obtain a unique solution for the temperature distribution when the impedance and surface temperature were measured but the cell thermal properties and heat generation rates were assumed unknown to achieve a unique solution in that case it was necessary to impose the assumption of a quadratic temperature distribution based on the solution of the 1 d heat equation at steady state muratori et al 22 showed that the time domain pde of eq 2 a can be transformed into an equivalent ode problem in the frequency domain which can be solved analytically using this approach the solution for the temperatures at the core and surface of the cell are shown to be tcore s 1 kta 2 q s h kt t s 1 ka 2 q s h kt j 0 aro aj 1 aro 31 tsurf s 1 kta 2 q s h kt t s 1 kta 2 q s h kt j 0 aro aj 1 aro j 0 aro 32 where a 2 s 1 q s is the transform of q t and ji is the ith order bessel function of the first kind 28 eqs 31 and 32 can be interpreted as the outputs of a continuous time dynamic system 22 where u t q t t t t and y t tcore t tsurf t t such that the solution of the bvp is equivalent to the impulse response of the system tcore s tsurf s h 11 s h 12 s h 21 s h 22 s q s t s 33 where the h matrix is formed by the transfer functions h 11 s 1 kta 2 h kt j 0 aro aj 1 aro hkt h kt j 0 aro aj 1 aro 34 h 12 s h kt h kt j 0 aro aj 1 aro 35 h 21 s 1 kta 2 aj 1 aro h kt j 0 aro aj 1 aro 36 h 22 s h kt j 0 aro h kt j 0 aro aj 1 aro 37 this system of transfer functions gives frequency responses for the analytical solution results plotted in fig 3 using a similar approach we can develop an analytical solution to the 9 qa model used in 17 where we denote the new transfer function hqa s in this case both the volume averaged cell temperature identified via the impedance 2 and the surface temperature were measured directly and it is assumed that no other information was available since these two inputs alone are not sufficient to achieve a unique solution for the temperature distribution it was also necessary to impose the following constraint on the temperature profile tqa r tsurf tcore qa tsurf 1 r 2 r 2 o 38 this is the 1 d steady state solution of the heat equation for a cylinder with uniform heat generation 24 with t r and tcore replaced by tqa r and tcore qa the volume average of the qa temperature distribution is set equal to the true volume average temperature giving tqa 2 r 2 o ro 0 rtqa r dr t 39 substituting eq 38 in eq 39 and integrating the qa core temperature becomes tcore qa 2 t tsurf 40 thus an estimate for the core temperature is obtained di rectly from the surface and volume averaged temperature measurements since the surface temperature is measured the values of hqa 21 s and hqa 22 s are identical to the corresponding values of the unsteady thermal model the values of hqa 11 s and hqa 12 s can be obtained as follows substituting t from eq 5 into eq 40 the qa approximation of the core temperature can be expressed as a function of the temperature distribution tcore qa 4 r 2 o ro 0 rt r dr tsurf dr 41 substituting eqs 31 and 32 for t r and tsurf respectively and integrating noting that ro 0 rj 0 ar dr roj 1 aro a we obtain tcore qa q s kta 2 h kt t s 1 kta 2 q s h kt j 0 aro aj 1 aro 4 j 1 aro aro j 0 aro 42 thus the qa system model is given by tcore qa s tsurf qa s hqa 11 s hqa 12 s hqa 21 s hqa 22 s q s t s 43 2 as discussed in section i the impedance actually identifies teis which is not necessarily equal to t however the assumption that teis t is satisfactory for the purpose of identifying the frequencies at which errors relative to the analytical solution become significant and is only used for this purpose in this article where the h matrix is formed by the functions hqa 11 s kta 2 roj 1 aro 2 hroaj 0 aro 4 hj 1 aro ktroa 3 hj 0 aro ktaj 1 aro 44 hqa 21 s hkta 3 j 0 aro 4 hkta 2 j 1 aro ktroa 3 hj 0 aro ktaj 1 aro 45 hqa 12 s h 21 s 46 hqa 22 s h 22 s 47 references 1 u s kim c b shin and c s kim modeling for the scale up of a lithium ion polymer battery j power sources vol 189 no 1 pp 841 846 apr 2009 2 q wang p ping x zhao g chu j sun and c chen thermal runaway caused fire and explosion of lithium ion battery j power sources vol 208 pp 210 224 jun 2012 3 c forgez d vinh do g friedrich m morcrette and c delacourt thermal modeling of a cylindrical lifepo 4 graphite lithium ion bat tery j power sources vol 195 no 9 pp 2961 2968 may 2010 4 y kim s mohan s member j b siegel a g stefanopoulou and y ding the estimation of temperature distribution in cylindrical battery cells under unknown cooling conditions ieee trans con trol syst technol pp 1 10 2014 5 x lin h e perez j b siegel a g stefanopoulou r d anderson and m p castanier online parameterization of lumped thermal dynamics in cylindrical lithium ion batteries for core temperature estimation and health monitoring ieee trans control syst technol vol 21 no 5 pp 1745 1755 sep 2013 6 y kim j b siegel and a g stefanopoulou a computationally efficient thermal model of cylindrical battery cells for the estimation of radially distributed temperatures in american control conference acc washington dc 2013 pp 698 703 7 x lin h e perez s mohan j b siegel a g stefanopoulou y ding and m p castanier a lumped parameter electro thermal model for cylindrical batteries j power sources vol 257 pp 1 11 jul 2014 8 a pesaran g h kim and m keyser integration issues of cells into battery packs for plug in and hybrid electric vehicles in evs 24 international battery hybrid and fuel cell electric vehicle symposium no may stavanger norway 2009 9 r srinivasan monitoring dynamic thermal behavior of the carbon anode in a lithium ion cell using a four probe technique j power sources vol 198 pp 351 358 jan 2012 10 j p schmidt s arnold a loges d werner t wetzel and e ivers tiff e measurement of the internal cell temperature via impedance evaluation and application of a new method j power sources vol 243 pp 110 117 jun 2013 11 l raijmakers d danilov j van lammeren m lammers and p notten sensorless battery temperature measurements based on electrochemical impedance spectroscopy j power sources vol 247 pp 539 544 feb 2014 12 r srinivasan b g carkhuff m h butler and a c baisden instantaneous measurement of the internal temperature in lithium ion rechargeable cells electrochimica acta vol 56 no 17 pp 6198 6204 jul 2011 13 j zhu z sun x wei and h dai a new lithium ion battery internal temperature on line estimate method based on electrochemical impedance spectroscopy measurement journal of power sources vol 274 pp 990 1004 jan 2015 14 d a howey p d mitcheson s member v yufit g j offer and n p brandon on line measurement of battery impedance using motor controller excitation ieee trans veh technol vol 63 no 6 pp 2557 2566 2014 15 n brandon p mitcheson d a howey v yufit and g j offer battery monitoring in electric vehicles hybrid vehicles and other applications 2012 16 w huang and j abu qahouq an online battery impedance measure ment method using dc dc power converter control ieee trans ind electron vol 0046 no c pp 1 1 2014 17 r r richardson p t ireland and d a howey battery internal temperature estimation by combined impedance and surface temperature measurement j power sources vol 265 pp 254 261 may 2014 10 18 m fleckenstein o bohlen m a roscher and b b ker current density and state of charge inhomogeneities in li ion battery cells with lifepo 4 as cathode material due to temperature gradients j power sources vol 196 no 10 pp 4769 4778 jan 2011 19 y troxler b wu m marinescu v yufit y patel a j marquis n p brandon and g j offer the effect of thermal gradients on the performance of lithium ion batteries journal of power sources no 247 pp 1018 1025 jun 2013 20 d bernardi e pawlikowski and j newman a general energy balance for battery systems j electrochem soc vol 132 no 1 pp 5 12 1985 21 c r birkl and d a howey model identification and parameter esti mation for lifepo 4 in iet hybrid and electric vehicles conference 2013 hevc 2013 2013 pp 1 6 22 m muratori n ma m canova and y guezennec a model order re duction method for the temperature estimation in a cylindrical li ion battery cell asme 2010 dynamic systems and control conference volume 1 no 7 pp 633 640 2010 23 b ratnakumar m smart l whitcanack and r ewell the impedance characteristics of mars exploration rover li ion batteries j power sources vol 159 no 2 pp 1428 1439 sep 2006 24 f p incropera and d p de witt fundamentals of heat and mass transfer 6 th ed wiley 2007 25 h khasawneh j neal m canova and y guezennec analysis of heat spreading thermal management solutions for lithium ion batteries in asme 2011 international mechanical engineering congress and exposition 2011 pp 421 428 26 x li f he and l ma thermal management of cylindrical batteries investigated using wind tunnel testing and computational fluid dynamics simulation j power sources vol 238 pp 395 402 sep 2013 27 e a wan and a t nelson dual extended kalman filter methods in kalman filtering and neural networks new york ny wiley 2001 pp 123 173 28 e kreyszig advanced engineering mathematics john wiley sons 2010 robert r richardson received the b eng degree in mechanical engineering from the national uni versity of ireland galway in 2012 he is currently working toward the d phil phd degree in the en ergy and power group department of engineering science university of oxford oxford u k where his research is focused on impedance based battery thermal management david a howey m 10 received the b a and m eng degrees from cambridge university cam bridge u k in 2002 and the ph d degree from imperial college london london u k in 2010 he is currently a lecturer with the energy and power group department of engineering science univer sity of oxford oxford u k he leads projects on fast electrochemical modeling model based battery management systems battery thermal management and motor degradation his research interests include condition monitoring and management of electric vehicle electric vehicle components i introduction ii measurement principle iii thermal impedance model iii a thermal model iii b polynomial approximation iii c impedance measurement iv frequency domain analysis v experimental vi model parameterisation validation vii state estimation viii results viii a convection coefficient known viii b convection coefficient unknown ix conclusions appendix a frequency domain analysis of quadratic assumption references biographies robert r richardson david a howey