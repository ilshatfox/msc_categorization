fre chet means for distributions of persistence diagrams katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 abstract given a distribution on persistence diagrams and observations x 1 xn iid we introduce an algorithm in this paper that estimates a fre chet mean from the set of diagrams x 1 xn if the underlying measure is a combi nation of dirac masses 1 m m i 1 zi then we prove the algorithm converges to a local minimum and a law of large numbers result for a fre chet mean computed by the algorithm given observations drawn iid from we illustrate the conver gence of an empirical mean computed by the algorithm to a population mean by simulations from gaussian random fields 1 introduction there has been a recent effort in topological data analysis tda to incorporate ideas from stochastic modeling much of this work involved the study of random abstract simplicial complexes generated from stochastic processes 22 23 11 10 14 12 and non asymptotic bounds on the convergence or consistency of topological summaries as the number of points increase 19 20 6 4 2 the central idea in these papers has been to study statistical properties of topological summaries of point cloud data in 16 it was shown that a commonly used topological summary the persistence diagram 8 admits a well defined notion of probability distributions and notions such as expectations variances percentiles and conditional probabilities the key contribution of this paper is characterizing fre chet means and variances of finitely many persistence diagrams and providing an algorithm for estimating them exis tence of these means and variances was previously shown however a procedure to compute means and variances was not provided in this paper we state an algorithm which when given an observed set of persis tence diagrams x 1 xn computes a new diagram which is a local minimum of the fre chet function of the empirical measure corresponding to the empirical distribu tion n n 1 n i 1 xi in the case where the diagrams are sampled independently and identically from a probability measure that is a finite combination of dirac masses we provide a weak law of large numbers for the local minima computed by the algorithm we propose date march 21 2013 1 ar x iv 1 20 6 27 90 v 2 m at h s t 2 0 m ar 2 01 3 2 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 2 persistence diagrams and alexandrov spaces with curvature bounded from below in this section we state properties of the space of persistence diagrams that we will use in the subsequent sections we first define persistence diagrams and the l 2 wasserstein metric on the set of persistence diagrams note that this is not the same metric as was used in 16 we discuss the relation between the two metrics and why we work with the l 2 wasserstein metric later in this section we then show that the space of persistence diagrams is a geodesic space and specifically an alexandrov space with curvature bounded from below we show that the fre chet function in this space is semiconcave which allows us to define supporting vectors which will serve as an analog of the gradient the supporting vectors will be used in the algorithm developed in the following section to find local minima the algorithm is a gradient descent based method 2 1 persistent homology and persistence diagrams consider a topological space x and a bounded continuous function f x r for a threshold a we define sublevel sets xa f 1 a for a b inclusions xa xb induce homomor phisms of the homology groups of sublevel sets f a b h xa h xb for each dimension we assume the function f is tame which means that f c c is not an isomorphism for any 0 at only a finite number of c s for all dimensions and h xa is finitely generated for all a r we also assume that the homology groups are defined over field coefficients e g z 2 by the tameness assumption the image f a b imf a b h xb is independent of 0 if is small enough the quotient group ba h xa f a a is the cokernel of f a a and captures homology classes which did not exist in sublevel sets preceding xa this group is called the th birth group at xa and we say that a homology class h xa is born at xa if its projection onto ba is nontrivial consider the map g a b b a h xb f a b and denote its kernel as d a b the kernel captures homology classes that were born at xa but at xb are homologous to homology classes born before xa we say that a homology class h xa that was born at xa dies entering xb if its projection onto d a b is 0 but its projection to d a b is nontrivial for all sufficiently small 0 we also call b a degree r death value of ba if rankd a b rankd a b r 0 for all sufficiently small 0 if a homology class is born at xa and dies entering xb we set b a and d b and represent the births and deaths of dimensional homology classes by a multiset of points in r 2 with the horizontal axis corresponding to the birth of a fre chet means for distributions of persistence diagrams 3 class the vertical axis corresponding to the death of a class and the multiplicity of a point being the degree of the death value the idea of a persistence diagram is to consider a basis of persistent homology classes and to represent each persistent homology class by a point b d the persistence of is the difference pers d b in the general setting we could have points with infinite persistence which corresponds to points of the form y or x these points are infinitely far from all points on finite persistence and hence would have to be treated separately the space of persistence diagrams would be forced to be disconnected with each component corresponding to the number of points at infinity for the sake of clarity we will restrict ourselves to the case where all classes have finite persistence this can be achieved by considering extended persistence but for simplicity we can simply kill everything by setting g a b 0 if b supx x f x after establishing some notation we can define persistence diagrams and the distance between two diagrams let x y r 2 x y be the diagonal in r 2 let x y be the usual euclidean distance if x and y are off diagonal points with a slight abuse of notation let x denote the perpendicular distance between x and the diagonal and 0 definition 2 1 a persistence diagram is a countable multiset of points in r 2 along with the infinitely many copies of the diagonal x y r 2 x y we also require for the countably many points xj r 2 not lying on the diagonal that j xj each point p a b in a persistence diagram corresponds to some homology class with b a and d b as a slight abuse of notation we say that p is born at b p b and dies at d p d we denote the set of all persistence diagrams by d one metric on d is the l 2 wasserstein metric 1 dl 2 x y 2 inf x y x x x x 2 here we consider all the possible bijections between the off diagonal points and copies of the diagonal in x and the off diagonal points and copies of the diagonal in y bijections always exist as any point can be paired to the diagonal we will call a bijection optimal if it achieves this infimum in much of the computational topology literature the following p th wasserstein distance between two persistence diagrams x and y is used dwp x y inf x x x x p 1 p 4 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 in 16 the above metric was used to define the following space of persistence dia grams dp x dwp x with p 1 and is the diagram with just the diagonal it was shown in 16 thm 6 and 10 that dp is a complete separable metric space and probability measures on this space can be defined given a probability measure on dp the existence of a fre chet mean was proven under restrictions on the space of persistence diagrams dp 16 thm 21 and lemma 27 the basic requirement is that has a finite second moment and the support of has compact support or is concentrated on a set with compact support in this paper we focus on the l 2 wasserstein metric since it leads to a geodesic space with some known structure thus we consider the space of persistence diagrams dl 2 x dl 2 x the results stated in the previous paragraph will also hold for dl 2 with metric dl 2 including existence of fre chet means this follows from the fact that for any x y r 2 2 x y x y 2 2 x y so dw 2 x y dl 2 x y 2 dw 2 x y this inequality coupled with the results in 7 implies the following stability result for the l 2 wasserstein distance theorem 2 2 let x be a triangulable compact metric space such that dwk diag h k cx for any tame lipschitz function h x r with lipschitz constant 1 where diag h denotes the persistence diagram of h k 1 2 and cx is a constant de pending only on the space x then for two tame lipschitz functions f g x r we have dl 2 diag f diag g 2 k 2 2 c f g 2 k 1 2 where c cx max lip f k lip g k for ease of notation in the rest of the paper we denote dl 2 x y 2 as d x y 2 proposition 2 3 for any diagrams x y dl 2 the infimum in 1 is always achieved we prove this proposition in the appendix we now show that the space of persistence diagrams with the above metric is a geodesic space a rectifiable curve 0 l x is called a geodesic if it is locally minimizing and parametrized proportionally to the arc length if is also globally minimizing then it is said to be minimal dl 2 is a geodesic space if every pair of points is connected by a minimal geodesic now consider diagrams x x and y y and some optimal pairing between the points in x and y let 0 1 dl 2 be the path from x to y where t is the diagram with points which have travelled in a straight line from the point which can be a copy of the fre chet means for distributions of persistence diagrams 5 diagonal x to the point which can be a copy of the diagonal for a distance of t x x in other words the diagram with points 1 t x t x x x 1 is a geodesic from x to y the proof of this is the observation that xt x t where xt x 1 t x t x 3 is optimal 2 2 gradients and supporting vectors on dl 2 we will propose a gradient descent based algorithm to compute fre chet means to analyze and understand the algorithm we will need to understand the structure of dl 2 we will show that dl 2 is an alexandrov space with curvature bounded from below see 5 for more informa tion on these spaces this result is not so surprising since there are known relations between l 2 wasserstein spaces and alexandrov spaces with curvature bounded from below 21 13 the motivating idea behind these spaces was to generalize the results of riemannian geometry to metric spaces without riemannian structure the property and behavior of fre chet means is closely related to the curvature of the space for metric spaces with curvature bounded from above called cat spaces 2 properties of fre chet means have been investigated and there exist algorithms to compute fre chet means 25 dl 2 is not a cat space see proposition 2 4 dl 2 is however an alexandrov space with curvature bounded from below less is known about properties of fre chet means in these spaces as well as algorithms to compute fre chet means we use the structure of alexandrov spaces with curvature bounded from below to compute estimates of fre chet means and provide some analysis of these estimates note that fre chet means are the same as barycenters which is what is referred to in much of the literature we first confirm that dl 2 is not a cat space proposition 2 4 dl 2 is not in cat k for any k 0 proof if dl 2 cat k then for all x y dl 2 with d x y 2 2 k there is a unique geodesic between them 3 proposition 2 11 however we can find x y arbitrarily close with two distinct geodesics one example is taking x to be a diagram with two diagonally opposite corners of a square and y a diagram with the other two corners the horizontal and vertical paths are equally optimal and we may choose the square to be as small as we wish the following inequality characterizes alexandrov spaces with curvature bounded from below by zero 21 given a geodesic space x with metric d for any geodesic 0 1 x from x to y and any z x d z t 2 td z y 2 1 t d z x 2 t 1 t d x y 2 4 1 if both x and x are the diagonal then this is the diagonal if exactly one of x or x is the diagonal then we replace it in this sum by the closest point in the diagonal to x or x respectively 2 terminology given by gromov 9 that stands for cartan alexandrov and toponogov 6 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 we now show that dl 2 is a non negatively curved alexandrov space theorem 2 5 the space of persistence diagrams dl 2 with metric d given in 1 is a non negatively curved alexandrov space proof first observe that dl 2 is a geodesic space let 0 1 dl 2 be a geodesic from x to y and let z dl 2 be any diagram we want to show that the inequality 4 holds let be an optimal bijection between x and y which induces the geodesic that is t 1 t x t x x x and defined t x tx 1 t x as done in 3 let tz z t be optimal construct bijections x z z x and y z z y by xz t 1 tz and y z x z there is no reason to suppose that either bijections xz or y z are optimal note that if t z z then x z z and yz z from the formula for the distance in dl 2 we observe 5 d z t 2 z z z tz z 2 z z z 1 t xz z t y z z 2 d z y 2 z z z yz z 2 d z x 2 z z z xz z 2 d x y 2 z z xz z x z z 2 z z xz z y z z 2 euclidean space has everywhere curvature zero so for each z in the diagram z and all t 0 1 we have z 1 t xz z t y z z 2 t z yz z 2 1 t z xz z 2 t 1 t xz z y z z combining these equalities with inequalities 5 gives us the desired result 2 3 properties of the fre chet function given a probability distribution on dl 2 we can define the corresponding fre chet function to be f dl 2 r y 7 d l 2 d x y 2 d x the fre chet mean set of is the set of all the minimizers of the map f on dl 2 if there is a unique minimizer then this is called the fre chet mean of the variance is then defined to be the infimum of the above functional we will show that the fre chet function has the nice property of being semiconcave for an alexandrov space a locally lipschitz function f r is called concave if for any unit speed geodesic in the function f t t 2 2 fre chet means for distributions of persistence diagrams 7 is concave a function f r is called semiconcave if for any point x there is a neighborhood x of x and r such that the restriction f x is concave proposition 2 6 if the support of is bounded as in has bounded diameter then the corresponding fre chet function is semiconcave proof we will first show that if the support of a probability distribution is bounded then the corresponding fre chet function is lipschitz on any set with bounded di ameter we then show that for any unit length geodesic and any x dl 2 the function gx s d s x 2 s 2 is concave we then complete the proof by showing the fre chet function f is 2 concave at every point and hence f is semiconcave by considering f s s 2 as gx s d x let u be a subset of dl 2 with bounded diameter this means that there is some k such that for any y u we have d x y d x k here we are also using that the support of is bounded let y z u then f y f z d x y 2 d x z 2 d x d x y d x z d x z d x y d x d z y d x z d x y d x 2 kd z y let be a unit speed geodesic and x dl 2 consider the function gx s d s x 2 s 2 we want to show that gx is concave which means that gx tx 1 t y tgx x 1 t gx y let t be the geodesic from x to y traveling along so that 1 t x ty t for t 0 1 and tgx x 1 t gx y td 0 x 2 1 t d 1 x 2 tx 2 1 t y 2 d t x 2 t 1 t d 0 1 2 tx 2 1 t y 2 d t x 2 t 1 t x y 2 tx 2 1 t y 2 d t x 2 tx 1 t y 2 gx tx 1 t y the inequality comes from the defining inequality 4 that makesdl 2 a non negatively curved alexandrov space 8 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 by the construction of gx we can think of f s s 2 as gx s d x this means that we can write t f x x 2 1 t f y y 2 tgx x 1 t gx y d x the concavity of gx ensures that tgx x 1 t gx y gx tx 1 t y and hence t f x x 2 1 t f y y 2 gx tx 1 t y d x f tx 1 t y tx 1 t y 2 we now define the additional structure on alexandrov spaces with curvature bounded from below that we will need to define gradients and supporting vectors this ex position is a summary of the content in 21 24 given a point y in an alexandrov space a with non negative curvature we first define the tangent cone ty let y be the set of all nontrivial unit speed geodesics emanating from y for y the angle between them defined by y arccos lim s t 0 s 2 t 2 d s t 2 2 st 0 when the limit exists we define the space of directions y y at y as the completion of y with respect to y where if y 0 the tangent cone ty is the euclidean cone over y ty y 0 y 0 dty s t 2 s 2 t 2 2 st cos y the inner product of u s v t ty is defined as u v y st cos y 1 2 s 2 t 2 dty u v 2 a geometric description of the tangent cone ty is as follows y dl 2 has countably many points yi off the diagonal a tangent vector is a set of vectors vi r 2 one assigned to each yi along with countably many vectors at points along the diagonal pointing perpendicular to the diagonal such that the sum of the squares of the lengths of all these vectors is finite observe that there can exist tangent vectors such that the corresponding geodesic may not exist for any positive amount of time the angle between two tangent vectors is effectively a weighted average of all the angles between the pairs of vectors we now define differential structure as a limit of rescalings for s 0 denote the space a s d by sa and define the map is sa a for an open set a and fre chet means for distributions of persistence diagrams 9 any function f r the differential of f at a point p is a map tp r is defined by dpf lim s s f is f p f is sa r for semiconcave functions the above differential is well defined and we can study gradients and supporting vectors definition 2 7 gradients and supporting vectors given an open set a and a function f r we denote by pf the gradient of a function f at a point p pf is the vector v tp such that i dpf x v x for all x tp ii dpf v v v for a semiconcave f the gradient exists and is unique theorem 1 7 in 15 we say s tp is a supporting vector of f at p if dpf x s x for all x tp note that pf is a supporting vector if it exists in the tangent cone at p lemma 2 8 i if s is a supporting vector then s pf ii if p is local minimum of f and s is a supporting vector of f at p then s 0 proof i first observe that from the definitions of pf and supporting vectors we have pf pf dpf pf s pf we also know that 0 pf s pf s pf pf 2 pf s s s these inequalities combined tell us that 0 pf pf s s ii if p is a local minimum of f then dpf x 0 for all x tp in particular dp s 0 since s is a supporting vector s s dpf s 0 this implies s s 0 and hence s 0 we care about gradients and supporting vectors because they can help us find local minima of the fre chet function indeed a necessary condition for f to have local minimum at y is s 0 for any supporting vector s of f at y since the tangent cone at y is a convex subset of a hilbert space we can take integrals over probability measures with values in ty this allows us to find a formula for a supporting vector of the fre chet function f proposition 2 9 let y dl 2 for each x dl 2 let fx z 7 d x z 2 i if is a distance achieving geodesic from y to x then the tangent vector to at y of length 2 d x y is a supporting vector at y for fx ii if sx is a supporting vector at y for the function fx for each x supp then s sxd x is a supporting vector at y of the fre chet function f corresponding to the distribution 10 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 proof i let be a unit speed geodesic from y to x consider the tangent vector sx 2 d x y let t i denote the point in t that is sent to xi x since is a distance achieving geodesic we know that inf 0 x i xi xi 2 i xi 0 i 2 fx y to show dy fx v sx v for all v ty it is sufficient to consider vectors of the form 1 where is a unit speed geodesic starting at y let t i denote the point in t which started at 0 i this means that xi 7 t i is a bijection from x to t and dy fx v d dt t 0 fx t lim t 0 fx t fx y t lim t 0 inf xi xi 2 xi 0 i 2 x t t lim t 0 xi t i 2 xi 0 i 2 t lim t 0 0 i t i 2 2 0 i t i xi 0 i cos i t where i is the angle between the paths s 7 s i and t 7 t i in the plane now xi 0 i d x y i 0 i d x y s i 0 i s for all s 0 and 0 i t i 2 t 2 0 i 1 i 2 for all t this implies that dy fx v 2 d x y lim t s 0 t i 0 i s i 0 i cos i st recall from our construction of the tangent cone that v sx 2 dl 2 x y cos y 2 d x y lim s t 0 s 2 t 2 d s t 2 2 st 2 d x y lim s t 0 s i 0 i 2 t i 0 2 s i t i 2 2 st 2 d x y lim t s 0 t i 0 i s i 0 i cos i st by comparing these equations we get dy fx v v sx and thus we can conclude sx is a supporting vector fre chet means for distributions of persistence diagrams 11 ii now let sx be any supporting vector of fx by its definition we know that dy fx v sx v for all v ty and hence dy f v dy fx v d x sx v d x sxd x v in the following section we provide an algorithm that computes a local minimum of a fre chet function using a gradient descent procedure the above results will be used since computing a supporting vector of z 7 d x z 2 can be significantly easier and faster than computing a supporting vector of f itself 3 finding local minima of the fre chet function in this section we state an algorithm that computes a fre chet mean of a finite set of persistence diagrams with finitely many off diagonal points and examine convergence properties of this algorithm we will restrict our attention to diagrams with only finitely many off diagonal points with multiplicity of the points allowed given a set of persistence diagrams xi mi 1 a fre chet mean y is a diagram that satisfies min y d l 2 fm d l 2 d x y 2 d m x with the empirical measure m m 1 m i 1 xi we employ a greedy search algorithm based on gradient descent to find a local minimum a key component of this greedy algorithm see algorithm 1 consists of a variant of the kuhn munkres hungarian algorithm 18 the hungarian algorithm finds the least cost assignment of tasks to people under the assumption that the number of tasks and people are the same the input is the cost for each person to do each of the tasks suppose we have two diagrams x and y each with only finitely many off diagonal points consider as many copies of the diagonal in x and y to allow the option of matching every off diagonal point with the diagonal we can think of the points and copies of the diagonal in x as the people and the points and copies of the diagonal in y as tasks the cost of x x doing task y y is x y 2 the total cost of an assignment or in other words bijection of tasks to people is x x x x 2 the hungarian algorithm gives us a bijection that minimizes this cost this means it gives an optimal pairing between x and y we would like to use the arithmetic mean of points in the plane and some number of copies of the diagonal if x 1 xm are points in r 2 then there arithmetic mean w 1 n m i 1 xi is the choice of z that minimizes the sum m i 1 z xi 2 if xi for all i then the arithmetic mean is set to be the final case without loss of generality is when x 1 xk are all off diagonal points and xk 1 xm are all the 12 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 diagonal let w be the normal arithmetic mean of x 1 xk and let w be the closest point on the diagonal to w we set w kw m k w m to be the arithmetic mean of x 1 xm this is the choice of z that minimizes m i 1 z xi 2 we use an operation meani 1 m x j i that computes the arithmetic mean for each pairing over the diagrams suppose y is our current estimate for the fre chet mean using the hungarian algorithm we compute optimal pairings between y and each of the xi we denote these pairings as yj xji ji j 1 where ji is the number of off diagonal in xi and y combined for each yj 6 we then consider all the xij let y j be the arithmetic mean of the xij whenever in our pairings yj x j i ji j 1 we see a x j i we think this as a different copy of the diagonal as in any pairing between y and xk with k 6 i we would be using the arithmetic mean of m 1 copies of the diagonal and x j i let y be the diagram with points y j we will show later that if y y then y is a local minimum of the fre chet function otherwise we chose y to be our current estimate the basic steps of algorithm 1 is to a randomly initialize the mean diagram for example we can start at one of the m persistence diagrams or the midway point of two of the m diagrams b use the hungarian algorithm to compute optimal pairings between the esti mate of the mean diagram and each of the persistence diagrams c update each point in the mean diagram estimate with the arithmetic mean over all diagrams each point in the mean diagram is paired with a point possibly on the diagonal in each diagram d if the updated estimate locally minimizes fm then return the estimate oth erwise return to step b an alternative to the above greedy approach would be a brute force search over point configurations to find a fre chet mean one way to do this is to list all possible pairings between points in each pair of diagrams then compute the arithmetic mean for all such pairings one of these means will be a fre chet mean while this approach will find the complete mean set its combinatorial complexity is prohibitive 3 1 convergence of the greedy algorithm the remainder of this section pro vides convergence properties for algorithm 1 by convergence we mean that the algorithm will terminate at some point having found a local minimum the reason for this is that at each iteration the cost function fm decreases at each iteration the algorithm uses a new set of pairings and there are only finitely many combinations of pairings between points in the diagrams we first develop necessary and sufficient conditions for a diagram y to be a local minimum of a set of persistence diagrams we define fi z d z xi 2 the fre chet fre chet means for distributions of persistence diagrams 13 algorithm 1 algorithm for computing the fre chet mean y from persistence diagrams x 1 xm input persistence diagrams x 1 xm return fre chet mean y draw i uniform 1 n randomly draw a diagram initialize y xi initialize y stop false repeat k y the number of non diagonal points in y for i 1 m do yj x j i hungarian y xi compute optimal pairings between each xi and y using the hungarian algorithm for j 1 k do yj meani 1 m x j i set each non diagonal point in y to the arithmetic mean of its pairings if hungarian y xi yj x j i then stop true the points in the updated y are optimal pairings w r t each xi until stop true return y function corresponding to xi this allows us to define the fre chet function as f 1 m m i 1 fi corresponding to the the distribution 1 m m i 1 xi the following lemma provides a necessary condition for a diagram to be a local minimum of f this condition is the stopping criterion in algorithm 1 lemma 3 1 if w wi is a local minimum of the fre chet function f 1 m m j 1 fj f then there is a unique optimal pairing from w to each of the xj which we denote as j and each wi is the arithmetic mean of the points j wi j 1 2 m furthermore if wk and wl are off diagonal points such that wk wl 0 then j wk j wl 0 for each j proof let j be some optimal pairings not yet assumed to be unique between y and xj and let sj be the corresponding vectors in the tangent cone at y that are tangent to the geodesics induced by j and are of length d xj y the 2 sj are supporting vectors for the functions fj y d y xj 2 by proposition 2 9 so we have 2 m m j 1 sj is a supporting vector of f 14 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 from lemma 2 8 we know that 2 m m j 1 sj 0 since at each wi the sj gives the vector from wi to j wi m j 1 sj 0 implies that wi is the arithmetic mean of the points j wi j 1 2 m now suppose that k and k are both optimal pairings by the above reasoning we have 1 m s k m j 1 j 6 k sj 0 1 m m j 1 sj and hence s k sk this implies that k wi k wi 0 for all wi w in particular for off diagonal points wk and wl with wk wl 0 and k an optimal pairing we can consider the pairing k with wk and wl swapped since k wi k wi 0 for all wi w we can conclude that j wk j wl we now prove that the above is also a sufficient condition for w to be a local minimum of f when f is the fre chet function for the measure 1 m i xi withe the diagrams xi each with finitely many off diagonal points this requires a result about a local extension of optimal pairings proposition 3 2 let x and y be diagrams each with only finitely many off diag onal points such that there is a unique optimal pairing yx between them and no off diagonal point in x matches the diagonal in y we further stipulate that if yk and yl are off diagonal points with yk yl 0 then yx 1 yk yx 1 yl 0 there is some r 0 such that for every z b y r there is a unique optimal pairing between x and z and this optimal pairing is induced from the one from x to y by this we mean there is a unique optimal pairing zy from y to z and that the unique optimal pairing from x to z is zy y x furthermore if x 1 x 2 xm and y are diagrams with finitely many off diagonal points such that there is a unique optimal pairing yxi between xi and y for each i with the same conditions as above then there is some r 0 such that for every z b y r there is a unique optimal pairing between each xi and z and this optimal pairing is induced by the one from xi to y proof since y has only finitely many off diagonal points there is some 0 such that for every diagram z with d y z there is a unique geodesic from y to z for each bijection of points in x to points in y define the function g between x and points in b y by setting g x z x x x zy x 2 z z z y 1 z z 2 where zy is the optimal pairing that comes from the unique geodesic from y to z first note that g x z x x x z y x 2 d y z 2 since there are only finitely many points in x and y there is a bound m on x x m is a bound on x zy x for all x and all we also know z y x x d y z for all x x let k be the number of off diagonal points in diagrams x and y fre chet means for distributions of persistence diagrams 15 combined g x z xi zy xi 2 d y z 2 x x x x x zy x 2 d y z 2 x x x x 2 x zy x 2 2 x x x zy x d y z 2 g x y 2 d y z 2 2 md y z k similarly g x y g x z 2 d y z 2 2 mkd z y let yx be the optimal pairing from x to y which is assumed to be unique in the statement of the proposition let be another bijection of points in x to points in y since there are only finitely many off diagonal points in x and y there are only finitely many possible set min 6 y x g x y g y x x y min 6 y x g x y d x y 2 which must be positive as yx is uniquely optimal by assumption choose r 0 such that 4 r 2 4 mkr now suppose that g z x g y x z x for some z b y r this will imply that g x y g x z 2 d y z 2 2 mk d z y g y x x y 4 d y z 2 4 mk d y z g y x x z which contradicts our choice of now suppose x 1 x 2 xm and y are diagrams with finitely many off diagonal points such that there is a unique optimal pairing yxi between xi and y for each i by the above argument there are some r 1 r 2 rm 0 such that for each i and for every z b y ri there is a unique optimal pairing between each xi and z and this optimal pairing is induced by the one from xi to y take r min ri which is positive the following theorem states that algorithm 1 will find a local minimum on termi nation theorem 3 3 given diagrams x 1 xm and the corresponding fre chet function f then w wi is a local minimum of f if and only if there is a unique optimal pairing from w to each of the xj denoted as j and each wi is the arithmetic mean of the points j wi j 1 2 m 16 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 proof in lemma 3 1 we showed that it it is a necessary condition given m points in the plane or copies of the diagonal x 1 x 2 xm the choice of y which minimizes m i 1 xi y 2 is the arithmetic mean of x 1 xm as a result we know that f z f w for all z with the same optimal pairings as w to x 1 x 2 xm since there is some ball b w r such that every z b w r has the same optimal pairings as w by proposition 3 2 we know that f z f w for all z in b w r thus we can conclude that w is a local minimum 4 law of large numbers for the empirical fre chet mean in this section we study the convergence of fre chet means computed from sampling sets to the set of means of a measure consider a measure on the space of persis tence diagrams dl 2 given a set of persistence diagrams xi ni 1 iid one can define an empirical measure n 1 n n k 1 xk we will examine the relation between the two sets y min z d l 2 f d l 2 d x z 2 d x yn min z d l 2 fn d l 2 d x z 2 d n x where y and yn are the fre chet mean sets of the measures and n respectively we would like prove convergence of yn to y asymptotically with n a law of large numbers result there exist weak and strong laws of large numbers for general metric spaces for example see 17 theorem 3 4 these results hold for global minima of the fre chet and empirical fre chet functions f and fn respectively it is not clear to us how to adapt these results to the case of algorithm 1 where we can only ensure convergence to a local minimum it is also not clear how we can adapt these theorems to get rates of convergence of the sample fre chet mean set to the population quantity in this section we provide a law of large number result for the restricted case where is a combination of dirac masses 1 m m i 1 zi where zi are diagrams with only finitely many off diagonal points and we allow for multiplicity in these points the proof is constructive and we provide rates of convergence the main results of this section theorem 4 1 and lemma 4 2 provide a probabilistic justification for algorithm 1 theorem 4 1 states that with high probability local minima of the empirical fre chet function fn will be close to local minima of the fre chet function f ideally we would like the above convergence to hold for global minima the fre chet mean set the condition of lemma 4 2 states that the number fre chet means for distributions of persistence diagrams 17 of local minima of fn is finite and not a function of n this suggests that applying algorithm 1 to a random set of start conditions can be used to explore the finite set of local minima theorem 4 1 set 1 m m i 1 zi where zi are diagrams with finitely many off di agonal points with multiplicity allowed let f be the fre chet function corresponding to and y be a local minimum of f set xi ni 1 iid and denote the corresponding empirical measure n 1 n n k 1 xk and fre chet mean function fn there exists a local minimum yn of fn such that with probability greater than 1 d y yn 2 m 2 f y n ln m for n 8 m ln m and m 2 f y n ln m r 2 where r characterizes the separation be tween the local minima of f proof the empirical distribution is n 1 n n k 1 xk 1 m m i 1 i zi where i is the random variable that states the multiplicity of each zi appearing in the empirical measure k xk zi observe that 1 2 m can be stated as a multinomial distribution with parameters n and p 1 m 1 m 1 m we will bound the probability that i nm n m for any i 1 2 m we then will show that under the assumption that i nm n m for all i 1 2 m for sufficiently small 0 there is a local minimal yn with d y yn 2 2 mf y 1 2 for each i i bin n 1 m and n i bin n 1 1 m using hoeffding s inequality we obtain pr i nm n m 1 2 exp 2 2 n m and pr i n m n m pr n i n n m n m 1 2 exp 2 2 n m together they show that pr i nm n m exp 2 2 n m implying the bound pr i n m n m for all i 1 2 m 1 m exp 2 2 n m from now on we will assume that i nm n m for all i 1 2 m let us consider our algorithm for finding a local minimal of fn starting at the point y we first define some notation we denote the points in y by yj jj 1 we denote by z j i zi y yj the point in zi that yj is paired to in the unique optimal bijection between y and zi recall that the z j i could be the diagonal but from our assumption that y is a local minimum no off diagonal point in any zi is paired with the diagonal in y 18 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 let a j i b j i be the coefficients of the vector from yj to z j i in the basis of r 2 given by 1 2 1 2 and 1 2 1 2 this basis has the advantage that when z j i is the diagonal then a j i 0 and b j i d yj from our assumption that y is a local minimum we know that m i l a j i 0 and m i l b j i 0 for all j and f y 1 m j j 1 m i 1 a j i 2 b j i 2 for the moment fix j without loss of generality reorder the zi so that the first k with 1 k m of the zji are off the diagonal and the remained are copies of the diagonal let ynj be the point in r 2 given by yj 1 1 2 k k i 1 iai 1 2 1 2 1 n m i 1 ib j i 1 2 1 2 by construction this ynj is the weighted arithmetic mean of the z j i where we have weighted by the i taking into account that when i k then z j i is the diagonal under our assumption that i nm n m for all i 1 2 m and using k i 1 a j i 0 m i 1 b j i we know that yj ynj 2 1 1 2 k 2 k i 1 ia j i 2 1 n 2 m i 1 ib j i 2 1 1 2 k 2 k i 1 i n m a j i 2 1 n 2 m i 1 i n m b j i 2 1 k 2 m 2 n 2 1 2 2 n 2 m 2 k i 1 a j i 2 1 n 2 2 n 2 m 2 m i 1 b j i 2 m 2 1 2 1 m m i 1 a j i 2 b j i 2 set yn to be the diagram with off diagonal points ynj j j 1 using the pairing between y and yn where we pair yj with y n j we conclude that d y yn j j 1 yj ynj 2 j j 1 m 2 1 2 1 m m i 1 a j i 2 b j i 2 m 2 1 2 f y fre chet means for distributions of persistence diagrams 19 set m exp 2 2 n m and solve for this provides the bound that with proba bility greater than 1 d y yn 2 m 2 f y 2 n ln m 1 1 2 for 0 25 it holds that 1 2 2 and n 8 m ln m implies 25 we want to show that yn is a local minimum for sufficiently small indeed it will be the output of algorithm 1 given the initializing diagram of y since y is a local minimum proposition 3 2 implies that there is a ball around y b y r such that for every diagram in b y r there is a unique optimal pairing with each zi which corresponds to the unique optimal pairing between y and zi that is zi x y x zi y for all x b y r for 0 such that 2 mf y 1 2 r 2 we have yn b y r plugging in for results in m 2 f y n ln m r 2 this implies that zi yn yyn zi y is the unique optimal pairing between yn and zi for all i and hence xk yn yyn xk y for each of the sample diagrams xk if xk zi then xk yn ynj y yn ziy y n j zi y yj z j i by construction ynj is the weighted arithmetic mean of the z j i weighted by the i and hence y n j is the arithmetic mean of the x j k by theorem 3 3 yn is local minimum the above theorem provides a weak law of large numbers results for the local minima computed from n persistence diagrams but it does not ensure that the number of local minima is bounded as n goes to infinity the utility of such a convergence result would be limited if the number of local minima could not be bounded the following lemma states that the number of local minima is bounded lemma 4 2 let 1 m m i 1 zi as before let n 1 n n k 1 xk be the empirical measure of n points drawn iid from and fn is the corresponding fre chet function the number of local minima of fn is bounded by m i 1 ki 1 k 1 k 2 km here ki is the number of off diagonal points in the i th diagram this bound is independent of n proof set yn as a local minimum of fn this implies there are unique optimal pairings i between yn and xi for each i and that any point y in yn is the arithmetic mean of i y since the optimal pairing is unique if xi xj then i j this in turn means that the i are determined by which of zi are in the set xj with multiplicity this implies that the number of local minima is bounded by the number of different partitions into subsets of the points in the xj so that each subset has exactly one point from each of the xj the number of subsets is bounded by k 1 k 2 km and for each subset there is a bound of m i 1 ki 1 on the choices of which element to take from each of the xi thus the number of different partitions is bounded by m i 1 ki 1 k 1 k 2 km 20 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 we would like to discuss not only the convergence of local minima but also the convergence of the fre chet means we can do this in the case when there is a unique fre chet mean lemma 4 3 let 1 m m i 1 zi as before suppose further that the corresponding fre chet function f has a unique minimum let n 1 n n k 1 xk be the empirical measure of n points drawn iid from and fn is the corresponding fre chet function let y be the fre chet mean of f and yn the set of fre chet means of fn with probability 1 the hausdorff distance between yn and y goes to zero as n goes to infinity proof it is sufficient for us to show for each r 0 that with probability 1 there is some nr such that yn b y r for all n nr fix r 0 suppose there does not exist some nr such that yn b y r for all n nr then there is some sequence of wnk ynk such that d wnk y r the set wnk is clearly bounded off diagonally birth death bounded and uniform and hence precompact this implies that wnk has a convergent subsequence wnkj let w denote the limit of this sequence since d wnkj y r for all j we have d w y r by the arguments in proposition 2 6 there is some k independent of n such that fn is k lipschitz in b w 1 and hence fnkj wnkj fnkj w kd wnkj w for large j hence for all 0 we can say that fnkj w fnkj wnkj for sufficiently large j the law of large numbers tells us that fn w f w and fn y f y as n with probability 1 hence for all 0 we know that with probability 1 both f w fn w and fn y f y for sufficiently large n from our assumption thatwnkj is a fre chet mean of fnkj we know that fnkj wnkj fnkj y for all j let 0 combining the inequalities above we conclude that with probability 1 f w fnkj w fnkj wnkj 2 fnkj y 2 f y 3 for j sufficiently large since 0 was arbitrary we obtain f w f y which contradicts the uniqueness assumption about the fre chet mean 5 persistence diagrams of random gaussian fields we illustrate the utility of our algorithm in computing means and variances of per sistence diagrams in this section via simulation the idea will be to show that per sistence diagrams generated from a random gaussian field will concentrate around the diagonal with the mean diagram moving closer to the diagonal as the number of diagrams averaged increases the persistence diagrams were computed from random gaussian field over the unit square using the procedure outlined in section 3 in 1 the field generated is a fre chet means for distributions of persistence diagrams 21 stationary isotropic and infinitely differentiable random field the gaussian was set to be mean zero and the covariance function was r p exp p 2 where 100 a few hundred levels in the range of the realization of the field were taken for each level a simplicial complex was constructed this was done by taking a fine grid on the unit square and including any vertex edge or square in the complex if and only if the values of the field at the vertex or set of vertices for the edge and square cases were higher than the level the complex increases as the level decreases which provides the filtering and from which birth death values of the diagram were computed we obtained from e subag 10 000 such random persistence diagrams generated as described above these diagrams contain points with infinite persistence we ignore these points using extended persistence in computing the diagrams would address this issue 22 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 3 2 1 0 1 3 2 1 0 1 birth d ea th mean of 2 diagrams 3 2 1 0 1 3 2 1 0 1 birth d ea th mean of 4 diagrams 3 2 1 0 1 3 2 1 0 1 birth d ea th mean of 8 diagrams 4 2 0 2 3 2 1 0 1 2 birth d ea th mean of 16 diagrams 3 2 1 0 1 3 2 1 0 1 birth d ea th mean of 32 diagrams 3 2 1 0 1 3 2 1 0 1 birth d ea th mean of 64 diagrams 1 0 1 2 3 1 0 1 2 3 birth d ea th mean of 2 diagrams 1 0 1 2 3 1 0 1 2 3 birth d ea th mean of 4 diagrams 1 0 1 2 3 1 0 1 2 3 birth d ea th mean of 8 diagrams 1 0 1 2 3 1 0 1 2 3 birth d ea th mean of 16 diagrams 1 0 1 2 3 1 0 1 2 3 birth d ea th mean of 32 diagrams 1 0 1 2 3 1 0 1 2 3 birth d ea th mean of 64 diagrams figure 1 the top two rows plot the mean persistence diagram for dimension zero each figure contains four means computed from the number of diagrams specified in the figure title each mean is computed from a different random sample of diagrams and is plotted in a different color the bottom two rows are the sample plots for dimension one fre chet means for distributions of persistence diagrams 23 in figure 1 we display the mean diagram of sets of 2 4 8 16 32 64 128 diagrams randomly drawn from the 10 000 diagrams this is done for both dimensions zero and one we wanted to see that as the number of diagrams being averaged increases the fre chet means converged to quantify this concentration we took ten draws of 2 4 8 16 32 64 128 diagrams from the 10 000 diagrams and considered the distri bution 1 10 10 i 1 xi where xi where the fre chet means of each of the sets of samples we then computed the variance of these distributions as documented in table 1 table 1 variance of the sample fre chet means number of samples h 0 h 1 2 0 8353 0 9058 4 0 6295 0 6741 8 0 4429 0 5608 16 0 4356 0 4618 32 0 3165 0 3742 64 0 3362 0 2965 128 0 3127 0 2233 6 discussion in this paper we introduce an algorithm for computing estimates of fre chet means of a set of persistence diagrams we demonstrate local convergence of this algorithm and provide a law of large numbers for the fre chet mean computed on this set when the underlying measure has the form m 1 m i 1 xi where xi are persistence diagrams we believe that generically there is a unique global minimum to the fre chet function and hence a unique fre chet mean but this needs to be shown the work in this paper is a first step and several obvious extensions are needed a law of large numbers result when the underlying measure is not restricted to a combination of dirac functions is obviously important the results in our paper are strongly dependent on the l 2 wasserstein metric generalizing these results to the wasserstein metrics used in computational topology is of central interest the proofs and problem formulation in this paper are very constructive the proofs and algorithms are developed for the specific examples and constructions we propose and are not meant to generalize to other metrics or variants on the algorithm it would be of great interest to provide a presentation of the core ideas in the algorithm and theory we developed in a more general framework using properties of abstract metric spaces and probability theory on these spaces acknowledgments sm and kt would like to acknowledge shmuel weinberger for discussions and in sight sm and kt would like to acknowledge e subag with help in obtaining 24 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 persistence diagrams computed from random gaussian fields and explaining the generative model jh and ym are pleased to acknowledge the support from grants dtra hdtra 1 08 brcwmd darpa d 12 ap 00001 on afosr fa 9550 10 1 0436 and nih systems biology 5 p 50 gm 081883 sm is pleased to acknowledge support from grants nih systems biology 5 p 50 gm 081883 afosr fa 9550 10 1 0436 and nsf ccf 1049290 appendix a in order to prove proposition 2 3 we need to give some conditions for a subset of dl 2 to be relatively compact we will use theorem 21 in 16 which requires a few definitions definition a 1 birth death bounded a set s dl 2 is called birth death bounded if there is a constant c 0 such that for all z s and for all 6 x z max b x d x c where b x and d x are the births and deaths respec tively for 0 and diagram z dl 2 we define the maps u dl 2 dl 2 such that 6 x u z x z pers x l dl 2 dl 2 such that 6 x l z x z pers x where u z is the upper part of z the points in z with persistence at least and l z is the lower part of z the points in z with persistence less than definition a 2 off diagonally birth death bounded a set s dl 2 is called off diagonally birth death bounded if for all 0 u s is birth death bounded definition a 3 uniform a set s dl 2 is called uniform if for all 0 there exists 0 such that d l z for all z s theorem 21 in 16 states that a subset of dwp is relatively compact if and only if it is bounded off diagonally birth death bounded and uniform this also holds for dl 2 due to the equivalence in norms stated in 2 we finally are ready to prove proposition 2 3 proof of proposition 2 3 fix two diagrams x and y let be the set of bijections between points in x and points in y with the further condition that x x 2 x 2 x 2 for all x x recall that by x we mean the perpendicular distance from x to the diagonal which can thought of as pairing x with the closest point to x on the diagonal by the above condition we are requiring that we never pair an off diagonal point x x with an off diagonal point in y when pairing both with the diagonal would be more efficient by considering only the bijections in we are only removing bijections for which there exists some such that x x x x 2 x x x x 2 this fre chet means for distributions of persistence diagrams 25 means that 1 is equal to inf x x x x 2 we will show this infimum is a minimum for each bijection we can construct a path 0 1 dl 2 by setting t to be the diagram with points 1 t xi t xi xi x let s t t 0 1 which contains all the images of the paths we want to show that s is relatively compact to do this we will show that s is bounded off diagonally birth death bounded and uniform which are sufficient conditions for relative compactness by theorem 21 in 16 firstly observe that for any bijection and any t 0 1 we know d t 2 d x 2 d y 2 which is finite and independent of and t this implies that the set s is bounded we now wish to show that s is off diagonally bounded for each 0 there can only be finitely many points in x and y whose distance from the diagonal is at least this implies that there is some c such that all x u x and x u y satisfy max b x d x c let m max d x x x or x y we will show that if p u z for some z s then max b p d p c 2 m consider p z for some z s this means p t with and t 0 1 and hence p 1 t x t x for some x x we have b p min b x b x max b x b x d p min d x d x max d x d x d p min d x d x max d x d x in order for d p either d x or d x and hence min b x b x c and min d x d x c the condition for to be in is that x 2 x 2 x x 2 and hence x x 2 m since b x b x x x we can conclude that max b x b x min b x b x 2 m c 2 m similarly we get max d x d x c 2 m we now will show that s is uniform recall that s is uniform if for all 0 there exists an 0 such that d l z for all z s for any diagram z dl 2 denote mk z as the number of points in z whose distance to the diagonal is in 2 k 2 k 1 for k 1 and let m 0 z be the number points with distance in 1 let nk z denote the number of points in z whose distance from the diagonal is at least 2 k in other words the number of off diagonal points in u 2 k z 26 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 let x y be the diagram whose off diagonal points are the union of the off diagonal points in x and y consider the following sum j 0 nj x y 2 2 j j 0 j k 0 mk x y 2 2 j j 0 mj x y k j 2 2 k 4 3 j 0 mj x y 2 2 j 4 3 d x y 2 let 0 since j 0 nj x y 2 2 j converges there is some l such that j l nj x y 2 2 j 4 let be a bijection between x and y consider the path 0 1 dl 2 where t is the diagram with points 1 t x t x x x for the point 1 t x t x to lie a distance at least 2 k from the diagonal at least one of x or x must lie at least 2 k from the diagonal this implies that nk t nk x y for all bijections and t 0 1 in other words nk z nk x y for all z s now for any z s we have d l 2 l z 2 j l mj z 2 2 j 2 4 j l nj z 2 2 j 4 j l nj x y 2 2 j since the choice of 2 l was made independently of z s we conclude that s is uniform we now know that s the closure of s is compact every path t 7 t is a k lipschitz map from 0 1 into s with k 2 x x x x 2 set k d x y 1 and let a be the set of k lipschitz maps from 0 1 into s since s is compact we know by the arzela ascoli theorem that a is compact by the definition of the infimum there exists a sequence of bijections j such that k j k for all j and k j is a sequence converging to k the corresponding sequence of paths j j is a sequence of k lipschitz maps from 0 1 to s and hence lie in the compact set a this means there must be a convergent subsequence of paths nj with some limit which exists and lies in a as a is compact since nj 0 x and nj 1 y for all j as they are all paths from x to y we know that 0 x and 1 y from d nj t nj s k nj s t for all fre chet means for distributions of persistence diagrams 27 s t 0 1 and all j and the limit k nj k as j we can infer d t s k s t for all s t 0 1 if we follow along the path where each point x x goes to in y we can construct a bijection from points in x to points in y this bijection achieves the infimum in 1 references 1 r j adler o bobrowski m s borman e subag and s weinberger persistent homology for random fields and complexes in borrowing strength theory powering applications a festschrift for lawrence d brown volume 6 2010 2 p bendich s mukherjee and b wang local homology transfer and stratification learning acm siam symposium on discrete algorithms 2012 3 m r birdson and a haefliger metric spaces of non positive curvature springer verlag 1999 4 p bubenik g carlsson p t kim and z m luo statistical topology via morse theory persistence and nonparametric estimation in algebraic methods in statistics and probability ii volume 516 of contemporary mathematics pages 75 92 2010 5 y burago m gromov and g perel man a d alexandrov spaces with curvature bounded below russian mathematical surveys 47 2 1 58 1992 6 f chazal d cohen steiner and a lieutier a sampling theory for compact sets in euclidean space discrete and computational geometry 41 461 479 2009 7 d cohen steiner h edelsbrunner j harer and y mileyko lipschitz functions have lp stable persistence foundations of computational mathematics 10 127 139 2010 10 1007 s 10208 010 9060 6 8 h edelsbrunner and j harer computational topology an introduction american mathe matical society 2010 9 m gromov hyperbolic groups in essays in group theory volume 8 of math sci res inst publ pages 75 263 springer 1987 10 m kahle topology of random clique complexes discrete math 309 6 1658 1671 2009 11 m kahle random geometric complexes http arxiv org abs 0910 1649 2011 12 m kahle and e meckes limit theorems for betti numbers of random simplicial complexes 2010 arxiv 1009 4130 v 3 math pr 13 j lott and c villani ricci curvature for metric measure spaces via optimal transport ann of math 169 903 91 2009 14 s lunago mez s mukherjee and r l wolpert geometric representations of hypergraphs for prior specification and posterior sampling http arxiv org abs 0912 3648 2009 15 a lytchak open map theorem for metric spaces st petersburg math journal 17 3 477 491 2006 16 y mileyko s mukherjee and j harer probability measures on the space of persistence diagrams inverse problems 27 12 124007 2012 17 i molchanov theory of random sets springer 2005 18 j munkres algorithms for the assignment and transportation problems journal of the society for industrial and applied mathematics 5 1 32 38 1957 19 p niyogi s smale and s weinberger finding the homology of submanifolds with high confidence from random samples discrete computational geometry 39 419 441 2008 20 p niyogi s smale and s weinberger a topological view of unsupervised a topological view of unsupervised learning from noisy data manuscript 2008 21 s ohta barycenters in alexandrov spaces with curvature bounded below advances in geom etry 2012 28 katharine turner 1 yuriy mileyko 2 sayan mukherjee 3 john harer 2 22 m d penrose random geometric graphs oxford univ press new york ny 2003 23 m d penrose and j e yukich central limit theorems for some graphs in computational ge ometry ann appl probab 11 4 1005 1041 2001 24 a petrunin semiconcave functions in alexandrov s geometry surv differ geom xi 11 137 201 2007 25 k t sturm probability measures on metric spaces of nonpositive curvature in heat kernels and analysis on manifolds graphs and metric spaces volume 338 2002 1 department of mathematics university of chicago 2 departments of statistical science computer science and mathematics institute for genome sciences policy duke university 3 departments of mathematics and computer science center for systems biology duke university 1 introduction 2 persistence diagrams and alexandrov spaces with curvature bounded from below 2 1 persistent homology and persistence diagrams 2 2 gradients and supporting vectors on dl 2 2 3 properties of the fr chet function 3 finding local minima of the fr chet function 3 1 convergence of the greedy algorithm 4 law of large numbers for the empirical fr chet mean 5 persistence diagrams of random gaussian fields 6 discussion acknowledgments appendix a references