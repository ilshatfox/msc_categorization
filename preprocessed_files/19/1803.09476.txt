ar x iv 1 80 3 09 47 6 v 1 m at h a g 2 6 m ar 2 01 8 gromov witten theory with derived algebraic geometry etienne mann and marco robalo abstract in this survey we add two new results that are not in our paper mr 15 using the idea of brane actions discovered by toe n we construct a lax associative action of the operad of stable curves of genus zero on a smooth variety x seen as an object in correspondences in derived stacks this action encodes the gromov witten theory of x in purely geometrical terms contents 1 introduction 2 2 moduli space of stable maps cohomological field theory and operads 4 2 1 moduli space of stable maps 4 2 2 gromov witten classes and cohomological field theory 9 2 3 reviewed on operads 10 3 lax algebra structure on x 11 3 1 main result 11 3 2 category of correspondances 12 3 3 derived enhancement 13 3 4 lax morphism 14 4 proof of our main result 15 4 1 brane action 15 4 2 sketch of proof of theorem 3 1 2 17 5 comparison with other definition 18 5 1 quantum product in cohomology and in g 0 theory 18 5 2 about the associativity 19 5 3 key diagram 20 5 4 virtual object from derived algebraic geometry 23 5 5 virtual object from perfect obstruction theory 26 5 6 comparison theorem of the two approachs 27 appendix a proof of theorem 5 3 11 28 e m is supported by the grant of the agence nationale de la recherche new symmetries on gromov witten theories anr 09 jcjc 0104 01 and syme trie miroir et singularite s irre gulie res provenant de la physique anr 13 is 01 0001 01 02 and project catag anr 17 ce 40 0014 m r was supported by a postdoctoral fellowship of the fondation sciences mathematiques de paris and anr catag anr 17 ce 40 0014 1 http arxiv org abs 1803 09476 v 1 2 etienne mann and marco robalo appendix b proof of theorem 5 4 2 1 29 appendix c alternative proof of corollary b 0 5 in the affine case 31 references 34 1 introduction this paper is a survey 1 of mr 15 we explain without technical details the ideas of mr 15 where we use derived algebraic geometry to redefine gromov witten invariants and highlight the hidden operad picture gromov witten invariants were introduced by kontsevich and manin in algebraic ge ometry in km 94 kon 95 the foundations were then completed by behrend fantechi and manin in bm 96 a bf 97 and beh 97 in symplectic geometry the definition is due to y ruan and g tian in rt 94 rua 96 and rt 97 mathematicians developed several techniques to compute them via a localization formula proved by graber and pandharipande in gp 99 via a degeneration formula proved by j li in li 02 and another one called quantum lefschetz proved by coates givental cg 07 and tseng tse 10 these invariants can be encoded using different mathematical structures quantum products cohomological field theories kontsevich manin in km 94 frobenius man ifolds dubrovin in dub 96 lagrangian cones and quantum d modules givental giv 04 variations of non commutative hodge structures iritani iri 09 and kont sevich katzarkov and pantev in kkp 08 and so on and used to express different aspects of mirror symmetry another important aspect of the theory concerns the study of the functoriality of gromov witten invariants via crepant resolutions or flop tran sitions in terms of these structures see rua 06 per 07 cit 09 ccit 09 bg 09 iri 10 bcr 13 bc 14 cij 14 etc we first recall the classical construction of these invariants let x be a smooth pro jective variety or orbifold the basic ingredient to define gw invariants is the moduli stack of stable maps to x denoted by mg n x with a fixed degree h 2 x z 2 the evaluation at the marked points gives maps of stacks evi mg n x x and forgetting the morphism and stabilising the curve gives a map p mg n x mg n see remark 2 1 3 to construct the invariants we integrate over the fundamental class of the moduli stack mg n x for this integration to be possible we need this moduli stack to be proper which was proved by behrend manin bm 96 a and some form of smoothness in general the stack mg n x is not smooth and has many components with different 1 we add two new results theorem 5 3 11 and 5 4 2 2 the co homology in this paper are the singular ones gromov witten theory with derived algebraic geometry 3 dimensions nevertheless and thanks to a theorem of kontsevich kon 95 it is quasi smooth in the sense that locally it looks like the intersection of two smooth sub schemes inside an ambient smooth scheme in genus zero however this stack is known to be smooth under some assumptions on the geometry of x for instance when x is the projective space or a grassmaniann or more generally when x is convex i e if for any map f p 1 x the group h 1 p 1 f tx vanishes see fp 97 this quasi smoothness has been used by behrend fantechi to define in bf 97 a virtual fundamental class denoted by mg n x vir which is a cycle in the chow ring of mg n x that plays the role of the usual fundamental class one of the most important result of gromov witten invariants is that they form a cohomological field theory that is there exist a family of morphisms ixg n h x n h mg n 1 0 1 1 n 7 stb mg n x vir iev i i that satisfy some properties another formulation of this result is that we have a mor phism of operads between h mg n n n and the endomorphism operad end h x see corollary 2 2 5 yet a more concise way to explain this is to say that h x owns a structure of algebra over the operads h mg n the main result of mr 15 is that it is possible to remove co homology from the previous statement the main result of mr 15 is the following theorem 1 0 2 see theorem 3 1 2 let x be a smooth projective variety the diagrams rm 0 n 1 x p e 1 en vv p en 1 m 0 n 1 x n m 0 n 1 x give a family of morphisms n m 0 n 1 end cor x n homcor xn x that forms a lax morphism of operads in the category of derived stacks we restrict our work to genus 0 because we lack fundamental aspects for modular operads in this survey we omit the technical details and we insist on the ideas behind the the orem nevertheless we add some new statements with respect to mr 15 as theorem 5 3 11 and theorem 5 4 2 with the proofs given in the appendices acknowledgements we want to thank bertrand toe n for the organisation of the e tat de la recherche and also for some ideas to prove theorem 5 3 11 the first author thanks daniel naie who explains how to make these figures 4 etienne mann and marco robalo 2 moduli space of stable maps cohomological field theory and operads in this section we recall some notions and ideas related to gromov witten theory most of them are in the book of cox katz ck 99 the mathematical story started with the paper of kontsevich kon 95 see also kontsevich manin km 96 and was followed by many more and interesting questions that we will skip here 2 1 moduli space of stable maps let x be a smooth projective variety over c let h 2 x z let g n n denote by aff sch the category of affine scheme and by grps the category of groupoids we define the moduli space of stable maps by the following functor mg n x aff sch op grps where mg n x s is the following groupoids objects are flat proper morphisms c s together with n sections i s c and a morphism f c x such that for any geometric point s s we have 1 the fiber cs is a connected nodal curve of genus g with n distinct marked points which live on the smooth locus of cs 2 fs cs x is of degree meaning f cs 3 the automorphism group of aut c f is finite where we denote 1 n this condition is called stability condition for any affine scheme s the morphism in the groupoid mg n x s ar the isomor phisms c c such that the following diagram is commutative c f c f x s i nn i pp let s s be a morphism of affine schemes let c s f be an object in mg n x s then the pullback family defined by the diagram below satisfies the three conditions above that is it is in mg n x s c s s f c f x s i ee s i yy gromov witten theory with derived algebraic geometry 5 notice that the condition 1 2 a d 3 are stable by pull back remark 2 1 1 let explain the stability condition 3 in more concrete terms see ck 99 7 1 1 p 169 denote by cs i the irreducible components of cs and by fs i cs i x the restrictions of the morphism denote by i fs i cs i h 2 x z the degree of fs on each irreducible component cs i on the irreducible component cs i a point is called special if it is a nodal point or a marked point the stability condition 3 is equivalent to the following condition on each irreducible component if i 0 and the genus of cs i is 0 resp 1 then cs i should have at least 3 resp 1 special points so for example if i 6 0 or the genus is greater than 2 there is no condition on cs i in this text we will never use the coarse moduli space of mg n x so all the morphisms that we will use are morphisms of stacks example 2 1 2 let us give an example in genus 0 see figure 1 consider the following stable map in m 0 5 x all the ci are isomorphic to p 1 the stability condition on this stable map imposes only that 2 6 0 because c 2 has only 2 special points c 1 1 c 2 2 6 0 c 3 3 f x x 1 x 2 x 3 x 4 x 5 figure 1 example of a stable map in particular the moduli space of stable curve denoted by mg n is mg n pt 0 notice that for g n 0 0 0 1 0 2 1 0 the moduli space mg n is empty remark 2 1 3 there are two kinds of natural morphisms of stacks from the moduli space of stable maps 1 for any i 1 n the evaluation morphism ei mg n x x is the eval uation at the i th marked point i e it sends the geometric point c x 1 xn f to f xi 2 when mg n is not empty we define the morphism of stacks p mg n x mg n that forgets the map and stabilises the curve that is it sends c x 1 xn f 6 etienne mann and marco robalo to cstab x 1 xn where c stab is obtained from c by contracting all the un stable components see knu 83 for the techniques on the stable map of the example 2 1 2 forgetting the map f the irreducible component c 2 become un stable because it has only 2 special points so the image by p is the following stable curve see figure 2 c 1 c 3 x 1 x 2 x 3 x 4 x 5 figure 2 the stabilisation of the stable maps of figure 1 theorem 2 1 4 deligne mumford dm 69 kontsevich manin km 96 behrend fan techi bf 97 1 the moduli space mg n is a proper smooth deligne mumford stack of dimension 3 g 3 n 2 the moduli space mg n x is a proper not smooth in general deligne mumford stack it has an expected dimension see remark below for the meaning which is c 1 tx 1 g dimx 3 g 3 n 3 there exists a class denoted by mg n x vir in the chow ring a mg n x of degree equal to the expected dimension of mg n x which satisfies some functorial properties remark 2 1 5 1 to use standard tools of intersection on the moduli space of sta ble maps we need this moduli space to be proper and smooth the smoothness would give us the existence of a well defined fundamental class nevertheless the moduli space of stable maps mg n x which is not smooth in general could have different irreducible components of different dimensions with some very bad singularities so the problem is to define an ersatz of a fundamental class this was done by behrend fantechi in bf 97 where they defined the virtual fundamental class see 5 6 2 in some very specific case the moduli space of maps is smooth for example only in genus 0 for homogeneous variety like pn grassmannian or flag varieties in these cases the virtual dimension is the actual dimension and the virtual fundamental class is the fundamental class gromov witten theory with derived algebraic geometry 7 3 the computation of the expected dimension comes from deformation theory namely a deformation of a stable maps turns to be a deformation of the under lying curve plus a deformation of the map as mg n is smooth the deformation functor of the curve has no obstruction and the tangent space has the dimension of mg n which is 3 g 3 n for the maps the deformation functor has a non zero obstruction more precisely at a point c x f mg n x the tangent space is h 0 c f tx and an obstruction is h 1 c f tx making this in family one gets two quasi coherent sheaves that are not vector bundles nevertheless the euler characteristic can be computed via the hirzebruch riemann roch theo rem c f tx dimh 0 c f tx dimh 1 c f tx c td tc ch f tx is constant and equals to c 1 tx 1 g dimx we will now introduce another moduli space which was introduce by costello cos 06 and which will play a crucial role latter let ne x be the subset of h 2 x z of classes given by the image of a curve i e the subset of all f c for any morphism f c x let define mg n as the moduli space of nodal curve of genus g with n marked smooth points where each irreducible component ci has a labelled i notice that this i is not the degree of a map because there is no map from c x it is just a labbeled at the end of the day it will be related to the degree of a map but not here such that i i if i 0 then ci is stable i e if ci is of genus 0 then it has at least 3 special points and if the genus is 1 then it has at least 1 special point we have a natural morphism of stacks p mg n 1 mg n which forgets the n 1 th marked point and contracts the irreducible components that are not stable theorem 2 1 6 cos 06 1 the stack mg n is a smooth artin stack 2 the morphism p mg n 1 mg n is the universal curve remark 2 1 7 1 notice that forgetting the last marked point and contracting the unstable component gives a morphism mg n 1 mg n which is also the universal curve see knu 83 2 the artin stack of prestable 3 curves denoted by mpreg n also have a universal curve which is not m pre g n 1 as there is no stability condition on the moduli space of prestable curves forgetting a marked point never contract a rational curve so forgetting a marked point m pre g n 1 m pre g n is not the universal curve let us explain the meaning of being an universal curve of mg n let c be a curve of genus g with 4 marked points with a label this is equivalent by definition to 3 where we do not ask any stability condition on irreducible components see ck 99 p 179 8 etienne mann and marco robalo a morphism pt mg 4 being a universal curve means that we have the c mg 5 mg 4 pt that is the following diagram c mg 5 pt mg 4 is cartesian let explain the morphism to a smooth point y c x 1 x 4 f y is the curve c where y is now x 5 if y xi then y is the curve c where we attach a p 1 at xi let s say at 0 of this p 1 with 0 and you marked xi and x 5 at 1 and if y is a node which is the intersection with ci and cj then we replace the node by a p 1 with degree 0 which meet ci at 0 cj at and we marked the point 1 by x 5 on this p 1 here is a picture that we hope makes this clearer see figure 3 forgetting the last point makes the component p 1 0 unstable so one should contract it and we get back c x 1 x 2 x 3 x 4 y y c f mg 5 f y x 1 x 2 x 3 x 4 y x 5 if y is not a marked point f y x 1 x 2 x 3 x 4 y x 5 c p 1 0 if y is the marked point x 4 figure 3 universal curve gromov witten theory with derived algebraic geometry 9 2 2 gromov witten classes and cohomological field theory we first define the gromov witten classes let 1 n h x let h 2 x z we define the following morphism g n h x h x h mg n 1 n 7 p n i 1 e i i mg n x vir theorem 2 2 1 kontsevich manin km 96 all these maps g n g n n h 2 x z together form a cohomological field theory remark 2 2 2 1 we refer to km 96 for a complete definition of a cohomological field theory 2 unwindy the definition is the so called splitting property let g 1 g 2 n 1 n 2 n denote by g g 1 g 2 and n n 1 n 2 consider the gluing morphism of stacks g mg 1 n 1 1 mg 2 n 2 1 mg n 2 2 3 c 1 c 2 7 c 1 c 2 that identifies the n 2 1 th marked point of c 2 with the first marked point of c 1 notice that the gluing morphism above is given by the pushout more precisely let c 1 s in mg 1 n 1 1 s and c 2 s in mg 2 n 2 1 s then c 1 c 2 is the pushout 4 c 1 s c 2 given by the two closed immersion given by the marking 1 s c 1 and n 2 1 s c 2 this corresponds to the following picture c 1 x 4 x 3 x 2 x 1 c 2 x 3 x 2 x 1 g x 5 x 4 x 3 x 2 x 1 c 1 c 2 figure 4 gluing curves the output of c 2 that is x 3 with the first input of c 1 4 notice that pushouts do not exist for any morphisms of schemes in the category of schemes but pushout along closed immersion does exist 10 etienne mann and marco robalo the splitting formula is the following g g n 1 n g 1 g 2 g 1 2 s a 0 g 1 n 1 1 1 1 n 1 ta g 2 n 2 1 2 t a n 1 1 n 2 2 4 where ta a 0 s is a basis of h x and t a is its poincare dual basis beyond this formula the idea is that we can control the behaviour of the virtual fondamental class when we glue curves we will see this again later restricting to genus 0 we can reformulate this equality 2 2 4 by the following statement corollary 2 2 5 we have a morphism of operads in vector spaces n h m 0 n 1 end h x n hom h x n h x given by 0 n 1 n en 1 p n i 1 e i i m 0 n x vir another way of expressing exactly the same statement is to say that the cohomology h x is an h m 0 n 1 n 2 algebra the goal of this survey is to explain how to remove the co homology from this corollary and doing this at the geometrical level 2 3 reviewed on operads we add this section for completeness as operads are not so well known to algebraic geometer 5 an operad is the following data 1 a family of objects in a category vector spaces schemes or deligne mumford stacks o n for all n n the example that one should have in mind for this note is o n m 0 n 1 we should think that o n as a collection of operations each with n inputs and one output in the case of m 0 n 1 the marked points x 1 xn can be thought as the inputs and the last marked points xn 1 is thought as the output 2 a collection of operations putting the output of o b with the i th input of o a let a b n for any i 1 a we have i o a o b o a b 1 2 3 1 satisfying some relations like associativity of the compositions example 2 3 2 we give three examples of operads that we will use in the next sections 5 the first author did not know this notion before the working seminar in montpellier where these ideas were first discussed gromov witten theory with derived algebraic geometry 11 1 the example o n m 0 n 1 is an operads in dm stacks where the composition c 1 i c 2 is obtained by gluing the last marked point of c 2 to the i th marked point of c 1 see 2 2 3 and figure 4 for an example of 1 with stable curves notice that here o 0 and o 1 are empty a standard way of completing this is to put o 0 o 1 pt so that o 1 is the unit 2 another example of operads that we will use is o n m 0 n 1 this is a graded operad that is in the composition 2 3 1 we sum the grading i o a o b o a b 1 the composition morphism for this operad is by gluing the curves as in the previous example 3 let v a vector space put o n end v n hom v v v this is called the endomorphism operad in vector spaces the composition is given by f i g v 1 va b 1 f v 1 vi 1 g vi vi b 1 vi b va b 1 let o o n n n and e e n n n be two operads a morphism of operads from f o e is a family of morphism fn o n e n such that the following diagram is commutative o a o b fa fb i e a e b i o a b 1 fa b 1 e a b 1 2 3 3 3 lax algebra structure on x in corollary 2 2 5 we have a collection of morphisms h m 0 n 1 end h x n that form a morphism of operads the idea is to remove the co homology from this statement that is to construct in a purely geometrical way a collection morphisms m 0 n 1 end x n in an appropriate category and then to see if these morphisms form a morphism of operads the correct category is the 1 category of derived stacks and the morphism is only a lax morphism of operads see theorem 3 1 2 3 1 main result denote by rm 0 n 1 x the derived enhancement of m 0 n 1 x see subsection 3 3 from the two natural morphisms of remark 2 1 3 we get the following diagram rm 0 n 1 x p e 1 en vv p en 1 m 0 n 1 x n m 0 n 1 x 3 1 1 we prefer to state our theorem and then give explanations about it 12 etienne mann and marco robalo theorem 3 1 2 let x be a smooth projective variety the diagram 3 1 1 give a family of morphisms n m 0 n 1 end cor x n homcor xn x that forms a lax morphism of operads in the category of derived stacks remark 3 1 3 in more conceptual terms x is lax m 0 n 1 n algebra in the category of correspondence in derived stack in the next sections we will explain the contents of this theorem namely in 3 2 we define the notion of correspondances in a cateogry in 3 3 we define the natural derived enhancement of the moduli space of stable maps mg n x and in 3 3 2 we explain the underlying notation hom cor xn x in 3 4 we explain what is a lax morphism between operads th notion of operads is a bit delicat and it is explain in in 4 1 1 3 2 category of correspondances let dstc be the category of derived stacks we denote dstcor c the 2 category of correspondences in derived stack which is defined informally as follows see 10 in dk 12 to have a formal definition we refer to the notion of span in the website nlab 1 object of dstcor c are objects of dstc 2 the 1 morphism of dstcor c between x and y denoted by x 99 k y is a diagram u g f x y there is no condition on f or g the composition is given by fiber product u y v u v zz x y z notice that a morphism from x to y is also a morphism from y to x but the composition is not the identity which is x id id x x hence a morphism of scheme f x y induces a morphism x 99 k y in correspondances given by idx x x and f x y this morphism gromov witten theory with derived algebraic geometry 13 x 99 k y is an isomorphism if and only if we have x x y x i e f is a monomorphism 3 the 2 morphisms are not necessarily isomorphisms they are u v that make the diagram commutative u x y v the diagram rm 0 n 1 x e 1 en xxqqq qq qq qq qq en 1 xn x 3 2 1 is by definition a morphism in dstcor c between xn 99 k x notice that the object that makes the correspondence is a derived stack so we need to be in the category of dstcor c and not in the category of correspondence in schemes or deligne mumford stacks 3 3 derived enhancement 3 3 1 derived enhancement of rm 0 n 1 x here we follow the idea of schu rg toe n vezzosi stv 15 with a small modification let g n n and h 2 x recall the definition of mg n the moduli space defined before theorem 2 1 6 we denote the relative internal hom in derived stacks by rhomdstk mg n mg n 1 x mg n 3 3 1 as mg n 1 mg n is the universal curve a point in rhomdstk mg n mg n 1 x mg n is by definition a morphism from f c x where c mg n notice that the degree f is not related for the moment to the truncation of 3 3 1 is homdstk mg n mg n 1 x mg n and inside it we have an immersion mg n x homdstk mg n mg n 1 x mg n 3 3 2 given by stable maps c f c x such that the degree of f on each irreducible component ci of c the degree of f ci is i i e we have the equality f ci ci i this immersion is open because the degree is discrete using the following result of schur g toe n vezzosi we have 14 etienne mann and marco robalo proposition 3 3 3 proposition 2 1 in stv 15 let x be in dstc and an open immersion of y t 0 x where t 0 x is the truncation of x then there exists a unique derived enhancement of y denoted by y such that the following diagram is cartesian y open closed t 0 x closed y open x taking y mg n x and the open immersion 3 3 2 we get a derived enhance ment which we denote by rmg n x remark 3 3 4 to define the derived enhancement of the moduli space of stable maps mg n x schu rg toe n vezzosi see stv 15 used the moduli space of prestable curve denoted by mpreg n instead of the moduli space of costello mg n in 3 3 1 so they use the universal curve of mpreg n in 3 3 1 instead of mg n 1 as we will see in the proof see section 4 the fact that mg n 1 is the universal curve is fundamental that is the reason why we made this little change notice that their derived enhancement is the same as ours as the morphism mg n mg n is e tale see cos 06 3 3 2 definition of homcor xn x the underling notation means the internal hom homcor xn x to be more precise it is the sheaf homcor xn x u homcor xn u x u it turns out that this is a derived stack because homcor xn u x u is the same as the category of derived stack over xn 1 u by yoneda s lemma the morphism n of theorem 3 1 2 is exactly given by an object in homcor xn m 0 n 1 x m 0 n 1 which is the diagram 3 1 1 3 4 lax morphism recall that a classical morphism of operad is a commutative diagram 2 3 3 a lax morphism is given by a collection of 2 morphisms a b a b n which are not an isomorphism o a o b fa fb i e a e b a b rz i o a b 1 fa b 1 e a b 1 in the following we will explain why the theorem 3 1 2 is lax in geometrical term let m 0 a 1 and m 0 b 1 denote by rm 0 a 1 x resp rm 0 a 1 x the inverse image of p 1 resp p 1 gromov witten theory with derived algebraic geometry 15 the composition is fa b 1 i given by rm 0 a b 1 x vv xa b x 3 4 1 the second composition morphism 1 fa fb is given by the following fibered product let such that rm 0 a 1 x x rm 0 b 1 x ss rm 0 a 1 x x b ea 1 idxb e 1 ea idxa uu rm 0 a 1 x eb 1 e 1 eb ss xa xb x xb x 3 4 2 let fix finally the 2 morphism is given by the gluing morphism rm 0 a 1 x x rm 0 b 1 x rm 0 a b 1 x 3 4 3 notice that we can glue the stable maps denoted by c x 1 xa 1 f and c x 1 x b 1 f because the fiber product is over x which means that f xa 1 f x 1 this morphism is surjective but not injective on points to see the non injectivity consider figure 3 4 then the gluing curves are the same notice that by stability condition we have 2 6 0 the two couple of curves c 1 c 2 c 3 and c 1 c 2 c 3 are in two different connected components of rm 0 a 1 x x rm 0 b 1 x 4 proof of our main result 4 1 brane action in this section we explain the main theorem of toe 13 this theorem has a lot of prerequisites like operads unital and coherent operads that are too complicated for this survey we refer to the definition of operads by lurie lur 14 definition 2 1 1 8 and to the definition 3 3 1 4 for the notion of coherent operad theorem 4 1 1 see theorem toe 13 let o be an operad in the category of spaces such that 1 o 0 o 1 are contractible 2 the operad is unital and coherent then o 2 is a o algebra in the category of co correspondence 16 etienne mann and marco robalo c 1 1 c 2 2 c 3 3 c 1 1 c 2 2 c 3 3 figure 5 geometric reason of the lax action example 4 1 2 we will illustrate the hypothesis and the conclusion of this theorem for the operad o n m 0 n 1 we choose this example because it is a well known operad and it is easier to explain notice that to prove see 4 2 1 our main theorem we need to apply to an other operad which is m 0 n 1 but the main ideas are the same notice that we set m 0 1 m 0 2 pt with the usual definition they are empty by definition we impose that o 1 is the unit for the operad o the following diagram is cartesian see below for an explanation o n o m 1 o 2 o n o m o n 1 o m q o n m p o n o m o n m 1 this property was called of configuration type in toe 13 notice that in the context of lur 14 definition 3 3 1 4 this notion was called coherent as p is flat we need to prove that it is a cartesian diagram in the stack category let c 1 x 1 xn 1 be in o n and c 2 y 1 ym 1 be in o m as o n 1 o n is the universal curve we deduce that q 1 c 1 c 2 c 1 pt c 2 which is exactly c 1 c 2 this implies that the diagram above is cartesian let us explain now the conclusion of this theorem notice that o 2 m 0 3 is a point the statement means that we have a morphism of operad that is a family of gromov witten theory with derived algebraic geometry 17 morphisms n o n hom cocorr n i 1 o 2 o 2 where the morphism n are compatible with the composition law the hom is the same meaning that in 3 3 2 the category of co correspondances is in the same spirit as correspondance see 3 2 but with the arrows in the other directions the morphism n is given by the following diagram o n n i 1 o 2 o n 1 o 2 o n oo ww o n 4 1 3 let explain this diagram with o n m 0 n 1 we have 1 the morphism o n 1 o n is to forget the last marked point 2 the map o n n i 1 o 2 o n 1 is given by the n possible gluings of the third marked point of o 2 m 0 3 with one of the marked points xi for i 1 n in o n 3 the is the gluing of last marked point xn 1 of o n with the third of o 2 4 2 sketch of proof of theorem 3 1 2 in this section we explain how to apply theorem 4 1 1 to get our main theorem here we take o n m 0 n 1 this is an operad in algebraic stack one can check that all we said before in the previous section for m 0 n 1 works as well for m 0 n 1 let x be a smooth projective variety we apply the functor rhom m 0 n 1 x m 0 n 1 to theorem 4 1 1 as the source curve of a stable map may not be a stable curve we need to use theorem 4 1 1 with an other operad than m 0 n 1 that s why we use m 0 n 1 we deduce the following result theorem 4 2 1 the variety x is an m algebra in the category of correspondances in derived stacks the algebra structure is given by the rm 0 n 1 x vv xn m 0 n 1 x m 0 n 1 remark 4 2 2 to apply theorem 4 1 1 we need to do several modifications 1 notice that in this statement the action is strong that means that the lax mor phisms are equivalences see 3 4 the geometrical reason is the following we can repeat the construction of 3 4 replacing m 0 n 1 by m 0 n the difference is that the forgetting morphism q m 0 n 1 x m 0 n 1 does not contract 18 etienne mann and marco robalo any component of the curve more precisely let m 0 a 1 and m 0 b 1 denote by rm 0 a 1 x q 1 take care that in 3 4 we use rm 0 a 1 x p 1 where p m 0 n 1 x m 0 n 1 writing the same kind of diagram as 3 4 2 we get the corresponding given by rm 0 a 1 x x rm 0 b 1 x rm 0 a b 1 x 4 2 3 which is now an isomorphism because from the glued curve there is a unique possibility to cut it with respect to and 2 first theorem 4 1 1 apply only to operads in spaces and here we have oper ads in derived stacks this can be done using non planar rooted trees and dendroidal sets more precisely one can enrich operads using segal functor from the nerve of op to derived stacks thanks to the work of chh 16 and hhm 13 these two definitions coincide on topological spaces 3 second the condition o 0 o 1 pt is not satisfied by m 0 n so we impose that for any 6 0 mfake 0 1 m fake 0 2 and that m fake 0 1 0 m fake 0 2 0 pt is with m fake 0 2 0 being the neutral element 4 an other issue is that m 0 n is not a coherent operad because the inclusion of schemes in derived stacks does not commute with pushouts even along closed immersion we only have a canonical morphism c 1 dst pt c 2 c 1 sch pt c 2 nevertheless most of the proof of theorem 4 1 1 is still valid and we know that the functor rhom x will see as an equivalence the next step in order to prove theorem 3 1 2 is to understand the morphism of operads m 0 n 1 m 0 n 1 embedding this morphism in the operads it turns out that this morphism is a lax morphism of operads this is the reason why the final action in theorem 3 1 2 is lax 5 comparison with other definition 5 1 quantum product in cohomology and in g 0 theory in this section we re view the definition of the quantum product in cohomology and ing 0 theory recall that x is a smooth projective variety givental lee defined in lee 04 the gromov witten invariants in g 0 theory for that they defined a virtual structure sheaf denoted by ovir mg n x on the moduli space of stable maps recall the morphism ei mg n x gromov witten theory with derived algebraic geometry 19 x are the evaluation morphism at the i th marked point for any e 1 en g 0 x the gromov witten invariants in g 0 theory are e 1 en g 0 0 n n i 1 e iei o vir m 0 n x z where is the euler characteristic let ne x be the neron severi group of x that is the subset of h 2 x z generated by image of curves in x definition 5 1 1 let 1 2 h x the quantum product in h x is defined by 1 h 2 ne x q ev 3 ev 1 1 ev 2 2 m 0 3 x vir 5 1 2 one can see this product as a formal power series in q hence the quantum product lies in h x where is the novikov ring i e it is the algebra generated by q for ne x we will recall the definition of the virtual class m 0 n x vir defined by behrend fantechi and the virtual sheaf ovir mg n x defined by lee lee 04 in 5 4 and 5 5 in g 0 theory we define the quantum product with the following formula definition 5 1 3 let f 1 f 2 g 0 x the quantum product in g 0 theory is defined to be the element in g 0 x f 1 g 0 f 2 ne x q ev 3 ev 1 f 1 ev 2 f 2 r n 0 r i 1 rovir m 0 3 x 0 ovir m 0 2 x 1 ovir m 0 2 x r the term r 0 in the formula in definition 5 1 3 is of the same shape 5 1 2 one has to understand the other terms i e r 0 are corrections terms 5 2 about the associativity the most important property of these two products is the associativity it is proved by kontsevich manin km 96 see also fp 97 that the quantum product in cohomology is associative notice that the key formula for the associativity is given in theorem 5 3 4 which states that virtual classes behave with respect to the morphisms s and the gluing morphisms recall that the morphisms s are the one that appear in the lax action 3 4 3 later when givental and lee see lee 04 try to define a quantum product in g 0 theory they want an associative product if one put the same kind of formula as in 5 1 2 the product is not associative hence the key observation of givental and lee is theorem 5 3 9 which is the analogue of theorem 5 3 4 in g 0 theory that is how the virtual sheaves behave with respect to the morphisms s and the gluing morphisms our contribution to this question is theorem 5 3 11 which is the geometric explana tion that explains the two theorems 5 3 9 and 5 3 9 20 etienne mann and marco robalo notice that givental lee packed the complicated formula of 5 1 3 in a very clever way notice that m 0 2 x m 0 2 x is empty if 0 as before put m 0 2 pt then we put o vir m 0 2 ox ne x 6 0 q ovir m 0 2 x g 0 x 5 2 1 let invert the formula above formally in g 0 x the terms in front of q is r n 0 r i 1 rovir m 0 2 x 0 ovir m 0 2 x 1 ovir m 0 2 x r 5 2 2 the formula 5 2 1 and 5 2 2 are the reason of the metric see formula 16 in lee 04 for more details because one can express in a compact form the formula 5 1 3 using the inverse of the metric 5 3 key diagram let us consider the following homotopical fiber product let n 1 n 2 n 2 put n n 1 n 2 z rm 0 n x p m 0 n 1 1 m 0 n 2 1 g m 0 n 5 3 1 the fiber over a point is denoted by m x in 3 4 that is stable maps where the curve stabilise to in figure 6 we have an example of a fiber over where we have a tree of p 1 in the middle using the universal property of the fiber product we get the morphism see 3 4 3 rm 0 n 1 1 x x rm 0 n 2 1 x z 5 3 2 where the left hand side is defined by the following homotopical fiber product rm 0 n 1 1 x x rm 0 n 2 1 x rm 0 n 1 1 x rm 0 n 2 1 x e 1 en 2 1 x x x 5 3 3 the heart of the associativity of the quantum products in cohomology see theorem 5 3 9 for g 0 theory is the following statement gromov witten theory with derived algebraic geometry 21 0 c 1 1 c 2 2 c 3 3 4 p x 1 x 2 x 3 x 4 x 5 x 1 x 2 x 3 x 4 x 5 m 0 5 figure 6 example of a stable map above with a tree of p 1 in the middle the tree c 1 c 2 c 3 is contracting by p to the node of theorem 5 3 4 theorem 5 2 lt 98 we have the following equality in the chow ring of the truncation of z m 0 n 1 1 x vir m 0 n 2 1 x vir g m 0 n x vir 5 3 5 remark 5 3 6 in beh 97 behrend proves that the virtual class satisfies five properties called orientation see 7 in bm 96 b namely mapping to a point products cutting edges forgetting tails and isogenies the formula 5 3 5 is a combination of cutting tails and isogenies the analogue statement in g 0 theory need a bit more of notations we denote rmg n x rxg n let r n 1 n 2 be in n with n 1 n 2 n and let be in ne x let 0 r be a partition of notice that there is only a finite number of partition we denote by rx 0 n 1 n 2 rx 0 n 1 1 0 x rx 0 2 1 x x rx 0 2 r 1 x rx 0 n 2 1 r 22 etienne mann and marco robalo we generalize the situation of 5 3 5 by the following homotopical cartesian diagram rx 0 n 1 n 2 rx 0 n 1 1 0 r 1 k 1 rx 0 2 i rx 0 n 2 1 r xr r x x r 5 3 7 gluing all the stable maps and using the universal property of z we have a mor phism r r i 0 i rx 0 n 1 n 2 z 5 3 8 notice that 1 is the of 3 4 3 finally we can state the analogue of theorem 5 3 4 in g 0 theory theorem 5 3 9 proposition 11 in lee 04 we have the following equality in the g 0 group of the truncation of z r n 1 r r r i 0 i r o vir x 0 n 1 1 0 ovirx 0 2 1 ovirx 0 2 r 1 ovirx 0 n 2 1 r g ovirx 0 n remark 5 3 10 1 comparing theorem 5 3 4 with theorem 5 3 9 we see that the formulas are more complicated in g 0 theory we see that moduli spaces of the kind m 0 2 x appears in g 0 theory this corresponds to stable curve with tree of p 1 in the middle see figure 6 notice that this is the same reason why the action of the main theorem 3 1 2 is lax 2 also in g 0 theory there are 5 axioms called orientation see remark 5 3 6 for the virtual sheaf ovir mg n x they are proved by lee in lee 04 denote by xr i rx 0 n 1 1 0 x rx 0 2 1 x x rx 0 2 r 1 x rx 0 n 2 1 r we deduce a semi simplicial object in the category of derived stacks where the r 1 morphisms from xr 1 xr are given by gluing two stable maps together we have x 0 x 1 x 2 moreover for any r we have a morphism of gluing all stable maps from xr z hence a morphism colimx z the following theorem was not proved in mr 15 we will prove it in the appendix theorem 5 3 11 we have that colimx z gromov witten theory with derived algebraic geometry 23 5 4 virtual object from derived algebraic geometry in this section we explain how derived algebraic geometry will provide a sheaf in g 0 mg n x that we will compare to the virtual sheaf of lee lemma 5 4 1 see for example toe 14 p 192 193 let x be a derived algebraic stack denote by t 0 x its truncation denote by t 0 x x be the closed embedding the morphism g 0 t 0 x g 0 x is an isomorphism moreover we have that 1 f i 1 i i f applying this lemma to the situation where x rmg n x we put o vir dag mg n x 1 ormg n x where the dag means derived algebraic geometry notice that the sheaf o vir dag mg n x depends on the derived structure that we put on the moduli space of stable maps the following theorem was not stated in mr 15 theorem 5 4 2 the dag virtual sheaf o vir dag mg n x satisfies the orientation axiom in g 0 theory that is 1 mapping to a point let 0 we have o vir dag mg n x 0 i 1 i i r 1 oc tx where c is the universal curve of mg n and c mg n 2 product we have o vir dag mg 1 n 1 x 1 mg 2 n 2 x 2 o vir dag mg 1 n 1 x 1 o vir dag mg 2 n 2 x 2 3 cutting edges with the notation of diagram 5 3 3 we have o vir dag mg 1 n 1 x 1 xmg 2 n 2 x 2 o vir dag mg 1 n 1 x 1 mg 2 n 2 x 2 4 forgetting tails forgetting the last marked point marked points we get a mor phism mg n 1 x mg n x we have the following equality o vir dag mg n x o vir dag mg n 1 x 5 isogenies the are two formulas the morphism above induces a morphism mg n 1 x mg n 1 mg nmg n x with notation of diagram 5 3 1 we have o vir dag mg n 1 x g o vir dag mg n x the second formula is r n 1 r r r i 0 i o vir dag x 0 n 1 1 x 0 xx 0 2 x 1 x xx 0 2 x r 1 xx 0 n 2 1 x r g o vir dag x 0 n x where g is defined in the key diagram 5 3 1 24 etienne mann and marco robalo before proving this theorem we need a preliminary result consider a homotopical cartesian morphisms of schemes x x y y pp ppp ppp ppp p x hy y f g y x f y denote by x hy y the homotopical pullback so that we have the closed immersion x x hy y assume that f is a regular closed immersion we have a rafined gysin morphism see lee 04 p 4 ful 98 ex 18 3 16 or chapter 6 in fl 85 which turns to be f g y g x 5 4 3 fy 7 1 f fy proof of theorem 5 4 2 1 strangely this proof is not easy and we postpone to the appendix b 2 this follows from the ku nneth formula 3 we have the following diagram xg 1 n 1 1 x xg 2 n 2 2 k h xg 1 n 1 1 h x xg 2 n 2 2 j g xg 1 n 1 1 xg 2 n 2 2 i rxg 1 n 1 1 x rxg 2 n 2 2 f rxg 1 n 1 1 rxg 2 n 2 2 ei ej x x x we deduce the following equalities o vir dag xg 1 n 1 1 xg 2 n 2 2 i 1 orxg 1 n 1 1 rxg 2 n 2 2 k 1 g i 1 orxg 1 n 1 1 rxg 2 n 2 2 by definition of rafined gysin morphism k 1 j 1 f orxg 1 n 1 1 rxg 2 n 2 2 by derived base change k 1 j 1 orxg 1 n 1 1 xrxg 2 n 2 2 o vir dag xg 1 n 1 1 xxg 2 n 2 2 4 as rmg n 1 x rmg n x is the universal curve hence it is flat and is the truncation of the derived base change formula implies the equality gromov witten theory with derived algebraic geometry 25 5 we have the following diagram mg n 1 x k mg n mg n mg n x a j mg n x i rmg n 1 x 11 mg n 1 mg n rmg n x b rmg n x mg n 1 c mg n notice that as c is flat the upper right square is also h cartesian we have c o vir dag mg n x c i 1 o rmg n x a i 1 o rmg n x j 1 b o rmg n x by derived base change j 1 o mg n 1 mg n rmg n x on the other hand we have o vir dag mg n x k 1 o rmg n 1 x j 1 ormg n 1 x the formula follows from the equality below which is a consequence of the proof of proposition 9 in lee 04 ormg n 1 x omg n mg n rmg n x to prove the second formula of 5 we use the key diagram 5 3 1 with theorem 5 3 11 let g 1 g 2 n 1 n 2 be integers put g g 1 g 2 and n n 1 n 2 and denote mi mgi ni 1 t 0 z k a m 1 m 2 h mg n x b j mg n x i z c rmg n x m 1 m 2 g mg n 26 etienne mann and marco robalo we have g o vir dag mg n x g i 1 o rmg n x k 1 b i 1 o rmg n x k 1 j 1 c o rmg n x by derived base change j k 1 oz we deduce the formula by observing that z is the colimit of x see theorem 5 3 11 and that the structure sheaf of a co limit is the alternating sum of oxr the last formula of theorem 5 4 2 and the third one implies the following corollary corollary 5 4 4 we have the following equality in g 0 t 0 z r n 1 r r r i 0 i r o vir dag x 0 n 1 1 x 0 o vir dag x 0 2 x 1 o vir dag x 0 2 x r 1 o vir dag x 0 n 2 1 x r g ovir dagx 0 n x 5 5 virtual object from perfect obstruction theory here we follow the ap proach of behrend fantechi bf 97 to construct virtual object in the following we denote by m a deligne mumford stack the reader can think of m being m 0 n x as an example definition 5 5 1 let m be a deligne mumford stack an element e in the derived category d m in degree 1 0 is a perfect obstruction theory for m if we have a morphism e lm that satisfies 1 h 0 is an isomorphism 2 h 1 is surjective let e be a perfect obstruction theory following bf 97 we have the following morphisms 1 the morphism a cm h 1 h 0 e where cm is the intrinsic normal cone and h 1 h 0 e is the quotient stack e 1 e 0 to understand how to construct this morphism let us simplify the situation assume that m is embedded in something smooth i e f m y is a closed embedding with ideal sheaf i then the intrinsic normal cone is the quotient stack cm cmy f ty where cmy spec n 0 i n in 1 is the normal cone of f in this case the intrinsic normal sheaf is nm nmy f ty h 1 h 0 l m where nmy spec sym i i 2 as we have a morphism from the normal cone to the normal sheaf cmy nmy we deduce a morphism from the intrinsic normal cone to the intrinsic normal sheaf i e a morphism 5 5 2 cm nm gromov witten theory with derived algebraic geometry 27 now the morphism of the perfect obstruction theory e lm induces a morphism from 5 5 3 nm e 1 e 0 the morphism a is the composition of the two morphisms 5 5 2 and 5 5 3 2 we also have a natural morphism b m h 1 h 0 e given by the zero section from these two morphisms we can perform the homotopical fiber product m hh 1 h 0 e cm r cm m h 1 h 0 e 5 5 4 as the standard fiber product is m we have that m hh 1 h 0 e cm is a derived enhance ment of m with j m m hh 1 h 0 e cm the canonical closed embedding notice that in the case m mg n x we get a derived enhancement which is different from rmg n x see remark 5 6 3 we will compare these two structures in 5 6 hence we can apply the lemma 5 4 1 and we denote o vir pot m j 1 om h h 1 h 0 e cm g 0 m 5 5 5 where pot means perfect obstruction theory the definition of lee for the virtual sheaf turns to be exactly this one indeed lee consider the following not homotopical la cartesian diagram m e 1 c 1 r c 1 cm m e 1 h 1 h 0 e 5 5 6 in lee 04 p 8 lee takes as a definition for the virtual sheaf o vir m i 1 itor h 1 h 0 i om oc 1 om l h 1 h 0 oc 1 o vir pot m where the last equality follows from lemma 5 4 1 5 6 comparison theorem of the two approachs let m m 0 n x in this section we want to compare o vir dag m with o vir pot m the first question is what is the perfect obstruction theory we are choosing this is given by the following result proposition 5 6 1 stv 11 let rm be a derived deligne mumford stack denote by m its truncation and its truncation morphism by j m rm then j lrm lm is a perfect obstruction theory now the original question makes perfectly sense and we have the following result that says that they are the same sheaves 28 etienne mann and marco robalo theorem 5 6 2 see proposition 4 3 2 in mr 15 in g 0 m we have o vir dag m o vir pot m remark 5 6 3 notice that the two enhancements rm or m hh 1 h 0 e cm are not the same indeed the second one has a retract r m hh 1 h 0 e cm m given in the diagram 5 5 4 that is r j idm where j is the closed immersion from m to m hh 1 h 0 e cm from this we get the following exact triangle of cotangent complexes l j 1 j lm h h 1 h 0 e cm lm 5 6 4 r lm lm h h 1 h 0 e cm lr 5 6 5 applying j to the second line we get lm j lm h h 1 h 0 e cm j lr this means that 5 6 4 has a splitting that is j lm h h 1 h 0 e cm l j 1 lm 5 6 6 comparing to the cotangent complex of rm that has no reason to split we get a priori two different derived enhancement of m notice that in the work of fantechi go ttsche fg 10 lemma 3 5 see also roy joshua jos 10 they prove that for a scheme x with a perfect obstruction theory e e 1 e 0 we have x o vir pot x td tx vir xvir pot 5 6 7 where txvir g 0 x is the class of e 0 e 1 where e 0 e 1 is the dual complex of e and x g 0 x a x q notice that the formula 5 6 7 with theorem 5 6 2 implies that mg n x vir pot o rmg n x td t rmg n x 1 appendix a proof of theorem 5 3 11 theorem a 0 1 the map f colimdm x z of mr 15 4 2 9 is an equivalence of derived deligne mumford stacks proof it follows from the discussion in the proof of mr 15 prop 4 2 1 that perf z f h pp ppp pp ppp pp perf colimdm x g uu lim perf x gromov witten theory with derived algebraic geometry 29 commutes with the morphism h being an equivalence after h descent for perfect com plexes hlp 14 4 12 and the morphism g being fully faithful after the result of gluing along closed immersions lur 17 16 2 0 1 this immediately implies that the map f is an equivalence of categories because we have g f h and g is conservative as it is fully faithful as both source and target of f are perfect stacks the first being a colimit of perfect stacks along closed immersions and second being pullback of perfect stacks f induces an equivalence qcoh z f qcoh colimdm x we conclude that f is an equivalence using tannakian duality lur 17 9 2 0 2 appendix b proof of theorem 5 4 2 1 let x be a derived stack we will use the linear derived stacks v e see toe 14 p 200 where e is a complex of quasi coherent sheaf on x we have a morphism v e x and a zero section s x v e one should understand that v e as a vector bundle where the fibers are e it is a derived generalisation of spec syme for a coherent sheaf e if e is a two terms complex with cohomology in degree 0 and 1 then we have that t 0 v e 1 h 1 h 0 e see 2 in bf 97 for the definition of the quotient stacks let recall some notation of 5 5 and 5 6 let g n n and h 2 x z denote by j the closed immersion mg n x rmg n x to simplify the notation put m mg n x and rm rmg n x from the exact triangle j lrm lm lj we deduce that following cartesian diagram v lj 1 v lm 1 m v j lrm 1 b 0 1 recall that j l rmg n x is a two terms complex in degree 1 and 0 but in general it is not the case for lj and lmg n x comparing with behrend fantechi we have t 0 v lm 1 is the intrinsic normal sheaf nm see 5 5 and we have the following cartesian diagram 30 etienne mann and marco robalo m hv j lrm 1 cm cm v lj 1 v lm 1 m v j lrm 1 b 0 2 proposition b 0 3 let g n n and h 2 x z denote by j the closed immersion mg n x rmg n x and by s mg n x v lj 1 be the zero section we have the following equality in g 0 mg n x o vir dag mg n x j 1 ormg n x s 1 ov lj 1 proof from gaitsgory see proposition 2 3 6 p 18 chapter iv 5 gai 17 we can con struct an derived stack yscaled such that the following diagram has two homotopical fiber products rm h yscaled v lj 1 voo m 0 i 0 j oo m a 1 oo m 1 i 1 oo s oo we have s 1 ov lj 1 s 1 v oyscaled i 1 1 oyscaled i 0 1 oyscaled the last equality follows from the a 1 invariance of the g theory that is we have that g 0 m a 1 g 0 m and i 0 1 i 1 where is the projection applying the same computation as above with the other homotopical fiber product we get formula remark b 0 4 this statement is a first step in proving theorem 5 6 2 the last step is to prove that the inclusion cm nm induces an equality of the structure sheaf in g 0 theory corollary b 0 5 for stable maps of degree 0 we have that o vir dag mg n x 0 i 1 i i tx r 1 oc gromov witten theory with derived algebraic geometry 31 remark b 0 6 notice that in the case of 0 we have that mg n x 0 mg n x which is smooth nevertheless it has a derived enhancement given by the rmap which has a retract given by the projection and the evaluation for 6 0 this retract does not exist proof for 0 the smoothness of m implies that the intrinsic normal cone is the intrinsic normal sheaf that is we have the cm v lm 1 in the diagram b 0 2 the second thing which is different is that j m rm has a retract this implies that lj 1 lm 1 j lrm hence the proposition b 0 3 implies that we need to compput s 1 ov lj 1 which is by standard computation i 1 i i tx r 1 oc where c is the universal curve of mg n from the proof we see that the rhs of the formula is the structure sheaf of v lj 1 in fact we think that rmg n x 0 is isomorphic to v lj 1 this should follow from a general argument that we will detail in the next section for the affine case appendix c alternative proof of corollary b 0 5 in the affine case proposition c 0 1 let f speca be an affine quasi smooth algebraic derived stack let f 0 spec 0 a its truncation and denote j f 0 f its closed immersion assume that f 0 is smooth and that f admit a retract r f f 0 then f v lj 1 this proposition is a way of proving corollary b 0 5 in the affine case without us ing the deformation argument of gaitsgory we believe that we can drop the affine assumption in the previous proposition notice that we can drop the existence of the retract in the hypothesis because when f 0 is smooth there always exists a retract see the remark c 0 6 lemma c 0 2 with the previous hypothesis we have 0 lj 1 lj 0 2 lj 1 j lf 2 l 0 a 1 a 1 a lj 1 1 a 1 proof we have the triangle j lf lf 0 lj applying the hypothesis we get 1 as f is quasi smooth we have that 2 j lf 0 2 as f 0 is smooth we have that 2 lf 0 1 lf 0 0 3 as j lf lf 0 is a perfect obstruction theory we deduce 0 j lf 0 lf 0 and 1 j lf 1 lf 0 is onto applying the three properties above to the associated long exact sequence we get 32 etienne mann and marco robalo 1 as f is quasi smooth we have that 2 j lf 0 2 as f 0 is smooth we have that 2 lf 0 1 lf 0 0 3 as j lf lf 0 is a perfect obstruction theory we deduce 0 j lf 0 lf 0 and 1 j lf 1 lf 0 is onto 0 0 2 lj 1 j lf 0 0 0 j lf 0 lf 0 0 we conclude that 1 2 lj 1 j lf 2 lj is 2 connective to prove the second equality of the lemma we use the postnikov tower that is we consider the closed immersion j 1 f 0 f 1 and j 2 f 1 f where f 1 is spec 1 a we deduce the exact triangle j 1 lj 2 lj lj 1 as we have j and j 1 are 1 connected and j 2 is 2 connected we deduce from connective estimates that lj and lj 1 are 2 connective and lj 2 is 3 connective see corollary 5 5 in pv 13 we deduce from the long exact sequence that 2 lj 2 lj 1 how we apply lemma 2 2 2 8 in tv 08 that implies that 2 lj 1 1 a as we have that k lj 0 for all k 6 2 and 2 lj 1 a we deduce that lj 1 1 a 1 proof of proposition c 0 1 to prove the proposition we will show that b sym 0 a 1 a 1 a c 0 3 first we will construct a morphism f b a notice that 1 a is a free 0 a module by the last statement of lemma c 0 2 then we get an inclusion 1 a 1 a of 0 a modules which induces f b a moreover f is an equivalence on 0 and 1 that is 1 b 1 a then we construct an inverse from a b using the postnikov tower we have a 1 a 1 b as b is the colimit of its postnikov tower we will proceed by induction on the postnikov tower first we want to lift the morphism a 1 b to a 2 b we use the following cartesian diagram see remark 4 3 in pv 13 2 b 1 b d 1 b id 0 1 b 2 b 3 c 0 4 gromov witten theory with derived algebraic geometry 33 hence we need to construct a commutative diagram a 1 b d 1 b id 0 1 b 2 b 3 c 0 5 as la has a tor amplitude in 1 0 we have that 0 map la 2 b 3 0 1 map la 2 b 3 0 hence we deduce a morphism from a a d 2 b 3 hence we get the morphism from a b 2 a a d 2 b 3 a d vv b 2 b 1 d b 1 0 b 1 2 b 3 a 0 88 a 2 b 3 id hh hence by induction we get a morphism from g a b the composition g f b a b is the identity on 1 b and by the universal property of sym we deduce that g f idb this implies that i b i 1 a i a is injective to finish the proof we will prove that these morphisms are surjective for this purpose we use another characterization of afffine quasi smooth derived scheme let us fix generators of 0 a this choice is determined a surjective map of commutative k algebras k x 1 xn 0 a as the polynomial ring is smooth we proceed by induction on the postnikov tower of a to construct a morphism from k x 1 xn na we use the same idea as above for constructing the morphism a b we get a map of cdga s k x 1 xn a which remains a closed immersion moreover one can now choose generators for the kernel i of k x 1 xn 0 a say f 1 fm whose image in i i 2 form a basis the fact that k y 1 ym is smooth allows us to extend the zero composition map k y 1 ym k x 1 xm 0 a 34 etienne mann and marco robalo to map k y 1 ym k x 1 xm a together with a null homotopy this puts a in a commutative square of cdga s k y 1 ym k x 1 xn k a which we is a pushout square indeed it suffices to show that the canonical map k lk y 1 ym k x 1 xn a induces an isomorphism between the cotangent complexes but as spec a is quasi smooth its cotangent complex is perfect in tor amplitudes 1 0 meaning that it can be written as am an and this identifies with the standard description of the cotangent complex of the derived tensor product k lk y 1 ym k x 1 xn this implies that surjectivity of the morphisms i b i a remark c 0 6 as f speca is a derived scheme not necessarily quasi smooth and its truncation is f 0 is smooth we have that f 0 f admits a retract we proceed by induction on the postnikov tower of a to construct a lift a 0 a id 0 a we use the same kind of diagrams as c 0 4 and c 0 5 indeed as lf 0 is concentrated in degree 0 all the groups 0 map lf 0 n a n 1 1 map lf 0 n a n 1 0 vanish for n 1 saying that the liftings exist at each level of the postnikov tower the space of choices of such liftings is connected references bc 14 a brini and r cavalieri crepant resolutions and open strings ii arxiv e prints july 2014 bcr 13 a brini r cavalieri and d ross crepant resolutions and open strings arxiv e prints september 2013 beh 97 k behrend gromov witten invariants in algebraic geometry invent math 127 3 601 617 1997 bf 97 k behrend and b fantechi the intrinsic normal cone invent math 128 1 45 88 1997 gromov witten theory with derived algebraic geometry 35 bg 09 jim bryan and tom graber the crepant resolution conjecture in algebraic geometry seattle 2005 part 1 volume 80 of proc sympos pure math pages 23 42 amer math soc providence ri 2009 bm 96 a k behrend and yu manin stacks of stable maps and gromov witten invariants duke math j 85 1 1 60 1996 bm 96 b k behrend and yu manin stacks of stable maps and gromov witten invariants duke math j 85 1 1 60 1996 ccit 09 tom coates alessio corti hiroshi iritani and hsian hua tseng computing genus zero twisted gromov witten invariants duke math j 147 3 377 438 2009 cg 07 tom coates and alexander givental quantum riemann roch lefschetz and serre ann of math 2 165 1 15 53 2007 chh 16 hongyi chu rune haugseng and gijs heuts two models for the homotopy theory of operads 2016 cij 14 t coates h iritani and y jiang the crepant transformation conjecture for toric complete intersections arxiv e prints september 2014 cit 09 tom coates hiroshi iritani and hsian hua tseng wall crossings in toric gromov witten theory i crepant examples geometry and topology 13 2009 ck 99 david a cox and sheldon katz mirror symmetry and algebraic geometry volume 68 of mathematical surveys and monographs american mathematical society providence ri 1999 cos 06 kevin costello higher genus gromov witten invariants as genus zero invariants of sym metric products ann of math 2 164 2 561 601 2006 dk 12 tobias dyckerhoff and mikhail kapranov higher segal spaces i 2012 dm 69 p deligne and d mumford the irreducibility of the space of curves of given genus inst hautes e tudes sci publ math 36 75 109 1969 dub 96 boris dubrovin geometry of 2 d topological field theories in integrable systems and quan tum groups montecatini terme 1993 volume 1620 of lecture notes in math pages 120 348 springer berlin 1996 fg 10 barbara fantechi and lothar go ttsche riemann roch theorems and elliptic genus for virtually smooth schemes geom topol 14 1 83 115 2010 fl 85 william fulton and serge lang riemann roch algebra volume 277 of grundlehren der mathematischen wissenschaften fundamental principles of mathematical sciences springer verlag new york 1985 fp 97 w fulton and r pandharipande notes on stable maps and quantum cohomology in algebraic geometry santa cruz 1995 volume 62 of proc sympos pure math pages 45 96 amer math soc providence ri 1997 ful 98 william fulton intersection theory volume 2 of ergebnisse der mathematik und ihrer grenzgebiete 3 folge a series of modern surveys in mathematics results in mathematics and related areas 3 rd series a series of modern surveys in mathematics springer verlag berlin second edition 1998 gai 17 dennis gaitsgory notes on geometric langlands http www math harvard edu gaitsgde gl 2017 giv 04 alexander b givental symplectic geometry of frobenius structures in frobenius mani folds aspects math e 36 pages 91 112 friedr vieweg wiesbaden 2004 gp 99 t graber and r pandharipande localization of virtual classes invent math 135 2 487 518 1999 hhm 13 gijs heuts vladimir hinich and ieke moerdijk the equivalence between lurie s model and the dendroidal model for infinity operads 2013 36 etienne mann and marco robalo hlp 14 daniel halpern leistner and anatoly preygel mapping stacks and categorical notions of properness 2014 iri 09 hiroshi iritani an integral structure in quantum cohomology and mirror symmetry for toric orbifolds adv math 222 3 1016 1079 2009 iri 10 hiroshi iritani ruan s conjecture and integral structures in quantum cohomology in new developments in algebraic geometry integrable systems and mirror symmetry rims kyoto 2008 volume 59 of adv stud pure math pages 111 166 math soc japan tokyo 2010 jos 10 roy joshua riemann roch for algebraic stacks iii virtual structure sheaves and virutal fundamental classes https people math osu edu joshua 1 rr 3 revision pdf 2010 kkp 08 l katzarkov m kontsevich and t pantev hodge theoretic aspects of mirror symmetry arxiv e prints may 2008 km 94 maxim kontsevich and yuri manin gromov witten classes quantum cohomology and enumerative geometry comm math phys 164 3 525 562 1994 km 96 m kontsevich and yu manin quantum cohomology of a product invent math 124 1 3 313 339 1996 with an appendix by r kaufmann knu 83 finn f knudsen the projectivity of the moduli space of stable curves ii the stacks mg n math scand 52 2 161 199 1983 kon 95 maxim kontsevich enumeration of rational curves via torus actions in the moduli space of curves texel island 1994 volume 129 of progr math pages 335 368 birkha user boston boston ma 1995 lee 04 y p lee quantum k theory i foundations duke math j 121 3 389 424 2004 li 02 jun li a degeneration formula of gw invariants j differential geom 60 2 199 293 2002 lt 98 jun li and gang tian virtual moduli cycles and gromov witten invariants of algebraic varieties j amer math soc 11 1 119 174 1998 lur 14 jacob lurie higher algebra http www math harvard edu lurie october 2014 lur 17 jacob lurie spectral algebraic geometry http www math harvard edu lurie october 2017 mr 15 e mann and m robalo brane actions categorification of gromov witten theory and quantum k theory arxiv e prints may 2015 per 07 fabio perroni chen ruan cohomology of ade singularities internat j math 18 9 1009 1059 2007 pv 13 m porta and g vezzosi infinitesimal and square zero extensions of simplicial algebras arxiv e prints october 2013 rt 94 yongbin ruan and gang tian a mathematical theory of quantum cohomology math res lett 1 2 269 278 1994 rt 97 yongbin ruan and gang tian higher genus symplectic invariants and sigma models cou pled with gravity invent math 130 3 455 516 1997 rua 96 yongbin ruan topological sigma model and donaldson type invariants in gromov theory duke math j 83 2 461 500 1996 rua 06 yongbin ruan the cohomology ring of crepant resolutions of orbifolds in gromov witten theory of spin curves and orbifolds volume 403 of contemp math pages 117 126 amer math soc providence ri 2006 stv 11 t schu rg b toe n and g vezzosi derived algebraic geometry determinants of perfect complexes and applications to obstruction theories for maps and complexes arxiv e prints february 2011 gromov witten theory with derived algebraic geometry 37 stv 15 timo schu rg bertrand toe n and gabriele vezzosi derived algebraic geometry determi nants of perfect complexes and applications to obstruction theories for maps and complexes j reine angew math 702 1 40 2015 toe 13 b toe n operations on derived moduli spaces of branes arxiv e prints july 2013 toe 14 bertrand toe n derived algebraic geometry ems surv math sci 1 2 153 240 2014 tse 10 hsian hua tseng orbifold quantum riemann roch lefschetz and serre geometry and topology 14 1 81 2010 math 0506111 tv 08 bertrand toe n and gabriele vezzosi homotopical algebraic geometry ii geometric stacks and applications mem amer math soc 193 902 x 224 2008 etienne mann universite d angers de partement de mathe matiques ba timent i fac ulte des sciences 2 boulevard lavoisier f 49045 angers cedex 01 france e mail address etienne mann univ angers fr marco robalo sorbonne universite universite pierre et marie curie institut mathe matiques de jussieu paris rive gauche cnrs case 247 4 place jussieu 75252 paris cedex 05 france e mail address marco robalo imj prg fr 1 introduction 2 moduli space of stable maps cohomological field theory and operads 2 1 moduli space of stable maps 2 2 gromov witten classes and cohomological field theory 2 3 reviewed on operads 3 lax algebra structure on x 3 1 main result 3 2 category of correspondances 3 3 derived enhancement 3 4 lax morphism 4 proof of our main result 4 1 brane action 4 2 sketch of proof of theorem 3 1 2 5 comparison with other definition 5 1 quantum product in cohomology and in g 0 theory 5 2 about the associativity 5 3 key diagram 5 4 virtual object from derived algebraic geometry 5 5 virtual object from perfect obstruction theory 5 6 comparison theorem of the two approachs appendix a proof of theorem 5 3 11 appendix b proof of theorem 5 4 2 1 appendix c alternative proof of corollary b 0 5 in the affine case references