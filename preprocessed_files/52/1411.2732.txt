ar x iv 1 41 1 27 32 v 1 m at h s t 1 1 n ov 2 01 4 quantiles as minimizers michel valadier november 2014 abstract a real random variable admits median s and quantiles these values minimize convex functions on r we show by convex analysis arguments that the function to be minimized is very natural the relationship with some notions about functions of bounded variation developed by j j moreau is emphasized 1 introduction let p a probability law on r assume that p is of order 1 which writes x dp x a real number m is a median if and only if it minimizes references to exercises in some textbooks will be given in section 3 the function ofm r x m dp x without the order 1 hypothesis the medians minimize m 7 m r x m x dp x this is not exactly when 1 2 the value of corresponding to medians the function defined in 6 because of a factor 2 this ex tends to quantiles this paper gives convex analysis proofs of these results with our process the function appears naturally we emphasize the links with some notions about functions of bounded variation developed by j j moreau i began this paper being unaware of koltchinskii kol this 1997 work is more devoted to the multivariate case see some other comments in section 4 retired professor mathe matiques universite montpellier ii place euge ne bataillon case courier 051 34095 monptellier cedex france email mivaladier wanadoo fr 1 http arxiv org abs 1411 2732 v 1 2 definitions and notations let p be a probability law on r if necessary x will denote a random variable obeying the law p the law p is of order p p 1 2 if x is of order p which writes x lp if no integrability condition on x is assumed specialists write x l 0 order 0 when p is of order 1 the mean e x does exist when p of order 0 there exists a non empty compact interval of medians the definition of a median is included in that of a quantile below let f be the right continuous distribution function f x p x p x x for 0 1 usually in statistics 0 95 or 0 99 etc a real number q is a quantile if p x q and p x q 1 or maybe more plainly p x q p x q note that x 7 p x x is the left continuous version f of f when 1 2 one recovers median s a geometrical definition of quantiles is the following their set is the projection on r of the intersection of r with the filled in graph 1 g of f that is the set of quantiles is q r q g this geometrical definition operates when 0 or 1 for example the set of 1 quantiles is the closed possibly empty interval q r f q 1 and the set of 0 quantiles is the closed possibly empty interval q r f q 0 a real number candidate to be the mean or a median will be denoted by m a candidate to be a quantile will be denoted by q 1 this graph is obtained from the graph of f by adding vertical segments when there are gaps thus obtaining an arcwise connected curve g x y x r and y f x f x this comes from monteiro marques and moreau works on the sweeping process mm 1 p 147 mm 2 p 15 some ideas coming back to mor 2 in section 4 the filled in graph will be seen as a maximal monotone operator 2 3 medians and quantiles as minimizers well known 2 is the result if p is of order 1 m is a median if and only if it minimizes on r the function m 7 r x m dp x surprising are the assumption about order 1 and the fact that medians depend only on the structure of ordered space of r and not on its metric nor on its group structure nor on haar measure an answer at least relatively to the order 1 assumption is the following well known too 3 is the result if p is any law x 7 x m x is p integrable obviously x m x m and m is a median if and only if it minimizes on r the function m 7 r x m x dp x the notion of median extends to rd and to banach spaces see kem kol md and there exist conditional medians v 3 kemperman kem and milasevic ducharme md gave in the multivariate case a sufficient condi tion implying uniqueness of the median see already in 1948 haldane ha these questions will not be considered here the interest of medians comes from robustness i e stability with respect to outliers values maybe the notions of means in metric spaces going back to fre chet see fr and many other papers by the same author should be revisited see the papers by armatte a 1 a 2 the first one containing more than six pages of fre chet s references numerous authors studied random variables with values in a metric space for instance bh rf now we turn to quantiles t s ferguson fe 1 exercise 1 8 3 p 51 solu tion in fe 2 says that 4 if 0 1 and p is of order 1 q is a quantile if and only if it minimizes on r the function q 7 x q dp x 2 in french textbooks dcd 1 exercice e 11 p 71 solution page 28 of dcd 2 and the ore me 10 1 page 93 in ff see also fe 1 ex 1 8 2 p 51 and its solution in fe 2 3 exercises in french universities and surely in many countries 4 this result is appreciated by specialists koe first chapter and already kb p 38 3 where 1 x 1 2 x 1 2 x 1 x if x 0 x if x 0 my purpose here is to give a convex analysis proof of the extension to any probability law and to follow a natural way surely koltchinskii kol contains the statement but his framework is multivariate 4 a convex analysis point of view the filled in graph g defined in section 2 is a subset of r 2 which is amaximal monotone operator rw chapter 12 and therefore a maximal cyclically monotone one because of dimension 1 cf rw 12 6 pp 547 548 let f be the primitive antiderivative of f null at 0 f x x 0 f u du if x 0 0 x f u du if x 0 several textbooks treats convexity one of the most fundamental is mor 1 since f is nondecreasing f is convex the sub derivative of f at x is f x r h r h f x h lemma 1 the graph of the multifunction x 7 f x is nothing else but the filled in graph g of the graph of f g x r 2 f x proof let f x w denote the directional derivative of f at x in the direction w there holds f x f x 1 f x 1 then since f is right continuous f x 1 lim h 0 f x h f x h lim h 0 1 h x h x f u du f x 4 and since f is as well the primitive of f f x 1 lim h 0 f x h f x h lim h 0 1 h x x h f u du f x therefore f x f x f x in such a situation a natural question is what does give the minimisation of f obviously the infimum may be this is why we cannot consider x f u du but with a slope belonging to 0 1 the function q 7 f q q does achieves minimum s and q is a minimum if and only if 0 f q this is equivalent to q g that is q is a quantile scholium let f denote a primitive of f for 0 1 2 q is a quantile q minimizes q 7 f q q next lemma is an integration by parts result we follow a proof by schilling but we could deduce the statement from results by rockafellar ro prop 1 pp 161 162 or moreau mor 3 section 11 this will be detailed elsewhere lemma 2 let a b in r then note the half open interval a b 3 a b x dp x b f b af a b a f x dx proof from schilling s 1 exercise 13 13 p 133 and its solution on the net s 2 pp 10 12 for the product of the lebesgue measure we denote it by dx and of p 4 dx dp a b 2 b a f b f a 5 and moreover dx dp a b 2 1 a b x 1 x b y dx dp y 1 a b x 1 a x y dx dp y 1 a b x 1 x b y dx dp y tonelli 1 a b y 1 y b x dx dp y a b f b f x dx a b b y dp y b a f b b a f x dx b f b f a a b y dp y 5 comparing 4 and 5 one gets 3 now let 5 is defined in 1 above 6 q r x q x dp x note that the function x 7 x q x is bounded on r theorem 1 let 0 1 and p be a law on r there holds q q 0 q f x dx if q 0 q q 0 f x dx if q 0 that is q f q q the function is convex and inf compact the value q is a quantile if and only if it minimizes the function comments part 3 below is a bit technical surely careless calculus would be quicker the formal calculus q r d dq x q x dp x q 1 dp q dp 1 f q 1 f q f q 5 koltchinskii kol considers the same functional see specially two lines after his formula 1 1 page 436 where he sets fp t s fp s s t there s is my variable q and t my threshold comparisons are not easy he also uses on pp 439 440 a multivalued integration result it th 8 3 4 i got similar results earlier in v 1 v 2 but ioffe and tihomirov published also some papers on these questions before their book 6 leads to q 0 f q proof 1 firstly x 7 x q x is less than q if 1 2 or than 1 q if 1 2 or more roughly x x q x q so the integral is well defined 2 the function defined by 1 being convex the convexity of q 7 x q x is trivial hence the convexity of 3 we now prove q as q for q 0 x q x 1 q if x 0 1 q x if x 0 q q if x q and for q 0 x q x 1 q if x q x q if x q 0 q if x 0 hence if q 0 we will apply formula 3 between lines 2 and 3 q 1 qp 0 0 q 1 q x dp x qp q 1 qp q 0 q x dp x qp q 1 qp q xf x q 0 0 q xf x dx qp q 1 q f q q f q 0 q xf x dx q 1 f q q 0 q f x dx 7 when q the mean value of f over 0 q ultimately exceeds any value in 1 so q more plainly for q q 0 f x dx q f x dx and f x 1 0 as x 7 on the other hand if q 0 we again apply 3 between lines 2 and 3 q 1 qp q q 0 x q dp x qp 0 1 qp q q 0 x dp x qp q 1 qp q xf x 0 q q 0 xf x dx qp q 1 q f q q f q q 0 xf x dx q 1 f q q q 0 f x dx 8 when q the mean value of f over q 0 ultimately passes under any value in 0 so q thus the finite valued convex function is inf compact so it achieves its infimum over a non empty compact interval by 7 and 8 q f q q from 2 the minimizers are the quantiles corollary 1 let 0 1 and p be a first order law on r then q is a quantile q minimizes q 7 r x q dp x proof the term r x dp x is finite and does not depend on q hence one can add it to the right hand side of 6 5 a direct proof classically the convex function on r achieves a minimum at q if and only if the left and right derivatives of at q are respectively 0 and 0 theorem 2 let 0 1 and p be a law on r the right derivative of at q is 0 if and only if p q is the derivative of at q in direction 1 is 0 if and only if p q is 8 proof we have to reformulate the inequalities q 1 lim h 0 q h q h 0 and q 1 lim h 0 q h q h 0 the second one expressing the positiveness of the directional derivative at q in the direction 1 another way to say that the left derivative is 0 a firstly let us consider the right derivative at q one has q h q h 1 h r x q h x q dp x the integral splits into q q q h q h where the non written integrands are respectively 1 h a function bounded above by h on a vanishing domain 6 and h on a domain which converges to q hence lim h 0 q h q h 1 p q p q p q thus the right derivative is 0 if and only if p q is b we turn now 7 to the directional derivative in the direction 1 one has q h q h 1 h r x q h x q dp x the integral splits into q h q h q q 6 the open intervals q q h decrease when h 0 and have empty intersection in order to apply convergence theorems of integration theory one should consider and this is sufficient a sequence hn n n satisfying hn 0 7 minus signs are always more perilous 9 where the integrands are respectively 1 h over a domain which con verges to q a function bounded above by h the domain being van ishing and h whence lim h 0 q h q h 1 p q p q p q thus the directional derivative in the direction 1 is 0 if and only if p q is acknowledgments thanks to manuel monteiro marques paul raynaud de fitte and lionel thibault for their comments they are not responsible of possible weaknesses references a 1 armatte m maurice fre chet statisticien enque teur et agitateur public revue d histoire des mathe matiques 7 2001 7 65 a 2 armatte m fre chet et la me diane un moment dans une histoire de la robustesse j soc fr stat 147 2006 23 37 bh belili n heinich h median for metric spaces appl math warsaw 28 2001 191 209 dcd 1 dacunha castelle d duflo m probabilite s et statistiques 1 proble mes a temps fixe masson paris 1982 dcd 2 dacunha castelle d duflo m exercices de probabilite s et statistiques 1 proble mes a temps fixe masson paris 1982 fe 1 ferguson t s mathematical statistics a decision theoretic ap proach probability and mathematical statistics vol 1 academic press new york london 1967 fe 2 ferguson t s see at http www math ucla edu tom solu tions to selected exercises http www math ucla edu tom mathematicalstatistics sec 18 pdf ff foata d fuchs a calcul des probabilite s deuxie me e dition dunod paris 1998 10 http www math ucla edu tom mathematicalstatistics sec 18 pdf fr fre chet m les e le ments ale atoires de nature quelconque dans un espace distancie ann inst h poincare sect b prob et stat 10 1948 215 310 this text and other papers by this author is on numdam org ha haldane j b s note on the median of a multivariate distribution biometrika 35 1948 414 415 it ioffe a d tihomirov v m theory of extremal problems stud ies in mathematics and its applications 6 north holland publish ing co amsterdam new york 1979 kem kemperman j h b the median of a finite measure on a banach space statistical data analysis based on the l 1 norm and related methods neucha tel 1987 217 230 north holland amsterdam 1987 koe koenker r quantile regression econometric society mono graphs 38 cambridge university press cambridge 2005 kb koenker r bassett g regression quantiles econometrica 46 1978 33 50 kol koltchinskii v i m estimation convexity and quantiles ann statist 25 1997 435 477 md milasevic p ducharme g r uniqueness of the spatial median ann statist 15 1987 1332 1333 mm 1 monteiro marques m d p regularization and graph approxima tion of a discontinuous evolution problem j differential equations 67 1987 145 164 mm 2 monteiro marques m d p differential inclusions in nonsmooth mechanical problems shocks and dry friction progress in nonlinear differential equations and their applications 9 birkha user verlag basel 1993 mor 1 moreau j j fonctionnelles convexes se minaire sur les e quations aux de rive es partielles 1966 1967 ii colle ge de france paris 1967 108 pages reedited in 2003 in 950 copies by facolta di ingegneria universita di roma tor vergata this hard to find text is on numdam org including an errata page 11 mor 2 moreau j j approximation en graphe d une e volution discontinue rairo anal nume r 12 1978 75 84 mor 3 moreau j j bounded variation in time in topics in nonsmooth mechanics j j moreau p d panagiotopoulos g strang eds birkha user basel 1988 pp 1 74 rf raynaud de fitte p the ore me ergodique ponctuel et lois fortes des grands nombres pour des points ale atoires d un espace me trique a courbure ne gative ann probab 25 1997 738 766 ro rockafellar r t dual problems of lagrange for arcs of bounded variation in calculus of variations and control theory ed by d l russel academic press new york 1976 pp 155 192 rw rockafellar r t wets r j b variational analysis grund lehren der mathematischen wissenschaften 317 springer verlag berlin 1998 s 1 schilling r l measures integrals and martingales cambridge university press new york 2005 s 2 schilling r l http www motapa de measures integrals and martingales solutions 13 14 pdf v 1 valadier m sur l inte gration d ensembles convexes compacts en dimension infinie c r acad sci paris se r a b 266 1968 a 14 a 16 v 2 valadier m sous diffe rentiels d une borne supe rieure et d une somme continue de fonctions convexes c r acad sci paris se r a b 268 1969 39 42 v 3 valadier m la muti application me dianes conditionnelles z wahrsch verw gebiete 67 1984 279 282 12 http www motapa de measures integrals and martingales solutions 13 14 pdf 1 introduction 2 definitions and notations 3 medians and quantiles as minimizers 4 a convex analysis point of view 5 a direct proof