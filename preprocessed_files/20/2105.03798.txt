relative order and spectrum in free and related groups jordi delgado 1 enric ventura 2 and alexander zakharov 3 1 department of mathematics university of the basque country ehu 2 departament de matem tiques universitat polit cnica de catalunya and institut de matem tiques de la upc barcelonatech catalonia 3 instytut matematyczny uniwersytet wroclawski pl grunwaldzki 2 4 50 384 wroclaw poland november 4 2021 abstract in this paper we consider a natural generalization of the concept of order of an element in a group an element g g is said to have order k in a subgroup h of g resp w r t a coset hu if k is the first strictly positive integer such that gk h resp gk hu we study this notion and its algorithmic properties in the realm of free groups and some related families both positive and negative algorithmic results emerge in this setting on the positive side among other results we prove that the order of elements the set of orders called spectrum and the set of preorders i e the set of elements of a given order w r t finitely generated subgroups are always computable in free and free times free abelian groups on the negative side we provide examples of groups and subgroups having essentially any subset of natural numbers as relative spectrum in particular non recursive and even non recursively enumerable sets of natural numbers also we take advantage of mikhailova s construction to see that the spectrum membership problem is unsolvable for direct products of nonabelian free groups key words and phrases order root spectrum subgroup free group stallings automata algorithmic problem decision problem undecidable problem 1 introduction for a finite group g the notion of order of an element is crucial to understand and study the algebraic structure of g the order of g g denoted by o g is the minimum positive integer k 1 such that gk 1 in g with a previous standard argument proving that such k always exists the classical lagrange theorem saying that the order of every g g must divide the cardinal of the group is fundamental in the study of the structure of finite groups jordi delgado r gmail com enric ventura upc edu alexander zakharov uwr edu pl 1 ar x iv 2 10 5 03 79 8 v 1 m at h g r 8 m ay 2 02 1 jordi delgado r gmail com enric ventura upc edu alexander zakharov uwr edu pl among many other classical results involving orders of elements gauss theorem sylow theorems etc when we move to infinite groups there usually show up non torsion elements i e elements g g such that gk 6 1 for every k 1 of course in this infinite setting we lose lagrange theorem and the concept of order of an element is relegated only to the torsion part of g which is usually not well behaved in general it is not even a subgroup of g on one extreme we have torsion free groups where it is totally vacuous and on the other extreme we have the so called periodic groups including of course all finite groups i e those where every element is a torsion element in this area of group theory i e infinite torsion groups burnside problems have special relevance let g be an arbitrary group in this paper we are going to relativize the notion of order of an element although our main focus is with respect to finitely generated subgroups many results can be extended to cosets as well we define the order of g in a subgroup h 6 g denoted oh g as the minimum k 1 such that gk h and we say that the order is zero instead of infinite when there is no such k clearly this relative notion extends the classical one to the infinite group setting and offers more potential to investigate the structure of the group for example it would allow to refine the classification of nonisomorphic groups with a given spectrum see 27 observe that for h 1 we recover the classical notion of order the order of g g in h 1 is precisely o 1 g o g also when h p g is normal the order of an element g g in h is nothing else but the classical order of its equivalence class gh in the quotient group g h i e oh g o gh some aspects of this notion have already been considered in the literature for example given g g and h 6 g we have oh g 1 if and only if g h hence the classical membership problem mp g given g g and a finitely generated h 6 g decide whether g h or not consists precisely on checking whether oh g 1 or not a natural generalization of mp g is then the computability of oh g for given g and h in this paper we investigate this problem as well as other related algorithmic problems providing examples of groups g where it is computable and others where it not another connection with notions already present in the literature is purity or isolation a subgroup h 6 g is called pure by some authors see for example 1 2 18 and isolated by others see for example 15 if for every g g and k z 0 gk h imply g h in our language this happens precisely when the set of orders in h is included in 0 1 a related concept is that of the pure closure of a subgroup h which is defined as the intersection of all pure subgroups of g containing h these notions appear recurrently in the literature but usually as technical tools with some other purposes for example an amalgamated product g 1 a 1 a 2 g 2 or an hnn extension g a has special properties when the corresponding subgroups ai 6 gi and a 6 g are pure in the present paper we start a systematic study of these concepts and some generalizations by themselves and not just as intermediate technical devices we start the paper defining the relative versions of the notions of root and order and their first properties to then consider some natural algorithmic problems involving them computation of the order of a given element computation of the set of elements of a given order computation of the spectrum i e the set of orders etc of course for a general group g these problems look undecidable and we provide a collection of specific negative results in this sense groups having subgroups with non computably enumerable spectrum groups with subgroups having spectrum with unsolvable membership etc to show this 2 negative behavior we use classical constructions like free and amalgamated products in one of our arguments bass serre theory plays a central role to understand orders of elements in certain subgroups also we use higman s embedding theorem to gain finite presentability in some special situations where this is possible thanks to a later observation by m chiodo that classical higman s embeddings preserve the orders of elements as one may suspect in this part of the paper direct products of free groups like f 2 f 2 pay their contribution via mikhailova s construction see 19 then we turn to positive results and focus our attention first on free groups we show that in this context all the considered questions are computable finitely generated subgroups have finite and uniformly computable spectrum there is a compact explicit and algorithmic friendly description of the set of elements of a given order in a given finitely generated subgroup and even in a given coset of it as a certain disjoint union of finitely many appropriate cosets conveniently closed by conjugation one can compute the so called s pure closure a generalization of the notion of pure closure of a given finitely generated subgroup which happens to be finitely generated again etc in this part of the paper the graphical representation of subgroups of a free group via stallings automata will be central introducing a nice and fruitful geometric component into the discussion in the last section we study the case of free times free abelian groups i e groups of the form fn zm this is an apparently simple extension of free groups whose behaviour however is known to differ remarkably from that of its factors in certain respects this family of groups has been source of interest in the last years see for example 5 12 25 26 although the analysis is more complicated here with arguments typically combining techniques both from the free and the free abelian parts we are able to prove parallel results conveniently adapted to the new framework in particular we see that the spectrum is bounded and computable and we obtain a finitary description for the sets of elements of a given order the main tools used in this part of the paper are the techniques developed by the first two authors for studying this family of groups this includes a vectorized version of stallings theory allowing to understand the lattice of finitely generated subgroups of fn zm with a combination of graphical techniques for the free part and linear algebra over the integers for the free abelian part the structure of the paper is the following in section 2 we give the definitions of relative root order and spectrum and analyze their first basic properties in section 3 we define several algorithmic problems involving these notions and observe obvious connections among them and with classical algorithmic problems like the word problem or the membership problem in section 4 we prove the existence of groups g and subgroups h 6 g with essentially arbitrary spectrum and analyze whether we can assume g finitely generated or finitely presented and h finitely generated in section 5 we study the case of direct products of free groups proving for these groups the non existence of an algorithm to decide whether a given integer shows up as an order in a given finitely generated subgroup finally in sections 6 and 7 we focus on free and free times free abelian groups respectively 1 1 notation and terminology the set of natural numbers denoted by n is assumed to contain zero and we specify conditions on this set using subscripts for example we denote by n 1 the set of strictly positive integers to avoid degenerate situations we adopt the convention that no natural 3 number divides 0 i e n 0 for every n n the number of elements of a set s is denoted by s we use lowercase italic font u v w to denote elements of the free group fn and lowercase boldface font a b c to denote vectors i e elements of the free abelian group zm uppercase boldface font a b c is used to denote matrices which as it happens with homomorphisms in general are assumed to act on the right that is we denote by x or simply x the image of the element x by the homomorphism and we denote by the composition a b c accordingly we denote by gh h 1 gh the conjugation of an element g by an element h in the free times free abelian context capitalized calligraphic font is used to distinguish subgroups h k l and subsets s r t of fn zm from their counterparts in fn and zm denoted by h k l and r s respectively throughout the paper we write h 6 fg g h 6 ff g h 6 fi g h 6 alg g to denote that the subgroup h is finitely generated a free factor of finite index and algebraic in g respectively whenever possible we try to extend the existing terminology to our expanded context making the original meaning correspond to the trivial or default instance in the general setting this is the case for the definitions of order spectrum periodic group the order problem or the torsion problem for example finally regarding computability the terms computable or decidable and computably enumerable are preferred to the also very common recursive or solvable and recursively enumerable respectively 2 relative roots orders and spectra definition 2 1 let g be a group let g g let s g and let k z if gk s we say that g is a k th root k root for short of s and that k is a logarithm of s in base g we denote by g k s or simply by k s if the ambient group g is clear the set of k roots of s in g and by log g s the set of logarithms of s in base g that is gk s g k s k log g s 1 definition 2 2 let g be a group let g g and let s g the relative order of g in s denoted by os g is the smallest strictly positive logarithm of s in base g if it exists and zero otherwise that is os g max 0 min k 1 gk h 2 for every k n the set of elements from g of order k in h is denoted by g k h i e g k h g g oh g k we extend the notation for roots and orders to subsets i n in the natural way namely i h i i i h and g i h i ig i h note that 4 os g k 1 g 1 gk 1 s and gk s os g 0 gi s for every i 1 remark 2 3 our notion of element of order zero corresponds to the usual terminology of element of infinite order when referred to the trivial subgroup this interpretation will be specially meaningful when dealing with orbits and their lengths in section 6 also we will omit the adjective relative since the context will be always clear from the notation if no subset is mentioned we will assume the trivial subgroup definition 2 4 let s be a subset of a group g the set of orders w r t s of the elements in g denoted by os g is called the spectrum of g w r t s or the s spectrum of g for short that is os g os g g g k n g k s 6 3 we abbreviate o 1 g o g for the set of standard orders of the elements in g which is called the standard spectrum of g also in concordance with the notation for roots we write o s g os g n 2 for the set of proper orders of g in s throughout the paper we will focus on subsets with algebraic structure specifically sub groups and cosets for the former ones the previous and related concepts have specially nice properties lemma 2 5 let h be a subgroup of g and let g g then the set log g h of logarithms of h in base g is an ideal of z equivalently for all k l z k h kl h and k h l h k l h lemma 2 6 the order of an element g g in a subgroup h 6 g is the unique nonnegative generator of the ideal log g h that is log g h oh g g h goh g and we have the order function namely o g sgp g n given by oh g min k 0 gk h if g h 6 1 or g 1 0 otherwise 4 remark 2 7 recall that for every g g and every h 6 g i oh g 0 k 1 gk h ii oh g 1 g h in particular oh 1 g 1 iii oh g k 2 g 1 g 2 gk 1 h and gk h note also that if h is a subgroup of g then for every k 1 k h i k g i h 5 and g k h k hr k 6 i k i h 6 5 remark 2 8 for each g g the map h 7 oh g is anti monotone w r t inclusion in sgp g and divisibility in n that is if h 6 k then ok g oh g remark 2 9 if g g has non zero order in h then ohu g 6 oh g for any u g indeed if g g 2 gn 1 hu and gn hu then it follows immediately that g g 2 gn 1 h note that by definition 0 h g and 1 h h the terminology below is meant to exclude these degenerate types of roots definition 2 10 let g be an arbitrary group let g g and let h be a subgroup of g if oh g 1 then we say that g is a nontrivial root of h or that g is periodic w r t h the group g is said to be periodic w r t h if every element in g is periodic w r t h that is if 0 oh g and bounded periodic w r t h if oh g 1 k for some k n in a similar vein g is said to be a proper root of h if oh g 2 that is the proper roots of h are the periodic elements w r t h not in h we denote the set of non trivial roots of h by h and the set of proper roots of h in g by h note that g g 0 h t h and h ht h remark 2 11 if h 1 6 h 2 6 g then g 0 h 2 g 0 h 1 and k h 1 k h 2 for every k 1 observe also that k h 1 is not in general a subgroup of g the product of two k roots of h 1 is not in general a k root of h 1 unless for example when g is abelian remark 2 12 the standard notions of order periodicity etc correspond to our respective notions w r t the trivial subgroup h 1 in which case we delete the reference to h from the notation accordingly o g is the standard order of the element g except for the case of elements of infinite order for which we put o g 0 also g k is the set of torsion elements in g of standard order k more generally if h is a normal subgroup of g then the order of an element g g in h coincides with the standard order of gh in the quotient group g h i e ogh g o g h gh hence g k h g h k 7 it is clear from the definition that certain properties of the standard order extend naturally to the order in a subgroup lemma 2 13 let g be a group let h be a subgroup of g let g g and let d 1 then oh g d oh g gcd oh g d 8 in particular if d oh g then oh gd oh g d below we recall that the order of an element in a subgroup is indeed an algebraic invari ant lemma 2 14 let h 6 g u v g and aut g then oh u oh u in particular oh u ohv u v and the set g k h of g elements of order k in h is closed under conjugation by elements from h 6 from remark 2 12 it is clear that if h is normal in g then oh g is the set of standard orders of the elements in the quotient group g h i e oh g o g h hence g is periodic w r t a normal subgroup h if and only if g h is periodic the properties below follow easily from the definitions lemma 2 15 let g be a group and let h k be subgroups of g then i oh g is closed by taking divisors ii 1 oh g iii if k 6 h 6 g then ok h ok g iv if k 6 h then for every g g oh g ok g 6 h k ordh g v if h 6 g and aut g then oh g oh g vi if g is torsion free then 0 oh g if and only if h admits a nontrivial complement see 11 vii if h p g then oh g o g h particularly appealing is the relation between subgroup relative order and index which mimics and extends some classical topics in group theory corollary 2 16 let g be a group let h be a subgroup of g and let 1 6 k then i g h k implies oh g 1 k in particular ii if 0 oh g then g h remark 2 17 observe that when applied to normal subgroups corollary 2 16 i resembles the classical lagrange s theorem note however that orders do not divide the index in general on the other hand the question of whether or when the converse to statement ii is true has a clear burnside problem flavour concretely the contrapositive of ii is saying that every group is periodic w r t its finite index subgroups whether a finitely generated group g is periodic only w r t its finite index subgroups constitutes a natural generalization of the burnside question in this paper we see that this converse is true for free proposition 6 33 and free times free abelian groups lemma 7 15 definition 2 18 a group g is said to have bounded subgroup spectra if its spectrum w r t every finitely generated subgroup is bounded analogous notions can be defined relative to cosets a well known notion closely related to the previous discussion is that of pure subgroup sometimes called isolated subgroup in the literature see 1 2 15 and 18 we extend this notion a bit further definition 2 19 let h be a subgroup of a group g and let s n 1 then h is said to be s pure in g if s h h or equivalently if oh g div s 1 a subgroup h is said to be pure in g if it has no proper roots in g that is if h h or equivalently oh g 0 1 7 remark 2 20 note that nontrivial free factors are always pure whereas the trivial subgroup is pure in a group g if and only if g is torsion free remark 2 21 for every s n 1 the whole group g is obviously s pure and the intersection of s pure subgroups is again s pure definition 2 22 let h be a subgroup of a group g and s n 1 the s pure closure of h denoted ps h is the smallest s pure subgroup of g containing h i e ps h k h 6 k 6 g and k is s pure in g 9 in particular the pure closure of h is p h pn 1 h namely the intersection of all pure subgroups of g containing h 3 algorithmic considerations one of the main goals of the present paper is to understand the algorithmic behavior of the concepts introduced in particular the order and spectrum functions constitute natural sources for algorithmic questions starting by their own computability and going through the algorithmic nature of some of the involved subsets we recall that a total function f n n is said to be computable if there exists an algorithm a turing machine such that on every input n n outputs the image of n by f otherwise it is said to be incomputable similarly a subset s n is said to be computable a k a decidable or recursive if its indicator function is computable i e if there exists an algorithm for deciding whether any given n n belongs to s or not s is called incomputable or undecidable otherwise finally a subset s n is said to be computably enumerable c e a k a semicomputable semidecidable or recursively enumerable if there exists an algorithm able to list the elements in s it is easy to see that s is computable if and only if both s and its complement n r s are computably enumerable we extend these notions to any functions or sets able to be appropriately encoded into n for details we refer the reader to general references on computability see for example 4 8 29 in this section we state some natural algorithmic questions related to roots orders and spectra see table 1 some of them such as the purity problem or the classical subgroup membership problem have been considered before in this paper we aim to provide a general framework for this kind of questions and extend their scope from free groups to some related families a problem is computable or decidable if it is a decision problem i e it has only two possible outputs if there exists an algorithm formally a turing machine able to solve every instance of it we shall abuse language and refer directly to the algebraic objects involved in the problems instead of their codification as an input or output of the corresponding turing machine for example we shall refer to elements g g instead of words in the generators x and to finitely generated subgroups h 6 fg g instead of tuples of words in x representing some generators of the subgroup it is not difficult to see that this does not suppose any loss of generality see e g 20 the area of algorithmic group theory dates back to the beginning of the last century with the seminal 1911 paper 9 where m dehn identifies the word problem wp together with the 8 conjugacy problem cp and the isomorphism probem ip as one of the fundamental decision problems in group theory word problem wp g decide given an element g g as a word in x whether g g 1 or not of course here as well as along the present paper we will assume that g is a group given by a computable presentation x r i e a presentation with recursively enumerable possibly finite sets of generators x and relations r this implies that we can computably enumerate the elements in g and the elements in the normal closure r fx this last property is sometimes referred to as the positive part of the word problem in g denoted by wp g being solvable in the sense that it provides an enumeration of all the words on the generators representing the trivial element from g one first easy consequence in this context is that the set of nontrivial roots of any finitely generated subgroup is computably enumerable as well lemma 3 1 if g is a computably presented group then there exists an algorithm which on input a finitely generated subgroup h of g enumerates the elements in the set h of nontrivial roots of h in g proof let h be a finitely generated subgroup of g from the hypotheses we can assume computable enumerations gi i 0 and hj j 0 of the elements in g and in h respectively with possible repetitions hence we can use a standard diagonal argument to produce an algorithm enumerating the set g h n 1 gi hj k i 0 j 0 k 1 now it is enough to start this last enumeration and at every step say corresponding to i j k start checking whether the element gki h 1 j appears in the enumeration provided by wp g meaning when this is the case that gki g hj meanwhile this does not happen keep the enumeration of wp g running and simultaneously keep starting new instances and when one of the started instances gki h 1 j shows up in the enumeration of wp g if so add gi to the initially empty list l of the already found nontrivial roots of h and optionally stop the part of the process involving gi since this procedure goes eventually through every non zero power of every element in g and every element in h it will eventually identify and list in l all the elements in the set h whereas it will keep running indefinitely over the instances containing elements from g of order zero in h if any in lemma 3 1 we proved that if g is computably enumerable then every set h of nontrivial roots of a finitely generated subgroup h 6 fg g is computably enumerable note that for h to be computable it is still not enough to have computable wp g since we need a way to guarantee that for any given i and k no further matches gki g hj involving new hj s will appear after some point let us state this last problem formally torsion problem tp g decide given an element g g and a finitely generated subgroup h 6 fg g whether g is periodic w r t h i e whether oh g 6 0 by definition if tp g is computable then every set of the form h grg 0 h of nontrivial roots of a finitely generated subgroup h 6 fg g is computable as well hence if tp g is computable then given an input g g we can decide whether it has order zero in h and if not we can enumerate powers of g in parallel with elements in h and use wp g to reach a guaranteed match note however that we can still not compute the exact order oh g 9 since a match gk hj could unless k 1 in principle be improved by a later one gk hj where k k conversely it is worth mentioning here that the computability of wp g does not imply that of the torsion problem even for the standard order i e for h 1 see 17 it turns out that if we replace 0 by 1 in the condition defining the tp we recover a well known and important generalization of the word problem that precisely does the missing work to compute the order subgroup membership problem mp g decide given an element g g and a finitely generated subgroup h 6 fg g whether g h i e whether oh g 1 that is mp g is computable if all the finitely generated subgroups of g are uniformly computable moreover the computability of mp g allows us to refine the argument in lemma 3 1 to computably enumerate the set of nonzero orders w r t h and the set of elements in g of a given nonzero order in h lemma 3 2 if g is a computably presented group and mp g is computable then for every finitely generated subgroup h 6 g the set o 1 h g of nonzero orders w r t h and every set g k h of elements in g of order k 1 w r t h are computably enumerable proof since g is computably enumerable we can enumerate the set g n 1 gi k i 0 k 1 in such a way that for each i 0 the elements gi k appear in increasing order of the second coordinate this can be easily done by using a standard diagonal argument then at every step of the enumeration say corresponding to i k we use the mp g to check whether gki h if the answer is no we do nothing otherwise we add k to an initially empty list o we add gi to an initially empty list lk and we kill the part of the process involving gi it is clear from construction that this process will enumerate the set of nonzero orders w r t h in the list o and for every k 1 the set of elements of order k w r t h in the list lk note also that if mp g is decidable then it is straightforward to compute the order oh g of any periodic element g g see the proof of lemma 3 3 therefore only the ability to recognize elements of order zero is missing in order to achieve the computability of the full order function h g 7 oh g defined in 4 the correspondig algorithmic problem is called the order problem in accordance with the usual terminology for the case h 1 order problem op g output given an element g g and a finitely generated subgroup h 6 fg g the order of g w r t h of course if op g is computable then for every h 6 fg g and every k 0 the set g k h of elements of order k w r t h is computable as well it is also clear that the computability of mp g together with that of tp g immediately provides the computability of op g finally we add one last algorithmic property that combined with mp allows us to detect elements of order zero and hence compute the order problem order boundability problem obp g output given a finitely generated subgroup h 6 g and an element g g a finite upper bound for oh g lemma 3 3 let g be a finitely presented group then the following statements are equivalent 10 a op g is computable b mp g and tp g are computable c mp g and obp g are computable proof it is clear from the definitions that the computability of op g implies that of mp g tp g and obp g conversely if both tp g and mp g are computable then given g g and h 6 fg g we can use tp g to decide whether oh g 0 and if not use mp g to find the first integer k 1 such that gk h which is guaranteed to exist by hypothesis finally if both mp g and obp g are computable then given g g and h 6 fg g it is enough to find the first positive power of g belonging to h using mp g up to the bound provided by obp g if such a power exists it is the searched order oh g otherwise the order of g w r t h must be zero this concludes the proof let us now move to algorithmic questions related to the spectrum function h 7 oh g where h is a finitely generated subgroup of g note that the purity problem already studied in 1 15 18 for free groups admits a natural restatement in terms of the subgroup spectrum purity problem pp g decide given a finitely generated subgroup h 6 fg g whether h is pure or not i e whether oh g 0 1 in the same vein we present other natural algorithmic questions involving subgroup spectra which are interesting to us torsion group problem tgp g decide given a finitely generated subgroup h 6 fg g whether g is periodic w r t h i e whether 0 oh g spectrum membership problem smp g decide given m n and a finitely generated subgroup h 6 fg g whether g has elements of order m in h i e whether m oh g hence smp g being computable means that the spectra of g w r t finitely generated subgroups h 6 fg g are uniformly computable note that this is a sort of computability of the spectrum function however we shall be interested in producing the explicit spectrum whenever it is finite this is called the finite spectrum problem finite spectrum problem fsp g decide given a finitely generated subgroup h 6 fg g whether the spectrum oh g is finite and if so output it note that the computability of mp g only allows to computably enumerate the elements in the spectrum oh g in order to guarantee the computability of fsp g it is still necessary to algorithmically detect when the enumeration has finished this is precisely the property that defines the algorithmic problem below spectrum boundability problem sbp g output given a finitely generated subgroup h 6 fg g a finite upper bound for oh g if it is finite and otherwise 11 problem name input output order problem op g h 6 fg g g g oh g torsion problem tp g h 6 fg g g g oh g 1 subgroup membership mp g h 6 fg g g g g h word problem wp g g g g 1 order boundability obp g h 6 fg g g g k oh g 6 k finite spectrum fsp g h 6 fg g oh g if finite otherwise purity problem pp g h 6 fg g oh g 0 1 spectrum membership smp g h 6 fg g k n k oh g torsion group problem tgp g h 6 fg g 0 oh g spectrum boundability sbp g h 6 fg g k supoh g if finite otherwise table 1 algorithmic problems related to order and spectrum as can be seen in the table we are mainly interested in the uniform versions where the subgroup h is part of the input of the problems if needed the corresponding non uniform versions for a fixed subgroup h shall be denoted by adding a subscript h to the problem name e g mph g consists of deciding on input g g whether g h and op 1 g is the standard order problem w r t the trivial subgroup in g throughout the paper we shall consider some of the coset counterparts of the problems in table 1 in order not to overload the terminology we will state these properties explicitly and we shall use problem names only for the cases involving subgroups 4 realizing sets as subgroup spectra a very natural question in our context is which subsets of n are indeed realizable as spectra of groups w r t finitely generated subgroups in this section we show that for every subset o n closed under divisors and containing 0 there exists a finitely generated torsion free group g and a finitely generated subgroup h 6 fg g such that oh g o note that the same assertion is not true if we impose g to be computably or finitely presented just by cardinality reasons there are uncountably many such sets o just take o 0 1 p for any set of primes p for example and only countably many pairs g h with g computably presented and h 6 g finitely or computably generated recall that a subgroup h of a group g is called malnormal if hg h 1 for every g grh observe that any malnormal subgroup of a torsion free group is pure since if gk h for some k 1 and some g grh then gk hg h 1 in contradiction with g being torsion free proposition 4 1 let h k be torsion free groups let h 0 be a proper malnormal subgroup of h and let k 0 be a proper subgroup of k isomorphic to h 0 then for any amalgamated product g of h and k with amalgamated subgroups h 0 and k 0 and amalgamation taking place along any isomorphism between them oh g ok 0 k 0 12 note that in the above proposition none of the groups nor subgroups is required to be finitely generated proof we will use some basic bass serre theory in the proof and this is the only place in the paper where we use it for an introduction to bass serre theory see for example 3 for a formal definition of a walk and reduced walk see section 6 1 let t be the bass serre tree corresponding to the amalgamated product g recall that t has the following structure there are two types of vertices in t those corresponding to left cosets of h in g we call them h vertices and those corresponding to left cosets of k in g we call them k vertices the edges of t correspond to the left cosets of the amalgamated subgroup h 0 k 0 in g and the incidence relations are the natural ones for any g g the edge gh 0 gk 0 begins at the h vertex gh and ends at the k vertex gk the action of g on t is by left multiplication so the stabilizer of an h vertex gh is the subgroup ghg 1 a conjugate of h similarly stabilizers of k vertices and of edges are conjugates of k and of h 0 k 0 respectively this action is transitive on edges and has two orbits of vertices h type and k type for the proof that t is indeed a tree see 3 it follows from the above that an h vertex gh is incident only to the edges of the form ghh 0 where h runs through any set of left coset representatives of h modulo h 0 and all these edges are different to each other similarly a k vertex gk is incident only to the edges of the form gkk 0 where k runs through any set of left coset representatives of k modulo k 0 and all these edges are different from each other as well in particular t is locally finite if and only if h 0 and k 0 are of finite index in h and k respectively recall also the standard classification of elements of g by their action on t there are two kinds of elements of the amalgamated product g elliptic and hyperbolic elliptic elements are those which fix some vertex of t these are precisely the conjugates of elements in h or k on the other hand a hyperbolic element g g does not fix any vertex of t and it determines an axis i e a bi infinite reduced walk on t along which g acts by translation by some positive integer let us look more closely to the action of g on t by the stabilizer of a walk we mean the subgroup of g consisting of the elements which fix every edge and every vertex in we claim that any reduced walk of length 2 beginning and ending at k vertices say has trivial stabilizer this is not in general the case for those walks of length 2 beginning and ending at h vertices indeed the middle vertex of must be an h vertex say gh and the first and last vertices of are of the form gh 1 k and gh 2 k for some h 1 h 2 h such that h 1 h 0 6 h 2 h 0 i e h 11 h 2 6 h 0 then the stabilizers of the two edges are gh 1 h 0 h 1 1 g 1 and gh 2 h 0 h 1 2 g 1 respectively and their intersection is trivial stab gh 1 h 0 h 1 1 g 1 gh 2 h 0 h 12 g 1 gh 1 h 0 h 11 h 2 h 0 h 1 2 h 1 h 11 g 1 1 10 11 since h 11 h 2 h 0 and h 0 is malnormal in h therefore every reduced walk of length at least 3 in t has trivial stabilizer because it always contains a subwalk of length 2 of the above form let us now prove the claimed result the inclusion ok 0 k 0 oh g is easy if m ok 0 k there exists k k of order m in k 0 but then k considered as an element of g also has order m in h because h k h 0 k 0 in g therefore m oh g as required to 13 show that 0 oh g take any hyperbolic element g g such an element exists since h 0 and k 0 are proper subgroups of h and k respectively since powers of hyperbolic elements are again hyperbolic gn is hyperbolic for every n 1 and so gn h therefore 0 oh g as required in order to show the other inclusion oh g ok 0 k 0 let w g be an element of order n 1 in h and let us see that n ok 0 k since w n h is elliptic and powers of hyperbolic elements are again hyperbolic w must be elliptic as well i e w is a conjugate of an element in h or in k let us consider these two cases separately case 1 w ghg 1 for some h h and some g g in this case h g 1 wg fixes the vertex h in t and n is the minimum positive integer such that hn g 1 wng fixes the vertex g 1 h in t note that if g 1 h h then g h w h n 1 ok 0 k and we are done so let us assume that h and g 1 h are different vertices in t and let be the unique reduced walk in t from h to g 1 h since hn fixes both ends of it also fixes note that by the bipartite structure of t cannot have length 1 both h and g 1 h are h vertices different from each other on the other hand if has length 3 or more then it follows from the above claim that hn 1 hence h 1 since h is torsion free w 1 n 1 ok 0 k and we are done so we are reduced to the case that has length 2 in this case the first vertex of is h the second one is of the form h k for some h h and the last one is of the form h k h g 1 h for some k k moreover the first edge of is h h 0 and the second one h k h 0 since hn fixes it fixes its first edge so hn h h 0 h 1 but h h and h 0 is pure since it is malnormal in h so also the conjugate subgroup h h 0 h 1 is pure in h therefore we get that h h h 0 h 1 i e h fixes the first edge in hence h also fixes the second vertex in i e h h k h 1 for some k k it follows then that n is the minimum positive integer such that hn fixes the second edge in i e such that hn h k h 0 k 1 h 1 in other words n is the minimum positive integer such that kn k h 0 k 1 k k 0 k 1 therefore n ok k 0 k 1 k ok 0 k as required case 2 w gkg 1 for some k k and some g g in this case k g 1 wg fixes the vertex k in t and n is the minimum positive integer such that kn g 1 wng fixes the vertex g 1 h in t recall that n was the minimum positive integer such that wn h let be the unique reduced walk in t connecting k to g 1 h then kn fixes from the bipartite structure of t it follows that does not have length neither 0 nor 2 on the other hand if has length 3 or more then it follows from the above claim that kn 1 hence k 1 since k is torsion free w 1 n 1 ok 0 k and we are done so we are reduced to the case where has length 1 i e it consists on a single edge say k k 0 k h 0 for some k k such that k h g 1 h then k k and n is the minimum positive integer such that kn stabilizes this edge i e kn k k 0 k 1 it follows that n ok k 0 k 1 k ok 0 k as required and the proof is complete proposition 4 2 let f 2 a b be a free group of rank 2 let o be a set of non negative integers closed under taking divisors and containing 0 and let ko b nanbn n o 6 f 2 then oko f 2 o and the rank of ko is equal to the cardinality of or 0 proof let denote the stallings graph of ko with respect to the free basis a b see sec tion 6 1 for a brief survey on stallings automata it is clear that has the following structure there is a ray of length sup o of b labelled arcs pointing to and ending at the basepoint denoting by pi the vertex where we arrive after reading b i from the basepoint there are 14 also directed closed pn walks reading an for every n or 0 there are no other vertices nor arcs in see figure 1 in view of it is clear that ko has rank equal to or 0 b a figure 1 stallings automaton of ko for o 0 1 2 3 6 the inclusion o oko f 2 is immediate for every n o the element b nabn f 2 clearly has order n in ko for the other inclusion let 0 1 6 n oko f 2 and let w f 2 be an element of order n in ko write w u 1 w u with no cancellations and where w is a cyclically reduced word then wn u 1 w nu is reduced as written and can be read as the label of some walk in note that since w is cyclically reduced the vertex where we arrive after reading u 1 from the basepoint cannot have degree 2 and so it must be pj for some j or 0 further replacing w with w 1 if necessary we can assume that the first letter in w is a let us now denote by q 0 pj q 1 qj 1 the vertices along the cycle at pj with label aj since n 2 the vertex where we arrive after reading w from pj is incident to an a arc but on the other hand from the structure of ko it is clear that the total b exponent of wn ko and so of w and of w must be 0 so the vertex we arrive after reading w from pj q 0 must be some qi where 1 6 i 6 j 1 again because n 2 now since w can be read both starting from the vertices q 0 and qi it cannot contain any letter b that is w akj i for some k n finally from n being the order of w in ko we see that it is also the smallest positive integer such that w n is readable as a closed walk at pj therefore n is the smallest positive integer such that ni is multiple of j i e n j gcd i j o as required finally combining propositions 4 1 and 4 2 we deduce the desired example theorem 4 3 let o be a set of non negative integers closed under taking divisors and containing 0 then there exists a finitely generated torsion free group g with a finitely generated subgroup h such that the spectrum oh g o proof if o is finite then proposition 4 2 immediately provides the required example oth erwise consider a free group of rank 2 say h and a subgroup h 0 6 h being malnormal and having infinite rank it is not hard to construct such a subgroup explicitly see for example 7 also consider another free group of rank 2 say k and let k 0 ko 6 k defined as in proposition 4 2 now fix an isomorphism from h 0 to k 0 both are free groups of countably infinite rank and let g be the corresponding amalgamated product since 0 ok 0 k it follows from propositions 4 1 and 4 2 that oh g ok 0 k o note also that both g and h are finitely generated while g is not finitely presented in general corollary 4 4 there exists a finitely generated torsion free group g and a finitely generated subgroup h 6 g such that the spectrum oh g is non computably enumerable resp computably enumerable but non computable proof take o 0 1 s in theorem 4 3 where s is any non computably enumerable resp computably enumerable but non computable set of prime numbers 15 in fact for computably enumerable sets the following stronger statement holds theorem 4 5 let o be any computably enumerable set of non negative integers closed under taking divisors and containing 0 then there exists a torsion free finitely presented group g and a finitely generated subgroup h 6 g with oh g o furthermore the group g can be chosen to be word hyperbolic and residually finite proof consider the free product of cyclic groups of orders in o say k n ocn by the hypotheses on o o k o since o is computably enumerable k is recursively presented and we can use higman s embedding theorem to embed it into a finitely presented group k q furthermore by 6 theorem 2 2 this embedding adds no new torsion and so o q o k o now apply wise s version of rips construction to q see 32 to produce a word hyperbolic in fact c 1 6 small cancellation torsion free residually finite group g and a finitely generated normal subgroup h p g such that g h is isomorphic to q hence oh g o corollary 4 6 there exists a word hyperbolic torsion free residually finite group g and a finitely generated subgroup h 6 g with oh g being non computable proof apply theorem 4 5 to any computably enumerable non computable set o of non negative integers closed under taking divisors and containing 0 the question about realizing spectra not containing 0 seems much more tricky and related to periodic groups note that 0 6 oh g means that every element in g must have a strictly positive power inside h 5 free times free groups the direct product of nonabelian free groups typically f 2 f 2 is a classic source of examples with bad algorithmic behaviour a seminal example is the undecidability of its subgroup membership problem proved by k a mikhailova in 19 below we take advantage of this result to expand undecidability to our context proposition 5 1 fix n 2 and a prime number p there is no algorithm such that on input h 6 fg fn fn decides whether p oh fn fn or not in particular the spectrum membership problem smp fn fn is undecidable proof observe first that for r s 2 there is a pure embedding of fr into fs i e a pure subgroup of fs isomorphic to fr say fr h 6 fs for r 6 s we can take for example h to be a free factor of fs and for the general case we just observe that the commutator fs fs p fs is pure in fs since it is normal and the corresponding quotient is torsion free and not finitely generated hence it contains a rank r free factor fr h 6 ff fs fs 6 fs which will be pure in fs as well recall that purity is transitive repeating this operation on each coordinate we see that fr fr embeds purely in fs fs for every r s 2 hence proving the statement for each fixed n 2 reduces to proving it for a single fixed value n n 0 n 0 2 for later convenience let us do it for n 0 3 i e let us work in f 3 f 3 16 we say that a group g has unique p roots if for every pair of elements g 1 g 2 g g p 1 g g p 2 implies g 1 g g 2 for an arbitrary finite presentation on three generators q a 1 a 2 a 3 r 1 rm consider the corresponding mikhailova subgroup m q u v f 3 f 3 u q v 6 f 3 f 3 it is straightforward to see that m q is finitely generated by the elements a 1 a 1 a 2 a 2 a 3 a 3 1 r 1 1 rm moreover given two words u v on a 1 a 2 a 3 we have u 6 q v but up q vp if and only if u v 6 m q but u v p up vp m q and by the primality of p if and only if u v u 2 v 2 up 1 vp 1 6 m q but u v p up vp m q that is if and only if om q u v p hence q fails to satisfy the unique p root property if and only if p om q f 3 f 3 therefore for our purpose it suffices to see that there is no algorithm which on input a presentationq on three generators decides whether q satisfies the p root property or not it is already known that such an algorithm does not exist if we enlarge the set of inputs to all finite presentations see next proposition we revisit one of the classical proofs for this fact in order to add an easy observation at the end implying the desired undecidability even when restricted to presentations with three generators this concludes the proof proposition 5 2 adian rabin for every fixed prime p there is no algorithm which takes as an input a finite presentation with three generators q a b c r 1 rm and decides whether q satisfies the p root property or not proof the proof is a slight variation of the argument given by miller in 20 pag 13 which was itself a variation of gordon s proof for the original adian rabin s theorem about non computability of markov properties we remind the context briefly describe miller s argument and then add our contribution at the very last paragraph an abstract property m for finitely presented groups is said to be markov if there exist finitely presented groups g and g such that g satisfies m and every group g admitting an embedding g g does not satisfy m for example being finite is a markov property with g 1 and g z whereas being infinite is not the classical adian rabin s theorem states that markov properties m are not computably recognizable i e there is no algorithm which on input a finite presentation decides whether the presented group satisfies the property m or not next we will focus on the unique p root property clearly it is a markov property take for example g z and g z pz so by adian rabin s theorem there is no algorithm to decide whether a given finite presentation has unique p roots we state below a small observation showing that such an algorithm does not exist either even restricting the input to finite presentations with exactly 3 generators the classical proof goes as follows the so called main technical lemma see 20 lem ma 6 13 takes a finite presentation of a group k and a word w on its generators and it explicitly constructs a new finite presentation of a group lw with just two generators and the following properties i if w 6 k 1 then k embeds in lw ii if w k 1 then lw is the trivial group now let m be a markov property with corresponding witnesses g and g and let u be a finitely presented group with unsolvable word problem if we apply the main technical lemma to k u g and to a word w in the generators of u 6 k then the finitely presented group lw g satisfies the following if w k 1 then lw 1 and hence lw g g satisfies property m otherwise if w 6 k 1 g u g k lw lw g and hence lw g does not satisfy property m that is lw g satisfies m if and 17 only if w k 1 therefore there exists no algorithm that on input a finite presentation recognizes whether the presented group satisfies m or not since such an algorithm would decide the word problem in u as well observe that particularizing the above argument to the markov property of having unique p roots the group lw in the construction above has two generators and g z has one generator so the group lw g is 3 generated hence the unsolvability of the word problem for u implies also the unrecognizability of the unique p root property even when restricted to 3 generated presentations as inputs proposition 5 3 for n 2 the group fn fn does not have subgroup bounded spectra more precisely for every n 2 there exists a finitely generated subgroup h 6 fn fn such that oh fn fn n proof let k be the free product of finite cyclic groups of all finite orders k n ncn then k is a computably presented group and so by higman embedding theorem k can be embedded into a finitely presented group g it follows that g is a finitely presented group containing elements of any possible order but not a torsion group suppose g is generated by m elements and consider the mikhailova subgroup m g in fm fm as in the proof of proposition 5 1 then it follows that om g fm fm n namely for a word u in fm representing an element of order k 1 in g respectively of infinite order the element u 1 of fm fm contributes k respectively 0 to om g fm fm since fm fm embeds purely into fn fn for every n 2 the claim follows 6 free groups let f fn fx denote the free group with basis x x 1 xn where n 2 in this section we provide an algorithmic description of the set f k hu of f elements of order k in the coset hu for k 0 and h a finitely generated subgroup of f as a consequence we obtain an algorithmic description of k h and the computability of the order problem op f the spectrum membership problem smp f and the finite spectrum problem fsp f within free groups finally we prove the computability of partial pure closures within this family note that the set of k roots of h k h is the set of solutions of the equation xk y subject to the rational constraint y h therefore it can be theoretically described using general approaches see the original paper by razborov 22 and the version with rational constraints in 14 however we aim to obtain a more synthetic and intuitive description for that purpose we will use the well known stallings interpretation of subgroups as automata see 15 30 which we briefly summarize below 6 1 automata and subgroups of free groups recall that a directed graph a digraph for short is a tuple v e where v and e are disjoint sets called the set of vertices of and the set of arcs of respectively and e v are maps assigning to each arc in its initial and terminal vertex respectively a walk in a digraph is a finite alternating sequence p 0 e 1 p 1 elpl of successively incident vertices and arcs i e such that ei pi 1 and ei pi for i 1 l then p 0 and pl are called the initial and final vertices of we say that is a walk from p 0 to pl a 18 p 0 pl walk for short and we write p 0 pl we write p q if there exists a walk from p to q if the first and last vertices of coincide then we say that is a closed walk a closed walk from p to p is called a p walk the length of a walk is the number of arcs in the sequence counting possible repetitions namely l the walks of length 0 are called trivial walks and correspond precisely to the vertices in definition 6 1 an x labelled directed graph an x digraph for short is a pair where v e is a digraph and e x is a map assigning to every arc in a label from some set x called alphabet whose elements are called symbols or letters if e is an arc from p to q with label e x then we write p x q and we say that e is an x arc of an x labelling on arcs extends naturally to an x labelling on walks by concatenating the corresponding arc labels i e if p 0 e 1 p 1 elpl is a walk on an x digraph then e 1 el x and the label of any trivial walk is the empty word then we write p 0 w pl where w definition 6 2 let be an x digraph and let p q be subsets of vertices in then the set of words read by walks from vertices in p to vertices in q is called the language from p to q in and is denoted by lpq for simplicity if p q v then the languages from p to q and from p to p are denoted by lpq and lp respectively definition 6 3 an x automaton is a tern pq p q where is an x digraph and p and q are distinguished nonempty sets of vertices of called the sets of initial and terminal vertices of pq respectively a walk in pq is said to be successful if it starts at a vertex in p and ends at a vertex in q similarly a word w x is said to be successful in pq if it is the label of some successful walk the language recognized by pq is l pq lpq i e the set of successful words in pq if an automaton pq has a unique initial vertex this vertex is called the basepoint of usually denoted by i e p an automaton pq is said to be pointed if it has a unique common initial and terminal vertex i e if p q in this case we write pq or even if the basepoint is clear definition 6 4 an x automaton is said to be saturated or complete if for every vertex p in and every letter x x there is an x arc leaving p definition 6 5 an x automaton is called deterministic if no two different arcs with the same label leave the same vertex that is if for every vertex p and every pair of arcs e e leaving p e e implies e e if is deterministic then for every vertex p in and every word w x there is at most one walk in reading w from p we denote by pw its final vertex in case it exists otherwise pw is undefined note that if is also saturated then pw is defined for every vertex p and every word w recall that for an alphabet x we write x 1 x 1 x x the set of formal inverses of x and x xtx 1 the involutive closure of x understanding x 1 1 x an alphabet x is said to be involutive if x x definition 6 6 an involutive x automaton is an x automaton with a labelled involution e e 1 on its arcs i e to every arc e p x q we associate a unique arc e 1 p x 1 q 19 called the inverse of e such that e 1 1 e that is in an involutive automaton arcs appear by mutually inverse pairs remark 6 7 we usually represent involutive x automata through their positive i e x labelled part with the convention that and arc p x q reads the inverse label x 1 when crossed backwards i e from q to p if we ignore the labelling and identify all the mutually inverse pairs in an involutive automaton we obtain an undirected graph called the underlying graph of involutive automata inherit terminology from its underlying graph for example the diameter of is defined to be the diameter of its underlying graph and we say that an involutive automaton is connected a tree etc if its underlying graph is so similarly the degree of a vertex in an involutive digraph refers to its degree i e the number of edges incident to it in the underlying undirected graph a walk in an involutive automaton is said to present backtracking if it has two successively inverse labelled arcs a walk without backtracking is said to be reduced if is a pointed and involutive x automaton then it is easy to see that l the free reduction of the language recognized by describes a subgroup of the free group f x we call it the subgroup recognized by and we denote it by that is l 6 fn it is well known that every subgroup of fn admits such a description which can be made unique after adding natural conditions on the involved automata the following lemma is straightforward to prove and will be important for us lemma 6 8 let be an involutive and deterministic x digraph let p q be two vertices of and let u be the label of a walk from p to q then pu q lpq p u u q and q p u definition 6 9 if a graph or automaton can be obtained by identifying a vertex p of a tree t with a vertex of some graph disjoint with t then we say that t is a hanging tree of and that is obtained from after removing the hanging tree t definition 6 10 an involutive automaton is said to be core if every vertex in appears in some reduced successful walk the core of an involutive automaton denoted by core is the maximal core subautomaton of containing all the initial and terminal vertices of note that an involutive automaton is core if and only if it is connected and all its hanging trees contain a terminal vertex different from the identified one the core of a pointed involutive automaton denoted by core is the pointed and involutive automaton obtained after taking the connected component of containing the basepoint and removing from it all the possible non trivial hanging trees not containing the basepoint and also all those containing the basepoint as the identified vertex it is clear that core finally a pointed and involutive automaton is called reduced if it is both deterministic and core as suggested by the previous characterization core can still have some hanging trees but mandatorily containing terminal points at all their leaves i e vertices of degree one definition 6 11 the restricted core of an automaton denoted by core is the labelled digraph obtained after ignoring all the initial an terminal vertices and removing all the hanging trees from it is clear that core core 20 if not stated otherwise from now on the automata appearing in this section will be involutive and deterministic we will refer to them simply as automata more precisely schreier and stallings automata defined below will have special prominence throughout the article definition 6 12 let f be a free group with basis x the right schreier automaton of h w r t x denoted by sch h x is the automaton having h f the set of right cosets of f modulo h as vertex set an arc hw x hwx for every coset hw h f and every element x x 1 and the coset h as the only initial and terminal point at some point of the discussion we shall consider a variation of the schreier automaton with h as initial vertex and any of the vertices say hu as the only terminal one we denote it by sch hu h x note that sch h h x sch h x note also that schreier automata are involutive deterministic connected and saturated but not necessarily core the core of sch h x is a reduced involutive and pointed x automaton called the stallings automaton of h w r t x and denoted by st h s that is st h x core sch h x note that sch h x st h x h and that all vertices in st h x have degree bigger than one except maybe the basepoint similarly the core of sch hu h x is denoted by st hu x we have sch hu h x st hu x hu and all vertices in st hu x have degree bigger than one except maybe the basepoint or hu finally the restricted core of st h x is called the restricted stallings automaton of h w r t x and denoted by st h x core st h x core sch h x if the chosen basis x is clear from the context we usually drop the reference to it and just write sch h st h st h etc in the seminal paper 30 j r stallings proved that if we restrict to deterministic and core automata then the description of subgroups of f by automata is essentially unique theorem 6 13 j r stallings 30 1983 let f be a free group with basis x then st subgroups of f isomorphic classes of reduced x automata h 7 st h x core sch h x 12 is a bijection furthermore finitely generated subgroups correspond precisely to finite automata and in this case the bijection is algorithmic the bijection 12 being algorithmic means that there is an algorithm which given a finite family of words w f produces st w x and conversely given a finite reduced x automaton it computes a free basis for roughly speaking the first algorithm consists of drawing the flower automaton with a basepoint and a petal spelling each w w and then folding and the second one consists on choosing a spanning tree t in and computing the free basis of given by t e t e e r et where p t q denotes the unique reduced walk from p to q using only arcs in t and e denotes the set of arcs in labelled by elements in x see 15 18 30 for details and proofs the interpretation of subgroups as automata and their computability in the finitely generated case given by theorem 6 13 has proved to be extremely fruitful and has become one of the main tools for studying finitely generated subgroups of a free group see for example 11 15 21 16 18 21 23 28 30 31 for example it follows from the definitions that the membership problem for free groups mp f is decidable by just checking whether the freely reduced form of the candidate element is the label of some walk in the finite automaton st h x it is also easy to see that a finitely generated subgroup h 6 f has finite index if and only if st h x is saturated and hence the finite index problem fip f is computable other more elaborated applications include the study of algebraic extensions see 18 and of intersections in this last case the key fact is that the stallings automaton of the intersection of two subgroups of f is essentially the tensor or categorical product of the stallings automata of the intersecting subgroups see example 6 36 below from this fact one can immediately derive the howson property for free groups the intersection of any two finitely generated subgroups of f is again finitely generated recall that we have defined different variations of stallings automata if h denotes the standard stallings automaton of a subgroup h 6 f and u f then we denote by h and hu the restricted and coset versions respectively example 6 14 let h ba 3 b 1 bab 1 ab 1 6 f a b then st h a b b a st h a b st hbab a b b a remark 6 15 it follows from the definitions that a subgroup h 6 f is finitely generated if and only if any of the automata st h st h and st hu for all u f are finite in this case all of them are clearly computable 6 2 relative spectra in free groups in the present subsection we use stallings description to study spectra of subgroups and cosets of free groups and related questions below we consider some geometric counterparts of the algebraic notions introduced in section 2 definition 6 16 let be an automaton an open trail in is a finite or infinite sequence p pi i 0 of pairwise different vertices in more formally an open trail is an injective map p i v i 7 pi from an initial subsequence i of n to the set of vertices of if an open trail is finite e g p p 0 p 1 pk we define the closure of p denoted by p as the sequence obtained after appending the initial vertex at the end of p i e p p 0 p 1 pk p 0 now injective except for the first and last positions closures of finite open trails are called closed trails if we want to highlight the first vertex p 0 in a trail p we say that p is a p 0 trail and if p p 0 pk is a finite trail then we say that p is a trail from p 0 to pk or a p 0 pk trail for short sometimes we abuse language and identify a trail p with their image for example we may write p v or given a vertex q we write q p resp q p to express that q appears resp does not appear as an element in p definition 6 17 the length of a open or closed trail p denoted by p is the cardinal of its domain minus one i e p i 1 a trail is said to be finite or infinite accordingly 22 the following are examples of trails which will play a central role in our arguments note that if is a deterministic and complete x automaton then the sequence pwi i n is well defined for every vertex p in and every word w fx moreover in case of having repeated vertices the first repeated vertex in pwi i n must be the initial vertex p definition 6 18 let be a deterministic and complete x automaton let p be a vertex in and let w f the full p orbit of w in denoted by orb p w is either the full sequence pwi i n if it has no repeated vertices or the closure of the largest initial subsequence of pwi i 0 with no repeated vertices otherwise that is orb p w is the subsequence of pwi i n obtained after stopping at the first repeated vertex if any moreover if q is any vertex in orb p w different from p we define the orbit of w between p and q denoted by orb p q w to be the subsequence of orb p w starting at p and ending at q note that orbits of any kind are always trails and that for every i n we have pwi w pwi 1 basepoint orbits are simply called orbits and we write orb w orb w also for a subgroup h 6 fx we abuse language and write orbh instead of orbsch h x and even omit the reference to the subgroup or the automaton if it is clear from the context definition 6 19 let be a deterministic and complete x automaton and let p pi i i be a open or closed trail in then the set of elements in f readable between any pair of successive vertices in p is called the preorbit of p in and is denoted by f p or just f p h if h 6 f and sch h x that is f p h w f pi 1 w pi i ir 0 13 of course preorbits may be empty when they are not an algebraic description of them follows easily from lemma 6 8 lemma 6 20 let be a deterministic complete and connected x automaton and let p pi i i be a trail in then the preorbit of p in is either empty or a coset of the form f p h i ir 0 hw i 1 w 14 where h p 0 6 fx and w fx proof according to definition 6 19 an element w f belongs to the preorbit of a trail p if and only if w labels a walk between any two successive vertices in p that is using lemma 6 8 f p h i ir 0 lpi 1 pi i ir 0 pi 1 upi 1 pi 15 where up q f denotes an arbitrary element labelling a walk from p to q which always exists by connectedness of therefore the preorbit f p h is an intersection of certain cosets of subgroups of f it is well known that such an intersection is either empty or a coset of the intersection of the corresponding subgroups in this second case if w is any coset representative of the intersection 15 then pi p 0 wi for all i i and hence again by lemma 6 8 f p h i ir 0 p 0 wi 1 w i ir 0 p 0 wi 1 w 23 note that expression 14 is not computable in general since the subgroup h may not be finitely generated and the trail p may have infinite length below we recall two well known algorithmic properties of f to prove that these are the only obstructions for the computability of preorbits in the free group lemma 6 21 let h be a finitely generated subgroup of f and let p be a finite trail of length k 1 in sch h then the preorbit f p h is computable more precisely given a finite generating set for h and coset representatives u 0 uk for the vertices in p p 0 pk it is decidable whether f p h is empty or not and in the negative case i e when f p h hu 0 hu 0 w hu 0 w k 1 w 16 for some w f then we can compute both such an element w and a free basis for the intersection hu 0 hu 0 w hu 0 w k 1 proof applying lemma 6 20 to sch h we reach 15 where the intersection is now finite it has k terms and involves only a finite portion of sch h since pi h ui for every i 0 k the emptiness of the preorbit f p h and the quest for a witness w in case it exists is just an instance of the coset intersection problem cip f which is well known to be solvable see 15 and in the case this intersection is nonempty we have f p h hu 0 hu 0 w hu 0 w k 1 w where w is the already computed witness and a free basis for the intersection subgroup of finitely many finitely generated subgroups of f is well known to be computable using products of stallings automata see 15 lemma 6 22 let h 6 f and let u w f then ohu w 0 if and only if hu appears in the sequence wi i 1 and in this case ohu w orbh h hu w proof since sch h is deterministic and complete all the vertices wi i n are well defined now ohu w k 1 if and only if w wk 1 6 hu and wk hu i e if and only if orbh h hu w w wk in this case orbh h hu w k oh w and otherwise ohu w 0 which means that wi 6 hu for every i 1 that is the coset hu does not appear in the infinite sequence wi i 1 the particular case of subgroups i e when u h can be stated as follows corollary 6 23 let h 6 f and let w f then oh w 0 if and only if orbh w and in this case oh w orbh w from lemma 6 22 it is clear that preorders are nothing more than disjoint unions of certain preorbits corollary 6 24 let h 6 f u f and k 1 then the set of elements of order k in hu is f k hu p f p h 17 where the union goes over all the hu trails p of length k in sch h and for k 0 we have that f 0 hu p f p h where now the union goes over all the infinite and all the finite closed trails in sch h not containing the coset hu apart from the starting vertex 24 in general the union in equation 17 is infinite it is finite if and only if h has finite index in f with some preorbits f p h possibly empty a first obstacle for the computability of f k hu is that even when h 6 f is finitely generated and k 1 these unions may very well contain infinitely many non empty terms as seen in the following example example 6 25 let h a 2 b 6 f a b and let k 2 all the words wn b nabn n 0 have order 2 in h and they all determine different orbits orbh wn wn since the vertices and wn are at distance n 1 in sch h however we shall see that ifh is finitely generated and k 1 then the union in equation 17 can be reduced to a finite union making the set of elements of a given order k 1 computable see proposition 6 27 the key point here is to observe that if we restrict ourselves to cyclically reduced words then we can bound the orbits contributing non trivially in equation 17 to finitely many in the finitely generated case lemma 6 26 let h be a subgroup of f and let u f if a cyclically reduced word w f has order k 1 in hu then orbh h hu w st hu moreover in the particular case u h we further have orbh w orbh h hu w st h st h proof let p orb h hu w p 0 p 1 pk 1 pk where p 0 and pk hu and let i be the reduced walk from pi 1 to pi reading w for i 1 k since w is cyclically reduced wk is reduced and so the path 1 2 k is reduced as well i e there is no backtracking in any of the products i i 1 since visits each pi we deduce that pi st hu core sch hu h for i 0 k finally if u h then pk and hence both the trail p and the walk are closed this further implies that there is no backtracking in pk 1 w w p 1 either therefore st h and the second claimed result follows that is for w f or order k 1 in hu the vertices in the orbit p orbh h hu w p 0 p 1 pk 1 pk belong to st hu if w is cyclically reduced while in general they can go far out of st hu as example 6 25 illustrates the strategy to keep orbits under control even when w is not cyclically reduced is the following let w v 1 w v be the expression of w as a conjugate of its cyclic reduction w and define the new vertices qi piv 1 for i 1 k observe that now q q 0 q 1 qk 1 qk orbhv 1 h v 1 hv 1 uv 1 w and so by lemma 6 26 q st hv 1 uv 1 st hu moreover if hu h then q st hv 1 st h whereas the vertices in p may very well be out of st hu see figure 2 p 0 q 0 q 1 p 1 q 2 p 2 qk 1 pk 1 qk hu v w w w k 3 w v v v v figure 2 scheme of the orbits p and q for an element w v 1 w v f or order k 1 in hu with the vertices within st hu shaded in blue 25 proposition 6 27 let h be a finitely generated subgroup of f let u f and let k 1 then the set of f elements of order k in the coset hu is either empty or f k hu q f q h vqh v qhu 18 where the union goes over the finitely many length k trails q q 0 q 1 qk within st hu vq is the label of some walk from q 0 to and v q is the label of some walk from qk to hu proof consider a trail q q 0 q 1 qk as in equation 18 and let w f q h and v vqh v qhu then w labels a walk from qi 1 to qi for every i 1 k and v labels walks both from q 0 to and from qk to hu therefore for i 1 k 1 we have v 1 wi qi 6 qk hence v 1 wiv qiv 6 qkv hu and so v 1 wv i v 1 wiv 6 hu whereas v 1 wkv qkv hu and so v 1 wv k v 1 wkv hu hence ohu wv k proving the inclusion to the left for the opposite inclusion let w be an f element of order k in hu and consider the orbit p orbh h hu w p 0 p 1 pk 1 pk writing w v 1 w v and q q 0 q 1 qk 1 qk st hu as above see figure 2 we have w f q h q 0 v and qk v hu i e v vqh v qhu therefore w w v f q h vqh v qhu finishing the proof we state separately the subgroup case which we use later and admits a slightly simpler expression proposition 6 28 let h be a finitely generated subgroup of f and let k 1 then the set of f elements of order k in the subgroup h is either empty or f k h q f q h vq h 19 where the union goes over the finitely many closed length k trails q q 0 q 1 qk 1 qk q 0 within the restricted stallings automaton st h and vq is the label of any walk from q 0 to proof apply the previous proposition to the case u h we have hu and f k h is given by equation 18 where all the involved trails q are within st hu st h and are closed since q 0 v and qkv hu imply q 0 qk and hence q st h on the other hand v q can be taken equal to vq and so vqh v qhu vqh and f q h vqh v qhu f q h vq h this concludes the proof corollary 6 29 free groups have bounded coset and hence subgroup spectra and the corresponding bounds are computable in particular sbp f is computable more precisely if h is a finitely generated subgroup of a free group f and u f then ohu f is bounded by the finite number of vertices in st hu and oh f is bounded by the finite number of vertices in st h note that the final claim is just a slight improvement of the result by kapovich and myasnikov in 15 where the spectrum of the free group w r t a finitely generated subgroup h was bounded by the finite number of vertices in st h st h proof let h 6 fg f let w f and consider w v 1 w v its expression as a conjugate of its cyclic reduction w then it is clear that ohu w ohv 1 uv 1 w which is either 26 zero and so trivially less than or equal to v st hu or equals the length of the orbit q orb hv 1 hv 1 uv 1 w contained in st hv 1 uv 1 st hu by lemma 6 26 then ohu w ohv 1 uv 1 w q 6 v st h v 1 uv 1 6 v st hu 20 as claimed finally note that if u h i e if hu h then q is the closed orbit of a cyclically reduced word and hence by lemma 6 26 q st h so oh w 6 v st h from corollary 6 29 together with the computability of the membership problem mp f we obtain the computability of the order function within free groups theorem 6 30 there is an algorithm that on input a finitely generated subgroup h 6 f a coset hu and word w f outputs ohu w the order of w in hu in particular the order problem op f and hence the torsion problem tp f is computable also combining the computability of preorbits of finite trails lemma 6 21 with the finiteness of the union in equation 19 we obtain a precise algebraic description of the set of elements of a given order k 1 in a given finitely generated subgroup or coset of f together with its computability proposition 6 31 let h be a finitely generated subgroup of f let u f and let k 1 then the set of elements of f of order k in the coset hu is computable more precisely given u k and a finite set of generators for h we can algorithmically decide whether f k hu 6 and if so compute finitely many elements w 1 wt f of order k in hu and a free basis for h hu such that f k hu t i 1 h hwi hw 2 i hw k 1 i wi h hu 21 proof compute the finite coset stallings automaton st hu from corollary 6 29 we know that if k v then f k hu so we can assume k 6 v let us apply proposition 6 27 and with the notation used there for each of the finitely many length k trails q let us check whether f q h or vqh v qhu are empty or not with a solution to the coset intersection problem cip f see 15 decide whether vqh v qhu 6 and if so pick v vqh v qhu i e such that q 0 v and qk v hu on the other hand use lemma 6 21 to check the emptiness of f q h and to obtain a description of the form f p h hv 1 hv 1 w hv 1 wk 1 w 22 in case it is not empty if for every length k trail q in either f q h or vqh v qhu or both are empty then f k hu and we are done otherwise for each q with f q h 6 and vqh v qhu v h hu 6 we have f q h vqh v qhu hv 1 hv 1 w hv 1 wk 1 w v h hu h hv 1 wv hv 1 wk 1 v v 1 wv h hu putting together these say t trails we get the desired expression 27 note that in the subgroup case i e when u h equivalently hu h the expression 21 is valid as well with the conjugating subgroup being just h hu h for subgroups h the set of k roots is the disjoint union of the sets of elements of order d with d running over the finitely many divisors of k see 5 therefore we have a description of exactly the same type for k h which is also algorithmically computable when h is finitely generated note that k h 6 since it always contains the elements from h themselves corresponding to the closed length 1 trail q note also that for w f of order d k in h we have wd h and so h hw hw 2 hw d 1 h hw hw 2 hw k 1 allowing a more compact description for k h we restate it here for later reference corollary 6 32 let h be a finitely generated subgroup of f and let k 1 then the set of k roots of h is computable more precisely given k and a finite set of generators for h we can compute finitely many elements 1 w 0 w 1 wt f of order in h being a divisor of k such that k h t i 0 h hwi hw 2 i hw k 1 i wi h once we have a description for the set of elements of any order k 1 it is straightforward to decide whether there exist elements of order zero the remaining ones and to give an explicit description of them in the finite index case proposition 6 33 let h be a finitely generated subgroup of f and let u f then for u 6 h f 0 hu is always nonempty and for u h f 0 h 6 if and only if h has infinite index in f moreover in case u 6 h and h is of finite index in f we can compute finitely many elements 1 w 0 w 1 wt f of orders 1 k 0 k 1 kt 1 in h respectively such that f 0 hu t i 0 h hwi hw 2 i hw ki 1 i wi h 23 in particular the torsion group problem tgp f is computable proof clearly if u 6 h then h f 0 hu 6 in the case hu h the implication to the right is a well known general fact see corollary 2 16 and for the converse suppose that h is a finitely generated subgroup of infinite index in f fx i e with st h x being finite and unsaturated take a vertex hv st h x which is x deficient for some generator x x take a cyclically reduced word of the form w hvx for some h h and it is clear that wk 6 st h x for every k 1 therefore w f 0 h 6 let us assume now that u 6 h and that h is of finite index in f i e st hu st h st h is finite and saturated by corollary 6 24 and taking into account that there are no infinite trails in st h we have f 0 hu p f p h where the union goes over all the finite closed trails in st h not containing the coset hu finally applying lemma 6 21 to each such preorbit f p h we can disregard the empty ones and get the corresponding description for the nonempty ones putting them together we obtain 23 finally the computability of preorders together with the algorithmic boundability of the spectra corollary 6 29 provides through the analysis in section 3 the computability of the spectrum function h 7 oh f and related problems 28 theorem 6 34 there exists an algorithm which on input a finitely generated subgroup h 6 fg f and an element u f it outputs the finite spectrum ohu f in particular the finite spectrum problem fsp f and hence the spectrum membership problem smp f the torsion group problem tgp f and the purity problem pp f are computable for free groups we recall that the purity problem pp f was previously proved in 1 and 15 constituting one of the first results in this direction finally let us point out an easy asymptotic consequence of our results recall that a subset s f is called negligible if it has asymptotic density zero it is called visible if it is not negligible and it is called generic if its complement is negligible remark 6 35 let h be an infinite index subgroup of f since any coset of h is a negligible sub set of f and a finite union of negligible subsets is negligible we deduce from proposition 6 31 that the preorders f k hu are also negligible for k 1 moreover from proposition 6 33 f 0 h is the complement of a negligible set so it is generic in f for a finite index h 6 f and k 0 each f k hu is either empty or visible in f 6 3 computing pure closures within free groups let s n 1 be any set of strictly positive natural numbers in this section we study the s pure closure ps h of a subgroup h 6 fn more concretely we shall see that if h is finitely generated then so is ps h additionally if s is finite more generally computable one can effectively compute generators for ps h from given generators for h a first naive approximation to computing the s pure closure of a finitely generated subgroup h 6 f is to add to h all its proper s roots for each s s we can apply corollary 6 32 and get s h t i 0 h hwi hw 2 i hw s 1 i wi h 24 where 1 w 0 w 1 wt are certain computable elements from f depending on s note that even if s is infinite corollary 6 29 tells us that only a finite subset of s contributes significant roots s h sh h where sh s oh f s 0 vst h is finite therefore taking the union of expressions 24 for s sh we get a similar finite description for s h now by definition if h has no proper s roots then ps h h and we are done otherwise ps h must contain all the elements in 24 that is s h 6 ps h however this inclusion is not necessarily an equality because the attachment of s h to h may create new proper s roots to be attached in a second round as the following example shows example 6 36 consider f 2 f a b and the subgroup h a 2 ab 2 6 f 2 clearly a f 2 h and hence h is not 2 pure whereas b 6 f 2 h in fact oh b 0 since no element in h starts with b however after adding a to h we get h a a 2 ab 2 a a b 2 which is still not 2 pure because now o a b 2 b 2 we complete the example by seeing that f 2 h a 2 n 1 n z h i e the odd powers of a are the unique proper 2 roots of h up to conjugacy by h hence after adding to h all its proper 2 roots we reach the same subgroup a b 2 which still has b as a proper 2 root 29 to compute f 2 h let us follow the argument given in proposition 6 31 applied to the subgroup h a 2 ab 2 6 f 2 the stallings graph h st h a b st h a b is depicted in figure 3 0 1 2 a b figure 3 the stallings automaton h since v h 3 there are two closed trails of length 2 in h namely 1 and 2 and so f 2 h f 1 h tf 2 h h in order to compute the preorbits f 1 h and f 2 h we compute in figure 4 the pullback of h with itself h h and read the intersections from there 0 1 2 0 1 2 figure 4 the product h h with the non core parts dashed f 1 h l 1 h l 1 h l 0 1 1 0 h h a 2 n 1 n z f 2 h l 2 h l 2 h l 0 2 2 0 h h therefore f 2 h f 1 h tf 2 h h a 2 n 1 n z h as wanted as the above example shows attaching to h all its proper s roots is not enough to reach ps h because these attachments can create new proper s roots to be attached again repeating the process we get closer and closer to ps h in proposition 6 38 we will see that for h finitely generated this procedure always stabilizes in a finite number of steps the crucial concept to prove this stabilization is that of algebraic extension recall that an extension h 6 k 6 f is called algebraic denoted by h 6 alg k if h is not contained in any proper free factor of k it is not hard to see that any h 6 fg f has only finitely many algebraic extensions all of them finitely generated again see 15 18 lemma 6 37 let h be a finitely generated subgroup of f and let s n 1 then h is algebraic in s h which is again finitely generated 30 proof suppose s h a b and h 6 a then since free factors are pure we have that s h s a a hence s h a and b 1 therefore h 6 alg s h and in particular s h is finitely generated finite generation of s h can also be deduced from the above argument even if s is infinite sh s oh f is finite and s h sh h can be obtained from h by attaching the finitely many wi s from expressions 24 s sh proposition 6 38 let h be a finitely generated subgroup of f let s n 1 and for i 1 let hi 1 s hi with h 0 h then all these subgroups are finitely generated and the ascending sequence h h 0 6 h 1 6 h 2 6 stabilizes at ps h i e there exists j 0 such that hj hj 1 ps h proof it is immediate by induction and using lemma 6 37 that all the subgroups hi are finitely generated a soon as we have hj hj 1 s hj we deduce s hj hj that is hj is s pure and so hj ps h therefore it all comes down to prove that the sequence hi i 0 stabilizes after a finite number of steps and this follows immediately from lemma 6 37 from transitivity of algebraic extensions a 6 alg b 6 alg c implies a 6 alg c and from the fact that h has finitely many algebraic extensions see 15 18 corollary 6 39 let h 6 f and s n 1 if h is finitely generated then ps h 6 f is finitely generated as well if additionally s is computable then a free basis for ps h can be effectively computed from a finite set of generators for h proof the first claim follows immediately from lemma 6 37 and proposition 6 38 if additionally s is computable then we can list the elements in sh s 2 v h and effectively compute free bases for the subgroups in the ascending chain hi i 0 until it stabilizes which we will realize computationally by the fact s hj hj at this point we have hj ps h and we have just computed a free basis for ps h 7 free times free abelian groups the family of free times free abelian groups namely the groups of the form g fn zm x 1 xn t 1 tm titj tjti tixk xkti 25 has some remarkable properties e g it is not howson and has been the subject of several studies over the last few years see 5 10 12 13 24 26 in the present section we aim to study order and spectra on this family the main results in the section are the computability of the sets k h of k roots and g k h of elements of order k of a finitely generated subgroup h 6 g fn zm and that of the corresponding spectrum oh g which we will see that is always finite as has been customary with this kind of groups we shall refer to elements in g by their normal forms with vectors on the right and abbreviated as uta u ta 11 t am m where u u x 1 xn fn is called the free part of uta a a 1 am zm is called the abelian part of uta and where the meaningless symbol t allows us to use the standard additive notation in zm inserted in a multiplicative environment i e uta vtb uvta b we extend 31 this notation to subsets in the natural way for every u fn and every a zm we write uta uta u u a a we denote by and the morphisms given by the projections to the free and free abelian parts respectively i e g fn uta 7 u and g zm uta 7 a 7 1 subgroups of free times free abelian groups bases and completion note that free times free abelian groups g fn zm are defined by the splitting short exact sequence 26 which restricts to every subgroup h 6 g as follows 1 zm g fn 1 6 6 6 1 h zm h h h 1 26 27 since h is a free group the restricted short exact sequence 27 also splits and hence for any given section of h we have h h zm h 28 in particular the subgroups of g are again free times free abelian the subgroup h zm is called the basepoint subgroup of h and is usually denoted by lh h zm 6 zm see section 7 2 for the motivation for this name taking a basis for each of the factors in 28 we reach our notion of basis of a free times free abelian group definition 7 1 a basis of a subgroup h 6 g is a tuple of the form b u where b is a free abelian basis of lh u is a free basis of h and is a section of h note that we use the words free basis free abelian basis and just basis depending on whether we refer to the free free abelian or free times free abelian case respectively finally we introduce abelian completions a key concept in our analysis definition 7 2 let h be a subgroup of g let be a section of h and let w fn then the completion of w in h is undefined if w 6 h and ch w w zm otherwise and the full completion of w in h is ch w w h a z m wta h this is nothing else than a vector or the full set of vectors which complete w into an element of h it is straightforward to see that abelian completions in h are either empty or cosets of the basepoint subgroup lh of h lemma 7 3 let h be a subgroup of g and let w f then the completion of w in h is ch w if w h ch w lh if w h 29 where is any section of h remark 7 4 when restricted to h the completion maps ch h zm and ch h zm l are group homomorphisms in particular completions work modulo conjugation by h i e for everyw fn every v h and every section of h ch v 1 wv ch w and ch v 1 wv ch w 32 from 28 it is clear that a subgroup h 6 g is finitely generated if and only if h is finitely generated and in this case bases are finite and have the form u tb 1 tbr u 1 t c 1 ust cs 30 where b b 1 br is a free abelian basis of lh u u 1 us is a free basis of h and c 1 cs zm the u completions in h of the elements in u then we denote by b the r m integral matrix having the row vector bi zm as i th row i 1 r and we denote by c or c cu if we want to emphasize the associate section or basis the s m integral matrix having the row vector cj zm as j th row j 1 s the matrix b is called the basepoint matrix of h w r t u and the matrix cu is called the completion matrix of h w r t u it is not difficult to see that bases for finitely generated subgroups of g fn zm are computable from a given finite set of generators see 13 for an algorithmic friendly geomet ric description of the subgroups of fn zm in the spirit of stallings briefly surveyed in section 7 2 consequently we shall usually assume that the finitely generated subgroups of g appearing in the discussion are given by some basis lemma 7 5 let u tb 1 tbr u 1 tc 1 ustcs be a basis of a finitely generated subgroup h of g and let w h be a word in the original generators of fn then ch u w w u scu and hence ch w w u scu b 31 where u h fs is the isomorphism sending every w h to its representation in base u s fs zs is the abelianization map cu is the completion matrix of h w r t u and b denotes the row space of the basepoint matrix of h w r t u notation 7 6 if the ambient free group say fs is clear from the context and u fs then we usually write u in boldface the abelianization of u i e u u s zs hence we can lighten notation in 31 and just write ch w u c b 32 where u u 1 us w u is the expression of w h as a word in the free basis u and u u s zs is its abelianization 7 2 enriched automata in 13 the first two authors extended the classical stallings theory to direct products of free and abelian groups after introducing enriched automata see section 6 1 as it happens with their free counterparts enriched automata constitute a convenient geometric representation of subgroups of fn zm in this case and provide a neat understanding of some of their properties these properties include the behavior of intersections of finitely generated subgroups which can be not finitely generated and index among others but here we shall only focus on their first natural application namely subgroup recognition we summarize the key points below see 13 for a complete description definition 7 7 a zm enriched x automaton enriched automaton for short is an involutive zm x zm automaton with a subgroup of zm attached to the basepoint 33 ignoring all the abelian information i e the basepoint subgroup and all the abelian labels from a zm enriched x automaton we get a standard x automaton denoted sk and called the skeleton of we usually use tildes to distinguish between enriched automata and standard automata in the same vein as for standard x automata we usually represent enriched automata by a positive x automata with extra zm labels at the beginning and at the end of each arc and we use the convention that an enriched arc e p a x b q reads e t axtb xtb a g when crossed forward from p to q and e 1 t bx 1 ta x 1 ta b xtb a 1 g when crossed backwards from q to p accordingly the enriched label of a non trivial walk e 11 e k k in an enriched automaton is e 1 1 ek k note that the label of as a walk in the skeleton is precisely the free part of the enriched label an element in fn zm is said to be recognized by the enriched automaton if it is of the form wta l where wta is the label of some nontrivial walk in and l lh one may think of lh as labelling infinitesimal walks formally invisible in because their free labelling is trivial it is straightforward to see that the set of all the elements recognized by an enriched automaton is a subgroup of fn zm it is called the subgroup recognized by and denoted by it is also easy to see that every subgroup in fn zm is recognized by some enriched automata however this representation of subgroups by automata is as it happens in the free setting far from unique in 13 the first two authors develop an enriched version of stallings automata that makes this representation bijective and also constructive when restricted to the finitely generated case see 13 theorem 2 7 moreover enriched stallings automata not only establishes a one to one connection with subgroups of g but also encode their structure in a very transparent way proposition 7 8 let be an enriched stallings automaton recognizing h 6 g then the skeleton of recognizes h whereas the basepoint subgroup of is lh h zm corollary 7 9 if is an enriched stallings automaton recgnizing h 6 g and wta h then there exists a walk in such that wta tlh 7 3 order and spectrum within free times free abelian groups we aim to take advantage of our results for free groups see section 6 together with our geometric understanding of subgroups of free times free abelian groups see section 7 2 to study order and spectra in the latter family in this section we obtain computable expressions for the sets k h of k roots and g k h of elements of order k of a finitely generated subgroup h 6 g fn zm and we derive the finiteness of the corresponding spectrum as it happens with some other problems the solutions for order and spectrum problems within fn zm are quite more intricate than the mere juxtaposition of the behavior of these problems in the factors we start with a standard argument solving these problems in the free abelian case recall that given a finite subset of zm we can use linear algebra to compute a free abelian basis say b 1 br of course with r 6 m of the subgroup l it generates and solve membership on it then if we call b the r m integral matrix whose rows are the linearly independent 34 vectors b 1 br zm we can compute invertible matrices p glr z and q glm z and unique nonzero positive integers d 1 dr such that pbq diag d 1 dr the r mmatrix s diag d 1 dr is called the smith normal form snf of b and the integers d 1 dr are called the elementary divisors of l b note that l b pb sq 1 d 1 q 1 drqr 6 fi q 1 qr 6 q 1 zm where q 1 qm are the rows of q 1 hence l q 1 qr is the smallest direct summand of zm containing l and zm l l l zm r z d 1 z z drz zm r 33 from this expression it is easy to derive an explicit description of the zm elements of a given order in l proposition 7 10 let l be a subgroup of zm of rank r 6 m and let d 1 d 2 dr be its elementary divisors then zm 0 l zm r l and for every k 1 zm k l if k dr zm l k 6 if k dr 34 where zm l k is the nonempty and computable set of elements namely cosets modulo l of order k in the finite abelian group l l z d 1 z z drz in particular smp zm is computable proof let b 1 br be a free abelian basis for l and let b p q and s be as above by 33 an element a zm has order zero in l if and only if a l i e zm 0 l zm r l moreover we claim that ol zm r 0 ol l div dr since ol qr dr the inclusions ol z m r 0 ol l div dr are clear conversely given q zm write q m i 1 iqi and note that ol q 6 0 if and only if r 1 m 0 furthermore in this case drq dr r i 1 iqi r i 1 i dr di diqi l and hence ol q dr the result follows corollary 7 11 let l be a subgroup of zm of rank r 6 m and let dr be the largest elementary divisor of l then the spectrum of zm w r t l is ol z m div dr if r m i e if zm l div dr 0 if r m i e if zm l and hence computable in particular fsp zm is computable corollary 7 12 free abelian groups have subgroup bounded spectra furthermore the spectrum membership problem smp zm and the order problem op zm are computable as well we introduce the following notation for later use notation 7 13 given a subset s zm and a positive integer k 1 we denote by 1 k s the set of k roots of s in zm namely 1 k s 1 k s kzm zm this is nothing else than k s but expressed in additive notation observe that in general 1 k s may be empty whereas if l 6 zm is a subgroup then 1 k l is again a subgroup containing l that is l 6 1 k l 6 zm moreover if s a l is a coset of a subgroup l 6 zm then 1 k s is either empty or a coset of 1 k l kzm 35 obviously the computability of preorders proposition 7 10 immediately produces the computability of roots which in this abelian context are indeed subgroups of zm corollary 7 14 for every l 6 zm and every k 1 one can compute an abelian basis for 1 k l we start the study within free times free abelian groups by analyzing when a group g fn zm has elements of order zero w r t a finitely generated subgroup h 6 fg g lemma 7 15 for every finitely generated subgroup h 6 fg g fn zm 0 oh g if and only if g h therefore tgp fn zm is computable proof the implication to the right is true in general for the converse note first that it is al ready known to be true for subgroups of both fn and zm see respectively proposition 6 33 and corollary 7 11 and let us assume that h is a finitely generated subgroup of g of infinite index then from 13 proposition 4 1 we know that either zm lh or fn h hence either 0 olh z m or 0 oh fn in the first case there exists a zm such that ka lh h zm and so ta k tka h for every k 1 hence 0 oh g in the second case there exists u fn such that uk 6 h and so uk 6 h for all k 1 hence 0 oh g as well since the finite index problem is solvable for free times free abelian groups see 13 proposition 4 2 the computability of tgp fn zm is immediate from the previous claim in free times free abelian groups it is more convenient to start studying the sets of k roots to then refining the arguments and getting a description for sets of elements of a given order k and the corresponding spectra let h be a subgroup of g fn zm and let k 1 then k h uta g uta k h uta g uktka h uta g uk h and ka ch uk kzm uta g u k h and a 1 k ch u k 35 where 1 k ch u k 1 k ch u k kzm and ch uk kzm is either empty or a coset of lh kzm so the set of k roots of h can be described in terms of k roots of subgroups or cosets in the factors however if ch uk kzm then the element u h does not contribute to k h the following lemma allows us to tighten the description 35 by cleaning off these negligible elements let h 6 fg g let u be a basis for h and let h fs be the isomorphism sending each element in h to its representation in base u now compose with the abelianization map s fs zs and then with right multiplication by the completion matrix c of h w r t u it is clear that lh kzm is a normal subgroup of finite index at most km in zm and hence its preimage mk lh kzm c s is a normal subgroup of finite index at most km in h see figure 5 36 h fs z s zm p p p p mk l k h c s l k h c s l k h c l k h lh kz m s c figure 5 the construction of mk pfi h lemma 7 16 for v fn ch v kzm 6 if and only if v mk proof from lemma 7 5 if v h then ch v is empty and we are done otherwise ch v v sc lh intersects kzm if and only if v sc lh kz i e if and only if v lh kzm c s mk as claimed in summary an element v fn admits an abelian completion in h 6 fg g if and only if v h and it admits an abelian completion in h which is a multiple of k if and only if v mk pfi fn in this last case ch v kzm is a coset of lh kzm and we write 1 k ch v 1 k ch v kzm a coset of 1 klh 1 k lh kzm for which a representative is easily computable lemma 7 16 allows us to clean off equation 35 to k h uta g u k mk and a 1 kch u k 36 where now none of the contributions is negligible now let us take advantage of the algorithmic description of k mk corollary 6 32 together with our geometric understanding of the subgroups of g section 7 2 to obtain a description of the set k h of k roots of a finitely generated subgroup h 6 fg fn zm clearly we can compute a free basis for mk and by corollary 6 32 we know that k mk w mk mkw mkw k 1 w mk 37 where the union runs over a finite set of computable k roots w of mk hence for each of these coset representatives w we have that wk mk and so there exists a computable and not necessarily unique vector aw zm such that wtaw k wktkaw h i e such that wtaw k h similarly for every v mk mkw mkw k 1 and every j 0 k 1 we have vw j mk and so there exist a computable and non necessarily unique vector bv j zm such that vtkbv j hw j moreover these vectors bv j can be chosen linearly compute a finite free basis v v 1 vq for mk mkw mkw k 1 and respective vectors bvi j z m such that vit kbvi j hw j then for v mk take bv j vbj where v vab is the abelianization of v w r t v and bj is the q m integral matrix having bvi j as i th row indeed vtkbv j v v 1 vq t kvbj v v 1 t kbv 1 j vqt kbvq j hw j note that conjugates of mk by different powers of w may coincide mk wj 1 mk wj 2 when this happens we take bvi j 1 bvi j 2 bj 1 bj 2 and so bv j 1 bv j 2 for each v mk finally we define b j bj and bv j bv j vb z m 37 the following claim uses enriched stallings automata see section 7 2 to build around each of the already computed wtaw k h a whole family of new k roots of h lemma 7 17 for each wtaw and each v mk mkw mkw k 1 we have vw tbv aw k h proof let be a stallings automaton for h since wk mk 6 h we can read w as the free label of k successively adjacent walks j pj pj 1 j 0 k 1 in such that p 0 pk see figure 6 note that the sequence of vertices p 0 p 1 pk 1 is not necessarily a trail because there may be repetitions due to the fact that the order of w in mk is a maybe proper divisor of k and due to the fact that mk is a maybe proper subgroup of h and hence the stallings automaton of h is a maybe proper quotient of the stallings automaton of mk for every j 0 k 1 let wta j be the enriched label of j of course with possible repetitions according to those at the sequence of vertices p 0 p 1 pk 1 then it is clear that the product wta 0 wta k 1 wkt j a j labels a closed walk in and hence belongs to h since by hypothesis wktkaw h from lemma 7 3 we have that j a j kaw lh on the other hand v mk mkw mkw k 1 hence for every j 0 k 1 v can be read as the free label of a closed pj walk v j in let vtb v j hw j be the enriched label of v j again with possible repetitions according to those at the sequence of vertices p 0 p 1 pk 1 see figure 6 since by construction vtkbv j hw j we have that b v j kbv j lhwj lh therefore j b v j kbv j b v j kbv j lh as well p 0 p 1 p 2 p 3 p 4 pk 1 w a 0 w a 1 w a 2 w a 3 k times wa k 1 v b v 0 v b v 1 v b v 2 v b v 3 v b v 4 v b v k 1 figure 6 the walks j in blue and v j in red within now it is clear from figure 6 that v 0 0 v 1 1 v k 1 k 1 is a closed walk in and hence its label belongs to h that is vtb v 0 wta 0 vtb v 1 wta 1 vtb v k 1 wta k 1 vw k t j b v j j a j vw k tkbv kaw t j b v j kbv t j a j kaw h since both j b v j kbv and j a j kaw belong to lh 6 h we deduce that vw t bv aw k vw ktkbv kaw h as claimed 38 for later use we introduce the graphical counterparts of the matrices bj and b in the natural way b j is the integral q m matrix whose i th row is b vi j and b j b j recall that for every j 0 k 1 the label of the closed pj walk vi j is vit b vi j and so for every v v 1 vq mk mkw mkw k 1 the label of the closed pj walk v v 1 j vq j is v v 1 t b v 1 j vqt b vq j v v 1 vq t vb j therefore b v j vb j theorem 7 18 let h be a finitely generated subgroup of g fn zm and let k 1 then the set of k roots of h in g is k h wtaw s hwwt aw h 38 where s is a finite set of k roots of h and hw are finitely generated subgroups of g all of them computable from a given basis for h proof within the free group fn compute a free basis for mk and then finitely many k th roots of mk giving equation 37 following the procedure described above for each such w k mk compute a vector aw zm such that wtaw k h a free basis for v v 1 vq for mk mkw mkw k 1 and respective vectors bvi j z m such that vit kbvi j hw j finally take bvi j bvi j z m and consider the finitely generated subgroup hw v 1 t bv 1 vqt bvq t 1 k lh vtbv c v mk mkw mkw k 1 and c 1 k lh 6 fg g 39 40 note that by corollary 7 14 we can compute an abelian basis for 1 k lh and get a basis for hw with this data we claim that 38 holds in fact the inclusion to the left follows eas ily from lemma 7 17 and the general form of the elements in hw vtbv cwtaw k vwtbv aw k tkc h for the other inclusion consider an arbitrary element utc k h then uktkc h and so uk mk u k mk and hence from equation 37 u vw v for some coset representative w some v mk mkw mkw k 1 and some v mk but by lemma 7 17 vw k tkbv kaw h and conjugating by v mk 6 h we get uk tkbv kaw vw k v tkbv kaw hv h therefore kc kbv kaw lh and so l c bv aw 1 k lh thus utc u tbv aw tc bv aw vw v tbv aw tl vtbv lwtaw v hwwtaw h finally the union under consideration is disjoint because projecting hwwtaw to the free part we get precisely mk mkw mkw k 1 w see equation 37 remark 7 19 observe that the description in equation 38 for the free times free abelian context is parallel to that of corollary 6 32 in both cases the set of k th roots of h resp h is a finite union of computable cosets conjugated by h resp h however the corresponding subgroups are intersections of conjugates of h in the free case concretely h hw hw 2 hw k 1 while they have a slightly more complicated form although still computable in the free times free abelian case namely hw 39 remark 7 20 in the special case where h 1 i e when h lh 6 zm we have mk 1 k mk 1 and equation 37 consists of just a single trivial coset namely w 1 and 1 1 w 1 further wtaw 1 t 0 hw 1 klh and equation 38 consists on just a single coset as well k h 1 k lh 1 t 0 h 1 k lh this agrees with the general fact k h zm k lh as we know the set of k roots k h consists precisely of the elements in g whose orders in h are divisors of k including the elements of order 1 which are the elements in h themselves let us now refine the description from theorem 7 18 by breaking each coset hwwtaw there into a finite disjoint union of computable cosets of a certain subgroup of finite index in hw in such a way that the order function becomes constant over each of these new smaller cosets theorem 7 21 let h be a finitely generated subgroup of g fn zm then the set of elements of g of any given nonzero order in h is computable more precisely given a finite set of generators for h and an integer k 1 we can algorithmically decide whether g k h 6 and if so the set of elements of g of order k in h is g k h ztaz s h z zt az h 41 where s is a finite set of elements of order k in h and h z are finitely generated subgroups of g all of them computable from a given basis for h proof from description 38 for k h fix one of the finitely many cosets say hwwtaw and consider the part of a stallings automaton for h corresponding to it see figure 6 recall that the vectors a j and b v j in that picture are related to aw and bv j respectively through the equations kaw k 1 j 0 a j lh and kbv j b v j lh and therefore v kb b kvb k 1 j 0 vb j kbv k 1 j 0 b v j lh 42 note that the elements in the coset hwwtaw may have different orders in h but the order in h of such an element vtbv cwtaw is always a divisor of k and a multiple of r 0 oh vw which is independent from v mk mkw mkw k 1 indeed r 0 is the minimum index j 0 such that pj in figure 6 now fix an element vtbv cwtaw hwwtaw let r n be such that r 0 r k and let k rs by construction pr and therefore the sequences of vectors b v 0 b v k 1 and a 0 a k 1 repeat in s blocs of r i e b v 0 b v k 1 b v 0 b v r 1 b v 0 b v r 1 s b v 0 b v r 1 a 0 a k 1 a 0 a r 1 a 0 a r 1 s a 0 a r 1 hence from equation 42 rsbv s r 1 j 0 b v j kbv k 1 j 0 b v j lh and so rbv r 1 j 0 b v j 1 s kbv k 1 j 0 b v j 1 s lh similarly kaw k 1 j 0 a j rsaw s r 1 j 0 a j lh and so raw r 1 j 0 a j 1 s kaw k 1 j 0 a j 1 s lh furthermore observe that vtbv cwtaw r vw r trbv raw rc vw r t r 1 j 0 b v j r 1 j 0 a j trbv r 1 j 0 b v j t raw r 1 j 0 a j trc 40 where the element vw r t r 1 j 0 b v j r 1 j 0 a j between the last pair of parentheses belongs to h since it labels closed walk at in hence vtbv cwtaw r h 1 s kbv k 1 j 0 b v j kaw k 1 j 0 a j kc lh this means that the order of vtbv cwtaw in h is min r n r 0 r k and v kb b kaw k 1 j 0 a j kc k r lh 43 recall that the vector kaw k 1 j 0 a j is fixed and consider the group homomorphism hw lh klh v tbv c 7 v kb b kc klh which is onto since c moves along 1 k lh since lh klh is a finite abelian group h w ker is a finite index subgroup of hw in fact of index p krk lh for which we can easily compute a finite basis then computing a preimage for each element in lh klh say u 1 t bu 1 c 1 upt bup cp hw we obtain the decomposition hw p i 1 h w uit bui ci therefore hwwt aw p i 1 h w uit bui ci wtaw p i 1 h w uiw t bui aw ci 44 finally we claim that the order function with respect to h is constant over each of these smaller cosets indeed according to equation 43 for every vtbv c h w the order of vtbv c uiw t bui aw ci vuiw t bv bui aw c ci is the smallest integer r 0 such that r 0 r k and v ui kb b kaw k 1 j 0 a j k c ci slh 45 but v kb b kc klh 6 slh since vtbv c h w ker therefore equation 45 holds if and only if ui kb b kaw k 1 j 0 a j kci slh which is to say that oh v tbv c uiwt bui aw ci oh uiwt bui aw ci this proves the claim finally collecting together all the cosets if any containing elements of order k and resetting the notation we obtain the claimed result corollary 7 22 free times free abelian groups g fn zm have subgroup bounded spectra and the corresponding bounds are computable in particular sbp g is computable more precisely if h is a finitely generated subgroup of g then oh g oh f olh z m in particular oh g is bounded above by vst h d where d is the largest elementary divisor of lh h zm 6 zm proof first note that 0 oh g g h f h or zm lh 0 oh f or 0 olh z m 41 where we have used lemma 7 15 proposition 4 1 in 13 proposition 6 33 and corollary 7 11 successively hence it is clear that if 0 oh g then 0 oh f olh z m so it only remains to prove that the inclusion holds for strictly positive orders i e that o h g o h f o lh zm this is obvious if h is pure otherwise let k o h g this means that some element uta g satisfies uta uta k 1 6 h but uta k h then uk h and so k is a multiple of r oh u say k rs but now ur h and so urtb h for some vector b zm by construction urtra urtra 2 urtra s 1 6 h whereas urtra s uktka h and this implies that the vector ra b zm satisfies ra b 2 ra b s 1 ra b lh whereas s ra b ka sb lh therefore olh ra b s and hence s olh z m the claimed result follows finally the upper bound follows from corollary 6 29 and corollary 7 11 since the membership problem is decidable for free times free abelian groups e g using enriched stallings automata the computability of op smp and fsp follows from the previous results and the discussion in section 3 theorem 7 23 let g fn zm be a free times free abelian group then the order problem op g is computable i e there exists an algorithm which on input a finitely generated subgroup h 6 fg g and an element uta g outputs the order oh uta of uta in h theorem 7 24 let g fn zm be a free times free abelian group then the spectrum membership problem smp g is computable i e there exists an algorithm which on input a finitely generated subgroup h 6 fg g and an integer k n decides whether k belongs to the spectrum oh g of g w r t h theorem 7 25 let g fn zm be a free times free abelian group then there exists an algorithm which on input a finitely generated subgroup h of g outputs the finite spectrum oh f in particular the finite spectrum problem fsp g is computable 7 4 computing pure closures within fn zm we now show that the results concerning pure s closures in a free group can be easily generalized to free times free abelian groups lemma 7 26 works eactly like lemma 6 37 and proposition 7 27 just puts into play the noetherianity of zm lemma 7 26 let h be a finitely generated subgroup of fn zm and let s n 1 then h is algebraic in s h which is again finitely generated proposition 7 27 let h be a finitely generated subgroup of fn zm let s n 1 and for i 0 let hi 1 s hi with h 0 h then all these subgroups are finitely generated and the ascending sequence h h 0 6 h 1 6 h 2 6 stabilizes at ps h i e there exists j 0 such that hj hj 1 ps h proof exactly like in the proof of proposition 6 38 the subgroups hi are finitely generated and the sequence h h 0 6 h 1 6 h 2 6 stabilizes i e there exists j 1 0 such that hj 1 hj 1 1 42 on the other hand zm is a noetherian group and so the ascending sequence lh lh 0 6 lh 1 6 lh 2 6 stabilizes as well there exists j 2 0 such that lhj 2 lhj 2 1 take j max j 1 j 2 and it is straightforward to see that hj hj 1 ps h finally an argument analogous to that in corollary 6 39 provides the computability of the pure closure in the free times free abelian case corollary 7 28 let h 6 fn zm and s n 1 if h is finitely generated then ps h is finitely generated as well if additionally s is computable then a basis for ps h can be effectively computed from a finite set of generators for h acknowledgements the first named author was partially supported by mineco grant pid 2019 107444 ga i 00 and the basque government grant it 974 16 the second named author acknowledges partial support from the spanish agencia estatal de investigaci n through grant mtm 2017 82740 p aei feder ue and also from the graduate school of mathematics through the mar a de maeztu programme for units of excellence in r d mdm 2014 0445 references 1 j c birget s margolis j meakin and p weil pspace complete problems for subgroups of free groups and inverse finite automata theoretical computer science 242 1 july 6 2000 pp 247 281 cit on pp 2 7 11 29 2 j c birget and s w margolis two letter group codes that preserve aperiodicity of inverse finite automata semigroup forum 76 1 jan 1 2008 pp 159 168 cit on pp 2 7 3 o bogopolski introduction to group theory zurich switzerland european mathematical society publishing house feb 29 2008 cit on p 13 4 d s bridges computability a mathematical sketchbook springer 2013 196 pp cit on p 8 5 a carvalho on the dynamics of extensions of free abelian times free groups endomorphisms to the completion arxiv 2011 05205 math nov 10 2020 arxiv 2011 05205 cit on pp 3 31 6 m chiodo on torsion in finitely presented groups groups complexity cryptology 6 1 may 1 2014 pp 1 8 cit on p 16 7 s das and m mj controlled floyd separation and non relatively hyperbolic groups journal of the ramanujan mathematical society 30 3 2015 pp 267 294 cit on p 15 8 p m davis computability and unsolvability new york dover publications 1985 248 pp cit on p 8 9 m dehn ber unendliche diskontinuierliche gruppen mathematische annalen 71 1 1911 pp 116 144 cit on p 8 10 j delgado extensions of free groups algebraic geometric and algorithmic aspects phd thesis universitat polit cnica de catalunya sept 15 2017 cit on p 31 11 j delgado and p v silva on the lattice of subgroups of a free group complements and rank journal of groups complexity cryptology volume 12 issue 1 mar 2 2020 cit on pp 7 21 12 j delgado and e ventura algorithmic problems for free abelian times free groups journal of algebra 391 oct 1 2013 pp 256 283 cit on pp 3 31 43 https arxiv org abs 2011 05205 13 j delgado and e ventura stallings automata for free times abelian groups intersections and index publicacions matem tiques 2021 to appear cit on pp 31 33 34 36 42 14 v diekert a jez and w plandowski finding all solutions of equations in free groups and monoids with involution information and computation 251 dec 1 2016 pp 263 286 cit on p 18 15 i kapovich and a myasnikov stallings foldings and subgroups of free groups journal of algebra 248 2 feb 15 2002 pp 608 668 cit on pp 2 7 11 18 21 24 26 27 29 31 16 s margolis m sapir and p weil closed subgroups in pro v topologies and the extension problem for inverse automata international journal of algebra and computation 11 2001 pp 405 446 cit on p 21 17 j mccool unsolvable problems in groups with solvable word problem canadian journal of mathematics 22 4 aug 1970 pp 836 838 cit on p 10 18 a miasnikov e ventura and p weil algebraic extensions in free groups in geometric group theory ed by g n arzhantseva j burillo l bartholdi and e ventura trends in mathematics birkh user basel jan 1 2007 pp 225 253 cit on pp 2 7 11 21 22 30 31 19 k a mikhailova the occurrence problem for direct products of groups doklady akademii nauk sssr 119 1958 pp 1103 1105 cit on pp 3 16 20 c f miller iii combinatorial group theory notes july 4 2004 cit on pp 8 17 21 d puder primitive words free factors and measure preservation israel journal of mathematics 201 1 jan 1 2014 pp 25 73 cit on p 22 22 a a razborov systems of equations in a free group izvestiya akademii nauk sssr seriya matematicheskaya 48 4 1984 pp 779 832 cit on p 18 23 a roig e ventura and p weil on the complexity of the whitehead minimization problem international journal of algebra and computation 17 8 2007 pp 1611 1634 cit on p 22 24 m roy and e ventura fixed subgroups and computation of auto fixed closures in free abelian times free groups journal of pure and applied algebra 224 4 2020 p 19 cit on p 31 25 m roy and e ventura degrees of compression and inertia for free abelian times free groups journal of algebra 568 2021 pp 241 272 cit on pp 3 31 26 j sahattchieve on convex hulls and the quasiconvex subgroups of fm x zn groups com plexity cryptology 7 1 2015 pp 69 80 cit on pp 3 31 27 w shi groups whose elements have given orders chinese science bulletin 42 21 nov 1 1997 p 1761 cit on p 2 28 p v silva and p weil on an algorithm to decide whether a free group is a free factor of another rairo theoretical informatics and applications 42 2 2008 pp 395 414 cit on p 22 29 r i soare turing computability theory and applications springer 2018 299 pp cit on p 8 30 j r stallings topology of finite graphs inventiones mathematicae 71 mar 1983 pp 551 565 cit on pp 18 21 22 31 e ventura on fixed subgroups of maximal rank communications in algebra 25 10 1997 pp 3361 3375 cit on p 22 32 d t wise a residually finite version of rips s construction bulletin of the london mathe matical society 35 1 2003 pp 23 29 cit on p 16 44 1 introduction 1 1 notation and terminology 2 relative roots orders and spectra 3 algorithmic considerations 4 realizing sets as subgroup spectra 5 free times free groups 6 free groups 6 1 automata and subgroups of free groups 6 2 relative spectra in free groups 6 3 computing pure closures within free groups 7 free times free abelian groups 7 1 subgroups of free times free abelian groups bases and completion 7 2 enriched automata 7 3 order and spectrum within free times free abelian groups 7 4 computing pure closures within n zm