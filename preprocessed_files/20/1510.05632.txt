ar x iv 1 51 0 05 63 2 v 2 m at h g r 1 7 d ec 2 01 5 decomposability of finitely generated torsion free nilpotent groups gilbert baumslag charles f miller iii and gretchen ostheimer abstract we describe an algorithm for deciding whether or not a given finitely generated torsion free nilpotent group is decompos able as the direct product of nontrivial subgroups 1 introduction finitely generated nilpotent groups seem tractable from some points of view such a nilpotent group g is finitely presented and the ele ments of finite order form a finite normal subgroup t with torsion free quotient g t moreover many algorithmic problems have positive so lutions for finitely generated nilpotent groups for example the word and conjugacy problems can be solved in a number of ways perhaps most remarkably grunewald and segal 8 have solved the isomorphism problem for finitely generated nilpotent groups in this paper we address a still open decidability question for these groups raised by baumslag in 5 determine whether a nilpotent group given by a finite presentation has a nontrivial direct product decom position we show that such an algorithm exists for the subclass of torsion free finitely generated nilpotent groups two common algorithmic approaches are 1 using residual prop erties and 2 using a polycyclic series inductively so the conjugacy problem for nilpotent groups can be solved by showing such groups are conjugacy separable that is non conjugate elements remain non conjugate in some finite quotient enumeration arguments then provide an algorithm to determine conjugacy the second approach also gives algorithms solving a wide variety of problems for nilpotent and poly cyclic groups 4 2 3 often using an effective version of the hilbert basis theorem date september 13 2018 2010 mathematics subject classification 20 f 10 20 f 18 17 b 30 key words and phrases nilpotent groups direct decomposition algorithm 1 http arxiv org abs 1510 05632 v 2 2 baumslag miller and ostheimer there are some known difficulties with nilpotent groups remeslen nikov 10 constructs non isomorphic finitely presented nilpotent groups which have the same collection of finite quotient groups perhaps more ominously remesennikov 11 shows that while one can deter mine whether one nilpotent group embeds in another there is no al gorithm to determine whether one is a quotient of another he shows hilbert s tenth problem is reducible to this epimorphism problem moreover the remak krull schmidt theorem fails for finitely gen erated nilpotent groups because direct product decompositions when they do exist are far from unique in 1 baumslag shows that for any pair of integers m n 1 it is possible to construct a single torsion free nilpotent group with two different direct product decompositions one with m indecomposable factors the other with n indecomposable factors where no factor in the first decomposition is isomorphic to any factor of the second decomposition an analysis of baumslag s non uniqueness examples led us to the following theorem theorem 15 there is an algorithm to determine of an arbitrary finite presentation of a torsion free nilpotent group g whether or not g has an abelian direct factor if so the algorithm expresses g as g g 1 z n where g 1 has no nontrivial abelian direct factor in section 5 we illustrate how the existence of abelian direct fac tors can be a source of non uniqueness the algorithm of theorem 15 combines some elementary considerations with several known al gorithms for presenting subgroups of abelian and nilpotent groups making progress in the absence of abelian direct factors involves more elaborate methods we rely on properties of the rational closure mal cev completion of torsion free nilpotent groups and use uniqueness of decomposition results for rational lie algebras our result is the following theorem 28 there is an algorithm to determine of an arbitrary finite presentation of a torsion free nilpotent group g without abelian direct factors whether or not g has a nontrivial direct decomposition if so the algorithm expresses g as g g 1 gn where each gi is directly indecomposable our paper is structured as follows in section 2 we present some background material about the rational closures of finitely generated torsion free nilpotent groups we believe that these results are prob ably well known but since we have not been able to find references we include proofs here in section 3 we prove theorem 15 in section 4 we present some structural theorems that describe the relationship decomposability of nilpotent groups 3 between the myriad decompositions of a torsion free nilpotent group and the more constrained decompositions of its rational closure and we use these to prove theorem 28 in section 5 we use the examples from 1 to illustrate our algorithm we leave three obvious questions unanswered first can our result be extended to include groups with torsion second is the algorithm presented here practical that is is it possible to implement this algo rithm or a variant of it in such a way that the algorithm can be used to determine the decomposability and also to find a decomposition in reasonably complex examples third if a finitely generated torsion free nilpotent group does not have any nontrivial abelian factors is its decomposition as a direct product of directly indecomposable groups unique up to isomorphism in memoriam gilbert baumslag this work results from discussions among the authors at various times particularly during july and au gust of 2014 in september of that year gilbert was diagnosed with incurable pancreatic cancer and he died on 20 october his passing was of great sadness to us and to his many friends and colleagues gilbert s contributions to group theory were vast he enjoyed sharing ideas and collaborated widely and he gave assistance generously to students and younger colleagues we miss him greatly 2 background material about the rational closure in this section we gather together results about the rational closures of finitely generated torsion free nilpotent groups we suspect that all of the results presented here are well known for those results for which we have been unable to find references we include our own proofs for every finitely generated torsion free nilpotent group g there ex ists a torsion free nilpotent group g satisfying the following properties g embeds in g for all h g and for all positive integers there exists a unique element k g such that k h for all h g there exists a positive integer such that h g g is unique up to isomorphism and it is called the rational closure of g see chapter 6 in 12 in order to understand the relationship between the direct product decompositions of g and those of g we need two straightforward re sults first a direct decomposition of g gives rise to a direct decompo sition of g second the well known theorem regarding the uniqueness of direct sum decompositions of lie algebras can be reframed to give a 4 baumslag miller and ostheimer useful description of the uniqueness of the direct product decomposi tions of g there are a number of ways to approach these proofs here we choose to exploit the fact that our groups can be represented by unitriangular matrices with integer entries and that in this context we can use the logarithm map to embed our groups in a finite dimensional lie algebra this approach is described in 12 for example the reader who is willing to accept proposition 5 and proposition 10 below can skip to section 3 for ring s z q and for m 0 1 s we let trm r s denote the set of r r upper triangular matrices with entries in s and m s on the diagonal every finitely generated torsion free nilpotent group can be embedded in the group tr 1 r z for a suitably chosen r see for example chapter 5 in 12 some of the proofs here will be easy using such a matrix representation so we will assume that our given group is a subgroup of tr 1 r z whenever it is convenient to do so recall that for x tr 1 r q log x is defined by log x u 1 2 u 2 1 3 u 3 where u x 1 for u tr 0 r q exp u is defined by exp u 1 u 1 2 u 2 1 3 u 3 in both cases since ur 0 the indicated sum is finite the following standard properties of log and exp can be found in 12 for example remark 1 for all x tr 1 r q and all u tr 0 r q exp log x x and log exp u u remark 2 for all x tr 1 r q and all non negative integers n log xn n log x the log and exp maps can be used to construct g as follows see 12 for example proposition 3 let g be a subgroup of tr 1 r z let l be the vector space of tr 0 r q generated by log g g g let h exp l then h is the rational closure of g proposition 4 let x 1 x 2 tr 1 r q u 1 u 2 tr 0 r q then x 1 and x 2 commute if and only if log x 1 and log x 2 commute likewise u 1 and u 2 commute if and only if exp u 1 and exp u 2 commute proof let x 1 and x 2 be commuting matrices in tr 1 r q let ui xi 1 then u 1 and u 2 commute thus from the definition of log we see that log x 1 and log x 2 also commute from this we also see that if exp u 1 and exp u 2 commute then by remark 1 so do u 1 log exp u 1 and u 2 log exp u 2 decomposability of nilpotent groups 5 now let u 1 and u 2 be commuting matrices in tr 0 r q by the definition of exp exp u 1 and exp u 2 also commute from this we also see that if log x 1 and log x 2 commute then by remark 1 so do x 1 exp log x 1 and x 2 exp log x 2 in tr 0 r q we will denote by u v the lie bracket uv vu proposition 5 let h be a finitely generated torsion free nilpotent group if h h 1 h 2 then h h 1 h 2 proof we may assume that h is a subgroup of tr 1 r z we first show that h 1 and h 2 commute let k 1 h 1 and k 2 h 2 there exist positive integers m 1 and m 2 such that k m 1 1 h 1 and k m 2 2 h 2 therefore by remark 2 0 log km 11 log k m 2 2 m 1 log k 1 m 2 log k 2 m 1 m 2 log k 1 log k 2 therefore log k 1 log k 2 0 and hence by proposition 4 k 1 and k 2 also commute as desired it is easy to see that h 1 h 2 1 if h h 1 h 2 then there exist positive integers m 1 and m 2 such that h m 1 h 1 and h m 2 h 2 thus hm 1 m 2 h 1 h 2 1 since tr 1 n q is torsion free h 1 finally we show thath h 1 h 2 suppose that h h then there exists a positive integer m and elements h 1 h 1 h 2 h 2 such that hm h 1 h 2 let r 1 and r 2 be the m th roots of h 1 and h 2 respectively since h 1 and h 2 commute r 1 r 2 m rm 1 r m 2 h 1 h 2 h m since roots are unique in tr 1 r q h r 1 r 2 the upper central series plays a special role in the relationship be tween a finitely generated torsion free group and its rational closure as the following well known theorem asserts see 9 p 257 for a proof and a discussion of the history of this result theorem 6 let g be a finitely generated torsion free nilpotent group let i g be the i th term in the upper central series of g then i g i g and i g i g g we will now describe the strong sense in which decompositions of rational nilpotent groups are unique we begin with a classical result about the uniqueness of decompositions in lie algebras let l be a lie algebra and let i j denote the lie bracket of two elements i and j in l recall that a subspace j of l is an ideal if for all j j and all l l 6 baumslag miller and ostheimer j l j and l j j and such an ideal is indecomposable if it cannot be written as the direct sum of two nontrivial ideals l is artinian resp noetherian it it satisfies the descending resp ascending chain condition on ideals the following is proved in 7 theorem 7 let l be a lie algebra that is both artinian and noether ian suppose also that l has two decompositions as a direct sum of nontrivial indecomposable ideals l m 1 m 2 mr n 1 n 2 ns let i be the projection of l onto mi and let i be the projection of l onto ni then r s and the summands can be reordered such that the following hold for all 1 k r k nk mk and the restriction of k to nk is an isomorphism from nk to mk whose inverse is the restriction of k to mk l m 1 m 2 mk nk 1 nr we will need a slight reformulation corollary 8 let l be a lie algebra satisfying the hypotheses of the orem 7 then for any k such that 1 k r l m 1 m 2 mk 1 nk mk 1 mr proof to see that l m 1 m 2 mk 1 nk mk 1 mr we need to show thatmk m 1 m 2 mk 1 nk mk 1 mr let m mk and let nk k m nk then k m nk 0 so m nk m 1 mk 1 mk 1 mr thus m m 1 m 2 mk 1 nk mk 1 mr it is clear from the statement of theorem 7 that nk commutes with and is disjoint from m 1 m 2 mk 1 and by reversing the roles of the mi s and ni s in theorem 7 it is clear also that nk commutes with and is disjoint from mk 1 mr the log and exp maps satisfy the following well known properties proposition 9 let h 1 h 2 be subsets of tr 1 r q and let m 1 m 2 be subsets of tr 0 r q such that mi log hi then 1 h 1 and h 2 commute if and only if m 1 and m 2 commute 2 h 1 h 2 1 if and only if m 1 m 2 0 decomposability of nilpotent groups 7 3 hi is a rational subgroup of tr 1 r q if and only if mi is a lie subalgebra of tr 0 r q proof the first claim follows from lemma 4 the second claim follows easily from the fact that log and exp are inverse bijections suppose that h 1 h 2 1 and let m m 1 m 2 then there exist hi hi such that m log h 1 log h 2 thus exp m h 1 h 2 1 and hence m log 1 0 conversely suppose that m 1 m 2 0 and let h h 1 h 2 then log h m 1 m 2 0 so log h 0 therefore h 1 we now prove the third claim if h 1 is a rational subgroup then m 1 is a lie subalgebra see theorem 2 on page 104 of 12 for the converse suppose that m 1 is a lie subalgebra there is an operator on tr 0 r q defined using the baker campbell hausdorff formula for u v tr 0 r q u v u v l where l is a certain q linear com bination of repeated lie brackets of u and v this operator satisfies exp u v exp u exp v for all u v tr 0 r q for a definition and properties of see p 102 in 12 sincem 1 is closed under it follows that h 1 is closed under multiplication since exp qu exp u q for all u tr 0 r q and all q q h 1 is closed under the taking of roots and inverses this establishes the third claim in our proposition we are now in a position to state our desired result concerning the uniqueness of decompositions in the rational closure of a finitely gen erated torsion free nilpotent group proposition 10 let g be a finitely generated torsion free nilpotent group suppose that we have two decompositions of g as the direct product of nontrivial rational subgroups which are themselves rationally indecomposable g r 1 r 2 rm k 1 k 2 kn let i be the projection of g onto ri and let i be the projection of g onto ki then m n furthermore there is a way to reorder the factors such that the following three properties hold for all 1 i m 1 i ki ri and the restriction of i to ki is an isomorphism from ki to ri whose inverse is the restriction of i to ri and 2 g r 1 r 2 ri 1 ki ri 1 rm proof let l log g since l is a lie subalgebra of the finite dimen sional lie algebra tr 0 r q it is itself finite dimensional and hence it is 8 baumslag miller and ostheimer both artinian and noetherian letmi log ri and let ni log ki by proposition 9 we have l m 1 m 2 mr n 1 n 2 ns and the conclusions of theorem 7 and its corollary hold applying the exp map to l m 1 m 2 mi 1 ni mi 1 mm we get g r 1 r 2 ri 1 ki ri 1 rm since i and i are projections they are clearly group homomor phisms it is easy to see that i exp i log and that i exp i log let h g and let ri ri such that h r 1 r 2 rm since the ri s commute exp i log h exp i log r 1 log rm exp log ri ri i h it now follows from theorem 7 that the suitable restrictions of i and i are inverse bijections as desired an automorphism of a group g is called normal if for all x y g xy x y corollary 11 let g be a group satisfying the hypotheses of proposi tion 10 if i is given by i r 1 r 2 rm r 1 r 2 ri 1 i ri ri 1 rm then i is a normal automorphism of g proof the fact that i is an automorphism follows immediately from proposition 10 to show that i is normal it suffices to show that for all r s ri i r s i r s but it is easy to see that i r s i r i s i r s we are interested in normal automorphisms because they fix central izers remark 12 if is a normal automorphism of group g and if cg h is the centralizer of h in g then cg h cg h proof let x cg h let y 1 x then hy h y h x hx h decomposability of nilpotent groups 9 therefore hy h and y cg h thus cg h cg h we obtain the opposite inclusion by considering the inverse of finally we will need to use the fact that there exist algorithms to determine whether g is rationally decomposable and if so to compute a decomposition see section 1 15 of 6 for example proposition 13 let g be a finitely generated torsion free nilpotent group there exists an algorithm to compute finite sets a 1 a 2 am of elements of g such that if si is the smallest rational subgroup of g containing ai then g s 1 s 2 sm 3 abelian direct factors in this section we describe an algorithm for deciding whether a given finitely generated torsion free nilpotent group has a nontrivial abelian direct factor in 1 baumslag proves that factorizations of finitely generated torsion free nilpotent groups are not unique in section 5 we will illustrate how the algorithms of this section provide an easy proof of this fact let g be a finitely generated torsion free nilpotent group suppose that g has an abelian factor then g h z h c computing abelianizations factor derived groups we have g g g h h h c so that c is a primitive element in g g g here g g g can have torsion so by primitive element we mean that its image is part of a basis modulo the torsion subgroup note that c z g here is a test for the presence of an abelian direct factor lemma 14 let g be a finitely generated torsion free nilpotent group then g has a nontrivial abelian direct factor if and only if the image of z g in the factor derived group g g g contains a primitive element proof we know from above that the condition is necessary for suffi ciency suppose we have an element c z g which is primitive then there is a retraction g c since c z g this gives a direct product decomposition g ker c theorem 15 there is an algorithm to determine of an arbitrary finite presentation of a torsion free nilpotent group g whether or not g has an abelian direct factor if so the algorithm expresses g as g g 1 z r where g 1 has no nontrivial abelian direct factor proof let w be the free abelian group g t where t is the pullback in g of the torsion subgroup of g g g and let n be the rank of 10 baumslag miller and ostheimer w let v be the subgroup of w given by v z g g g g g and let k be the rank of v we can compute a basis for w and a set of generators for v we can use a smith normal form calculation to determine if v contains a primitive element of w as follows let m be the n k matrix whose j th column is the j th generator for v expressed in terms of our basis for w compute p gln z and q glk z such that pmq s where s is in smith normal form then v contains a primitive element of w if and only if s 1 1 1 in which case the first column of p 1 is a primitive element of w which is also an element of v 4 nonabelian direct factors in the previous section we described an algorithm for deciding if g has a nontrivial abelian direct factor in this section we will develop an algorithm for deciding if g has a decomposition as the the direct product of indecomposable nonabelian factors in order to do so we prove some structural theorems about the relationship between the decompositions of a finitely generated torsion free nilpotent group and the decompositions of its rational closure we begin with two definitions which will help simplify the exposition that follows definition 16 we say that decomposition g r 1 r 2 matches decomposition g g 1 g 2 if giz g riz g definition 17 we say that decomposition g r 1 r 2 gives rise to a decomposition of g z g if when xi riz g g then g x 1 x 2 x 1 x 2 1 and x 1 x 2 z g we begin with some technical results in proposition 10 we saw that decompositions of g are unique up to isomorphism we will need a result which is slightly stronger in a way proposition 18 let g be a finitely generated torsion free nilpotent group suppose that we have two decompositions of g as the direct product of nontrivial rational subgroups which are themselves rationally indecomposable g r 1 r 2 rm k 1 k 2 km and that the ki s have been permuted so that the conclusions of propo sition 10 hold then for all i kiz g riz g decomposability of nilpotent groups 11 proof it suffices to prove the proposition for i 1 let r r 2 r 3 rm let be the normal automorphism 1 whose existence is posited in proposition 10 so r 1 k 1 and fixes every element of r fix h r the centralizer cg h r 1 cr h r 1 cr h k 1 cr h since fixes centralizers we see that r 1 cr h k 1 cr h and hence that k 1 r 1 cr h since this holds for all h r we get k 1 h r r 1 cr h r 1 h rcr h r 1 z r so k 1 r 1 z g by considering the inverse of we see that r 1 k 1 z g so our result now follows the following corollary establishes that if g g 1 g 2 we can use a decomposition of g to make a finite list of decompositions of g as g r 1 r 2 and trust that at least one of those decompositions matches the decomposition g g 1 g 2 corollary 19 let g be a finitely generated torsion free nilpotent group suppose that g s 1 s 2 sm is a decompostion of g into non trivial rational subgroups each of which is rationally indecomposable suppose furthermore that g g 1 g 2 is a nontrivial decomposition of g then it is possible to reorder the si s and to choose j such that if r 1 s 1 s 2 sj and r 2 sj 1 sm then the decomposition g r 1 r 2 matches the decomposition g g 1 g 2 proof we can decompose g 1 and g 2 into nontrivial rationally inde composable subgroups as follows g 1 t 1 tj g 2 tj 1 tm by proposition 18 we can reorder the si s such that for all i siz g tiz g let r 1 s 1 s 2 sj and r 2 sj 1 sm then for i 1 2 riz g giz g we will rely repeatedly on the following obvious fact about the center of a direct product lemma 20 let h be any group suppose that h h 1 h 2 then z h z h 1 z h 2 proof let z z g let gi hi such that z g 1 g 2 let h 1 h 1 then zh 1 g 1 g 2 h 1 g 1 h 1 g 2 on the other hand h 1 z h 1 g 1 g 2 therefore h 1 g 1 g 1 h 1 hence g 1 z h 1 likewise g 2 z h 2 hence z g z h 1 z h 2 z h 1 z h 2 12 baumslag miller and ostheimer proposition 21 let g be a finitely generated torsion free nilpotent group suppose that decomposition g r 1 r 2 matches decomposition g g 1 g 2 let xi riz g g then xi giz g proof let x x 1 since riz g giz g there exist r 1 g 1 and z z g such that x rz by proposition 5 g g 1 g 2 and hence by lemma 6 z g z g 1 z g 2 therefore there exist zi z gi such that z z 1 z 2 since x g there exist gi gi such that x g 1 g 2 thus we have two ways of expressing x as an element of g 1 g 2 x r 1 z 1 z 2 g 1 g 2 therefore r 1 z 1 g 1 and z 2 g 2 therefore r 1 z 1 g 1 and z 2 z g so x g 1 z g we have shown that x 1 g 1 z g the other inclusion is clear since by theorem 6 z g z g corollary 22 let g be a finitely generated torsion free nilpotent group suppose that decomposition g r 1 r 2 matches decomposition g g 1 g 2 then g r 1 r 2 gives rise to a decomposition of g z g proof by proposition 21 xi giz g it is obvious that g x 1 x 2 to see that x 1 x 2 z g it suffices to show that g 1 g 2 z g z g suppose that g 1 g 1 g 2 z g by lemma 20 g 1 g 2 z 1 z 2 for some g 2 g 2 and zi z gi therefore g 1 z 1 g 2 z 2 hence g 1 z 1 z g 1 hence g 1 z g x 1 x 2 g 1 z g g 2 z g g 1 g 2 1 lemma 23 let g be a finitely generated torsion free nilpotent group suppose that decomposition g r 1 r 2 matches decomposition g g 1 g 2 let xi riz g g if h 1 and h 2 are subgroups of g such that xi hiz g and z g z h 1 z h 2 then g h 1 h 2 proof by proposition 21 xi giz g and by corollary 22 g x 1 x 2 x 1 x 2 1 and x 1 x 2 z g we first show that g h 1 h 2 let g g then g x 1 x 2 for some xi xi since each xi hiz g g h 1 h 2 z for some hi hi and z z g by assumption there exist zi z g hi such that z z 1 z 2 therefore g h 1 h 2 z 1 z 2 h 1 z 1 h 2 z 2 h 1 h 2 we next show that h 1 h 2 1 suppose that g h 1 h 2 then g x 1 x 2 z g and hence g h 1 z g since z g z h 1 z h 2 g z h 1 similarly g z h 2 since z h 1 z h 2 1 g 1 finally h 1 h 2 x 1 x 2 g 1 z g g 2 z g g 1 g 2 1 decomposability of nilpotent groups 13 lemma 24 let g be a finitely generated torsion free nilpotent group suppose that the decomposition g r 1 r 2 matches decomposition g g 1 g 2 let xi riz g g suppose that a 1 a 2 ak are elements of x 1 such that a 1 z g a 2 z g akz g is a consistent polycyclic generating sequence for x 1 z g suppose that b 1 b 2 bl is a corresponding sequence of elements of x 2 define g 1 a 1 a 2 ak z g 1 and g 2 b 1 b 2 bl z g 2 then g g 1 g 2 proof we first notice that by corollary 22 the decomposition g r 1 r 2 gives rise to a decomposition of g z g and so by proposition 21 giz g xi also notice that g iz g giz g xi by lemma 23 it suffices to show that z g i z gi let z z g i there exist integers i and an element z 1 z g 1 such that z a 11 a 2 2 a k k z 1 this implies that a 11 a 2 2 a k k z g but by our choice of the ai s this in turn implies that each i is equal to 0 therefore z z 1 and hence z z g 1 the opposite inclusion is obvious we now describe an algorithm to test whether a given decomposition g r 1 r 2 which gives rise to a decomposition of g z g satisfies the further property that it matches a decomposition g g 1 g 2 if it does then the algorithm produces a decomposition theorem 25 let g be a finitely generated torsion free nilpotent group suppose that the decomposition g r 1 r 2 gives rise to a decompo sition of g z g let xi riz g g suppose that a 1 a 2 ak are elements of x 1 such that a 1 z g a 2 z g akz g is a consistent polycyclic generating sequence for x 1 z g suppose that b 1 b 2 bl is a corresponding sequence of elements of x 2 let h 1 a 1 a 2 ak and let h 2 b 1 b 2 bl if the decomposition g r 1 r 2 matches a decomposition g g 1 g 2 then there is a decomposition z g z 1 z 2 such that z h 1 z 1 and z h 2 z 2 conversely if there is a decomposition z g z 1 z 2 such that z h 1 z 1 and z h 2 z 2 then g g 1 g 2 where gi hizi and g r 1 r 2 matches this decomposition 14 baumslag miller and ostheimer proof suppose that there is a decomposition g g 1 g 2 that matches the decomposition g r 1 r 2 to show that there is a decomposition z g z 1 z 2 such that z h 1 z 1 and z h 2 z 2 we let g 1 a 1 a 2 ak z g 1 and g 2 b 1 b 2 bl z g 2 then by lemma 24 g g 1 g 2 let zi z g i then z g z 1 z 2 we will show that z hi zi let z z hi then z g i and z commutes with everything in g i therefore z zi suppose that there is a decomposition z g z 1 z 2 such that z h 1 z 1 and z h 2 z 2 and we let gi hizi notice that xi giz g since we are assuming that our decomposition g r 1 r 2 gives rise to a decomposition of g z g we know that g x 1 x 2 x 1 x 2 1 and x 1 x 2 z g from which it follows that g 1 g 2 x 1 x 2 1 we now show that g g 1 g 2 let g g since g x 1 x 2 g h 1 z 1 h 2 z 2 for some hi hi and zi z g since z 1 z 2 z g there exists z 1 z 1 and z 2 z 2 such that z 1 z 2 z 1 z 2 now g h 1 z 1 h 2 z 2 g 1 g 2 finally g 1 g 2 1 to see this suppose that g g 1 g 2 then g x 1 x 2 z g so g z 1 z 2 for some zi zi therefore z 1 g 2 so z 1 h 2 z 2 for some h 2 h 2 and z 2 z 2 therefore h 2 z g and hence h 2 z 2 now z 1 z 1 z 2 1 so z 1 1 likewise z 2 1 so g 1 we have proven that g g 1 g 2 it remains only to show that g r 1 r 2 matches g g 1 g 2 i e that giz g riz g let x gi there exists a positive integer m such that xm gi so x m xi hence x m riz g since ri is rational and by theorem 6 z g z g riz g is rational and hence x riz g conversely suppose that x ri there exists a positive integer m such that xm g thus xm ri g xi giz g therefore x giz g giz g we have shown that the decomposition g r 1 r 2 matches the decomposition g g 1 g 2 suppose that a is a finitely generated abelian group so it is a direct product of finitely many cyclic groups we recall that a subgroup v of a is pure if wk v implies w v a pure subgroup of a is a direct factor also the intersection of pure subgroups is pure we need the following variation on the smith normal form algorithm lemma 26 there is an algorithm which given a finitely generated free abelian group a and a finitely gnerated subgroup v finds a set of generators for the smallest subgroup w v which is pure in a the decomposability of nilpotent groups 15 algorithm determines whether v is already pure and finds a splitting a w a 2 also rankzw rankzv proof since we are dealing with abelian groups it is convenient to use additive notation let w be the set of all elements w a such that kw v for some k z then w is the smallest pure subgroup of a containing v the usual smith normal form computations giving the structure of finitely generated abelian groups can be applied here so if m is the integer matrix expressing the generators of v in terms of the basis for a the computation does row and column operations to obtain a new matrix pmq in canonical form with integer invariants c 1 cm where 1 ci z and ci ci 1 here m is the rank of v and n is the rank of a using the matrix p 1 we can find the new basis w 1 wn such that v is generated by c 1 w 1 cmwm clearly w gp w 1 wm is the smallest pure subgroup containing v no tice that v itself is pure if and only if all the ci 1 also if we put a 2 gp wm 1 wn then we have a direct product splitting a w a 2 the following lemma shows that the condition of theorem 25 is easily testable lemma 27 there is an algorithm which given a finitely generated free abelian group a and two finitely gnerated subgroups v 1 and v 2 determines whether or not there exists a splitting a a 1 a 2 such that ai vi if such splitting exists the algorithm produces such a decomposition explicitly proof given the subgroups vi we use the algorithm of lemma 26 to compute the smallest pure subgroups wi vi notice that w 1 w 2 0 if and only if v 1 v 2 0 now consider the subgroup b gp w 1 w 2 in general b may not be pure in a but if there is a splitting a a 1 a 2 such that ai vi then ai wi vi and hence b is pure in a and rankzb rankzw 1 rankzw 2 conversely suppose that b is pure in a then rank formula is rankzb rankzw 1 rankzw 2 rankz w 1 w 2 but rankzb rankzw 1 rankzw 2 implies w 1 w 2 0 so that b w 1 w 2 hence we can find the desired splitting since we can test purity and compute ranks we can determine whether such a splitting of a exists and if so explicitly find one notice that in the special case when one of the rational factors is abelian theorem 25 is vacuous in this case x 1 g x 2 z g and h 2 1 if we let z 1 z g and z 2 1 we get a splitting 16 baumslag miller and ostheimer z g z 1 z 2 with z h 1 z 1 and z h 2 1 we then find that g 1 g and g 2 1 so we have proven the existence of the trivial decomposition for g that is we have proven nothing however if g has a decomposition g g 1 g 2 where neither factor is abelian then given any decomposition of g as the direct product of rationally inde composable groups there will be a way to group the indecomposable factors to obtain g r 1 r 2 such that neither ri is abelian thus the theorems described in this section provide a test for the existence of a nontrivial nonabelian direct factor in section 3 we described a separate algorithm for deciding if g has a nontrivial abelian factor we can now summarize our algorithm for deciding whether or not there exist nonabelian groups g 1 and g 2 such that g g 1 g 2 we compute a decomposition g s 1 s 2 sm of g into nontrivial rational subgroups each of which is rationally indecomposable there are a finite number of ways to group the si s to obtain g r 1 r 2 where neither ri is abelian we further restrict our attention to decompositions that give rise to a decomposition of g z g which we determine by computing xi riz g g and deciding whether g x 1 x 2 x 1 x 2 1 and x 1 x 2 z g if none of our computed decompositions g r 1 r 2 give rise to a decomposition of g z g we conclude that g does not have a decomposition into two nonabelian factors otherwise for each of the computed decompositions of g that does give rise to a decomposition of g z g we decide whether that de composition matches a decomposition g g 1 g 2 as follows we de fine hi using a consistent polycyclic generating sequence for xi z g as in theorem 25 we compute z h 1 and z h 2 by theorem 25 and remark 27 there exists a decomposition of g corresponding with g r 1 r 2 if and only if z h 1 z h 2 1 in this case we compute a decomposition z g z 1 z 2 with z hi zi and we let gi hizi then g r 1 r 2 matches the decomposition g g 1 g 2 if after consideration of all our computed decompositions g r 1 r 2 that give rise to decompositions of g z g we find that none matches a decomposition of g then we deduce that g is cannot be decomposed as the direct product of two nonabelian factors we have now completed the proof of our main theorem theorem 28 there is an algorithm to determine of an arbitrary finite presentation of a torsion free nilpotent group g without abelian direct factors whether or not g has a nontrivial direct decomposition if so the algorithm expresses g as g g 1 gn where each gi is directly indecomposable decomposability of nilpotent groups 17 5 examples in this section we use the examples from 1 to illustrate how our algorithms work in doing so we also provide an easy proof of the theorem in 1 asserting that direct product decompositions of finitely generated torsion free groups may not be unique we begin by describing some examples of torsion free nilpotent groups which we shall denote by gp for p 1 and which are denoted g 1 p in 1 let a a b c be the free abelian group of rank 3 on the listed generators then the hnn extension b a t at ab bt bc ct c is torsion free and nilpotent of class 3 let f f be the free abelian group of rank 1 on the given generator and put k b f we define a subgroup k gp k by gp k s where s p bf thus s is the unique p th root of bf in k in lemma 3 of 1 baumslag proves that gp is not directly decom posable here we provide a simpler proof of this lemma using our algorithm we begin with some simple observations about the struc ture of gp notice that neither b 1 p nor f 1 p is an element of gp and yet c 1 p is an element of gp an easy calculation shows that t s 1 p c the center of gp is given by z gp c 1 p f the derived subgroup of gp is given by gp gp b c 1 p the abelianization of gp is free abelian on t a s we use the algorithm of section 3 to show that gp has no abelian direct factor the image of z gp in the abelianization is generated by the image of f which is equal to the image of sp clearly the image of sp is not primitive in the abelianization by lemma 14 gp has no abelian direct factor we use proposition 5 to show that gp cannot be decomposed as the direct product of nonabelian factors by showing that gp cannot be decomposed as the direct product of nonabelian factors the ra tional closure of gp has the following decomposition into rationally indecomposable groups gp k b f to see that b is rationally indecomposable observe that the center of b is the cyclic group gen erated by c and hence by theorem 6 the center of b is isomorphic to q since every factor in a splitting has a nontrivial center this shows that b is rationally indecomposable next we consider d gp gq where p and q are relatively prime we will prove that this decomposition as the direct product of inde composable groups is not unique by using the algorithm of section 18 baumslag miller and ostheimer 3 to find an abelian direct factor we will name the generators of gq using the corresponding greek letters and so for ex ample q the abelianization of d is free abelian with basis t a s the image of z d in the abelianization is generated by the images of sp and q we can perform a smith normal form calculation as described in section 3 but in this case it is easy to see that if l and m are integers such that lp mq 1 then p m q l is invertible and hence b 1 sp q f 1 is a primitive element of the abelianization that is central in d thus f 1 generates a cyclic direct factor t of d we have proved that the decomposition of d is not unique even up to isomorphism we use our algorithm to show that the complement s to t in d is itself indecomposable we are going consider s as the quotient of d obtained by identifying f and that is d t notice that in d the subgroup t intersects each of gp and gq trivially and so the quotient d t s is a direct product with central amalgamation and s is isomorphic to the subgroup s of d generated by t a s f and 1 qf 1 q to simplify the notation for the rest of this section we will refer to s as s even though s is not actually a subgroup of d but rather it is a subgroup of d that is isomorphic to a direct complement of t in d notice that with this notation the derived subgroup of s is given by s s b c 1 p 1 q and the center of s is given by c 1 p 1 q f we first show that s does not have an abelian factor in the abelian ization of s the image of the center is generated by f which is also the image of sp and q and so is a pq th power therefore f is not a primitive element of the abelianization thus by lemma 14 s does not have an abelian factor finally we will show that s is not the direct product of two non abelian factors note that s decomposes into rationally indecompos able factors as follows s bp bq f where we use bp to denote the subgroup of s generated by t a and bq to denote the subgroup of s generated by so b bp bq the first step of the al gorithm demands that we consider all ways of partitioning the given factors of s to obtain s r 1 r 2 where both ri s are rational and nonabelian there are essentially two partitions here to consider which are entirely analogous so it suffices look at the case when r 1 bp and r 2 bq f decomposability of nilpotent groups 19 we must first decide whether s r 1 r 2 gives rise to a decompo sition of s z s let xi riz s s we find that x 1 t a b 1 p f 1 p c 1 p 1 q f x 2 1 q f 1 q c 1 p 1 q f we now define h 1 and h 2 according to the requirements of theorem 25 the images of t a b 1 pf 1 p form a consistent polycyclic generating sequence for x 1 z s and the images of 1 q f 1 q form a consistent polycyclic generating sequence for x 2 z s we let h 1 t a b 1 pf 1 p h 2 1 q f 1 q then f z h 1 z h 2 and so by theorem 25 and remark 27 there is no decomposition s g 1 g 2 that matches the decomposition s r 1 r 2 we have completed our proof that s is indecomposable references 1 gilbert baumslag direct decompositions of finitely generated torsion free nilpotent groups math z 145 1 1 10 1975 2 gilbert baumslag frank b cannonito and charles f miller iii infinitely generated subgroups of finitely presented groups i math z 153 2 117 134 1977 3 gilbert baumslag frank b cannonito and charles f miller iii infinitely generated subgroups of finitely presented groups ii math z 172 2 97 105 1980 4 gilbert baumslag frank b cannonito derek j s robinson and dan segal the algorithmic theory of polycyclic by finite groups j algebra 142 118 149 1991 5 gilbert baumslag alexei g myasnikov and vladimir shpilrain open prob lems in combinatorial group theory second edition in combinatorial and geo metric group theory new york 2000 hoboken nj 2001 volume 296 of contemp math pages 1 38 amer math soc providence ri 2002 6 willem a de graaf lie algebras theory and algorithms volume 56 of north holland mathematical library north holland publishing co amsterdam 2000 7 david j fisher robert j gray and peter e hydon automorphisms of real lie algebras of dimension five or less j phys a 46 22 225204 18 2013 8 fritz grunewald and daniel segal some general algorithms ii nilpotent groups ann of math 112 585 617 1980 9 a g kurosh the theory of groups vol ii chelsea publishing company new york n y 1956 translated from the russian and edited by k a hirsch 10 v n remeslennikov conjugacy of subgroups in nilpotent groups algebra i logika sem 6 2 61 76 1967 20 baumslag miller and ostheimer 11 v n remeslennikov an algorithmic problem for nilpotent groups and rings sibirsk mat zh 20 5 1077 1081 1167 1979 12 daniel segal polycyclic groups volume 82 of cambridge tracts in mathemat ics cambridge university press new york 1983 gilbert baumslag department of mathematics and computer sci ence city college of new york convent ave and 138 th street new york n y 10031 usa charles f miller iii department of mathematics and statistics university of melbourne melbourne 3010 australia e mail address c miller ms unimelb edu au gretchen ostheimer department of computer science 211 adams hall hofstra university hempstead ny 11549 usa e mail address gretchen ostheimer hofstra edu 1 introduction 2 background material about the rational closure 3 abelian direct factors 4 nonabelian direct factors 5 examples references