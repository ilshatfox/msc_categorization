arxiv 1903 06088 v 1 math ph 14 mar 2019 ar x iv 1 90 3 06 08 8 v 1 m at h ph 1 4 m ar 2 01 9 a homological approach to belief propagation and bethe approximations olivier peltre universit denis diderot paris france abstract we introduce a differential complex of local observables given a decompo sition of a global set of random variables into subsets its boundary operator allows us to define a transport equation u u equivalent to belief propagation this definition reveals a set of conserved quantities under be lief propagation and gives new insight on the relationship of its equilibria with the critical points of bethe free energy introduction a common feature of statistical physics and statistical learning is to consider a very large number of random variables each of them mostly interacting with only a small subset of neighbours both lead to the effort of extracting relevant information about collective phenomena in spite of intractable global computations hence motivating the development of local techniques where only small enough subsets of variables are simultaneously considered in the present note we substitute the space of global observables with a col lection of local ones where relations between intersecting subsets of variables are translated into a boundary operator our construction yields a differential complex which we expose in section 1 this allows for a homological interpretation of some well known techniques having motivated the present work its starting point being the equivalence established by yedidia et al between critical points of the bethe free energy and fixed points of the belief propagation algorithm we review this beautiful theorem bridging statistical learning and thermodynamics in section 2 bethe first proposed in 1935 a combinatorial method to compute an approxi mate value of the free energy per atom in a bipartite cristal expanding computa tions over concentric shells around a given lattice point bb 35 his method was soon generalised by peierls pei 36 and others but its most important refinement was brought in 1951 by kikuchi s cluster variation method kik 51 these various methods solve a common combinatorial problem first related by morita to the general theory of m bius inversion mor 57 and we generically call them bethe approximations 1 http arxiv org abs 1903 06088 v 1 in the following we denote by a finite set of variables and by x a collection of subsets of the approximate value f of the global gibbs free energy f is computed as a weighted sum of each cluster s gibbs free energy f f c f where each c is a suitably chosen integer to account for the redundancies brought by intersecting clusters through a variational principle on f one may try to approximate the marginals of the gibbs state on each cluster belief propagation is a bayesian inference algorithm introduced by pearl in 1988 pea 88 equivalent to the low density decoding algorithms defined by gallager in 1963 gal 63 it was initially considered on graphs and known to converge to the exact marginal probabilities on trees while graphs with loops show degeneracy of its fixed points wei 97 mwj 99 the generalised version of yedidia et al considers more general clusters yfw 01 yfw 05 allowing for a better trade off between complexity and accuracy it describes one of the widest class of learning algorithms let us denote by the set of subclusters of and by the set of ordered pairs such that 6 and the algorithm defines a dynamic over a set of beliefs q and a set of messages m where for strictly containing each m is a strictly positive observable on describing a message from to given a collection of strictly positive functions f accounting for priors and local evidence each belief is the non vanishing markov field defined as q f m where the bracket denotes normalisation denoting by the integration over the variables in messages follow the update rule m m f m m which is sometimes called a sum product algorithm substituting beliefs the up date rule may take the much nicer form m m q q belief propagation essentially searches for a consistent statistical field q i e such that q is the marginal of q whenever is contained in inside a particular subspace defined by the priors f this subspace can be characterised by a max imal set of conserved quantities under a transport equation of the form u u equivalent to belief propagation where is the boundary operator in degree zero of a natural homology theory this is part of a phd work done under the kind supervision of daniel ben nequin i wish to thank him as well as gr goire sergeant perthuis and juan pablo vigneaux for their sustained collaboration and many fruitful discussions 2 1 differential and combinatorial structures 1 1 statistical system regions we will call system a finite set equipped with a collection of subsets x p such that the empty set is in x if x and x then is also in x we say that x is an admissible decomposition 1 of when it satisfies the above axioms we call x a region 2 of and denote by x the subsystem of those regions contained in we may view x as a subcategory of the partial order p having an arrow whenever the above axioms state that is a final element of x and that x has sums chains and nerve a p chain is a totally ordered sequence 0 p in x it is said non degenerate when all inclusions are strict and we write 0 p to emphasize on non degeneracy a p chain may be viewed as a p simplex its p 1 faces are the chains k 0 k p of degree p 1 obtained by removing k the nerve of x is the simplicial complex 3 nx p n px formed by all non degenerate chains its dimension is the degree of the longest non degenerate chain in x bounded by the cardinal of microscopic states for each i suppose given a finite set ei a microscopic state of a region is an element of the cartesian product 4 e i ei an element x e is also called a configuration of configuration spaces yield a functor from p to set and we denote by e e the canonical projection of e onto e whenever is a subregion of in the following we will be mostly interested in the restriction of such a functor e p set to an admissible decomposition x p 1 2 scalar fields differentials we call scalar field a collection r x of scalars indexed by the nerve of x we denote by rp x the space of p fields vanishing everywhere but on the p simplices of nx rp x r npx 1 a general x p is called a hypergraph these two axioms are necessary for the inter action decomposition theorem 1 to hold 2 the term is chosen to refer to the notion of region graphs in yedidia et al 3 for the general theory of simplicial complexes see es 52 4 the configuration space e is thus a point unit for the cartesian product and terminal element in set 3 using the canonical scalar product of r x scalar fields can be identified with chains or cochains with real coefficients in nx eitherwise we denote by the boundary operator of r x and by d its adjoint differential 5 r 0 x r 1 x d r 0 x r 1 x because x has as final element nx is a retractable simplicial complex and its homology is acyclic convolution we denote by r 1 x r 0 x r 1 x the space of scalar fields of degree lower than one equivalently an element of r 1 x is indexed by general 1 chains in x identifying the degenerate 1 chain with equipped with dirichlet convolution r 1 x is the incidence algebra 6 of x the product of and r 1 x is defined for every by the unit of is 1 r 0 x sometimes viewed as a kronecker symbol in r 1 x the incidence algebra of x has two natural actions on the 0 fields they give r 0 x a r 1 x bi module structure the left action of r 1 x on r 0 x is given by we will sometimes denote by and the two adjoint endomorphisms of r 0 x associated to the left and right action of respectively m bius inversion we denote by r 1 x the dirichlet zeta function defined by 1 for every in x the k th power of counts chains of length k and 1 k is the number of non degenerate k chains from to because x is locally finite 7 we easily recover the fundamental theorem of m bius inversion stating that is invertible its inverse satisfies k 0 1 k 1 k the field r 1 x is known as the m bius function and is valued in z we also introduce the right m bius numbers as the coefficients c r 0 x defined by c 1 these integers satisfy the following inclusion exclusion formula c c 1 5 we shall give formulas for these operators shortly a nice presentation can be found in kodaira kod 49 6 see rota rot 64 for a deeper treatment of these combinatorial structures 7 x is locally finite if for any x there is only a finite number of non degenerate chains from to 4 1 3 observables densities and statistical states observable fields an observable on a region is a real function on e we denote by a r e the commutative algebra of observables on for every subregion any observable u a admits a cylindrical extension j u a defined by pulling back the projection of e onto e j u u the injections j make a x op alg a contravariant functor to the category of unital real algebras we denote by 1 the unit of a and will generally drop the injection in our notation we call observable field an allocation of observables on the nerve of x defining an observable on a p chain npx to be an observable on its smallest region p we write a for the copy of a p on and denote the space of p fields by ap x npx a and by a x the graded vector space of observable fields if is a face of its terminal region contains that of it follows that there is a canonical injection j a a whenever is a subchain of 8 the boundary operator ap 1 x ap x is defined on a p 1 field by the following formula p 1 k 0 k 1 k j the proof of 2 0 is done as usual it uses functoriality of the injections but otherwise does not differ from the case of scalar coefficients in the case where p 0 we have for example each a may also be viewed as the abelian lie algebra of the multiplicative lie group g r e of strictly positive observables on we denote by e a g the group isomorphism u 7 e u and by ln its inverse density fields we call density on a region a linear form on observables a for every we denote by a the density defined by integrating along the fibers of x x e x x 8 observable fields form a simplicial algebra a x ordop alg our construction is related to this more general theory see segal s note on classifying spaces seg 68 for instance 5 the marginal projections make a x vect a covariant functor each is dual to j as for every a and every u a we have u j u we define the complex a x of density fields by duality with a x and denote its differential by d adjoint of the action of d on a density p field is the p 1 field defined by d p k 0 1 k k k writing for the adjoint of j for p 0 we have d we say that a field a 0 x is consistent if d 0 for every region x and every subregion the marginal of on is then a density on is said positive if u 2 0 for every observable u the counting measure on e denoted by 1 is positive its free orbit under multiplication by the observables of g is the space of strictly positive densities we will sometimes identify g with g 1 a statistical fields a statistical state on a region is a positive density p a such that p 1 1 equivalently it is a probability measure on e and we denote by prob e the convex set of statistical states on it is a topological simplex of dimension e 1 and its image under is so that x top defines a covariant functor of topological spaces any non trivial positive density a defines a normalised statistical state which we denote by the interior of the probability simplex on e consists of all the non vanishing probability densities it is diffeomorphic to the quotient of g by scalings of r itself isomorphic to the quotient of a by the action of additive constants pg a r it follows that has a natural lie group structure the extensions j admit a quotient by scalings and xop grp also defines a contravariant functor the gibbs state associated to any observable u a is the non vanishing probability density e u and we denote by e g the surjective group morphism induced by gibbs states the convex set x a x of statistical fields may be defined by inclusion of each a and we denote by x the interior of x we say that p x is a consistent statistical field if dp 0 and denote by d 0 x the subset of non vanishing consistent statistical fields 6 1 4 homology gauss formula for every region x let us define the coboundary of the subsystem as the subset of arrows n 1 x that meet but are not contained in 6 and the following proposition may then be thought of as a gauss formula on proposition 1 for every a 1 x and x we have in particular the above vanishes if is supported in proof in the sum of over each term appears with opposite signs in and whenever both and belong to we may write a similar formula on the cone v over in x formed by all the regions that contain and define its coboundary v as the set of arrows leaving v the sums however need to be embedded in the space of global observables proposition 2 for every a 1 x and x we have v v as global observables of a interaction decomposition for each region x we call boundary observ able on a region x any observable generated by observables on strict subregions of we denote by b the subspace of boundary observables b a suppose chosen for every a supplement z of boundary observables called inter action subspace of so that we decompose a as a z b we may inductively continue this procedure on b as illustrated by the following well known 9 theorem theorem 1 interaction decomposition given supplements z of boundary observables for every x we have the decompositions a z 9 the first appearance of this now very common result in statistics seems to be in kellerer kel 64 see also mat 88 for a proof via harmonic analysis 7 the interaction decomposition induces a family of coherent projectors p of a onto z a they induce a map p a 0 x z accounting for the contributions of all regions containing p u p u writing z 0 x a 0 x for the direct sum of interaction subspaces they define a projection p a 0 x z 0 x we call p the interaction decomposition given u a 0 x we may define a global observable u a by u x u the interaction decomposition essentially characterises the global sum of local ob servable fields corollary 1 for any u a 0 x we have the equivalence p u 0 u 0 in particular z 0 x is isomorphic to the image of in a 10 proof when x does not contain we have a z z 0 x and the image of may be viewed as the subspace of boundary observables on homology groups the complex of observable fields a x is also acyclic as might be expected 11 from the retractability of nx and we only focus on the first homology group theorem 2 the interaction decomposition p induces an isomorphism on the first homology group of observable fields a 0 x a 1 x z 0 x proof the gauss formula on the cone v above inx first ensures that p vanishes on boundaries p p 6 p 0 as p a is non zero if and only if contains let us denote by p the quotient map induced by p given u a 0 x consider the flux defined by p u p u u when p u 0 this gives u hence p is injective 10 they both represent the inductive limit of a over x 11 we do not provide a proof here a treatment of higher degrees shall be given in later work 8 corollary 2 let v v denote an observable field of a 0 x and c r 0 x denote the right m bius numbers we have the equivalence cv im v im proof according to the theorem it suffices to show that p v p cv as p v p v p v p c v p cv for every x theorem 2 and its corollary are at the core of our homological interpretation for critical points of bethe free energy and fixed points of belief propagation 2 first applications 2 1 critical points of bethe free energy gibbs free energy we denote by f the global gibbs free energy of viewed as the smooth functional on a defined by f p h ep h s p where s denotes shannon entropy given a global hamiltonianh a we denote by f h the induced functional on the thermodynamic equilbrium state 12 of is the global minimum of its gibbs free energy fh describing the cotangent fibers of by the quotient a r this defines a unique statistical state p by f p h ln p 0 mod r this means p is the global gibbs state e h associated to h this definition of equilibrium being hardly computable in practice we shall seek to approximate the marginals p of the global gibbs state on the regions x of an admissible decomposition of we first introduce the local gibbs free energy f of a region x as the functional on a defined by f p h ep h s p given a local hamiltonian h we denote by f h the induced functional on its minimum is the local gibbs state e h which would describe the equilibrium of had it been isolated from 12 when describes a canonical ensemble i e a closed system interacting with a thermostat the inverse temperature kbt 1 is set to 1 9 bethe approximation the bethe peierls approach and its refinements 13 es sentially consist in writing an approximate decomposition of f as a sum of local free energy summands f x f where each f is a smooth functional on a this localisation procedure can be made exact on any region x defining the free energy summands of f by m bius inversion f f f f the approximation only comes when is not in x we may then write the error f f as a global free energy summand f from a physical point of view we expect f to be small when sufficiently large regions are taken in x by extensivity of the global gibbs free energy 14 the functional f is thus defined for every p 0 x and h a 0 x by f p h x c f p h we call f the bethe free energy given a reference hamiltonian field h a 0 x we denote by f h the induced functional on 0 x critical points because of the m bius numbers c appearing in its definition the bethe free energy f is no longer convex in general and f h might have a great multiplicity 15 of consistent critical points in d using theorem 2 we provide with a rigorous characterisation of the consistent statistical fields critical for f h we hope to give a better geometric understand ing of these fields by showing that they bear a homological relationship with the reference hamiltonian field h theorem 3 a non vanishing consistent statistical field p d is a critical point of the bethe free energy f h constrained to d if and only if there exists a flux a 1 x such that ln p h mod r 0 x proof to describe the normalisation constraints we may look at the quotient a 0 x r 0 x as the cotangent space of 0 x at p and write the differential of f h as f p x c h ln p mod r 0 x 13 namely the cluster variation method introduced by kikuchi kik 51 whose variational free energy was related to a truncated m bius inversion by morita mor 57 14 schlijper sch 83 proved this procedure convergent to the true free energy per lattice point for the infinite ising 2 d model 15 for numerical studies see wei 97 mwj 99 kp 17 a first mathematical proof of multiplicity is given by bennequin in bpspv 19 10 the flux term comes as a collection of lagrange multipliers for the consistency constraints whenever p is a critical point the differential of f h vanishes on ker d im and we have c h ln p im r 0 x the corollary of theorem 2 is crucial 16 to state that this implies h ln p im r 0 x as r 0 x r 0 x 2 2 belief propagation as a transport equation effective energy for every in x we call effective energy the smooth submersion f of a onto a defined by f u ln e u from a physical perspective one may think of f u x as the conditional free energy of given x mathematically we view effective energy as interlacing marginal projections with the diffeomorphisms between each a and the orbit of the counting measure 1 a under g f ln e which implies functoriality in the category of smooth manifolds a weaker yet fundamental property is that gibbs state maps induce the following commutative diagram between effective energy and marginalisation e e f effective energy also induces a smooth functional f from a 0 x to a 1 x which we call effective gradient it is defined by f h h f h given a field of potentials h we will be interested in the effective gradient of its local hamiltonian field h h letting f gives h f h which is the effective contribution of to the energy of 16 the proof given in yfw 05 is problematic when there exists such that c 0 11 belief propagation given a field of potentials h a 0 x consider the following transport equation with initial condition h u u we denote by the induced vector field on a 0 x and by e t its flow in absence of normalisation 17 we claim that belief propagation is equivalent to the naive euler scheme 18 approximating the flow of by en 1 n the conjugated vector field on local hamiltonians induces the dynamic over beliefs through the isomorphism of a 0 x with g 0 x we believe this new perspective reveals a strong homological character of belief propagation denoting by th the transport of h by a flux a 1 x th h it is clear that the potentials u remain in the image of th this yields a maximal set of conserved quantities in light of theorem 2 theorem 4 let q g 0 x n denote a sequence of belief fields obtained by iterating bp the following quantity remains constant q x q c proof the fact that u im th is equivalent to p u p h itself equivalent to u h where u x u x c u the beliefs are given by q e u belief propagation is usually viewed as a dynamic over messages letting u h we may recover the dynamic on potentials while keeping messages in memory by considering the evolution th we denote by h th the induced vector field on a 1 x although it converges on trees this algorithm is generally divergent in presence of loops and beliefs need to be normalised in order to attain projective equilibria 17 this is the case of the original algorithm on trees as introduced by pearl in pea 88 18 bp is actually for 1 a different time scale would appear as exponent in the multiplicative formulation 12 normalisation because the effective gradient f is additive along constants and both and preserve scalar fields we have u r 0 x u r 0 x and induces a vector field on the space 0 x of non vanishing statistical fields identified with a 0 x r 0 x dynamics over normalised beliefs and over messages h are similarly induced by and h given an initial hamiltonian field h and an initial flux 0 let us denote by u t et u 0 the integral curve of originating from u 0 h 0 the normalised flow is recovered by defining beliefs as q e u and messages as m e which gives ln q h mod r 0 x in virtue of theorem 3 this implies that q is a critical point of the bethe free energy f h constrained to d if and only if q is a consistent statistical field considering all beliefs that may be obtained by any choice of messages we may define a subspace of admissible beliefs as h e u u h im 0 x following yedidia et al we might call any consistent q h d a fixed point of belief propagation 19 with this terminology we can rephrase their initial claim yfw 05 theorem 5 fixing a reference hamiltonian field h fixed points of belief prop agation are in one to one correspondence with critical points of the bethe free energy references bb 35 hans a bethe and william l bragg statistical theory of superlat tices proceedings of the royal society of london series a mathe matical and physical sciences 150 871 552 575 1935 bpspv 19 d bennequin o peltre g sergeant perthuis and j p vigneaux informations energies and messages preprint 2019 es 52 samuel eilenberg and norman steenrod foundations of algebraic topology princeton university press 1952 gal 63 robert g gallager low density parity check codes mit press 1963 kel 64 hans g kellerer ma theoretische marginalprobleme mathematische annalen 153 3 168 198 jun 1964 19 this terminology is somewhat ambiguous as it does not mean that q may be obtained by iterating bp from e h 13 kik 51 ryoichi kikuchi a theory of cooperative phenomena phys rev 81 988 1003 mar 1951 kod 49 kunihiko kodaira harmonic fields in riemannian manifolds gener alized potential theory ann math 2 50 587 665 1949 kp 17 christian knoll and franz pernkopf on loopy belief propagation local stability analysis for non vanishing fields in uncertainty in artificial intelligence 2017 mat 88 franti ek mat discrete marginal problem for complex measures kybernetika 24 36 46 1988 mor 57 tohru morita cluster variation method of cooperative phenomena and its generalization i journal of the physical society of japan 12 7 753 755 1957 mwj 99 kevin p murphy yair weiss and michael i jordan loopy belief propagation for approximate inference an empirical study in uai 1999 pea 88 j pearl networks of plausible inference probabilistic reasoning in intelligent systems 1988 pei 36 r peierls on ising s model of ferromagnetism mathematical pro ceedings of the cambridge philosophical society 32 3 477 481 1936 rot 64 gian carlo rota on the foundations of combinatorial theory i theory of m bius functions z warscheinlichkeitstheorie 2 340 368 1964 sch 83 a g schlijper convergence of the cluster variation method in the thermodynamic limit phys rev b 27 6841 6848 jun 1983 seg 68 graeme segal classifying spaces and spectral sequences publications math matiques de l ih s 34 105 112 1968 wei 97 yair weiss belief propagation and revision in networks with loops technical report mit 1997 yfw 01 jonathan s yedidia william t freeman and yair weiss bethe free energy kikuchi approximations and belief propagation algorithms technical report tr 2001 16 merl mitsubishi electric research laboratories cambridge ma 02139 may 2001 yfw 05 j s yedidia w t freeman and y weiss constructing free en ergy approximations and generalized belief propagation algorithms ieee transactions on information theory 51 7 2282 2312 july 2005 14