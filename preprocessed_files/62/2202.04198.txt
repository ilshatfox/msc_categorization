multilayer adjusted cluster point process model application to microbial biofilm image data analysis suman majumder harvard t h chan school of public health boston massachusetts u s a brent a coull harvard t h chan school of public health boston massachusetts u s a jessica l mark welch marine biological laboratory woods hole massachusetts u s a patrick j la riviere university of chicago chicago illinois u s a floyd e dewhirst the forsyth institute cambridge massachusetts u s a jacqueline r starr brigham and women s hospital boston massachusetts u s a kyu ha lee harvard t h chan school of public health boston massachusetts u s a february 10 2022 co senior author 1 ar x iv 2 20 2 04 19 8 v 1 st at a p 8 f eb 2 02 2 abstract a common problem in spatial statistics tackles spatial distributions of clusters of objects such clusters of similar or dissimilar objects are encountered in many fields including field ecology astronomy and biomedical imaging still challenging is to quan tify spatial clustering when one or more entities clusters around a different entity in multiple layers such multi entity and multi layered structures are observed for ex ample in human dental plaque biofilm images which exhibit multi species structures in corncob like arrangements we propose a novel fully bayesian multivariate spatial point process model to quantify corncob like arrangements with parent offspring sta tistical approaches the proposed multilayer adjusted cluster point process macpp model departs from commonly used approaches in that it exploits the locations of the central parent object in clusters and accounts for multilayered multivariate parent offspring clustering in simulated datasets the macpp outperforms the classical neyman scott process model a univariate model for modeling spatially clustered pro cesses by producing decisively more accurate and precise parameter estimates we analyzed data from a human dental plaque biofilm image in which streptococcus and porphyromonas simultaneously cluster around corynebacterium and pasteurellaceae clusters around streptococcus the proposed macpp model successfully captured the parent offspring structure for all the taxa involved keywords dental plaque sample imaging microbiome parent offspring models point processes spatial statistics thomas process 1 introduction nature abounds in instances where one type of object is dispersed around another type of object at interplanetary and field ecologic scales respectively radio galaxies yates et al 1989 hill and lilly 1991 bornancini et al 2004 2006 and forest songbirds tarof and ratcliffe 2004 bourque and desrochers 2006 melles et al 2009 exemplify this type of spa tial clustering at microscopic scales among single celled organisms and human cells such arrangements are common for example in human dental plaque biofilm spherical strepto coccus cells often cluster around the ends of filamentous corynebacterium cells jones 1972 mark welch et al 2016 these corncob like arrangements have been observed in dental plaque for decades and are likely to hold clues about interspecies microbial interactions to describe and quantify such arrangements we have developed a new multilayer adjusted cluster point process model macpp most biofilm image analyses have focused primarily on macro level structural characteristics or derived features such as biofilm volume thickness or surface roughness vorregaard 2008 less commonly spatial point process models have been used to analyze the spatial patterning of microbial cells how cells of one taxonomic class or taxon are distributed in relation to other cells of the same or different taxa however standard point process models such as the log gaussian cox process model m ller et al 1998 do not account for the complex spatial clustering arrangements often present in biofilm images 2 figure 1 a multi layered parent offspring structure the green dots behave as offspring to the pink dot while the orange dots behave as offspring to the green dots the neyman scott process model nsp neyman and scott 1958 is a classic statistical model used to quantify spatial clustering relationships most often applied to true parent offspring clusters such as trees in a forest in this approach locations of the central object in each cluster are treated as latent in part because in a cluster comprising similar objects such as a grove of trees or a school of fish it may be impossible to identify any true parent in contrast in corncob arrangements in dental plaque biofilm the locations of the parent corynebacterium cells are often known while reasonable for within taxon clustering na ve application of the nsp to investigate between taxon relationships i e one taxon clustering around the other is inappropriate because it ignores the taxon in the center of the cluster corncob arrangements in dental plaque biofilm also have other characteristics that preclude direct application of the nsp or the related shot noise cox process model m ller 2003 first the parent and offspring cells are of different bacterial taxa thus requiring a mul tivariate extension of univariate approaches second the corncob arrangements sometimes include multiple offspring taxa in that both streptococcus and porphyromonas are ob served around corynebacterium parents in this regard existing multivariate cluster point process models tanaka and ogata 2014 jalilian et al 2015 are not applicable to microbial corncob like arrangements because they do not model the taxa in the cluster center and have no scope to enforce multiple offspring taxa having the same parent taxon moreover neither of the existing approaches address a third challenge that the corncobs can be multilayered in nature e g figure 1 and fourth the corncob arrangements themselves are part of a more complexly organized microbial community that includes other taxa unrelated to the arrangements the primary innovation of our proposed macpp model is that it exploits the known lo cations of central objects in clusters and it also addresses the above described challenges specifically it can quantify multivariate and multilayered clustering and inter process re lationships the macpp is flexible in that it can simultaneously model clustered and non clustered processes and can be applied in multivariate or univariate contexts in this paper we describe the model in detail evaluate its performance through simulation studies and demonstrate the feasibility of applying the model to both real and synthetic datasets 3 figure 2 a biofilm image of a dental plaque sample from from a human donor rgb image taxa relevant to the multilayered concob arrangements are corynebacterium pink strep tococcus green porphyromonas blue and pasteurellaceae orange spatial locations for the centroids of the taxa identified from the segmented image 2 microbiome biofilm image data from dental plaque samples dental plaque samples were collected from a donor who was asked not to smoke floss or brush for 12 hours and not to eat for 2 hours prior to collection the sample was suspended in ethanol an aliquot mounted on a glass slide and dried multi spectral fluorescence in situ hybridization fish imaging was applied to the microbiota of the dental plaque sample by including multiple genus level probes to identify several distinct microbial taxa simultane ously actinomyces capnocytophaga corynebacterium fusobacterium leptotrichia neis seriaceae pasteurellaceae porphyromonas streptococcus and eubacterium figure 2 a we performed segmentation of the biofilm image in fiji schindelin et al 2012 by apply ing the 3 3 median filter and auto local thresholding function with the bersen method spatial coordinate information for centroids of the taxa were identified by applying the an alyze particles function using size filter with a 0 5 m diameter threshold in fiji figure 2 b more details on collection and processing of dental plaque fixation on a microscopy slide and multi spectral fish imaging process are described in mark welch et al 2016 the sampled image is representative of similar samples from the same and other donors without active tooth decay not shown filamentous corynebacterium cells figure 3 pink are among the most common members of this genus are now believed to help estab lish the healthy dental microbiota providing a scaffold around which other community members assemble in some parts of the image cells of streptococcus figure 3 green and 4 figure 3 rgb images of only corynebacterium pink streptococcus green and porphy romonas blue a in the entire dental plaque sample b in a sub region of the sample focusing on the corncob structure the corncob structures are present in areas of the image corresponding to the tip of the corynebacterium the central portion of the entire image in a consisting of stems of the corynebacterium are relatively empty without any taxa surrounding them porphyromonas figure 3 blue seem to surround the tips of corynebacterium filaments mark welch et al 2016 sometimes both in the same clusters adding another layer and further complexity pasteurellaceae cells figure 4 orange sometimes surround streptococ cus cells mark welch et al 2016 perera et al 2020 as outlined in section 1 these arrangements give streptococcus the potential to be either parent offspring or both in the same cluster other taxa are scattered around seemingly homogeneously and may or may not have additional spatial relationships with corynebacterium streptococcus porphyromonas or pasteurellaceae individual images in section a of the supplementary materials 3 multilayer adjusted cluster point process model we consider a multivariate process y m i 1 yi i 1 m at location s w r 2 where each component yi is a poisson process characterized by an intensity function i s and w the observation window in application to the biofilm sample each yi will capture the spatial distribution of a taxon i the intensity function s of the superimposed process is defined as s m i 1 i s i s yi 1 5 figure 4 rgb images of pasteurellaceae orange clustering around streptococcus green a in the entire human dental plaque sample b in a sub region of the sample focusing on the clustering where i s yi is the indicator function of the i th process being observed at location s w the indicator terms ensure that only one process can be observed at each location 3 1 model formulations suppose that y 1 yp are homogeneous poisson processes with intensities c v for v 1 p m and serve only as parent processes then we consider the q m p processes yp 1 yp q that behave as offspring processes furthermore let cl for l p 1 p q denote the corresponding parent processes with the following properties i cl cl for some l 6 l implying multiple offspring processes can share a parent process ii cl yj for some l and j 1 p q implying some offspring processes can function as parent processes we assume that the offspring points are distributed around parent point c cl l p 1 p q according to the rule lkl c hl where l is the average number of offspring per parent kl is a kernel e g gaussian and hl is a bandwidth parameter that controls the distance between the parent and its offspring locations for the l th offspring process chiu et al 2013 illian et al 2008 the parameter hl should be interpreted as the distance at which offspring are most likely to be situated relative to their corresponding parents the remaining m p q types e g taxa that are unrelated to multilayered arrangements are modeled as homogeneous poisson processes with intensities j for j p q 1 m 6 therefore under the proposed specification the intensity function in 1 can be written as s p v 1 cv i s yv p q l p 1 l cl cl kl s cl hl i s yl m j p q 1 ji s yj 2 since the superimposed process y is modeled as a poisson process with intensity function s in 2 the likelihood as a function of the unknown parameters p 1 p q hp 1 hp q c 1 c p p q 1 m is given by l y exp w 1 u du y y y exp w p v 1 w cv p q l p 1 l cl cl w kl u cl hl du m j p q 1 w j exp p v 1 nv log c v p q l p 1 y yl log l cl cl kl y cl hl m j p q 1 nj log j 3 where w is the area ofw and ni denotes the number of observations from the i th process in w 3 2 prior distributions and practical considerations we outline priors for the unknown model parameters to complete the bayesian specification of the macpp specifically we consider the following priors l iid gamma ay by l p 1 p q hl iid half normal l p 1 p q cv iid gamma ac bc v 1 p j iid gamma a b j p q 1 m 4 where iid denotes independent and identically distributed and a b ay by ac bc are hyperparameters to be specified it is well appreciated in the literature on point process models that using a noninformative prior for spatial bandwidth or scale parameters is impossible due to numerical reasons moller and waagepetersen 2003 diggle 2013 kopecky and mrkvic ka 2016 we use a half normal prior for the bandwidth parameters hl ensuring the bulk of the mass remains on relatively small positive values enables comparatively easier prior elicitation specifically the value of hyperparameter can be set such that the 99 th percentile of the half normal prior corresponds to the maximum extent of the distance d between a parent point and offspring 7 points this choice helps sensitize the proposed bayesian framework to stronger clustering within a small radius the type of clustering we seek to detect and quantify when for example cells of two bacterial taxa directly interact in general choosing the value of d should depend on the context of application 3 3 computational scheme combining 3 and 4 the joint posterior density for the proposed macpp can be written as y l y where is the product of all the individual prior densities we then proceed to draw samples from the posterior distribution by using a markov chain monte carlo mcmc algorithm more conventional nsp type approaches treat the number of parent points and their locations as random and thus require an additional reversible jump mcmc step to estimate the parameters associated with the latent parent process green 1995 moller and waagepetersen 2003 in contrast the proposed framework exploits the observed parent locations and proceeds without a complex birth death move algorithm the components of can then be updated by gibbs sampling exploiting conjugacies in the full conditionals or via metropolis hastings steps details in section b of the supplementary material one practical challenge is that the integral term in 3 does not have a closed form expres sion therefore we use monte carlo methods to approximate the integral for computational efficiency in practice the expression w kl u cl hl du can be thought of as the probability of occurrence of xl within the observation window w where xl is a bivariate real valued random variable with density kl cl hl furthermore in the proposed framework with thomas processes kl cl hl corresponds to a bivariate normal density function with mean cl and covariance matrix h 2 l i thus we draw samples from the bivariate normal distribu tion and compute the average proportion of points that fall within w which serves as an approximation to the integral term in 3 we further optimized the code by using c language based coding an user friendly version of the r software package is available in the online repository https github com suman m 47 po modeling git the implementation of the model in the r package can generate 10 000 scans in 1 5 minutes for a dataset with 150 points from a single parent process with a total of 750 points from two offspring processes on a dell latitude 7210 laptop with i 5 cores and 16 gigabytes of memory 3 4 model validation we assess goodness of fit of the models by comparing the observed and estimated counts of different entities specifically for the parent species the estimated intensity parameter cv v 1 p per unit area can be scaled by the area of the observation window c v w should be close to the number of the v th parent cells counted in the observation window for approximating the l th offspring count one can compute l c cl w kl u c hl du for l p 1 p q the integral term can be approximated by monte carlo method 8 as described in section 3 3 this expression involves both the offspring density param eter and the bandwidth parameter and therefore helps validate the joint estimate of the l hl pair in our example c w should provide a good estimate of the number of corynebacterium cells and 2 c c 2 w k 2 u c h 2 du 3 c c 3 w k 3 u c h 3 du and 4 c c 4 w k 4 u c h 4 du should provide good estimates of the observed number of strep tococcus clustered around corynebacterium the observed number of porphyromonas clus tered around corynebacterium and the observed number of pasteurellaceae clustered around streptococcus respectively 4 simulation studies 4 1 simulation set up we performed simulation studies to benchmark the performance of the macpp for sim plicity the unit square was taken as the observation window we generated data under the model outlined in section 3 with q 2 offspring taxa b and c around the same parent taxon a which was the only parent taxon p 1 we considered twelve data scenarios in table 1 that varied in terms of offspring density 2 3 bandwidth h 2 h 3 and presence of a taxon spatially unrelated to the multilayered arrangement hereinafter referred to as unrelated taxon throughout the scenarios the intensity of the parent process c 1 and that of the process for the unrelated taxon 4 were set to 150 and 95 respectively for each of the twelve scenarios we generated 100 images each analyzed as an independent dataset 4 2 analysis plan and hyperparameters we applied the following three approaches to each simulated dataset i the proposed macpp model multilayered taxa a b c were jointly analyzed in one framework ii a set of two univariate macpp models two separate group of taxa a b and a c were analyzed respectively iii a set of two univariate nsp models ignoring the parent taxon a only offspring taxa b and c were analyzed separately we applied the method of minimum contrast diggle 2013 using the r package spatstat baddeley et al 2015 the parameters estimated by the three approaches have different interpretations for ex ample the bandwidth parameter h 2 in nsp models from the analysis iii is interpreted as the distance scale for the unobserved cluster formed by the offspring taxon b ignoring the observed parent taxon a despite this distinction we included analysis iii using the nsp because it is among the most relevant cluster point process models applied to this class of problems in simulation studies we primarily focused on the numerical performance of the methods in estimating the parameters rather than on their interpretations for analyses i and ii we set the hyperparameters ay by ac bc a b to 0 01 the hyperparameter was set to 0 02 so that the 99 th percentile of the prior distribution of hl s 9 was approximately 0 05 i e 5 of the length of the observation window the posterior means were used as estimates of parameters we estimated the offspring intensity 2 3 and bandwidth parameters h 2 h 3 for the offspring processes taxa b and c and the intensity parameter c 1 for the parent process taxon a for the macpp the estimates are the average of the posterior mean for the parameters for each of the datasets in a given scenario we also computed the posterior standard deviation sd averaged over 100 datasets for each scenario as well as the empirical standard error se of the estimates for the different datasets with the nsp no uncertainty measure is available for the individual estimates for each dataset so we computed only the se for these estimates between different datasets however the nsp method failed to converge in multiple scenarios we report the percentage of instances where estimates of parameters are not reliable due to the numerical issue for each scenario therefore for the nsp the average estimates and se were computed based only on the datasets in which the model converged 4 3 primary results results were very similar between multivariate and univariate macpp models hereafter we refer to tabular results from the multivariate macpp analyses the macpp method performed well in estimating the true parameter values with both a small sd and a small se tables 2 and c 1 of supplementary materials the nsp method often failed to converge in up to 70 of datasets depending on the scenario when the nsp did converge it produced results that are nonsensical with ses too high to give any credibility to these estimates for both methods standard errors increased in the high bandwidth scenarios compared with the low bandwidth scenarios the parent process intensities were also captured better by the macpp than by the classical nsp especially in high bandwidth scenarios lastly performance of the macpp was not affected by the presence of a taxon spatially unrelated to the multilayered arrangement tables 2 and c 1 of supplementary materials 4 4 sensitivity analyses as outlined in section 3 2 we chose a half normal prior for the bandwidth parameter we conducted comprehensive sensitivity analyses detailed in section d of the supplementary materials to examine the extent to which conclusions are robust with respect to the choice of prior distribution for the bandwidth parameter in these analyses we compared parameter estimation performance under three different prior distributions half normal uniform log normal in summary the proposed framework was not sensitive to the choice of the prior distribution for the bandwidth parameter under scenarios with low bandwidth under high bandwidth data scenarios however elicitation of an informative prior seemed to help the proposed framework become more numerically stable increasing power 10 table 1 a summary of twelve simulation scenarios considered in section 4 the offspring density is controlled by setting 2 3 1 5 1 for sparse 4 3 for dense and 4 1 for mixed setting bandwidth low setting sets h 2 h 3 0 01 0 02 and the high setting sets it to 0 1 0 01 the setting unrelated taxon refers to whether there exists a taxon in the data spatially unrelated to the multilayered arrangement scenario unrelated taxon offspring density bandwidth 1 absent sparse low 2 absent sparse high 3 absent dense low 4 absent dense high 5 absent mixed low 6 absent mixed high 7 present sparse low 8 present sparse high 9 present dense low 10 present dense high 11 present mixed low 12 present mixed high 5 analysis of human microbiome biofilm image data 5 1 hyperparameters and analysis settings from the m 9 different taxa probed in the human dental plaque sample we analyzed the data for locations of three offspring taxa namely streptococcus porphyromonas and pasteurellaceae the parent taxon for the first two taxa is corynebacterium and for the third taxon it is streptococcus which itself is an offspring taxon figure 1 therefore according to the notations introduced in section 3 1 the process y 1 corresponding to corynebacterium which functions only as a parent taxon p 1 y 2 y 3 and y 4 represent the three offspring processes q 3 for streptococcus porphyromonas and pasteurellaceae respectively the corresponding parent processes are c 2 y 1 c 3 y 1 corynebacterium as a parent and c 4 y 2 streptococcus as a parent the remainder of the taxa are modeled as homogeneous poisson processes in the macpp analyses we set the hyperparameters at ay by ac bc a b 0 01 and at 2 06 such that the 99 th percentile for the bandwidth parameters was approximately 5 m streptococcus and porphyromonas clustered around corynebacterium only at its tip not along its length and not at its base figure 3 and mark welch et al 2016 because all parts of corynebacterium cells were observed in the image there is inhomogeneity in the clustering relationships thus we manually subset the dataset to create more homogeneous sub datasets in which we could test performance of the macpp we simply subset the image in four equally sized quadrants figure 5 and analyzed data from each quadrant independently taxa s abundance varied across the quadrants allowing for some comparison of performance table 3 the inclusion of black space where no taxa are observed can 11 table 2 the true value estimates and uncertainty measures for the parameters 2 3 h 2 h 3 c using macpp and nsp models for the first six scenarios for macpp the estimates est are the posterior means averaged over different datasets the sd is computed by averaging the posterior standard deviation over different datasets and se is computed as the standard deviation of the estimates over the datasets for nsp the esti mates est are the outputs of the minimum contrast method and se is calculated similarly using these estimates sd for nsp is not computed as the method does not provide an un certainty measure the last column f refers to the percentage of times the nsp model failed to converge in that particular scenario true macpp nsp scenario value est sd se est se f 2 1 50 1 54 0 10 0 11 2 34 7 71 3 1 00 1 03 0 08 0 09 1 97 6 84 1 h 2 0 01 0 01 0 01 0 01 0 01 0 04 6 h 3 0 02 0 02 0 01 0 01 0 70 6 43 c 150 00 164 07 13 16 13 28 170 78 52 51 2 1 50 1 50 0 11 0 11 291 16 383 69 3 1 00 1 02 0 08 0 08 1 06 0 40 2 h 2 0 10 0 08 0 01 0 01 8 33 23 82 26 h 3 0 01 0 01 0 01 0 01 0 01 0 01 c 150 00 162 74 13 05 13 52 679 72 2378 68 2 4 00 4 05 0 14 0 16 13 30 66 75 3 3 00 3 06 0 13 0 11 10 60 75 03 3 h 2 0 01 0 01 0 01 0 01 0 02 0 10 1 h 3 0 02 0 02 0 01 0 01 0 03 0 08 c 150 00 204 84 14 50 14 29 209 22 49 75 2 4 00 4 01 0 17 0 17 710 62 648 03 3 3 00 3 04 0 13 0 12 3 00 0 62 4 h 2 0 10 0 09 0 01 0 01 1 21 0 77 56 h 3 0 01 0 01 0 01 0 01 0 01 0 01 c 150 00 202 08 14 34 15 32 20 33 45 79 2 4 00 4 05 0 15 0 16 4 07 0 68 3 1 00 1 03 0 17 0 09 3 06 14 91 5 h 2 0 01 0 01 0 01 0 01 0 01 0 01 1 h 3 0 02 0 02 0 01 0 01 1 10 10 15 c 150 00 203 82 14 51 15 40 203 47 35 16 2 4 00 4 02 0 17 0 14 685 54 694 99 3 1 00 1 01 0 07 0 06 2 49 10 25 6 h 2 0 10 0 09 0 01 0 01 1 48 1 21 53 h 3 0 01 0 01 0 01 0 01 0 02 0 07 c 150 00 198 19 14 22 13 86 35 99 99 33 12 figure 5 division of the locations of the dental plaque sample image in first bottom left second top left third bottom right and fourth top right segments deflate density estimates and induce spurious spatial correlations we minimized unnecessary black space by using a convex hull of the observed locations as the analysis window figure 5 we also applied the classical nsp model individually on the three offspring processes streptococcus porphyromonas and pasteurellaceae for each of the four quadrants 5 2 results the macpp approach successfully identified the multilayered arrangement in which strepto coccus and porphyromonas clustered around corynebacterium and pasteurellaceae around streptococcus the estimated bandwidth parameters h 2 h 3 and h 4 for the four quadrants ranged between 7 62 11 23 m 7 23 15 21 m and 3 82 4 62 m respectively the corre sponding estimated offspring density parameters 2 3 and 4 were between 1 04 2 22 1 80 5 05 and 0 36 0 57 respectively the estimated intensity parameter for the process related to corynebacterium was 0 01 0 02 per unit area table 4 the estimates of inten sity parameters for the processes corresponding to the other taxa also varied among the 13 table 3 the abundance of different taxa of interest in the human dental plaque sample dataset and its subdivisions taxon quadrant total i ii iii iv actinomyces 119 280 154 223 776 capnocytophaga 512 755 574 573 2414 corynebacterium 58 219 186 245 708 fusobacterium 92 250 141 173 656 leptotrichia 191 411 234 339 1175 neisseriaceae 339 479 402 491 1711 pasteurellaceae 53 130 76 106 365 porphyromonas 227 525 269 420 1441 streptococcus 98 379 163 249 889 quadrants table e 3 the estimates for the parent intensity and the offspring density parameters varied among quadrants and among the parent offspring pairs the estimates for c in each quadrant were consistent with the observed counts for example in the second quadrant there are 219 observed corynebacterium cells and the estimated intensity parameter of 0 02 per unit area corresponds to a count of c w 219 for each of the three offspring taxa the esti mated counts matched the observed counts rounded to the nearest integer for example the estimated taxon counts for streptococcus porphyromonas and pasteurellaceae in the third quadrant comes out to be 163 269 and 76 respectively which matches the corresponding counts in table 3 the estimated bandwidth parameters h 2 h 3 and h 4 also varied by quadrant exhibiting con sistent patterns for the different offspring parent pairs across all quadrants for example the estimated bandwidth parameter for the process related to pasteurellaceae clustering around streptococcus was smaller than those estimated for the processes concerning streptococcus and porphyromonas clustering around corynebacterium the estimated bandwidth parame ters for the two processes that have corynebacterium as their parent process were especially high and more variable the nsp analysis of each of the offspring processes separately for each of the quadrants resulted in very low estimated bandwidth parameter values table 4 the nsp based estimated number of cluster centers parents was extremely low in fact underestimated compared with the observed number of parent cells on the other hand the corresponding estimates of offspring density parameters 2 3 and 4 from the nsp analyses were substantially larger than those from the macpp analysis 6 discussion and conclusion we have developed a multivariate multilayer adjusted model to estimate parent offspring clustering relationships the proposed macpp framework produces model parameters that directly quantify multilayered structural arrangements in which locations of one type of 14 table 4 the estimates and uncertainty measures for the parameters 2 3 4 h 2 h 3 h 4 c using macpp and nsp model for the four segments of the human dental plaque biofilm data for macpp the estmates est are the posterior means and sd is computed as the posterior standard deviation for each of the parameters for nsp the estimates are the output of the minimum contrast method sd is not computed for nsp as the method does not provide one macpp nsp segment est sd est 2 2 22 0 22 9 94 3 5 05 0 34 24 19 4 0 57 0 08 15 39 i h 2 8 32 0 56 2 88 h 3 7 23 0 50 2 55 h 4 3 82 0 40 9 39 c 0 01 0 01 0 01 2 1 98 0 10 41 89 3 2 91 0 13 35 43 4 0 36 0 03 10 12 ii h 2 11 23 0 58 7 07 h 3 15 21 0 79 4 57 h 4 4 23 0 46 6 72 c 0 02 0 01 0 01 2 1 04 0 08 9 34 3 1 80 0 11 18 66 4 0 52 0 06 3 78 iii h 2 7 62 0 71 3 36 h 3 9 83 0 72 1 92 h 4 4 50 0 43 2 67 c 0 02 0 01 0 01 2 1 22 0 08 32 29 3 2 11 0 11 51 56 4 0 46 0 05 9 93 iv h 2 9 41 0 81 5 84 h 3 11 09 0 72 4 14 h 4 4 62 0 42 4 42 c 0 02 0 01 0 01 15 object depend on locations of another central object this task cannot be achieved with a traditional nsp approach because it ignores the locations of parent objects in simula tion studies the macpp produced less bias and much lower empirical standard deviations for parameter estimates compared with the nsp model which produced rather nonsensical results although development of the proposed macpp model was motivated by oral mi crobiome biofilm image data the approach is not specific to biofilm and can be used for other biomedical nonclinical or nonbiological image applications we demonstrated feasibility and utility of the proposed method in application to real biofilm image data that exhibit complex arrangements with nine taxa broadly speaking the macpp successfully captured the multilayered corncob like structure among a group of four taxa despite the presence of five other spatially unclustered taxa yet the estimated bandwidth parameters were much greater than the approximately sub 5 micron distances expected from cell to cell or nearly cell to cell contact apparent in the visible corncob arrangements and likely when cells physico chemically interact because of this seeming discrepancy it could be tempting to conclude that the low parent offspring bandwidths esti mated from the nsp framework make the nsp a more valid and preferred approach than the macpp however because the classical nsp ignores the location of parent cells it highly underestimates the number of cluster centers parents to compensate it greatly overes timates the offspring density additionally in ignoring parent locations the nsp models self clustering instead of parent offspring clustering therefore though appealing the es timates produced by applying the nsp are not appropriate to quantify the multilayered intertaxon relationships we seek to investigate it would also be inappropriate to interpret the macpp s high average estimated parent offspring bandwidth strictly as bias or as reflecting a universal drawback to the proposed approach rather the seeming discrepancy suggests the need for careful interpretation of model parameters from such a complex heterogeneous image it also highlights a need for modifications to the approach if a simple direct interpretation about cell to cell parent to offspring contact is the goal two characteristics of the dental plaque biofilm data present particular challenges first cells of corynebacterium are filamentous when the locations of imputed centroids are used to estimate average distances to neighboring cells of a different taxon centroid based methods may give misleading estimates of true cell to cell distances this form of bias may be exacerbated by the specific biological organization in that the spherical offspring taxa streptococcus and porphyromonas cluster around only one end of the parent corynebac terium filaments estimates of average pasteurellaaceae streptococcus distances were much smaller and closer to the expected range for cell to cell contact likely because these clusters involved two types of similarly sized spherical organisms one way to improve the macpp performance therefore might be to model the shapes of cells by bi axial spheroids another might be to use outline based approaches such as the hausdorff distance huttenlocher et al 1993 rather than relying on the geographic coor dinates of imputed centroids to locate each filamentous cell nevertheless such complicated adaptations of the macpp are likely to be unnecessary if qualitative inference about the clustering arrangement suffices another option we are exploring is to condition models on 16 features empirically identified in the image limiting the macpp analysis only to parent or offspring cells within some short distance of each other e g radius 10 microns might improve its usefulness in similar applications compared with analyses yielding only marginal bandwidth estimates over a heterogeneous spatial structure a second challenge is higher order spatial structure such as is evident in the image of a dental plaque biofilm community among other reasons for macro level community struc ture the environment at the outer edge of dental biofilm differs from that near the tooth surface image sampling and processing further contribute to heterogeneity especially in that the image is of a two dimensional slice from a three dimensional structure some ar eas of the image have a higher concentration of cross sections in which corynebacterium cells themselves appear spherical whereas other areas display large numbers of lengthwise corynebacterium filaments for the purposes of pilot testing model performance we divided the image into four quadrants each with more homogeneous spatial patterns than the whole between quadrant variability in parameter estimates from both the macpp and nsp ap proaches suggest this approach was helpful however for many applications this ad hoc approach is unlikely to be sufficient and better subsetting methods could be considered even more powerful would be incorporation of the macpp into a broader modeling frame work that could capture higher order spatial structure for example through regression pa rameters the proposed model in 1 is flexible in that it can accommodate different standard modeling frameworks for example one can choose the form of i s i 1 m and re place the homogeneous poisson process components in 2 by multivariate log gaussian cox process components such an extension would enable the characterization and quantification of more complex spatial correlation structures among multiple taxa or other types of objects we are actively pursuing this line of model development a further avenue that will enhance usefulness of the approach is development of a meta analytic approach to combine data from multiple images in 100 sampled images of tongue biofilm from five donors both within sample and across sample variability of inter taxon spatial relationships is apparent this variability can be quantified via a meta analytic multivariate log gaussian cox process model that we have developed manuscript in prepa ration to date it has not been standard to apply formal unified models to combine data across multiple biomedical images instead most practitioners have relied on post hoc com parisons such as through anova or non parametric two group comparisons an efficient meta analytic approach would increase the scope and applicability of the proposed method and would help in development of spatial analysis of multiple microbiome samples in general and may therefore prove to be a more fruitful line of model development model validation for macpp is not straightforward the complex spatial structure does not permit out of sample prediction or split sample cross validation in the context of traditional bayesian point process models the empirical spatial distributions can be compared with those based on posterior predictive samples leininger and gelfand 2017 however this observed versus expected approach is challenged by the complexity of the data residuals for each of the sub processes in 2 are easily obtained yet a good match of observed and expected counts for one process can be misleading about overall model fit if another process is poorly estimated this is exactly what happened with the nsp analysis of real data 17 where offspring predicted counts were accurate and predicted parent counts were grossly underestimated in contrast the macpp produced nearly perfect prediction of counts of different taxa in the observation window to our knowledge there is as yet no valid method to combine the multiple residuals to produce a summary statistic reflecting overall goodness of fit we have proposed a novel macpp method for quantifying multilayer multivariate spatial relationships that we applied to analyze spatial arrangements of microbial cells in dental plaque biofilm image data the proposed method exploits information about locations of objects at the center of a cluster of unlike objects providing distinct advantages over the classic nsp model when parent information is available the macpp clearly outperformed the existing cluster point process model in every scenario in our numerical studies references adrian baddeley ege rubak and rolf turner spatial point patterns methodology and applications with r crc press 2015 carlos g bornancini he ctor j mart nez diego g lambas wim de vries wil van breugel carlos de breuck and dante minniti clustering and light profiles of galaxies in the environment of 20 ultra steep spectrum radio sources the astronomical journal 127 2 679 2004 carlos g bornancini nelson d padilla diego g lambas and carlos de breuck spatial clustering of ultra steep spectrum sources and galaxies monthly notices of the royal astronomical society 368 2 619 622 2006 julie bourque and andre desrochers spatial aggregation of forest songbird territories and possible implications for area sensitivity avian conservation and ecology 1 2 2006 sung nok chiu dietrich stoyan wilfrid s kendall and joseph mecke stochastic geometry and its applications john wiley sons 2013 peter j diggle statistical analysis of spatial and spatio temporal point patterns crc press 2013 peter j green reversible jump markov chain monte carlo computation and bayesian model determination biometrika 82 4 711 732 1995 gary j hill and simon j lilly a change in the cluster environments of radio galaxies with cosmic epoch the astrophysical journal 367 1 18 1991 daniel p huttenlocher gregory a klanderman and william j rucklidge comparing images using the hausdorff distance ieee transactions on pattern analysis and machine intelligence 15 9 850 863 1993 janine illian antti penttinen helga stoyan and dietrich stoyan statistical analysis and modelling of spatial point patterns volume 70 john wiley sons 2008 18 abdollah jalilian yongtao guan jorge mateu and rasmus waagepetersen multivariate product shot noise cox point process models biometrics 71 4 1022 1033 2015 sheila j jones a special relationship between spherical and filamentous microorganisms in mature human dental plaque archives of oral biology 17 3 613 in 27 1972 ji r kopecky and toma s mrkvic ka on the bayesian estimation for the stationary neyman scott point processes applications of mathematics 61 4 503 514 2016 thomas j leininger and alan e gelfand bayesian inference and model assessment for spatial point patterns using posterior predictive samples bayesian analysis 12 1 1 30 2017 jessica l mark welch blair j rossetti christopher w rieken floyd e dewhirst and gary g borisy biogeography of a human oral microbiome at the micron scale proceedings of the national academy of sciences 113 6 e 791 e 800 2016 sj melles d badzinski m j fortin f csillag and k lindsay disentangling habitat and social drivers of nesting patterns in songbirds landscape ecology 24 4 519 531 2009 jesper m ller shot noise cox processes advances in applied probability 35 3 614 640 2003 jesper moller and rasmus plenge waagepetersen statistical inference and simulation for spatial point processes crc press 2003 jesper m ller anne randi syversveen and rasmus plenge waagepetersen log gaussian cox processes scandinavian journal of statistics 25 3 451 482 1998 jerzy neyman and elizabeth l scott statistical approach to problems of cosmology journal of the royal statistical society series b methodological 20 1 1 29 1958 dasith perera anthony mclean viviana morillo lopez kaileigh cloutier leblanc eric almeida kiana cabana jessica l mark welch and matthew m ramsey mechanisms underlying proximity between oral commensal bacteria biorxiv 2020 johannes schindelin ignacio arganda carreras erwin frise verena kaynig mark longair tobias pietzsch stephan preibisch curtis rueden stephan saalfeld benjamin schmid et al fiji an open source platform for biological image analysis nature methods 9 7 676 682 2012 ushio tanaka and yosihiko ogata identification and estimation of superposed neyman scott spatial cluster processes annals of the institute of statistical mathematics 66 4 687 702 2014 scott a tarof and laurene m ratcliffe habitat characteristics and nest predation do not explain clustered breeding in least flycatchers empidonax minimus the auk 121 3 877 893 2004 19 martin vorregaard comstat 2 a modern 3 d image analysis environment for biofilms master s thesis citeseer 2008 mg yates l miller and ja peacock the cluster environments of powerful high redshift radio galaxies monthly notices of the royal astronomical society 240 1 129 166 1989 20 supplementary materials for multilayer adjusted cluster point process model application to microbial biofilm image data suman majumder harvard t h chan school of public health boston massachusetts u s a brent a coull harvard t h chan school of public health boston massachusetts u s a jessica l mark welch marine biological laboratory woods hole massachusetts u s a patrick j la riviere university of chicago chicago illinois u s a floyd e dewhirst the forsyth institute cambridge massachusetts u s a jacqueline r starr brigham and women s hospital boston massachusetts u s a kyu ha lee harvard t h chan school of public health boston massachusetts u s a 1 ar x iv 2 20 2 04 19 8 v 1 st at a p 8 f eb 2 02 2 contents a images of the remaining taxa from the human dental plaque biofilm data 3 b computational details of the sampling algorithm 4 b 1 updating parameters associated with offspring densities 4 b 2 updating intensity parameters in homogeneous poisson processes 4 b 3 updating bandwidth parameters 4 c table of estimates for the remaining scenarios from the simulation study 5 d sensitivity analyses 7 e table of macpp based parameter estimates for the remaining taxa in dental plaque biofilm data 8 2 a images of the remaining taxa from the human dental plaque biofilm data additional images for distribution of neisseriaceae capnocytophaga actinomyces fusobac terium and leptotrichia in the human dental plaque sample are presented here in figure a 1 there are no particular pattern in any of them except eubacterium and therefore they were modeled as homogeneous poisson process in the data analysis eubacterium was used for probing and therefore takes the shape of every available structure it was excluded from the analysis figure a 1 rgb images of neisseriaceae top left capnocytophaga top middle actino myces top right fusobacterium bottom left leptotrichia bottom middle and eubac terium bottom right distribution in the dental plaque sample eubacterium was used for probing and hence is left out of the analysis the other taxa presented here are scattered randomly over the region 3 b computational details of the sampling algorithm we use a markov chain monte carlo mcmc method to draw samples from the joint pos terior distribution of in the mcmc scheme parameters are updated by either exploiting conjugacies inherent to the proposed model or using a metropolis hastings algorithm b 1 updating parameters associated with offspring densities let denote a set of parameters with removed the full conditional distribution for l l p 1 p q is l l gamma ay nl by cl cl w kl u cl hl du where nl is the number of observations in the window of taxon l b 2 updating intensity parameters in homogeneous poisson pro cesses posterior conjugacy is also achieved in the full conditional distributions of intensity param eters cv v 1 p and j j p q 1 m which are given by cv c v gamma ac nv bc w v 1 p j j gamma a nj b w j p q 1 m where nv and nj are the numbers of observations for taxon v and taxon j within the window respectively b 3 updating bandwidth parameters since the full conditionals of the bandwidth parameters do not have standard forms we use a random work metropolis hastings step to update each of hl l 1 p given h t j the sample for hj j p 1 p q from iteration t for iteration t 1 we propose a candidate sample h j as a random draw from n h t j 2 prop where 2 prop is the prespecified variance of the proposal density the corresponding acceptance ratio computes to be r exp l cl cl w k u cl h j du y yl cl cl w k u cl h j exp h 2 j 2 2 i h j 0 exp l cl cl w k u cl h t j du y yl cl cl w k u cl h t j exp h t 2 j 2 2 then we accept the proposed candidate h j as h t 1 j with probability min r 1 or keep h t 1 j h t j 4 c table of estimates for the remaining scenarios from the simulation study here we present results from the simulation study of cases 7 through 12 as numbered in table 1 of the main manuscript the results in table c 1 tell a similar story as in section 4 the macpp performs much better compared to the nsp in terms of both estimating the model parameters as well as producing credible uncertainty quantification nsp often fails to converge and produces nonsensical results 5 table c 1 the true value estimates and uncertainty measures for the parameters 2 3 h 2 h 3 c using macpp and nsp models for the last 6 scenarios for macpp the estimates est are the posterior means averaged over different datasets the sd is computed by averaging the posterior standard deviation over different datasets and se is computed as the standard deviation of the estimates over the datasets for nsp the esti mates est are the outputs of the minimum contrast method and se is calculated similarly using these estimates sd for nsp is not computed as the method does not provide an un certainty measure the last column f refers to the percentage of times the nsp model failed to converge in that particular scenario true macpp nsp scenario value est sd se est se f 2 1 50 1 53 0 10 0 10 1 46 0 33 3 1 00 1 02 0 08 0 09 3 31 20 25 7 h 2 0 01 0 01 0 01 0 01 0 01 0 01 2 h 3 0 02 0 02 0 01 0 01 0 04 0 09 c 150 00 161 06 12 91 12 20 171 35 34 72 2 1 50 1 48 0 11 0 09 198 46 283 69 3 1 00 1 02 0 08 0 09 0 98 0 28 8 h 2 0 10 0 08 0 01 0 01 10 30 28 72 36 h 3 0 01 0 01 0 01 0 01 0 01 0 01 c 150 00 160 25 12 86 12 57 939 70 2777 40 2 4 00 4 02 0 14 0 15 8 77 48 78 3 3 00 3 05 0 13 0 13 2 91 0 77 9 h 2 0 01 0 01 0 01 0 01 0 02 0 08 0 h 3 0 02 0 02 0 01 0 01 0 02 0 01 c 150 00 202 78 14 38 14 29 208 52 39 37 2 4 00 4 00 0 17 0 17 613 34 569 20 3 3 00 3 02 0 13 0 14 2 93 0 53 10 h 2 0 10 0 09 0 01 0 01 1 15 0 64 48 h 3 0 01 0 01 0 01 0 01 0 01 0 01 c 150 00 200 49 14 26 14 48 13 30 28 78 2 4 00 4 05 0 15 0 14 18 45 87 48 3 1 00 1 00 0 07 0 08 2 05 10 04 11 h 2 0 01 0 01 0 01 0 01 0 03 0 11 0 h 3 0 02 0 02 0 01 0 01 0 47 4 41 c 150 00 201 50 14 37 14 09 203 36 53 30 2 4 00 4 02 0 17 0 17 547 61 553 61 3 1 00 1 02 0 07 0 07 0 97 0 24 12 h 2 0 10 0 09 0 01 0 01 1 04 0 82 70 h 3 0 01 0 01 0 01 0 01 0 01 0 01 c 150 00 199 05 14 23 15 95 26 62 41 46 6 d sensitivity analyses we perform sensitivity analyses based on the simulated datasets used in section 4 for the sensitivity analysis we only looked at two scenarios numbered 5 and 6 in table 1 in the main paper these scenarios allow us to judge the performance of the model both high and low offspring densities as well as in scenarios where the parent offspring clustering is tight or loose since we are interested in testing the prior sensitivity of the bandwidth parameters we used 4 different choices for the prior distribution of the bandwidth parameters namely 1 half normal prior 2 uniform prior 3 log normal prior with a flat tail and high variance and 4 log normal prior with a slim tail and higher peak for the uniform prior the lower and upper bounds were taken to be 0 and 0 2 both the log normal priors had log 0 05 but the flat tailed one had 1 while the high peaked one had 0 1 as their hyperparameter setting the hyperparameter setting for the half normal prior was the same as in section 4 we report the mean absolute percentage bias for estimating the corresponding parameters in the two scenarios for the four different prior settings the half normal prior based macpp works best and the performance is similar to what was observed in section 4 when the true bandwidth is low all the models irrespective of prior choice work great and their performances are similar to each other but when the true bandwidth is high clearly having a tighter prior helps table d 2 however having an informative log normal prior backfired for even low bandwidth scenario when the offspring density is low as is the case for the second offspring process further sensitivity analysis on choice of parameter for the log normal prior may be needed to understand its effects table d 2 mean absolute percentage bias for estimating parameter values of 1 2 h 1 h 2 and c based on posterior means of each of the 100 datasets for different choices of priors for the bandwidth parameters for macpp when there is no extra taxon present in the data and when the first offspring process has true offspring density set at 4 while the for the second one it is 1 setting low bwd means when both h values are small while in high bwd h 1 is high but h 2 is low log normal flat refers to the prior setting where a flat tailed log normal prior was used for the bandwidth parameters while log normal tight refers to the scenario where the said log normal prior was tight and more informative half normal uniform log normal flat log normal tight 1 0 03 0 03 0 03 0 03 low 2 0 07 0 07 0 07 0 07 bwd h 1 0 02 0 02 0 02 0 05 h 2 0 04 0 04 0 04 0 24 c 0 06 0 06 0 06 0 06 1 0 03 0 31 0 52 0 03 high 2 0 05 0 05 0 05 0 05 bwd h 1 0 09 0 99 1 37 0 10 h 2 0 03 0 03 0 03 0 20 c 0 06 0 06 0 06 0 06 7 e table of macpp based parameter estimates for the remaining taxa in dental plaque biofilm data table e 3 estimates for parameters associated with neisseriaceae 5 capnocytophaga 6 actinomyces 7 fusobacterium 8 and leptotrichia 9 obtained by applying the proposed method on each of the four segments of the dental plaque sample image all results are rounded to two decimal places the standard errors were all smaller than 0 01 and hence are not reported separately 5 6 7 8 9 segment 1 0 04 0 06 0 01 0 01 0 02 segment 2 0 05 0 07 0 03 0 02 0 04 segment 3 0 04 0 05 0 01 0 01 0 02 segment 4 0 05 0 06 0 02 0 02 0 03 8