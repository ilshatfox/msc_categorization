ar x iv 1 90 4 05 63 6 v 1 st at m e 1 1 a pr 2 01 9 robust principal component analysis for compositional tables j rendlova 1 k hron 1 k fac evicova 1 and p filzmoser 2 1 department of mathematical analysis and applications of mathematics faculty of science palacky university olomouc czech republic 2 institute of statistics and mathematical methods in economics vienna university of technology vienna austria abstract a data table which is arranged according to two factors can often be considered as a com positional table an example is the number of unemployed people split according to gender and age classes analyzed as compositions the relevant information would consist of ratios between different cells of such a table this is particularly useful when analyz ing several compositional tables jointly where the absolute numbers are in very different ranges e g if unemployment data are considered from different countries within the framework of the logratio methodology compositional tables can be decomposed into in dependent and interactive parts and orthonormal coordinates can be assigned to these parts however these coordinates usually require some prior knowledge about the data and they are not easy to handle for exploring the relationships between the given factors here we propose a special choice of coordinates with a direct relation to centered logratio clr coefficients which are particularly useful for an interpretation in terms of the original cells of the tables with these coordinates robust principal component analysis pca is performed for dimension reduction allowing to investigate the relationships between the factors the link between orthonormal coordinates and clr coefficients enables to apply robust pca which would otherwise suffer from the singularity of clr coefficients keywords compositional data compositional table robust principal component anal ysis independence table interaction table pivot coordinates 1 http arxiv org abs 1904 05636 v 1 1 introduction many practical data sets e g in economics 11 12 biology 18 5 or sociology 7 27 consist of observations which contain inherently relative information about the distribu tion according to two factors from a mathematical perspective this leads to a two factorial extension of vector compositional data 1 30 carrying information about a re lationship between and within these row and column factors in 7 it was shown that such a structure called a compositional table x x x 11 x 1 j xi 1 xij xij 0 i 1 i j 1 j 1 can be decomposed into its independent and interactive parts where their separate analysis can be advantageous for further interpretation concerning both factors and their relation ships similar as compositional data compositional tables are driven by the aitchison geometry 28 which inhibits a direct application of multivariate statistical tools instead an appropriate coordinate representation needs to be established first to map the infor mation from the aitchison geometry into the real space such a coordinate system and a decomposition into independent and interactive parts were proposed in 12 a common primary task in multivariate statistics is to reduce the dimensionality of the data at hand done using principal component analysis pca as stated above in case of compositional data and consequently also compositional tables this needs to be done in a proper coordinate representation that maps the aitchison geometry of compositions to a standard euclidean geometry 28 to eliminate the influence of outlying observations in pca in 15 it was proposed to estimate the covariance matrix for robust pca by the minimum covariance determinant mcd estimator 23 since centered logratio clr coefficients 1 that aggregate relative information on single compositional parts lead to singularity and are not appropriate for most robust methods including the mcd estimator loadings and scores of pca need to be computed from isometric logratio ilr coordinates 9 of the compositional data and then transformed back to clr coefficients for a better interpretation of the resulting compositional biplot accordingly the aim of this paper is to generalize the previous considerations on di mension reduction of vector compositional data and to propose a robust approach to principal component analysis of compositional tables in sections 2 and 3 the logratio methodology of vector compositional data and their dimension reduction using principal component analysis respectively are briefly reviewed compositional tables and their interpretable processing using robust pca are introduced in section 4 the new method ology is illustrated in sections 5 and 6 on real data sets from oecd statistics using the statistical software r namely the robcompositions package data from several dif ferent countries containing unemployment information with gender distribution and age structure are processed as a set of 2 4 compositional tables therefore a robust com positional biplot is a possible tool to analyze the distribution of unemployment rates in these countries as well as gender and age differences data from the area of education carrying relative information about fields of study and the resulting degree in given coun 2 tries are approached as larger 3 8 compositional tables and results for men and women are compared 2 logratio methodology of compositional data in many applications the relative structure of the observations is more interesting than the absolute values of their components for example when considering numbers of students attending bachelor master and doctoral studies at different universities the ratios among these three groups might be more relevant for a statistical analysis than just the empirical values which might not be comparable because of different total student numbers in other words the actual total number of students sufficiently high so that the impact of a measurement error with small sample sizes can be neglected might be considered as not informative for the purpose of the analysis however to work with quantitatively described contributions on a given whole in a concise and meaningful manner some concepts need to be introduced first a positive row vector x x 1 x 2 xd is defined to be a d part composition if it carries relative information i e the ratios between the components are informative 1 30 any compositional vectors with equal number of parts are considered to be representatives of the same equivalence class if one vector is obtained from another by a positive scalar multiplication 30 accordingly equivalence classes of compositional data are represented without loss of information in a d part simplex sd x x 1 xd xi 0 i 1 d d i 1 xi 2 for any 0 the choice of being 1 for proportions and 100 for percentages is irrele vant for the analysis and can also vary throughout the compositional data set formally the closure operation c x x 1 d i 1 xi x 2 d i 1 xi xn d i 1 xi 3 can be applied to rescale the data to a given constant sum representation accord ingly the d part simplex is a sample space of representatives of equivalence classes of compositions the constant sum representation is useful e g for a comparison of several compositions from a sample as an interesting consequence possibly deviating outlying observations from the main data cloud are characterized by aberrant ratios rather than by significantly high or low absolute values of components 16 as mentioned above relevant information in data with compositional nature is con tained only in ratios consequently results of statistical processing should not depend on the sum of compositional parts and instead of euclidean distances relative differences are used to express distances between observations this principle called scale invariance is the first of three basic compositional principles 30 often the original data contain some non informative part s in the compositional vector that are not of interest hence we do not expect any change of results concerning the respective subcomposition when 3 these parts are removed from the data subcompositional coherence is a principle stating that results obtained from a d part subcomposition d d are not in contradiction with results obtained by an analysis of the original d part composition finally permutation invariance states that the results are independent from a chosen order of parts within the composition an expectable assumption for any reasonable statistical processing due to the above principles and the relative scale of compositional data the euclidean geometry needs to be replaced with the aitchison geometry 9 operations of perturbation and power transformation being analogous to a sum of two vectors and a multiplication of a vector by a scalar in the real euclidean geometry are defined as x y x 1 y 1 xdyd x x 1 x d 4 where x and y are d part compositions and is a real constant accordingly opera tions of perturbation and power transformation form a d 1 dimensional vector space sd 30 to obtain euclidean vector space structure the aitchison inner product norm and distance are defined for d part compositions x and y as x y a 1 2 d d i 1 d j 1 ln xi xj ln yi yj x a x x a da x y x y a 5 respectively where x y x 1 y given the introduced specifics of compositional data endowed with the aitchison ge ometry standard multivariate statistical methods cannot be applied directly on raw data it is advisable to employ the working on coordinates principle that is to represent the compositional data in real coordinates before starting with a statistical analysis 29 24 there are two types of isometric coordinate representations with respect to the aitchison geometry centered logratio coefficients 1 are defined as clr x ln x 1 g x ln x 2 g x ln xd g x 6 where g x stands for the geometrical mean of the whole composition each clr coefficient aggregates all pairwise logratios with a given compositional part thus enabling for a simple and meaningful interpretation in terms of dominance of that part with respect to the other parts on average consequently clr coefficients are useful for a graphical interpretation of compositional data including compositional biplots as a result of a dimension reduction using pca 2 on the other hand clr coefficients sum up to zero which leads to a singular covariance matrix being inappropriate for processing using common robust statistical methods 15 16 fortunately isometric logratio coordinates z rd 1 representing orthonormal coor dinates with respect to the aitchison geometry can be derived as z ilr x x e 1 a x e 2 a x ed 1 a 7 4 where d part compositions ei c ei 1 e i 2 e i d i 1 d 1 form an orthonormal basis on the simplex obviously the interpretation of ilr coordinates might be more tricky than in the case of clr coefficients as there are infinitely many possibilities of constructing ilr coordinates depending on the choice of basis vectors ei i 1 d 1 sequential binary partitioning sbp of compositional parts is one possibility for providing a meaningful choice of ei for the practitioner which is corresponding to the prior knowledge about compositions and resulting in coordinates called balances 8 moreover there is a linear transformation between ilr coordinates and clr coefficients done through a d d 1 matrix v of clr representations of the ilr basis vectors clr x v z clr e 1 t clr e 2 t clr ed 1 t ilr x 8 recently pivot coordinates 17 19 z l i d i d i 1 ln x l i d i d j i 1 x l j 9 were introduced as a special case of ilr coordinates they are appropriate especially in situations where no prior knowledge about how to perform sbp is available e g in 3 4 6 21 here x l i refers to the i th part of the re ordered composition xl x 1 xl 1 xl 1 xd which can be rewritten as x l 1 x l 2 x l l x l l 1 x l d in each of the d coordinate systems a permutation of compositional parts needs to be performed so that the l th part of x l 1 d stands at the first position accordingly the first pivot coordinate in each system z l 1 then clearly explains all relative information about part xl and additionally it is proportional to the respective clr coefficient clr x l l d d 1 z l 1 10 the expression 8 holds also for pivot coordinates which is particularly useful in the context of this paper 3 robust principal component analysis for composi tional data when dealing with large scale data sets dimension reduction is often of primary interest pca is one of the widely used methods for this purpose also in a compositional approach converting possibly correlated original variables from the data at hand into a smaller set of linearly uncorrelated variables called principal components pcs additionally the first component accounts for the largest variance of the given data the second one for a maximum of the remaining variance etc under the constraint of being orthogonal to all the previous principal components 20 the covariance matrix c estimated from a real data matrix x can be spectrally decomposed into c glgt 11 5 where g is a matrix of eigenvectors and l represents a diagonal matrix of eigenvalues of c it is then possible to define the pca transformation as x x 1 tt g 12 where t is the location estimator and 1 is a vector of ones with length n the columns of the matrix x the coordinates of the principal components are called scores and the columns of g containing the respective basis vectors are called loadings typically only the first few principal components are considered for further analysis taking into account only two pcs a graphical outcome called biplot can depict both loadings as arrows and scores as points in one plot where associations can be revealed it is common to take t as the arithmetic mean and c as the sample covariance matrix however both are very sensitive to outlying observations robust alternatives can be obtained by using the minimum covariance determinant mcd estimators of location and covariance 23 however this approach inquires working in ilr coordinates to obtain full rank data in order to get the mcd estimate of the covariance matrix and the respective matrix of eigenvectors g in addition ilr coordinates ensure subcompositional coherence and enable to keep affine equivariance of the results to the change of basis accordingly robust principal component analysis of compositional data based on the mcd estimator requires ilr coordinates zi as an input and the scores z i are given by z i g t zi t 13 once pca is performed the loadings can be transformed back to clr coefficients as gclr v g accounting for compositional biplot construction with meaningful interpretation whereas the scores remain identical and only a column of zeros is added to the end clr coefficients are also worth as such for their simple construction as an amalgamation of pairwise logratios of a given part due to the zero sum constraint of clr coefficients their covariance structure is distorted thus the interpretation of the biplot in terms of the correlation between coefficients through angles between arrows might be misleading instead the focus is on links between vertices of arrows as they stand for a proportionality between the original compositional parts 2 on the other hand due to the link with pivot coordinates the single clr variables or the respective loadings can be used to identify observations with a high dominance of the respective parts in a compositional vector 22 4 compositional tables compositional tables describe quantitatively relative contributions to a given whole that is distributed according to two row and column factors mathematically this leads to a two factorial extension of vector compositional data carrying information about a relationship between these factors a compositional table 1 thus can be represented e g either as a contingency table with sufficiently high numbers of counts in the cells or as a table of the same order with ml estimates of the respective probabilities due 6 to scale invariance the relative information contained in the ratios between the cells is the same in both cases 7 10 hence the concept of compositional tables 1 covers both the discrete case of contingency tables and its continuous counterpart e g input output tables see 11 nevertheless in the compositional context a concrete table represents usually just one realization in a sample from a multivariate continuous distribution due to the decision to treat the data from such a distribution compositionally the possible order of the factor categories e g age levels is ignored making this a relevant subject for future research since compositional tables form a direct extension of vector compositional data all the principles and operations introduced in section 2 apply up to some minor modifications due to the two factorial structure of the tables accordingly the closure operation c x x 11 i j xij x 1 j i j xij xi 1 i j xij xij i j xij 14 is used to represent a compositional table x in an ij part simplex sij of vectorized tables vec x x 11 xi 1 xij perturbation x y powering x and the aitchison inner product x y a of two tables x y and a real number can be defined analogously 7 10 x y x 11 y 11 x 1 jy 1 j xi 1 yi 1 xijyij x x 11 x 1 j x i 1 x ij x y a 1 2 ij i j k l ln xij xkl ln yij ykl 15 it is straightforward to derive that the dimension of the simplex sij is ij 1 corre sponding to the dimensionality of i j compositional tables permutation invariance and subcompositional coherence are valid with respect to the two factors of the compositional tables allowing to permute and discard entire rows or columns only to analyze compositional tables it is beneficial to work also with the so called indepen dence and interaction tables these can be obtained through an orthogonal decomposition 7 x xind xint 16 here the independence table is constructed to extract all the relative information about row and column factors under the assumption that the original compositional table is a product of its row and column geometric marginals and the interaction table contains information about the relationships between the row and column factors therefore in case of actual independence in the data at hand in the above sense all the entries of the interaction table are the same since there is no remaining information left in the data 7 after the decomposition the interaction table thus forms a neutral element with respect to the aitchison geometry of compositional tables otherwise the interactive part describes the nature of the deviation from an independent situation needless to say analyzing each of these new tables separately allows for a deeper insight into the original data it turns out that the introduced decomposition can be easily derived from row and column projections of the compositional table onto marginal subspaces for further details see 7 row x g x 11 x 1 j g x 11 x 1 j g xi 1 xij g xi 1 xij 17 col x g x 11 xi 1 g x 1 j xij g x 11 xi 1 g x 1 j xij 18 where g denotes the geometric mean of the cells in the argument and stands for orthogonality of the projections recalling the case of independence in probability tables it is instant to get the inde pendence table simply by perturbing both these projections xind row x col x from 16 it follows that the interaction table is just a decomposition remainder in xint x xind for practical calculations the following formulas are used to obtain the single entries of these tables xindij i k 1 j l 1 xkjxil 1 ij i k 1 xkj 1 i j l 1 xil 1 j xintij i k 1 j l 1 xij xkjxil 1 ij 19 it is crucial to realize that the dimensions of xind and xint lower to i j 2 for the inde pendence tables which follows immediately from the dimensions of the row and column projections being respectively i 1 and j 1 and to i 1 j 1 for the interaction tables which is easily obtained from the orthogonality of the decomposition as stated in the previous sections a coordinate representation which respects the sample space dimensionality is needed to perform robust pca of compositional data in case of compositional tables and particularly their decomposed parts a generaliza tion of balance coordinates needs to consider two sbps according to each factor 13 even for moderate numbers of rows and columns the interpretation of this coordinate representation gets rather complex without a deeper expert knowledge therefore only a two factorial alternative to pivot coordinates is usually used in practice 12 13 inter estingly the coordinates of the entire compositional table can be divided into two groups according to the dimensionality of the independence and interaction tables respectively this becomes the main advantage also when using pivot coordinates for robust pca since it allows for a comparison of the results from the whole table and its decomposed parts 8 generally there are three types of pivot coordinates corresponding to the row column and odds ratio partitioning of the compositional table 12 the first two types together form a coordinate representation of the independence table the third one is used for the interaction table altogether they form a coordinate representation of the original compositional table in case of row and column types of coordinates the entire first row or column respectively is taken as the pivot element and separated from the rest in the next step this pivot is not considered anymore and the following row or column is taken as the new pivot element and so on until the following i j 2 coordinates are obtained zri i i j 1 i i ln g xi g xi 1 g xi 1 i i i 1 i 1 20 zcj i j j 1 j j ln g x j g x j 1 g x j 1 j j j 1 j 1 21 where g xi and g x j stand for the geometric mean of the i th row and j th column respectively the process of obtaining the remaining i 1 j 1 coordinates is based on a division of the original compositional table into four blocks say upper left a upper right b lower left c and lower right d where a contains always just one pivot cell indexed by rs the odds ratio interpretation should be now easily seen from the following formula where the elements of blocks a and d are in the numerator and the elements of blocks b a c in the denominator of the logratio zorrs 1 i r j s i r 1 j s 1 ln i i r 1 j j s 1 xijxrs xisxrj 22 to obtain all coordinates of the odds ratio type in a proper order corresponding to the zr and zc coordinates the position of the pivot cell is moving firstly by rows with fixed first column r 1 i 1 then by columns with fixed last row s 1 j 1 and afterward the row position is always leveled back down by one and the column position moves again from 1 to j 1 for the given row until all sizes of the r s table are covered for the sake of completeness permutations of the entire rows or columns following the same principle as stated in section 2 could be performed hereby for all combinations of rows and columns different coordinate systems consisting of z r k i z c l j and z or kl rs where kl k 1 i l 1 j defines row and column permuted to the pivot position within the whole table would be gained 12 following 10 also the first coordinates of the three types from each system can then be expressed as proportional up to a constant to respective clr coefficients clr xind kl i 1 ij z r k 1 j 1 ij z c l 1 23 clr xint kl i 1 j 1 ij z or kl 11 24 9 which is an important fact for the interpretation of the analysis the resulting clr coeffi cients computed originally from the elements of the independence and interaction tables clr xind ij ln xindij g xind clr xint ij ln xintij g xint 25 can thus be expressed also in terms of cells of the input compositional table as clr xind ij ln g xi g x j g x 2 clr xint ij ln xijg x g xi g x j 26 where g xi g x j and g x stand for the geometric mean of the i th row the j th column and the whole compositional table and its independent and interactive counter parts respectively as a consequence each clr xind ij expresses a dominance of a given combination of factor values in case of independence this dominance is then either amplified or weakened according to the interaction table which depends on whether the interaction is shifted in a positive or a negative direction the interaction table refers also to sources of departures from independence nevertheless the information obtained only from clr xint ij does not provide a complete picture about the dominance of the respective cell to all other averaged cells furthermore note that each coordinate clr xind ij is formed by the sum of clr coeffi cients of the respective row and column marginals 1 j j clr xind ij ln gi g and 1 i i clr xind ij ln g j g which amount to zero thus there are only i j 2 linearly independent clr coefficients reflecting the dimensionality of the sample space of independence tables again a similar feature holds also for clr coefficients of interaction tables that sum up to zero across each row or column consequently in the case of an interaction table the number of linearly independent clr coefficients reduces to i 1 j 1 since this dependency makes it impossible to use the clr coefficients for the robust pca of independence and interaction tables the strategy to perform robust pca for compositional tables is the same as in case of vector compositional data pca loadings and scores are computed in ilr coordinates and then back transformed using relation 8 to the clr space where the loadings can be interpreted in terms of dominance of single cells here clr coefficients of basis vectors for rows er columns ec and interactions eor forming the columns of the matrix v are defined as follows clr er i i i i 1 j for the elements in pivot row i 1 i i 1 j i i for the elements in rows i 1 i 0 otherwise 27 clr ec j j j j 1 i for the elements in pivot column j 1 i i 1 j i i for the elements in columns j 1 j 0 otherwise 28 and 10 clr eor 1 rs r 1 s 1 for the elements on positions i r 1 i j s 1 j r 1 s 1 rs for the pivot elements rs r 1 rs s 1 for the elements in pivot row r j s 1 j s 1 rs r 1 for the elements in pivot column s i r 1 i 0 otherwise 29 reinterpreting the expressions from 12 as a result of 8 row wise clr coefficients of the whole table are obtained for the ij 1 columns of the matrix v alternatively if the matrix v has just i j 2 columns formed by clr coefficients of basis vectors corresponding to the ilr representation of the independence table 20 21 its respective clr coefficients are derived and similarly for the interaction table with its coordinates 22 finally the transformed loadings and scores can be used to construct a biplot in order to reveal the multivariate structure of the sample of compositional tables and relations between both factors 5 unemployment data analysis in the following the methodological results are applied to two real world data sets in order to illustrate the main features and possible limitations of the approach in the first case data from oecd statistics about more than 150 million unemployed people from 42 different countries in 2010 25 are analyzed using the statistical software environment r 31 the data set contains the numbers of unemployed people together with their gen der and age category for the following countries australia austria belgium canada chile czech republic denmark estonia finland france germany greece hungary iceland ireland israel italy japan korea mexico netherlands new zealand norway poland portugal slovakia slovenia spain sweden switzerland turkey united king dom united states colombia costa rica latvia lithuania china india indonesia russian federation and south africa an example of transposed raw data from the first four countries is shown in table 1 the numbers in the tables are basically counts of unemployed people according to two factors as the population size varies among the countries the interest here is not in the absolute values of the counts in the single countries but rather the relative structure of unemployment particularly ratios of men and women and ratios among age groups 15 24 25 39 40 54 and 55 as well as pro portionality among countries will be analyzed since outliers can be anticipated due to completely different economics education levels gender balance and also traditions of the listed countries the analysis will be carried out in a robust manner 11 australia austria belgium canada age men women men women men women men women 15 24 129 111 29 25 53 43 250 178 25 39 90 85 40 35 86 83 241 192 40 54 66 68 36 27 65 52 242 188 55 37 19 7 3 13 11 121 75 table 1 unemployed people in thousands partitioned according to their gender and age groups 25 all compositional tables in this example have two rows and four columns i e gender is the row factor and age structure is the column factor the sample space of tables thus has dimension 7 out of which independence tables account for a dimension of 4 with pivot coordinates zr 1 z c 1 z c 2 and z c 3 while the remaining coordinates z or 11 z or 12 and z or 13 correspond to the interaction tables with a dimension of 3 to point out the differences between the classical and robust pca both are performed and compared through the resulting covariance compositional biplots recall that classical pca can directly be applied on clr coefficients nevertheless since for this data set robust pca may be more relevant because of potential outlying tables ilr coordinates are used in both cases and the results are transformed to clr for the biplot construction this can only result in a different rotation of the classical biplot however it obviously does not alter the results in order to perform pca in ilr coordinates the standard function princomp in r can be used where the parameter covmat is set to covmcd mcd estimator of covariance in case of robust pca thereafter loadings need to be transformed to clr coefficients as described in section 2 using the matrix v with columns defined by 27 29 for the entire compositional table and by 27 and 28 or by 29 for its independent and interactive part respectively the resulting classical biplots are depicted on the right hand side of figure 1 while the robust pca output is on the left assessing figure 1 it can be noticed that in all three cases robust pca performs bet ter in terms of explained variability by the first two principal components as mentioned above some outliers might be present in the data and even from the classical biplot of the whole compositional tables upper right corner of figure 1 at least two outlying tables turkey tur and south africa zaf could be expected and thus the robust approach should provide more meaningful results however an outlier detection is performed ad ditionally in order to confirm these expectations in the r package robcompositions 32 there is a function outcoda defined for this purpose based on robust mahalanobis dis tances computed from ilr transformed data 14 using the pivot coordinates and applying the 0 975 quantile of the chi squared distribution as the common cut off value 15 out of all 42 countries are identified as outlying observations clearly supporting the choice of robust analysis note that similarly 10 observations from the set of independence tables and 6 from the interaction tables were detected as potential outliers additionally from the same part of the figure it is easy to identify from the direction of the arrows which countries tend to have relatively higher unemployment among younger people and which ones have a rather higher rate in the opposite situation although 12 2 0 1 0 0 0 0 5 1 0 2 0 1 0 0 0 0 5 1 0 pc 1 52 29 p c 2 3 6 8 3 aus aut bel can chl cze dnk est fin fra deu grc hun isl irl isr ita jpn kor mex nldnzl nor pol prt svk svn esp swe che tur gbr usa col cri lva ltu chn ind idn rus zaf m 15 24 m 25 39 m 40 54 m 55 f 15 24 f 25 39 f 40 54 f 55 2 0 1 0 0 0 0 5 1 0 2 0 1 0 0 0 0 5 1 0 pc 1 53 41 p c 2 2 4 7 2 aus aut bel can chl cze dnk est fin fra deu grc hun isl irl isr ita jpn kor mex nld nzl nor pol prt svk svn esp swe che tur gbr usa col cri lva ltu chn ind idn rus zaf m 15 24 m 25 39 m 40 54 m 55 f 15 24 f 25 39 f 40 54 f 55 2 0 1 0 0 0 0 5 1 0 2 0 1 0 0 0 0 5 1 0 pc 1 51 15 p c 2 3 9 1 2 aus aut bel can chl cze dnk est fin fra deu grc hun isl irl isr ita jpn kor mex nld nzl nor pol prtsvk svn esp swe che tur gbr usa colcri lva ltu chn ind idn rus zaf m 15 24 m 25 39 m 40 54 m 55 f 15 24 f 25 39 f 40 54 f 55 2 0 1 0 0 0 0 5 1 0 2 0 1 0 0 0 0 5 1 0 pc 1 57 32 p c 2 2 6 6 4 aus aut bel can chl cze dnk est fin fra deu grc hun isl irl isr ita jpn kor mex nld nzl nor pol prtsvk svn esp swe che tur gbr usa col cri lva ltu chn ind idn rus zaf m 15 24 m 25 39 m 40 54 m 55 f 15 24 f 25 39 f 40 54 f 55 0 5 0 0 0 5 0 5 0 0 0 5 pc 1 87 22 p c 2 8 4 3 aus autbel can chl cze dnk est fin fra deu grc hun isl irlisr itajpn kor mex nldnzl nor pol prt svk svn espswe che tur gbr usa col cri lva ltu chnind idn rus zaf m 15 24 m 25 39 m 40 54 m 55 f 15 24 f 25 39 f 40 54 f 55 0 5 0 0 0 5 1 0 0 5 0 0 0 5 1 0 pc 1 77 31 p c 2 1 7 0 5 aus aut bel can chl cze dnk est fin fra deu grc hunisl irl isr ita jpn kor mex nld nzl nor pol prt svk svn espswe che tur gbr usa col cri lva ltu chn ind idn rus zaf m 15 24 m 25 39 m 40 54 m 55 f 15 24 f 25 39 f 40 54 f 55 figure 1 robust left column and classical right column covariance biplots of the unemployment compositional upper row independence middle row and interaction tables lower row 13 no clear compact clusters are visible it is obvious that most european countries together with the usa and canada tend to have most likely problems with employing older people say 40 while for central and south america together with china india and indonesia the unemployment depending on age structure has rather opposite tendencies moreover also some gender differences can be observed except for the youngest generation the structure in the classical biplot upper right plot is similar but driven by the identified outlying observations the left plot in the middle part of figure 1 shows the ideal situation in case the relationships between gender and age factors would be filtered out while the positions of the countries are not apparently changed compared to the previously discussed covariance biplot upper right corner the general relationships between the factors are remarkably illustrative in case of independence nearly gender equity would be achieved while on the contrary relationships among the age levels would be disproportionally weaker also a bigger difference between results provided by robust and classical pca is present here one can easily understand how the classical approach does not handle outliers and how those can affect the output the biplot on the right side is quite far away from picturing the same ideal situation as demonstrated the independence table captures the hypothetical balanced state with each clr interpreted in terms of dominance of a given combination of factors in case of independence however this dominance is then either amplified or weakened according to the interaction table in terms of clr coefficients it depends on whether the logratio dominance is shifted in a positive or in a negative direction note that information obtained from the interaction table only does not provide a complete picture about the dominance of single cells in the table for example in the lower left biplot robust biplot of interaction tables costa rica cri is placed towards the loading male 55 but this does not necessarily lead to a conclusion that unemployment in this group is higher in general in this country it simply marks the cell whose dominance causes imbalance for costa rica although the actual proportion of unemployment for this age group can be lower than its average dominance therefore the conclusion about the higher dominance of unemployed men in the oldest group than expected in the hypothetical case of independence can be stated only after looking at the biplot of the independence tables for the compositional tables with dimension 2 j or alternatively i 2 this feature is nicely illustrated by the depicted loadings themselves placed along a line corresponding to increasing dominance of one factor value at the expense of the latter value of the same factor the opposite relation between the respective clr coefficients is clearly visible from both the biplots and the form of clr xint ij in 26 as it was already discussed in section 4 clr coefficients of the interaction table sum up to zero across each row and column which results in the identity clr xint 1 j clr xint 2 j holding for each j when i 2 and similarly for j 2 while in case of higher data dimension the property is no longer visible in the graphs in this example it can be seen that the two possible values of the gender factor lead to precisely contradictory loadings for any chosen value of the age factor thus they might only carry the information about the origin of the dominance shift but no longer about the direction of the shift for which the difference from the independence table has to be consulted 14 6 education data analysis it was illustrated in the previous example how outliers can affect results of classical pca especially the gender equity achieved in the robust biplot of the independence tables would not be present in the classical one hence in this second example only robust analysis outputs are discussed the data set contains information about more than 7 million female and nearly 6 million male students divided according to 8 different fields of study being education humanities and arts social sciences business and law science mathematics and computing engineering manufacturing and construction agriculture and veterinary health and welfare and services 26 the information about the achieved degree bachelor master and doctoral respectively is recorded as well for about 30 different countries compositional tables are analyzed for both genders separately in order to allow for a comparison of possible differences between them later on biplots as graphical pca outcomes of the whole compositional table as well as independence and interaction tables are collected in figure 2 due to a larger dimensionality of compositional tables than in previous case 3 8 the biplots contain three times more variables and an objective interpretation becomes more difficult an additional aspect is that since it is necessary to go many dimensions down to achieve the pca projection using the first two principal components it is expected to obtain more approximative picture of the multivariate data structure in the biplot however for data of similar or even bigger size the proposed methods still offer an extremely useful rank two approximation capturing the relationships between both factors the performance of robust pca is still good enough at least 54 08 for this concrete case in terms of cumulative variability explained by the first two principal components despite the previous interpretational doubts it can be seen that the effect of the chosen final degree is possibly stronger than the effect of the study field since the loadings tend to create a quite clear division of bachelors masters and doctors for most of the biplots this property is more obvious for men while for women the difference between bachelors and masters is partially wiped out maybe also due to a less compact data structure finally employing the outcoda function 32 14 again some outliers for the data set of the whole compositional tables are detected austria norway and spain for men and united kingdom turkey and united states for women from the second row of the figures some overall idea about the hypothetical state of independence between degree and study field factors might be obtained a stronger effect of the chosen degree and a weaker effect of the study field would still be apparent for men and one new feature could be observed there would be a strong relation between educa tion and humanities and arts study fields for each degree for women e g a similarity of educational systems in sweden finland belgium and switzerland is reflected also in the case of independence higher occurrence of outliers would be present for both men and women when looking at the biplot for the interaction tables for women lower right figure two of the mentioned countries are shifted away from the fields of study that would dom inate if independence was achieved being especially agriculture and veterinary science mathematics and computing and services these countries are sweden and belgium 15 6 4 2 0 2 4 6 6 4 2 0 2 4 6 pc 1 31 85 p c 2 2 2 2 3 aus autbel cze fin deu grchun irl ita jpn kor lva mex nzl nor pol prt svk svn esp swe che tur gbr usa bra col idn bc 1 bc 2 bc 3 bc 4 bc 5 bc 6 bc 7 bc 8 mgr 1 mgr 2 mgr 3 mgr 4 mgr 5 mgr 6 mgr 7 mgr 8 phd 1 phd 2 phd 3 phd 4 phd 5 phd 6 phd 7 phd 8 5 0 5 5 0 5 pc 1 41 37 p c 2 2 1 6 3 aus aut bel cze fin deu grc hun irl ita jpn kor lva mex nzl nor pol prt svk svn esp swe che tur gbr usa bra col idn bc 1 bc 2 bc 3 bc 4 bc 5 bc 6 bc 7 bc 8 mgr 1 mgr 2 mgr 3 mgr 4 mgr 5 mgr 6 mgr 7 mgr 8 phd 1 phd 2 phd 3 phd 4 phd 5 phd 6 phd 7 phd 8 8 6 4 2 0 2 4 6 8 6 4 2 0 2 4 6 pc 1 38 21 p c 2 3 1 4 0 aus aut bel cze est fin deu grc hun irl ita jpn kor lva mex nzl nor pol prt svk svn esp swe che tur gbr usa bra col idn bc 1 bc 2 bc 3 bc 4 bc 5 bc 6 bc 7 bc 8 mgr 1 mgr 2 mgr 3 mgr 4 mgr 5 mgr 6 mgr 7 mgr 8 phd 1 phd 2 phd 3 phd 4 phd 5 phd 6 phd 7 phd 8 2 1 0 1 2 2 1 0 1 2 pc 1 65 96 p c 2 1 4 3 8 aus aut bel cze est fin deu grc hun irl ita jpn kor lva mex nzl nor pol prt svk svn esp swe che tur gbr usa bra col idn bc 1 bc 2 bc 3 bc 4 bc 5 bc 6 bc 7 bc 8 mgr 1 mgr 2 mgr 3 mgr 4 mgr 5 mgr 6 mgr 7 mgr 8 phd 1 phd 2 phd 3 phd 4 phd 5 phd 6 phd 7 phd 8 5 0 5 5 0 5 pc 1 39 12 p c 2 2 4 3 8 aus aut bel cze est fin deu grc hunirl ita jpn kor lva mex nzl nor pol prt svk svn esp swe che tur gbr usa bra col idn bc 1 bc 2 bc 3 bc 4 bc 5 bc 6 bc 7 bc 8 mgr 1 mgr 2 mgr 3 mgr 4 mgr 5 mgr 6 mgr 7 mgr 8 phd 1 phd 2 phd 3 phd 4 phd 5 phd 6 phd 7 phd 8 2 1 0 1 2 3 2 1 0 1 2 3 pc 1 67 29 p c 2 1 4 3 3 aus aut bel cze fin deu grc hun irl ita jpn kor lva mex nzl nor pol prt svk svnesp swe che tur gbr usa bra col idn bc 1 bc 2 bc 3 bc 4 bc 5 bc 6 bc 7 bc 8 mgr 1 mgr 2 mgr 3 mgr 4 mgr 5 mgr 6 mgr 7 mgr 8 phd 1 phd 2 phd 3 phd 4 phd 5 phd 6 phd 7 phd 8 figure 2 robust covariance biplots of the education compositional upper row in dependence middle row and interaction tables lower row for men left column and women right column respectively study fields are marked as follows 1 education 2 humanities and arts 3 social sciences business and law 4 science mathematics and computing 5 engineering manufacturing and construction 6 agriculture and veterinary 7 health and welfare and 8 services 16 while finland would correspond approximately to the independence between the factors and switzerland actually accounts for even stronger dominance of those fields particu larly master and doctoral studies in services for both men and women it could be stated that the actual relationships between the factors are quite distant from the relative dominance given in the independence state stronger patterns concerning both factors are generally observed for men 7 conclusions vector compositional data or their generalization to compositional tables are charac terized by their relative scale and scale invariance properties captured by the aitchison geometry accordingly a representation of the compositional tables isometrically in clr coefficients or ilr coordinates is essential for the further statistical analysis using popular multivariate methods compositional tables can be decomposed onto their independence and interaction parts a statistical analysis of both is recommended to get insight into the ideal situation when relationships between factors are filtered away as well as into interactions between factors forming the compositional table as most real world datasets contain outlying observations robust methods requiring an orthonormal coordinate rep resentation have been considered to reduce the dimension of data at hand a robust pca using the mcd estimator can be applied to pivot coordinates of compositional in dependence and interaction tables but also any other ilr coordinates which respect the decomposition of compositional tables could be used the necessity of respecting di mensionality of independence and interaction tables forms the main difference to vector compositional data where such feature does not occur in case of pivot coordinates it is also possible to find a simple relationship between them and the respective clr coefficients as well as to enhance interpretation of the latter variables therefore pca loadings ob tained in pivot coordinates are transformed back to clr coefficients where they are used for the construction of biplots and their meaningful analysis in case of 2 j table dimensions an additional feature can be observed in the graphical output of interaction tables which can be traced back to the interpretation of the clr coefficients as a next step three factors of a compositional cube i j k could be analyzed by robust pca and appropriate 3 d graphical tools employed consequently the educational datasets for men and women could be merged into one and approached accordingly the case of com positional cubes and also its further extension to generally n factors belong to primary research interests of the authors funding this work was supported by cost action cronos under grant ic 1408 the czech sci ence foundation under grant 18 05432 s and the grant iga prf 2018 024 mathematical models of the internal grant agency of the palacky university in olomouc 17 references 1 j aitchison the statistical analysis of compositional data chapman and hall lon don 1986 2 j aitchison m greenacre biplots of compositional data journal of the royal sta tistical society series c applied statistics 51 2002 pp 375 392 3 f bruno f greco m ventrucci spatio temporal regression on compositional co variates modeling vegetation in a gypsum outcrop environmental and ecological statistics 22 2015 pp 445 463 4 a buccianti j j egozcue v pawlowsky glahn variation diagrams to statistically model the behavior of geochemical variables theory and applications journal of hydrology 519 2014 pp 988 998 5 t dickhaus k straburger d schunk c morcillo suarez t illig a navarro how to analyze many contingency tables simultaneously in genetic association studies statistical applications in genetics and molecular biology 11 2012 6 d dumuid t e stanford j a mart n ferna ndez z pedi sic c a maher l k lewis k hron p t katzmarzyk j p chaput m fogelholm g hu e v lam bert j maia o l sarmiento m standage t v barreira s t broyles c tudor locke m s tremblay t olds compositional data analysis for physical activity sedentary time and sleep research statistical methods in medical research 2018 doi 10 1177 0962280217710835 7 j j egozcue j l d az barrero v pawlowsky glahn compositional analysis of bivariate discrete probabilities in proceedings of codawork 08 the 3 rd com positional data analysis workshop j daunis i estadella j a mart n ferna ndez eds university of girona spain 2008 8 j j egozcue v pawlowsky glahn groups of parts and their balances in composi tional data analysis math geol 37 2005 pp 795 828 9 j j egozcue v pawlowsky glahn g mateu figueras c barcelo vidal isometric logratio transformations for compositional data analysis mathematical geology 35 2003 pp 279 300 10 j j egozcue v pawlowsky glahn m templ k hron independence in contingency tables using simplicial geometry commun stat theory 44 2015 pp 3978 3996 11 k fac evicova k hron v todorov d guo m templ logratio approach to statis tical analysis of 2 x 2 compositional tables journal of applied statistics 41 2014 pp 944 958 12 k fac evicova k hron v todorov m templ compositional tables analysis in coordinates scandinavian journal of statistics 43 2016 pp 962 977 18 13 k fac evicova k hron v todorov m templ general approach to coordinate rep resentation of compositional tables scandinavian journal of statistics 2018 doi 10 1111 sjos 12326 14 p filzmoser k hron outlier detection for compositional data using robust meth ods mathematical geosciences 40 2008 pp 233 248 15 p filzmoser k hron c reimann principal component analysis for compositional data with outliers environmetrics 20 2009 pp 621 632 16 p filzmoser k hron robustness for compositional data in robustness and com plex data structures c becker et al eds springer heidelberg 2013 pp 117 131 17 e fi serova k hron on interpretation of orthonormal coordinates for compositional data mathematical geosciences 43 2011 pp 455 468 18 c herder w rathmann k strassburger h finner h grallert c huth c meisinger c gieger s martin g giani w a scherbaum h e wichmann t illig variants of the pparg igf 2 bp 2 cdkal 1 hhex and tcf 7 l 2 genes confer risk of type 2 diabetes independently of bmi in the german kora studies horm metab res 40 2008 pp 722 726 19 k hron p filzmoser p de caritat e fi serova a gardlo weighted pivot coor dinates for compositional data and their application to geochemical mapping math ematical geosciences 49 2017 pp 797 814 20 r johnson d wichern applied multivariate statistical analysis 6 th ed prentice hall london 2007 21 a kalivodova k hron p filzmoser l najdekr h janecc kova t adam pls da for compositional data with application to metabolomics journal of chemometrics 29 2015 pp 21 28 22 p kync lova p filzmoser k hron compositional biplots including external non compositional variables statistics 50 2016 pp 1132 1148 23 r maronna r d martin v j yohai robust statistics theory and methods wiley new york 2006 24 g mateu figueras v pawlowsky glahn j j egozcue the principle of working on coordinates in compositional data analysis theory and applications pp 31 42 wiley 2011 25 oecd statistics unemployment by sex and age 2010 http stats oecd org ac cessed 10 march 2017 26 oecd statistics education and training 2010 http stats oecd org accessed 24 april 2017 19 http stats oecd org http stats oecd org 27 m i ortego and j j egozcue bayesian estimation of the orthogonal decomposition of a contingency table austrian journal of statistics 45 2016 pp 45 56 28 v pawlowsky glahn and j j egozcue geometric approach to statistical analysis on the simplex stochastic environmental research and risk assessment serra 15 2001 pp 384 398 29 v pawlowsky glahn statistical modelling on coordinates universitat de girona 2003 isbn 84 8458 111 x http ima udg es activitats codawork 2003 30 v pawlowsky glahn j j egozcue r tolosana delgado modeling and analysis of compositional data wiley chichester 2015 31 r core team r a language and environment for statistical computing r founda tion for statistical computing vienna austria 2018 https www r project org 32 m templ k hron p filzmoser robcompositions an r package for robust sta tistical analysis of compositional data in compositional data analysis theory and applications v pawlowsky glahn and a buccianti eds pp 341 355 wiley chichester 2011 20 http ima udg es activitats codawork 2003 1 introduction 2 logratio methodology of compositional data 3 robust principal component analysis for compositional data 4 compositional tables 5 unemployment data analysis 6 education data analysis 7 conclusions