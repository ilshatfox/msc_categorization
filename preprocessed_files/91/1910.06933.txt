assortment and reciprocity mechanisms for promotion of cooperation in a model of multilevel selection daniel b cooney 1 1 program in applied and computational mathematics princeton university july 9 2020 abstract in the study of the evolution of cooperation many mechanisms have been proposed to help overcome the self interested cheating that is individually optimal in he prisoners dilemma and other social dilemmas these mechanisms include assortative or networked social interactions reciprocity rules to establish cooperation as a social norm or simultaneous competition between individuals favoring cheaters and competition between groups favoring cooperators here we build on recent mathematical tools describing the dynamics of multilevel selection to to consider the role that assortment and reciprocity mechanisms play in facilitating cooperation in concert with multilevel selection using a deterministic partial differential equation variant of the replicator equation including the effects of within group and between group competition we demonstrate the synergistic effects between population structure within groups and the competitive ability of cooperative groups when groups compete according to collective payoff keywords multilevel selection evolutionary game theory assortment reciprocity contents 1 introduction 2 2 evolutionary games and replicator dynamics 4 2 1 generalized dynamics 7 3 within group assortment 11 4 indirect reciprocity 19 5 multilevel selection in a repeated game 29 6 graph structure within groups 33 6 1 death birth updating 40 6 2 birth death updating 47 6 3 imitation updating 49 6 4 behavior in the limit of strong between group competition 53 1 ar x iv 1 91 0 06 93 3 v 3 ph ys ic s so c ph 8 j ul 2 02 0 7 discussion 54 1 introduction in many biological settings it is helpful to explore natural selection through the lens of multilevel se lection examining how there are conflicts between selective forces operating at different organizational levels selection on multiple levels readily arises in settings varying from the formation of protocells and the origins of life 1 3 collective behavior in animal groups 4 the evolution of aggressive or cooperative behavior of ant queens 5 host microbe mutualisms in the microbiome 6 and compe tition between pathogen strains under both immunological dynamics and epidemiological dynamics 7 8 the evolution of cooperation provides a useful case study for questions of multilevel selection and evolutionary game theory provides an instructive analytical framework for analyzing the tension between the interests of a group and the interests of the individuals comprising the group in the literature of evolution of cooperation there has been an emphasis on the roles of popu lation structure in facilitating the possibility of cooperation that cannot be achieved on its own in a well mixed population described by a wright fisher or moran process in finite populations or by the replicator dynamics in the infinite population limit in particular nowak identifies five key mechanisms for promotion of the evolution of cooperation kin selection assortment direct reciprocity indirect reciprocity network reciprocity and group multilevel selection 9 we explore how several of these other interaction structures can be combined with multilevel selection in the search to achieve cooper ation in some sense the evolution of cooperation within a group can be considered the emergence of an entity operating at a higher level of selection 3 9 achieving higher levels of biological complexity can be buoyed by mechanisms which hinder the lower level advantages of cheater types the break down of regulatory mechanisms like programmed cell death or copy number regulation is considered a characteristic property of cancer 10 and can be associated with aging through the eventual dominance of cheater types in mitochondrial dna evolution 11 a model of multilevel selection in evolutionary games was introduced by traulsen and nowak 12 and further studied by traulsen et al and b tcher and nagler 13 14 as a baseline model for multilevel selection we will take the multilevel replicator dynamics introduced by luo and coauthors 15 17 and has recently been extended to multilevel selection in evolutionary games 18 19 luo introduced a stochastic description for a two level selection process with two types of individuals one with an advantage at individual level reproduction and the other conferring an advantage to its group in group level reproduction the multilevel replicator dynamics is a deterministic partial differential equation pde description of the distribution of the composition of cooperators and defectors in groups with two terms describing the effects of within group competition and between group competition this framework provides an analytically tractable approach to study the conflicts between these levels of selection and can be extended to include more realism for group level events 20 24 in previous work on the multilevel replicator dynamics the main characterization of the behavior of the multilevel dynamics is to determine whether within group or between group dynamics dominate in the long run and whether the population converges to a delta concentration at equilibrium of the within group dynamics or if the population achieves a nontrivial steady state producing additional cooperation 17 19 a particularly interesting phenomenon found in this analysis is the shadow of lower level selection for games in which groups are best off with a mix of cooperators and defectors no level of between group competition strength can produce the optimal proportion of cooperators 18 19 in this paper we will explore whether implementing mechanisms of assortment or reciprocity 2 can facilitate cooperation via multilevel selection and we are particularly interested in seeing whether these mechanisms can help to erase the shadow of lower level selection several authors have studied the evolution of cooperation in the context of group selection and assortment 25 26 in those models assortative mechanisms are used to form groups for game theoretic interactions promoting cooperation in the population by allowing cooperators to cluster together here we instead consider group identities that are fixed in time but that the game theoretic interactions within each group follow an assortment or reciprocity rule that can help to promote cooperation through simultaneous competition within groups based on individual payoff and competition between groups based on the average payoff of group members in particular we are interested in the different ways in which altering the interactions with peer group members can change the shape of the function describing average payoff of group members helping to move from a payoff regime in which groups are best off with a mix of cooperators or defectors to a regime in which between group competition most favors full cooperator groups by doing this we hope to explore the extent to which we can mitigate the effects of the shadow of lower level selection and help to promote the possibility of establishing full cooperation for sufficiently strong relative levels of between group competition even when our payoff function favors intermediate cooperation under well mixed interactions first we consider an extension of these multilevel selection model in which strategic interactions are assortative cooperators are more likely to interact with cooperators and defectors are more likely to interact with defectors we follow the approach of grafen 27 by assuming that individuals have a greater probability of interacting with individual with the same strategy this can be used to model the effects of relatedness and kin selection or to understand how strategy based homophily can be used to promote cooperation mechanisms of assortative interactions individuals have been explored by eshel and cavalli sforza 28 and bergstrom has provided analysis of a wide variety of assortative matching mechanisms 29 31 an endogenous model of strategic homophily or heterophily was introduced by pacheco et al 32 33 in which individuals create and break links based on payoff received through interactions on the link which can serve as a microfoundation for the exogenous assortment probabilities we also consider an extension of this model in which strategic interactions occur on a k regular random graph 34 35 and show that graph interactions can in effect change a game from one in which group average payoff is maximized for intermediate cooperation to one in which full cooperation is optimal for groups we also explore the role of reciprocity manifested as rewards for cooperation or punishment for defection we study both models of direct and indirect reciprocity distinguished by whether one punishes an individual who cheated against one in the past or whether one punishes individuals who have a reputation for cheating against anyone for indirect reciprocity we take nowak and sigmund s model in which cooperators have a probability of identifying a defector through their reputation and punishing the defector by defecting as well 36 for direct reciprocity we study the competition between defectors and individuals playing the tit for tat strategy in the repeated prisoners dilemma as initially studied by axelrod 37 39 the remainder of the paper is structured as follows in section 2 we present the original model for the multilevel replicator dynamics and describe the general behavior of the multilevel dynamics in the presence of an arbitrary mechanism of assortment or reciprocity in section 3 we address the model of assortative interactions in sections 4 and 5 we address indirect reciprocity and direct reciprocity respectively we consider the role of network reciprocity in the special case of games on k regular graphs with death birth updating in section 6 we conclude in section 7 with a discussion on the behaviors found across the models and connections with the well mixed model and the shadow of lower level selection 3 2 evolutionary games and replicator dynamics here we will illustrate the baseline model for deterministic multilevel selection for evolutionary games with well mixed strategic interactions as in cooney 18 we consider two strategy games in which individuals can either choose to cooperate c or defect d and individuals receive payoff from pairwise interaction given by the following payoff matrix c d c r s d t p 2 1 where the payoffs correspond toreward sucker temptation and punishment four games of interest to our analysis are the prisoners dilemma pd the hawk dove hd game the stag hunt sh and the prisoners delight pdel which are characterized by the following rankings of payoffs 40 pd t r p s 2 2 a hd t r s p 2 2 b sh r t p s 2 2 c pdel r t s p 2 2 d in terms of individual payoff dynamics the pd promotes dominance of defectors the hd game pro motes coexistence of cooperators and defectors the sh promotes bistability between dominance of defectors and dominance of cooperators and the pdel promotes dominance of cooperators in a group composed of fraction x cooperators and 1 x defectors the expected payoffs received by cooperators and defectors in well mixed interactions are c x xr 1 x s 2 3 d x xt 1 x p 2 4 and the average payoff of individuals in a group with x fraction cooperators is g x x c x 1 x d x p r s t p x s t 2 p x 2 2 5 recently the multilevel selection framework of luo and mattingly was applied to study the simultaneous competition between individuals based on individual payoff and competition between groups following the average payoff of group members 17 19 a non local partial differential equation was derived to describe the changing probability density of groups at time t composed of a fraction of x cooperators f t x which is the natural analogue of the replicator dynamics in the context of multilevel selection the dynamics are given by 2 6 f t x t x x 1 x c x d x f t x f t x g x 1 0 g y f t y dy for two strategy social dilemmas there are three generic behaviors of interest for the within group dynamics and how the within group dynamics relate to the between group dynamics for the prisoners dilemma the full defector equilibrium x 0 is globally stable under the within group 4 replicator dynamics while the hawk dave game has a globally stable interior equilibrium and the stag hunt and prisoners delight games feature local stability full cooperator groups general behaviors have been shown to appear for these three archetypal games which can depend on the h lder exponent near x 1 of the initial density f 0 x a property of the tail of the initial distribution 19 definition 2 1 the h lder exponent t of the probability distribution with density f t x near x 1 satisfies t inf 0 lim y 0 1 1 y f t z dz y 0 for the pd and hd games it was shown that the h lder exponent near x 1 is preserved in time for solutions to equation 2 6 we now describe the generic behaviors of the pd hd and sh games that can stand in for games played with our structured population mechanisms 19 1 for pd games with an initial distribution with h lder exponent near x 1 there is a threshold level of relative selection strength pd d 1 c 1 g 1 g 0 2 7 such that the population f t x x concentration upon the full defector equilibrium if pd if there is a unique steady state with h lder exponent near x 1 so we conjecture that the population will converge to this steady state 2 for hd games with an initial distribution with h lder exponent near x 1 there is a threshold level of relative selection strength hd d 1 c 1 g 1 g xeq 2 8 such that the population f t x x xeq concentration upon the within group hd equilib rium if hd if there is a unique steady state with h lder exponent near x 1 so we conjecture that the population will converge to this steady state 3 for sh and pdel games the population converges to 1 x a delta mass at x 1 if 0 and at least some initial probability is located in the basin of attraction of the full cooperator equilibrium we can also characterize the different parameter regimes for which games follow pd hd sh or pdel within group dynamics and have group payoff functions either most favoring full cooperation or an intermediate level of cooperation using the following parameterization of the payoff matrix from equation 2 1 here we use the notation inspired by the donation game in which cooperators pay a cost c to confer a benefit b to their opponents and include an extra term d representing possible positive or negative synergies for mutual cooperation 41 c d c b c d c d b 0 2 9 5 under this representation of the payoff matrix we can characterize the four regimes for within group dynamics using the following rankings of parameters pd b 0 d c 2 10 a hd b d c 0 2 10 b sh b 0 c d 2 10 c pdel b c 0 d 2 10 d additionally we see that the individual payoffs of cooperators and defectors can be written as c x b d x c and d x bx while the average payoff of group members is given by g x b c x dx 2 therefore the multilevel dynamics can be rewritten under this parameterization as f t x t x x 1 x dx c f t x f t x b c x dx 2 1 0 b c y dy 2 f t y dy 2 11 because c and d show up in the expressions both for individual and group average payoff we can see that these parameters can be used to delineate the different within group regimes as well as between games for which collective payoff is maximized by full cooperation or by a mix of cooperation and defection we illustrate the possible regimes of our multilevel dynamics for fixed b and various values of c and d in figure 2 1 figure 2 1 depiction of the different within group and between group regimes in terms of the cost and synergy parameters c and d for fixed benefit b 1 the gray shaded region corresponds to games for which group payoff is maximized by an intermediate level of cooperation x while unshaded region corresponds to games for which group payoff is maximized by full cooperation 6 from equation 2 7 we see that the threshold for achieving steady state cooperation under the pd within group regime is given by pd c d b c d b b c d 1 2 12 in particular this tells us that the threshold pd is a decreasing function of the synergy parameter d so increasing the synergy of mutual cooperation makes it easier to achieve cooperation via multilevel selection 2 1 generalized dynamics before we introduce the specific assortment and reciprocity mechanisms we will study a more general two level selection process that contains the dynamics with these mechanisms as a special case we consider a game with a structure parameter which could represent assortment neighborhood size social reputation etc this can be thought of in a somewhat similar manner to the structure coefficient for fixation probabilities of cooperation in evolutionary games in structured populations 42 43 but there is no intention right now to unify the concept in the same way cooperators and defectors receive payoffs c x and d x in group with x fraction of cooperators whiles groups with x fraction of cooperators receives average payoff of g x x c x 1 x d x for all of the examples we will study it is fine to assume that the defector s advantage is an affine function of the form d x c x a bx and therefore the advantage varies constantly with x or x d x c x b multilevel dynamics follow modified replicator dynamics given by f t x t x x 1 x c x d x f t x f t x g x g f t x 2 13 in the pd regime of the structured population dynamics we can look to find steady state solutions of equation 2 13 we can find that if all defection is the within group equilibrium that steady states of equation 2 13 satisfy the implicit expression f x 1 zf x g f d 0 c 0 1 1 x g 1 g f d 1 c 1 1 d x c x g f g x eq bxeq 1 xeq 1 2 14 recalling that the h lder exponent near x 1 is preserved for our multilevel dynamics it is reason able to parameterize our steady state solutions by this quantity because we have a density description 7 we use equation 2 14 to compute that lim y 0 y 1 1 y f x dx lim y 0 z 1 f y 1 1 y x g f d 0 c 0 1 1 x g 1 g f d 1 c 1 1 d x c x g xeq g f bxeq 1 xeq 1 dx lim y 0 zfy 1 1 1 y g f d 0 c 0 1 y g 1 g f d 1 c 1 1 d 1 y c 1 y g xeq g f bxeq 1 xeq 1 zf 1 d 1 c 1 g f g xeq bxeq 1 xeq 1 k lim y 0 y g 1 g f d 1 c 1 0 g 1 g f d 1 c 1 zf 1 k g 1 g f d 1 c 1 g 1 g f d 1 c 1 using the definition of h lder exponent we see that the the h lder exponent near x 1 is given by g 1 g f d 1 c 1 2 15 using this expression we can rewrite our steady state densities in terms of as follows 2 16 f x z 1 f x g 1 d 1 c 1 1 1 x 1 d x c x g 1 g x eq d 1 c 1 bx eq 1 x eq 1 in order for this probability density to be integrable and therefore actually a probability density there is a threshold level of between group competition required to obtain any cooperation through between group competition d 1 c 1 g 1 2 17 for these steady states we can use equation 2 15 to find that the average payoff of population is g f x g 1 c 1 d 1 2 18 in particular we can rewrite the expression for the average payoff of the population at steady state by using the threshold selection intensity which gives us g f x g 1 1 2 19 8 so we see g f x ranges from 0 at to g 1 as notably this means that the average payoff of the population is limited by the average payoff of full cooperator groups then for group fitness functions g x maximized at an intermediate level of cooperation the steady state population cannot achieve the maximal average payoff possible to the population even as selection strength at the between group level becomes infinitely strong similarly we can show in the case that x eq is the stable equilibrium of the within group dynamics that steady state densities take the form f x 0 x x eq p x x x eq 2 20 where p x is given by the righthand side of equation 2 16 in the latter case in order for the steady state density to be integrable near x eq we need the exponent of d x c x to exceed 1 or we equivalently require that g 1 g x eq d 1 c 1 bx eq 1 x eq 0 because the defector s advantage is increasing in x we know that bx eq 1 x eq 0 and therefore this condition becomes d 1 c 1 g 1 g x eq 2 21 noting that when x eq 0 we have that g x eq g 0 0 it turns out that our for integrability of steady states given by equations 2 17 and 2 21 coincide precisely when the interior within group equilibrium x eq coincides with the full defection within group equilibrium as a consequence the threshold level of between group selection needed to obtain cooperation in excess of that achieved by within group selection alone passes continuously from to as the structure parameter varies to alter the within group dynamics from favoring full defection to favoring an interior mix of cooperation and defection when x eq is the stable equilibrium of within group dynamics we can use our expression for threshold group level selection strength to describe average payoff at steady state yielding g f x g 1 g 1 g x eq 2 22 so we see that g f x ranges from g x eq when to g 1 when we can also study the group type that is most abundant at steady state as we find that the modal group type ends up converging to the type of group which achieves the same average payoff as a full cooperator group we demonstrate this behavior in proposition 2 1 in particular this phenomenon means that if the full cooperator group has the maximal average payoff out of all possible group compositions then the highest payoff group is also most abundant at steady state when between group competition becomes infinitely stronger than within group competition however when there is an intermediate group optimum x for the group payoff function g x then the most abundant group type will have fewer cooperators and a lower collective payoff that the best possible group payoff even in the limit as and between group selection should dominate the dynamics this behavior which has been detailed for the multilevel dynamics of two player two strategy symmetric games with game theoeretic interactions in well mixed groups 18 19 can be thought of as the individual level selection casting a long shadow on the dynamics of multilevel selection this phenomenon is one motivating 9 reason to explore the role of within group mechanisms in promoting the evolution of cooperation via multilevel selection in particular we are interested in determining under which conditions assortment reciprocity and network structure can help pd games with intermediate payoff optima allow for the achievement of optimal steady state levels of cooperation in the large limit proposition 2 1 suppose 1 the most abundant group composition in the steady state density f x is given by x lim x min 1 g 1 a b g 1 g 1 g xeq xeq 1 xeq 2 23 proof we start by differentiating df dx z 1 f g x x b 1 g 1 d 1 c 1 2 1 x 2 d x c x g 1 g xeq d 1 c 1 axeq 1 xeq 2 where g x is given by g x g 1 d 1 c 1 b 1 1 x d x c x 1 x d x c x d x x c x x g 1 g xeq d 1 c 1 axeq 1 xeq x 1 x for convenience we will now use the shorthand notation g g 1 g xeq d 1 c 1 and e xeq 1 xeq 1 noting that d x c x b ax and d x c x a we can rewrite our expression for g x as the quadratic function g x g 1 g b 1 1 x b ax 1 x b ax g ex 1 x g 1 a b ge 1 a e x 2 a b 1 g 1 ge 1 a b 1 a e x g 1 b we know that the critical points of f x correspond to the roots of g x 2 24 x 1 a b g 1 ge a b 1 1 e 2 ag 1 b ge 1 a e 1 a b g 1 ge a b 1 1 e 2 4 g 1 a b ge 1 a e g 1 b 2 ag 1 b ge 1 a e 10 using the notation o f to denote any quantity g such that lim g f 0 we can further express the roots of g x as x 1 a b g 1 ge o 2 ag 1 b ge 1 a e 1 a b g 1 ge 2 2 4 ag 1 b ge g 1 2 o 2 2 ag 1 b ge 1 a e 1 a b g 1 ge o 1 a b g 1 ge 2 2 ag 1 b ge 1 a e considering the limit of large between group selection we see that lim x 1 a b g 1 ge 1 a b g 1 ge 2 ag 1 b ge simplifying our expression tells us that the critical points of g x take the form x lim x 1 g 1 ag 1 b ge in the limit as the two possible modal group types at steady state become the full cooperator group x 1 and a group type that can potentially correspond to an intermediate level of cooperation x x int g 1 ag 1 b ge we note that g 0 g 1 b b g 1 d 1 c 1 b 1 0 where we know that the inequality is satisfied for any density steady state due to the threshold condition on from equation 2 17 if x int 0 or x int 1 then the quadratic function g x is positive for x 0 1 and reaches zero when g 1 0 if x int 0 1 we instead see that g x is positive for x 0 x int and negative for x x int 1 because the sign of g x and df x dx agree on the interior of the support of f x this means that f x has a global maximum at the interior root x int if it biologically feasible when it is infeasible x int 6 0 1 we instead see that f x increases for all x 0 1 and therefore the model group type at steady state is the full cooperator group with x 1 recalling the formulas for x int g and e we see that the formula of equation 2 23 is therefore satisfied 3 within group assortment we consider game theoretic interactions within groups which follow an r assortment process as intro duced by grafen and studied in various deterministic and stochastic settings 27 44 47 in particular we assume a form of like with like assortment in which with probability r individuals play the game with an individual with the same strategy while with probability 1 r individuals play the game with a randomly chosen member of their group in an infinitely large group with a fraction x of cooperators 11 the expected payoff of a cooperator rc x and of a defector r d x under this assortment process is rc x rr 1 r c x rr 1 r xr 1 x s 3 1 a rd x rp 1 r d x rp 1 r xt 1 x p 3 1 b we can also understand the role of the assortment process by describing the expected payoff with the following transformed payoff matrix for well mixed interactions 9 48 c d c r 1 r s rr d 1 r t rp p 3 2 we see that the within group replicator dynamics are given by dx t dt x 1 x rc x r d x x 1 x r 1 r x 3 3 the within group dynamics have equilibria at 0 1 and a third point xeqr satisfying rc x eq r r d x eq r using equation 3 3 we see that this third potentially interior equilibrium is given by xreq r 1 r 3 4 we note that xreq r 1 1 r 2 0 when 0 so the potential interior equilibrium level of within group cooperation is increasing in r furthermore we see that there exists rsw and r a w such that for any r rsw r a w x r eq 0 1 we choose this notation to indicate that rsw is the minimum value of r above which some s cooperation is promoted by within group selection which is achieved by the r at which xreq 0 which is found from equation 3 4 to be rsw 0 1 3 5 similarly we define raw as the minimum level of r above which all cooperation a is favored by within group selection and corresponds to the level of r at which xreq 1 which we can find via equation 3 4 to be raw rsw 3 6 where we know the last inequality because xreq is increasing in r and that x 0 eq x eq 0 for pds with 0 in this paper we are primarily focused on the case of the pd in which group payoff can have an intermediate optimum so most of our analysis assumes 0 if instead we considered 0 we would find that xreq would start out above 1 when r 0 and that x r eq is a decreasing function of r resulting in a region of bistability of full cooperation and full defection before cooperation becomes dominant for sufficiently large r we will address the multilevel dynamics of the 0 case briefly but we will delay discussion of the bistable within group dynamics until section 4 in which bistable within group dynamics arise for underlying pd games with intermediate group payoff maxima 12 the average payoff for a group with interactions following an r process is given by gr x x r c x 1 x r d x 3 7 r p r p x 1 r p s t 2 p x r s t p x 2 3 8 we see that the group payoff function interpolates between the group payoff function for well mixed interations g 0 x x x 2 g x when r 0 to an affine function of cooperator composition g 1 x p x the dynamics of g 1 x under equation 2 13 are equivalent to the dynamics of the luo mattingly model or the 0 case of the pd under the well mixed dynamics of equation 2 6 noting that g r x 1 r s t 2 p r r p 2 x 1 r r s t p we see that average group payoff is maximized by the fraction of cooperators x r given by x r 1 r s t 2 p r r p 2 s t r p r rb 1 r rb for rb s t 2 rr s t p in terms of our parameters and the critical assortment parameter above which between group competition most favors full cooperator groups is rb 2 notably this means that rb 0 no assortment needed for full cooperator groups to achieve optimal average payoff when while there exists an rb 0 1 such that the most fit group composition x r is less than 1 for r r b and is the full cooperator group for r rb this means that any prisoners dilemma whose average payoff is maximized by intermediate fractions of cooperator for well mixed within group interactions can have maximal average payoff achieved by full cooperator groups if interactions occur with sufficiently strong assortment so assortment can be used as a mechanism to overcome the shadow of lower level selection we also note that when 0 i e our main case of interest dx r dr 2 4 2 1 r 2 2 2 1 r 2 0 because r p 0 which means that assortment always increases the level of cooperation in the group composition that maximizes average payoff pushing the goal of between group competition to fix on the type without the individual level advantage eventually x r will increase to the full cooperator group when r rb furthermore we can study the average payoff of the highest payoff group by plugging in the value of x r into the group payoff function gr x yielding gr x r r r 2 1 r 1 r r 2 1 r 2 r 2 4 2 1 r 2 3 9 specifically we can show that average payoff of the highest payoff is increasing in r when x r 1 as we can compute gr x r r 4 1 r 2 2 1 r r r 2 0 3 10 where the inequality holds because we are considering pds with 0 and r 0 for r 1 from this we see that the best possible outcome involves higher average payoffs as we increase 13 the assortment probability r from our characterization of the within group dynamics and group payoff function we construct two possible bifurcation diagrams for the assortment process in figure 3 1 we do not have a definitive ordering on rsw and rb but we do know that r s w rb and rb r a w for all pds with 0 and therefore we include both the possibilities that rb rsw r a w left and r s w rb r a w right in the former case we have left the regime of intermediate payoff optima and the shadow of lower level selection while the multilevel dynamics are still in pd regime while in the latter case we first transition from the pd regime to the hd regime and then encounter group payoff functions that are maximized by full cooperator groups in either case we see that the multilevel assortment dynamics starting out in the pd regime with intermediate fitness optima first shift to the hd multilevel regime and then into the pdel regime figure 3 1 bifurcation diagram for within group replicator dynamics and group type with maximal average payoff in assortment model the green lines refer to the group composition which maximizes average payoff of group members x r solid blue lines refer to stable equilibria of the within group dynamics while dashed blue lines describe unstable equilibria the gray dot dashed lines refer to the levels of assortment above which group payoff is maximized by full cooperator groups rb some level of cooperation can be achieved by within group selection alone rsw and all cooperation can be achieved by within group selection r a w we can further understand the content of the above bifurcation diagram by rewriting the trans formed payoffs of equation 3 2 in terms of the benefit cost synergy formulation of our social dilemmas under this parameterization the payoffs of cooperators and defectors are transformed under the as sortment process to take the form c d c b c d 1 r c r b c d d 1 r b 0 3 11 we can further think of the transformed benefits costs and synergies in terms of the expressions br 1 r b 3 12 a cr 1 r c r b c d 3 12 b dr 1 r d 3 12 c 14 now that we see how cr and dr change with the assortment parameter r we can reiterate information from the bifurcation diagram from figure 3 1 by showing how the payoffs move through the different regimes for within group dynamics and between group competition as we vary q in figure 4 2 we illustrate this for the two example games considered in the bifurcation diagram showing how the first game left first transitions between favoring intermediate cooperation to favoring full cooperation and then moves from pd to hd to pdel within group dynamics as r increases in contrast we see how a second pd game first experiences a transition to hd within group dynamics then between group dynamics favoring full cooperation followed finally by a transition to pdel within group dynamics as r is increased figure 3 2 illustration of regimes for within group and between group competition for various costs c and synergies d with b fixed to 2 5 left and 1 75 right markers correspond to transformed cost cr and synergy dr for various values of r j 10 j 0 10 blue circles correspond to games with intermediate group payoff optimum while green squares correspond to games in which full cooperator groups maximize collective payoff original game with r 0 is located at c d 1 1 left and c d 0 25 1 right while the transformed payoff with r 1 is given by c d 0 5 0 for both underlying games from the individual and group payoff functions we can calculate that rd 1 r c 1 r and that gr 1 using these expressions and equation 2 18 we can find that the average payoff at steady state is gr f x r we can compute that gr f x r t p 0 so the average payoff at steady state is increasing as assortment increases we can similarly use equation 2 17 to find that the minimum relevant selection strength to achieve cooperation is r r we compute that r r p t r p 0 15 and we see that we decrease the threshold of between group selection intensity as assortment decreases now we can take a look at the steady state densities under multilevel selection with game theoretic interactions featuring assortment with probability r in figure 3 3 for various assortment probabilities r and a fixed initial condition and relative selection strength we choose the game parameters 3 2 and 1 and can depict two scenarios by a choice of two different values of 1 shown in figure 3 3 left corresponds to the case in which rb rsw and between group selection begins to most favor full cooperation at levels of assortment below those needed to bring about some cooperation through within group selection alone the choice 1 4 shown in figure 3 3 right corresponds to the case in which rb rsw and within group selection can promote some cooperation at levels of assortment for which between group selection is still most favoring an intermediate level of cooperation in both cases we see the densities support increasing levels of steady state cooperation as r increases and that for the largest value of r depicted the within group dynamics now favor a stable mix of cooperation depicted with a vertical dashed line with the same color as the corresponding density because we keep the same relative selection strength as we increase the value of r we are well above the threshold selection strength r by the time we have reached within group dynamics resembling the hd game and therefore the density concentrates near full cooperation rather than the within group equilibrium in that case figure 3 3 steady state densities for 10 1 5 1 left and various values of the assortment parameter r for 3 1 5 1 and 0 25 vertical dotted lines correspond to the equilibrium for within group dynamics for the value of r whose corresponding steady state is displayed in the same color in figure 3 4 we can plot the average payoff at steady state for various values of and r we see that the threshold level of selection strength r needed to achieve cooperation is decreasing in r and that group payoff gr f is increasing in r for fixed values of in particular we see that a substantial amount of the gains in sustaining cooperation occur at levels of r well below rsw when within group selection would start to allow for some cooperation this highlights the synergistic effect of assortative interactions on helping to improve group level outcomes in addition to being individually advantageous for payoff in figure 3 5 we show a similar heatmap for a pd game with 0 for which assortment promotes bistability of full cooperation and full defection rather than coexistence of the two strategies for intermediate levels of r dynamics of this type are addressed in more detail in the discussion of the reciprocity models 16 figure 3 4 heatmap of average payoff at steady state gr f for various values of and r other parameters fixed as 1 5 1 and 2 the left dashed gray line refers to rsw and the right dashed gray line refers to raw the multilevel hd regime occurs for values of r between these two bounds and we observe that the threshold r needed to achieve cooperation vanishes in the limit that r raw figure 3 5 heatmap of average payoff at steady state gr f for various values of and r dashed gray line corresponds to level of assortment probability r such that cooperation becomes the globally stable outcome within groups other parameters fixed as 1 5 1 4 and 2 17 in figure 3 6 we provide a comparison between the highest payoff group x r with the average payoff of steady state for a fixed finite value of showing how this discrepancy varies as a function of r in the left panel we depict a case in which rb rsw while in the right panel we depict the opposite case in which rb rsw for the first case we see that defection dominates for r near 0 and we require r 0 1 to achieve a positive average payoff at steady state while in the right panel our choice of is sufficient to feature cooperation at steady state even when r 0 as r is increased the steady state average payoffs increases until it reaches the payoff of the full cooperation group at r raw 0 8 the level of assortment at which full cooperation is produced by individual level selection alone figure 3 6 maximal group payoff gr x blue and average payoff at steady state gr f green for various assortment parameters r and a fixed value of 7 parameters for game and initial condition are 3 2 1 and 1 for both images while we choose different values of as 1 left and 1 4 vertical dotted lines correspond to the equilibrium for within group dynamics for the value of r whose corresponding steady state is displayed in the same color we can also consider the composition of group with greatest abundance at steady state using the formulas considered in proposition 2 1 in figure 3 7 we show a comparison between the group type with maximal average payoff x r and the group type that is most abundant at steady state for a fixed value of plotted as a function of the assortment probability r in figure 3 8 we make the same comparison but this time consider the modal group type at steady state in the limit as for the finite case we see that the modal group type reaches full cooperation as r raw and the within group dynamics themselves favor full cooperation in the case of infinite we see that the modal group type at steady state features fewer cooperators than in the optimal group x r when r rb and then the optimal group and modal group as coincide at full cooperation when r rb in a sense we can think of having assortment at the level r rb serves to erase the shadow of lower level selection cast under the dynamics of multilevel selection for the underlying game played in groups with well mixed interactions 18 figure 3 7 group composition with maximal payoff x blue and group type that is most abundant at steady state for fixed relative strength of between group selection 8 plotted for various values of the assortment parameter r parameters for game and initial condition are 3 2 1 and 1 for both images while we choose different values of as 1 left and 1 4 vertical dotted lines correspond to the equilibrium for within group dynamics for the value of r whose corresponding steady state is displayed in the same color figure 3 8 group composition with maximal payoff x blue and group type that is most abundant at steady state green in the limit as plotted for various values of the assortment parameter r parameters for game and initial condition are 3 2 1 and 1 for both images while we choose different values of as 1 left and 1 4 vertical dotted lines correspond to the equilibrium for within group dynamics for the value of r whose corresponding steady state is displayed in the same color 4 indirect reciprocity now we turn to analyzing interactions with reciprocity mechanisms which punish defectors for their reputation of bad behavior and can help to stabilize populations with an established social norm of cooperation as a first example of reciprocity mechanism we consider a model of nowak and sigmund for social interactions with indirect reciprocity in which cooperators sometimes detect that their opponent is a defector and punish them for their defector status 36 this can be seen as a distinct mechanism from direct reciprocity in repeated games which we address in section 5 because 19 individuals are not necessarily punishing defectors for a transgression in a past interaction between the two players but because the defector has defected against someone in the population at all while we can incorporate more mechanistic descriptions of reputation effects 49 50 the model of nowak and sigmund is particularly tractible to include within our multilevel selection framework as in nowak and sigmund we assume when a cooperator interacts with a defector that they recognize the defector with probability q and punsish them with defection while with probability 1 q they do not recognize the defector and choose to cooperate using these rules we see that cooperators and defectors have the following expected payoffs q c x xr 1 x qp 1 q s 4 1 a q d x x qp 1 q t 1 x p 4 1 b for this process it can also be helpful to view the detection probability q and the expected payoffs in terms of a transformed payoff matrix c d c r 1 q s qp d 1 q t qp p 4 2 we can rearrange the payoffs of equation 4 1 to write them as perturbations of the payoffs from well mixed interactions as q c x xr 1 x s q 1 x p s c x q 1 x p s q d x xt 1 x p qx t p d x qx t p we can also rewrite the payoffs in the following form q c x 1 q c x q qp 4 3 a q d x 1 q d x qp 4 3 b and we can use these payoffs to see that the within group replicator dynamics are given by dx t dt x 1 x q c x q d x x 1 x 1 q q x 4 4 the within group dynamics have equilibria at 0 1 and a third point xeqq satisfying q c x eq q q d x eq q using equation 4 4 we see that this third equilbrium is given by xeqq 1 q q then we see that xeqq 0 for q and x eq q 0 for q further noticing that x eq q 1 when q 0 1 analyzing the stability of the equlibria 0 1 and x eq q we verify that 0 and 1 become bistable when xeqq decreases below 1 therefore achievement of cooperation through within group selection alone becomes possible when q increases above the threshold value qwg 4 5 20 average payoff in a group with fraction x cooperators is given by gq x x c x q 1 x p s 1 x d x qx t p g x qx 2 p s t qx 2 s t 2 p we can also write the group payoff in terms of q and the game parameters and as gq x p 1 q x q x 2 4 6 where we see that gq x interpolates between the well mixed group payoff function g 0 x p x x 2 g x with corresponding intermediate payoff optimum when 2 0 when q 0 to a payoff function g 1 x p x 2 increasing on all of 0 1 when q 1 we observe that gq x has a critical point at x q 1 q 2 q which is a local maximum when q 0 or when q further this critical point is biologically feasible when x q 1 or when q 2 1 0 1 for the prisoners dilemmas with intermediate fitness optima satisfying x 2 1 2 1 because the group type maximizing average payoff is 1 when x q 1 we see that the group type maximizing average payoff can be expressed as x q min 1 q 2 q 1 4 7 when x q is in the interior we can compute its derivative with respect to q to see that x q q 2 q 2 0 4 8 and therefore the group composition maximizing average payoff increases with q until reaching full cooperation we can also compute the average payoff of the population at the interior optimum x q which is given by gq x q 1 q 1 q 2 q q 1 q 2 q 2 1 q 2 2 4 q 4 9 we further see that gq x q is a decreasing function of q by computing gq x q q 2 1 q 4 q 2 1 q 2 0 4 10 where the inequality holds because we are considering the case in which x 1 and then we can apply equation 4 7 to see that enforces the constraint that 1 q 2 q and consequently 1 q 2 therefore we see that the maximal possible group payoff under our indirect reciprocity model actually decreases until the highest payoff group becomes the full cooperator group our subsequent analysis of the multilevel dynamics will show that this decrease in maximal possible payoff does not actually have an appreciable effect on the level of cooperation or collective payoff achieved as we increase the detection probability q we would also like to characterize the shift in regimes from group payoff most favoring interme diate levels of cooperation to to group payoff most favoring the full cooperator group we denote that the level of detection probability at which group average payoff is maximized at full cooperation by qbg 2 1 4 11 21 from analyzing the within group dynamics and the group average payoff we have defined two threshold quantities qwg and qbg describing respectively the detection probabilities needed to pro mote cooperation via within group selection and for full cooperator groups to have highest average payoff now we observe that qbg qwg so that the alignment of group average payoff to support full cooperation happens at lower detection probabilities than the probability of detection neeed to achieve cooperation by within group selection alone to see this we instead suppose that qwg qbg and use equations 4 5 and 4 11 to see that this is equivalent to 2 2 2 2 2 0 which contradicts the fact that 0 for the prisoners dilemma as a consequence it is not possible to both have locally stable full cooperation due to within group selection and a group level competition favoring a group with a mix of cooperators and defectors over full cooperator groups once we have enough detection to achieve cooperation within group for some initial group compositions we already also have that the fastest reproducing groups are full cooperator groups we can also compare values of rb and qbg to see whether a greater assortment probability or probability of detecting and punishing defectors is required to alter the group payoff function from being maximized by an intermediate level of cooperation to most favoring the full cooperator group we recall that pd games with intermediate payoff optima have payoff parameters satisfy 0 0 0 and 2 0 using these conditions and the expressions for rb and qbg from equations and 4 11 we see that 4 12 rb gbg 2 2 1 2 0 in particular a lower punishment probability under the q process is needed to align the group level interest upon favoring full cooperation than the equivalent assortment probability needed to do so under the r process from the above properties of individual and collective payoff functions qc x q d x and gq x we are able to illustrate in figure 4 1 the generic bifurcation for the two level q process dynamics for the pd with intermediate group payoff optimum in particular we see as q increases that optimal group composition x q increases to 1 as q increases to qbg while within group dynamics still favor full defection in this regime and the multilevel dynamics still resemble the pd then as q increases past qwg the unstable equilibrium x eq q appears allowing for the bistability of full cooperation and full defection under the within group dynamics and moving the multilevel dynamics into the sh regime as q further increases to 1 the basin of attraction of the full cooperator equilibrium expands to all possible within group states and the multilevel dynamics resemble the pdel game 22 figure 4 1 bifurcation diagram for within group replicator dynamics and group type with maximal average payoff for indirect reciprocity model green line describes group type x q with maximal average payoff of group members gq x solid blue lines describe stable equilibria of within group dynamics while dashed blue lines correspond to unstable equilibria the leftmost dot dashed gray line corresponds to qbg the detection probability above which group payoff gq x is best off with full cooperation and the rightmost gray line corresponds to qwg the detection probability above which full cooperation is locally stable within groups we can further understand the content of the above bifurcation diagram by rewriting the trans formed payoffs of equation 4 2 in terms of the benefit cost synergy formulation of our social dilemmas under this parameterization the payoffs of cooperators and defectors are transformed under the q reciprocity process to take the form c d c b c d 1 q c d 1 q b 0 4 13 we can further think of the transformed benefits costs and synergies in terms of the expressions bq 1 q b 4 14 a cq 1 q c 4 14 b dq b c q d 4 14 c now that we see how cq and dq change with the defector detection probability q we can reiterate information from the bifurcation diagram from figure 4 1 by showing how the payoffs move through the different regimes for within group dynamics and between group competition as we vary q in figure 4 2 we illustrate this for the example games considered in the bifurcation diagram showing how the game first transitions between favoring intermediate cooperation to favoring full cooperation and then 23 moves from pd to sh within group dynamics as q is increased before settling on the edge between the pdel and sh at q 1 figure 4 2 illustration of regimes for within group and between group competition for various costs c and synergies d with b fixed to 2 5 markers correspond to transformed cost cq and synergy dq for various values of q j 10 j 0 10 blue circles correspond to games with intermediate group payoff optimum while green squares correspond to games in which full cooperator groups maximize collective payoff original game with q 0 is located at c d 1 1 while the transformed payoff with q 1 is given by c d 0 0 5 for both underlying games using these formulas we see that g 1 and that qd 1 q c 1 q then when q qwg and the multilevel dynamics are of the pd type we see from equation 2 17 that the threshold level of relative selection strength needed to achieve cooperation is q q 4 15 further we see that q q qwg 0 so the relative level of between group competition needed to achieve any cooperation decreases to 0 in the limit as q qwg in which within group selection is sufficient to sustain cooperation through within group selection alone we notice that q q 0 so the threshold level of selection intensity needed to obtain any cooperation decreases as the recognition probability q increases using our formulas for 24 q d 1 q c 1 and gq 1 we can use equation 2 18 to see that the average payoff at the steady state density is gq f x q and we have gr f x r t p 0 so the average payoff at steady state is increasing as the probability of detecting defectors further we see that as q qwg that g q f x g 1 in agreement with the observation that the multilevel dynamics are in the sh regime when q qwg and the population should concentrate at the full cooperator equilibrium in figure 4 3 we illustrate the impact of introducing indirect reciprocity and increasing the defector detection probability q on the steady state densities of the multilevel dynamics for a fixed initial condition and relative strength of selection the leftmost and lightest colored curve corresponds to within group pd interactions without detection and punishment of defectors q 0 for which our value of is only slightly over the threshold level pd needed to produce a steady state density supporting some cooperation as we increase the parameter q the steady state densities with darker colored curves show increased support for cooperation with almost all groups consisting mostly of cooperators by the time q 0 625 figure 4 3 steady state densities for 10 1 5 2 1 and various values of the defector detection probability q in figure 4 4 we illustrate the average payoff at steady state as a heatmap depending on the detection probability q and the relative selection strength the figure shows that increasing q decreases the threshold q needed to achieve cooperation and therefore nonzero steady state payoff and increases the average payoff gq f the gray dashed line indicates the point wg at which we 25 transition from the pd regime to the sh regime in which full cooperation is achieved by any positive figure 4 4 heatmap of average payoff at steady state fitness gq f for various values of and q other parameters chosen as 1 5 1 2 the gray dashed line corresponds to qwg the point above which the full cooperator equilibrium is locally stable in figure 4 5 we show a comparison between the average payoff of the group type with maximal payoff gr x r and the average payoff of the population at steady state gr f for various defector detection probabilities q and a fixed value of relative selection strength as noted in equation 4 10 the maximal possible payoff of the population decreases with q until reaching the average payoff of the full cooperation group however we still see that the average payoff of the population at steady state is non decreasing in q for our chosen payoff parameters of the underlying game and our choice of the full defector group takes over the population for values of q less than around 0 15 and the average payoff of the population takes on its minimal value then cooperation persists at steady state for larger values of q and the average payoff increase with q until leveling off at gq 1 when q 0 8 and full cooperation becomes locally stable within groups transitioning us into the stag hunt regime in which any level of between group selection fixes full cooperation in the population 26 figure 4 5 maximal group payoff gq x blue and average payoff at steady state gq f green for various values of the defector detection probability q and a fixed value of 7 the gray dashed line corresponds to qwg the point above which the full cooperator equilibrium is locally stable in figure 4 6 we show a comparison between the group type x q which maximizes average payoff gq x to the group type which is most abundant in steady state as characterized by proposition 2 1 for various defector detection probabilities q and a fixed value of we see that for our choice of payoff parameters and that we require q 0 25 to achieve a positive level of cooperation as the modal outcome at steady state and that this most abundant group composition then increases with greater detection probability q before reaching full cooperation at q 0 8 the point at which the full cooperator group becomes locally stable under the within group replicator dynamics with indirect reciprocity we make a similar plot in figure 4 7 but this time the modal steady state group composition we depict is for the limit as here we see that the most abundant group type as agrees with the optimal group type x q whenever the optimum features full cooperation and that otherwise there are fewer cooperators than optimal in the modal group type even as by including the effects of indirect reciprocity we see that detection probabilities of at least 30 percent can in a sense eliminate the shadow cast by lower level selection in the multilevel dynamics governed by the original payoff matrix 27 figure 4 6 group composition with maximal payoff x blue and group type that is most abundant at steady state green for fixed strength of between group competition 7 plotted for various values of the defector detection probability q figure 4 7 group composition with maximal payoff x blue and group type that is most abundant at steady state green in the limit as plotted for various values of the defector detection probability q 28 5 multilevel selection in a repeated game the deterministic evolutionary dynamics of strategies in the repeated prisoners dilemma was explored by imhof et al who demonstrated that cylces and stable fixed points can be achieved under the replicator dynamics in a single group with players of always cooperate all c always defect all d and tit for tat tft 51 in this section we will analyze the multilevel dynamics for equation 2 13 for which strategic interactions consist of a repeated pd and the population is composed of individuals playing all d and either tft or a the strategy grim trigger grim the grim strategy specifies that a player cooperates in the first round and then continues to cooperate until their opponent defects against them after which the player will punish their opponent by defecting thereafter a tft player cooperates in the first round and reciprocates their opponent s action from the previous round in all subsequent rounds when playing against an opponent with the same strategy both a tft and grim player will always cooperate because they and their opponent start the first round by cooperating and reciprocate with cooperation in all previous rounds when playing against an all d player both a tft and grim player will cooperate in the first round and then punish their opponent with defection in all subsequent rounds because the payoffs will be the same if we consider a population of tft and all d players or a population of grim and all d players we will stick to the name tft for convenience we will denote by x the fraction of tft strategists in a group where the remaining fraction 1 x of group members play all d if the discount rate for a time step or alternately the probability of termination of the repeated game is then the expected payoff for pariswise interactions in a population of tft and all d players follow the payoff matrix tft all d tft r 1 s p 1 all d t p 1 p 1 5 1 where these expected payoffs come from the rule that tft players cooperate until they meet a first defection from a defector then the expected payoffs to tft and all d players in a group composed of fraction x tft players are c x x 1 1 r 1 x s 1 p d x x t 1 1 p 1 x 1 1 p in terms of the original pd payoff matrix we can rewrite the payoffs as c x c x 1 xr 1 x p 5 2 a d x d x 1 p 5 2 b this means that the payoff difference between tft players and all d players in an x cooperator group 29 is c x d x c x d x 1 r p x 1 1 1 x 5 3 then we have that the within group replicator dynamics are given by dx t dt x 1 x 1 1 1 x 5 4 and we see that the defector s advantage in a full cooperator groups is given by d 1 c 1 1 1 1 5 5 from here we see that a defector in an otherwise full cooperator group has a payoff advantage over its peer cooperators when w 5 6 while the cooperators have greater payoff than that defector when w in particular this means that the fixed point at x 1 will be locally unstable for w and locally stable for w for our repeated games with a given discount rate the average payoff of group members is given by g x x c x 1 x d x 5 7 1 1 x c x 1 x d x 1 p r p x 2 5 8 and this can be simplified in terms of our parameters and as g x p x 1 x 2 5 9 we also find that the average payoff in a full cooperator group is g 1 1 1 1 5 10 using the quantities calculated above for individual and collective payoff functions c x d x and g x we are able to illustrate in figure 5 1 the generic bifurcation for the two level dynamics for the repeated pd with intermediate group payoff optimum 30 figure 5 1 bifurcation diagram for within group replicator dynamics and group type with maximal average payoff for direct reciprocity model qualitatively this has the same behavior as the bifurcation diagram for the indirect reciprocity model of section 4 the green line represents the group type with maximal average payoff x the solid blue lines represent stable equilibria of the within group dynamics and the dashed blue lines represent unstable equilibria the dash dotted gray lines represent b left and w right corresponding to the threshold values of above which group payoff is maximized by full cooperator groups and the full cooperator group becomes locally stable under the within group dynamics respectively as with the other mechanisms we recover the well mixed group payoff function as 0 and we find that g x can become arbitrarily large as nears 1 therefore for sufficiently strong discounting we can make the benefit of full cooperator groups as strong as we would like enabling establishment of cooperative density steady states for relatively lower relative selection strength when 0 w the multilevel dynamics are in the pd regime so we expect to see density steady states of the form of equation 2 16 when relative selection strength is sufficiently large w then we can use the expressions from equations 5 3 and 5 10 for the repeated game to find that the average payoff of the population at steady state is g f x 1 1 1 1 5 11 computing the partial derivative of average payoff with respect to g f x 1 1 2 0 we see that the fitness of the population is increased by additional discounting similarly we can calculate from equation 2 17 that the threshold to establish cooperation through multilevel selection 31 is given by 1 1 1 5 12 and we find that 1 1 2 0 so the threshold for cooperation is decreasing in and cooperation is facilitated by additional discount ing in figure 5 2 we illustrate the average payoff of the population at steady state for various values of relative selection strength and discount factor unlike the previously studied mechanisms we see that higher values of average payoff are achieved for larger discount factors than for the average payoff achieved in the large payoff limit for the well mixed game we also illustrate the threshold level of relative selection strength needed to sustain cooperation at steady state by the gray dashed line figure 5 2 average payoff of the population at steady state for various values of and in the multilevel repeated pd dynamics downward sloping dotted gray line represents the threshold level of need to produce cooperation for given discount factor as we see that discounting improves the maximal possible payoff achieved by groups it is po tentially unfair to measure payoff for an entire repeated game in terms of the payoff matrix of the one shot stage game alternatively we can consider the possibility of measuring the payoff of the repeated game in the units of the stage game using the notion of discounted average payoff 52 we 32 discount the realized payoffs of tft and all d players by a factor of 1 corresponding to counteract the denominator 1 1 corresponding to the receipt of payoffs over the potentially infinite horizon of the game we can introduce the discounted average payoffs for the tft grim and all d strategies as c x 1 c x and d x 1 d x using equation 5 2 we can see that the discounted average payoffs take the form c x 1 c x p 5 13 a d x 1 d x p 5 13 b from these expressions we see that the discounted average payoffs under direct reciprocity take the same form as the payoffs qc x and q d x from equation 4 3 from our model of indirect reciprocity except with the discount factor taking the place of the defector detection probability q therefore we see that multilevel selection for our repeated games with discounted average payoff for a given discount factor will have the exact same long time behavior as the same game under our indirect reciprocity model with a detection probability q taking the same value as the discount factor intuitively this equivalence makes sense because both involve a fraction of events in which the interaction between a defector and a conditional cooperator result in the standard s and t payoffs and a complementary fraction in which the interaction represents a punishment defection by the conditional cooperator that results in a payoff of p for each player the mechanism for generating the analogous weighted payoff is different as the indirect reciprocity model involves averaging one s payoffs across interactions with different individuals while the weighted average in the direct reciprocity model comes from the expected fraction of interactions in the initial round and the subsequent punishment phase when a tft grim player meets an all d player in future work it will be interesting to explore the extent to which direct and indirect reciprocity mechanisms display different behavior if we expand the strategy space to include at least three interacting strategies which will introduce higher order dilemmas that arise due to neutral invasions of strategies that agree along the equilibrium path but are less robust to subsequent invasions 53 55 6 graph structure within groups we can also study our multilevel selection process when the game theoretic interactions and within group selection events take place on a k regular graph a random graph where each node has exactly k edges for within group dynamics these evolutionary games were studied by ohtsuki and coauthors 34 35 there are other ways to derive individual level replicator equations arising from games played on graphs such as those considered by tarnita and coauthors 56 57 here we focus on ohtsuki s replicator equations for graphs in part because the equations have been associated with a new payoff matrix whose well mixed replicator dynamics agree with the realized dynamics for the graph structured population playing the original game this payoff transformation is an example of the notion of an effective game as characterized by kaznatcheev 58 in which the transformed payoff matrix provides a description of the resulting time trajectories for cooperation and defection under the replicator dy namics the approach has proven useful for attempting to understand the game theoretic interactions taking place in cell cultures for experiments on the dynamics of cancer 59 and virus 60 evolution here we are interested in seeing how the effective payoff matrices obtained by ohtsuki and coauthors and the underlying microscopic interactions on the graph structured population reductive games as described by kaznatcheev can impact the dynamics of multilevel selection when games are played on k regular graphs 33 ohtsuki et al derived different versions of the replicator dynamics of graphs corresponding to the rules by which individuals updated their strategy the processes studied included death birth updating db a random individual is chosen to die and its neighbors compete with probability proportional to payoff to reproduce and replace their neighbor birth death updating bd an individual is chosen to reproduce with probability proportional to payoff and their offspring replaces a randomly chosen neighbor imitation updating im an individual is chosen at random to possibly revise their strategy and they pick either to imitate a neighbor s strategy or retain their own strategy with probability proportional to payoff pairwise comparison updating pc a random individual is chosen to reconsider their strategy by comparing to a randomly chosen individual and imitates their role model with probability proportional to the difference in their payoffs 34 35 it was shown by ohtsuki and nowak that the pc rule had the same replicator equation as the bd rule and therefore they primarily considered the qualitative differences between the db bd and im update rules 35 they derived effective replicator equations for the changing fraction of cooperators x in a population living on k regular graphs playing a cooperative dilemma with the payoff matrix of equation 2 1 and using one of the three update rules for strategy revisions a main result of that paper is the so called ohtsuki nowak transformation in which the effective individual level replicator equation for a given n strategy game and update rule is shown to satisfy the well mixed replicator equation for a new payoff matrix in the context of two strategy social dilemmas with payoff matrices as in equation 2 1 the new payoff matrix takes the form c d c r s burk d t burk p 6 1 where burk is the change in effective payoff or imitation rates received in a cooperator defector interac tion for the given update rule ud db bd im for the three update rules the shifts in payoff were given in equation 2 of ohtsuki and nowak 35 by bdbk k 1 r s t k 1 p k 1 k 2 2 k k 1 k 2 6 2 a bbdk r s t p k 2 2 k 2 6 2 b bimk k 3 r 3 s 3 t k 3 p k 3 k 2 3 2 k k 3 k 2 6 2 c for any pd game we know that 2 r s t p r t 0 s p 0 0 and therefore the term proportional to 2 0 decreases the effective payoff of a cooperator and increases the effective payoff of a defector when cooperators and defectors meet therefore in the bd 34 case it turns out that the effective payoff matrix of equation 6 1 hurts cooperation for any pd game r p 0 and therefore we know that the term proportional to in the payoff shift burk is beneficial to cooperators whether the update rule provides a beneficial shift to the cooperator or defector in a cooperator defector interaction depends on the graph s degree k and the relative values of the payoff parameters and 2 further because k 1 k 3 and 2 3 2 we know that bdbk b im k so the bd update rule is more conducive to favoring cooperation than the im update rule using the well mixed individual level replicator equation for games with payoff matrices of the form of equation 6 1 the ohtsuki nowak transformation tells us that the within group replicator equations on k regular graphs for update rule ur are dx t dt x 1 x burk x 6 3 which has the usual endpoint equilibria of 0 and 1 as well as the potentially interior equilibrium x eq ur burk 6 4 for convenience we will often use the shorthand notation jurk b ur k x to represent the rate of birth or imitation of cooperators relative to defectors with the corresponding differential equation written as dx t dt x 1 x jurk x 6 5 in the well mixed population we know that the full defector equilibrium x 0 is globally stable under the within group dynamics while the full cooperator equilibrium is unstable under the within group dynamics when game theoretic interactions take place on a k regular graph the all defector equilibrium becomes unstable when jurk 0 0 and cooperators outperform defectors for reproduc tion imitation in groups with few cooperators the full cooperator equilibrium becomes stable under the within group dynamics on graphs when jurk 1 0 and cooperators outperform defectors for reproduction imitation in groups with many cooperators furthermore we can determine the possible bifurcation behaviors by examining the relative values of jurk 0 and j ur k 1 when 0 we know that burk b ur k and j ur k 0 j ur k 1 this means that stability of the full cooperator equilibrium implies the instability of the full defection equilibrium so the possible dynamical behaviors of within group selection for any our update rules and 0 are dominance of defectors dominance of cooperators or coexistence of a stable mix of cooperators or defectors if instead 0 we see that burk b ur k and j ur k 0 j ur k 1 this means that instability of the full defection equilibrium implies instability of the full cooperator equilibrium meaning that the possible dynamical behaviors for 0 are dominance of defectors dominanxce of cooperators or bistability of the full cooperation and full defection equilibria in other words the 0 case allows within group dynamics on graphs analogous to the well mixed dynamics of a prisoners dilemma hawk dove game or prisoners delight while the 0 case allows for within group graph replicator equations with well mixed dynamics for the prisoners dilemma stag hunt game or prisoners delight now that we have discussed the within group dynamics for interactions taking place on k regular graphs we now need to consider the role that within group graph structure plays in the competition between groups due to the average payoff of group members notably while the replicator dynamics on graphs is equivalent for the replicator dynamics for the game with the appropriate ohtsuki nowak 35 payoff transformation on a well mixed population we see that the total payoff generated by interactions following the payoff matrix in equation 6 1 is 2 r for two cooperators 2 p for two defectors and s t for a cooperator and a defector so the average payoff for a group playing a game on equation 6 1 is still equal to g x p x x 2 equal to the average payoff in a group for interactions following the original payoff matrix 2 1 as a result the payoff transformation doesn t actually change average payoff but rather transfers payoff from defectors to cooperators when a cooperator and defector play against each other because the transformed payoff matrix doesn t reflect how average group payoff changes when interactions occur on a k regular graph we must calculate average group payoff on these graphs to study the dynamics of our multilevel selection process however we can use some of the calculations from the pair approximations of ohtsuki and coau thors 34 35 to determine the average payoff obtained in a population with fraction x cooperators and with individual level selection on a k regular graph following any of the update rules under consider ation for a cooperator on such a regular k graph a cooperator and defector receive expected payoffs of kc x qc cr qd cs 1 qd c r qd cs 6 6 a kd x qc dt qd dp qc dt 1 qc d p 6 6 b where q a b is the conditional probability that the neighbor of an b player is an a player using the pair approximation of ohtsuki et al 34 35 the conditional probability of connections equilibrates to qc d k 2 k 1 x 6 7 a qd c k 2 k 1 1 x 6 7 b for all three of our update rules plugging the interaction probabilities of equation 6 7 into our expression for expected payoffs in equation 6 6 we further see that kc x r k 2 k 1 s r 1 x 6 8 a kd x p k 2 k 1 t p x 6 8 b remark 6 1 we note that the pair approximations for qc d and qd c and within group dynamics of equation 6 3 derived by ohtsuki and coauthors hold under certain weak selection assumptions for individual level competition 34 35 but we will consider the resulting within group selection dynamics occuring simultaneously with between group selection events at a different level of selection so we may need to also consider a sufficiently weak intensity of between group competition in order to have within group and between group competition operating on comparable time scales because the expressions for individual payoff for cooperator and defectors in x cooperator groups agree across our three update rules we will denote by gk x the average payoff of group members in an x cooperator groups with within group interactions and competition on a k regular graph with any our update rules we can calculate this average payoff by computing gk x x kc x 1 x k d and we find that this satisfies gk x p k 2 k 1 s t 2 p x r s t p x 2 1 k 1 r p x 6 9 noting that r p so we can also write our group payoff function for k regular graphs in 36 terms of our usual parameters 6 10 gk x p k 1 x k 2 k 1 x 2 k 2 k 1 p x x 2 1 k 1 p x we observe from equation 6 10 that gk x is a convex combination of the well mixed group payoff function g x p x x 2 for our two player game and p r p x a scaled version of group level payoff function in the frequency independent luo mattingly model for k 3 the group function gk x places 1 2 weight on r p x and 1 2 weight on the well mixed group payoff function while we recover the well mixed group payoff function in the limit as k unlike in our models for assortment and reciprocity our model does not fully interpolate from the original group payoff function from the well mixed game theoretic interactions following equation 2 1 to a regime favoring full cooperation with collective payoff linearly proportional to the fraction of cooperators as we vary our neighborhood size parameter k between the well mixed limit as k and the smallest possible k regular graph with k 3 in particular we still an equal weight placed upon the original group payoff and the luo mattingly group payoff function even in the sparsest graphs we consider meaning that the mechanism of including k regular graph structure is not guaranteed to eliminate the possibility of collective payoff being optimized by an intermediate mix of cooperators and defectors however for many of our games of interest placing interactions onto a sufficiently sparse k regular graph does shift the average payoff function gk x to make the full cooperator groups the most competitive in between group competition we illustrate this through the following example consisting of a family of pd games with 1 previously studied because the well mixed within group dynamics are exactly solvable 18 example 6 2 for 3 2 2 1 we see that g k x 1 k 1 2 k 2 k 1 x 0 when x k 1 2 k 2 1 2 k 2 so for k 3 we see that g 3 x has its only critical point at 12 1 3 2 so g 3 x is maximized at x 3 1 in the well mixed limit we see that limk gk x is maximized at x 2 3 4 1 therefore a game with such and has average group payoff maximized at an interior fraction of cooperators in 0 1 with well mixed interactions but allowing interactions for the same game to take place on a 3 regular random graph allows average group payoff to be maximized with full cooperation notably the choice of k 3 is required for the games with 3 2 5 3 and 1 as an intermediate payoff optimum is achieved for 4 regular graphs when g 4 1 5 3 0 or 5 3 what this example illustrates is that for a two player game for which the group average payoff g x is maximized at an interior strategy x 0 1 for well mixed groups it is possible for average group payoff to be maximized at x 3 1 when within group interactions occur on regular k graph for k 3 in other words the presence of graph structure within groups can facilitate further promotion of cooperation in selection at the between group level in particular by increasing the point at which average group payoff gk x is maximized decreasing the degree of social interactions k can facilitate 37 greater abundance of groups with large fractions of cooperators as and in particular choosing small enough k can shift the multi level selection dynamics from a regime where the most abundant group type at steady state x k 0 1 as to one where full cooperation is the most abundant group type in the large limit in fact we can generalize the idea of example 6 2 to understand how the number of neighbors k impacts the shape of the group payoff function gk x and the types of group that maximize collective payoff in the setting of game theoretic interactions taking place on k regular graphs in lemma 6 3 we show for any pd game with intermediate group payoff optimum x 1 under well mixed interactions that the maximizer of average payoff of group members x k is a decreasing function of k we also derive threshold quantities for the number of neighbors required to produce a group payoff function gk x maximized at full cooperation in terms of x lemma 6 3 consider a pd game with intermediate group payoff optimum x 2 then the group composition x k which maximizes the collective payoff gk x for interactions on a k regular graph is given by x k min 1 k 2 k 1 x 1 2 1 6 11 furthermore this expression is a decreasing function of k when x k 1 and we know that the full cooperator group maximizes group payoff gk x for sufficently neighborhood sizes k 3 2 x 2 1 x additionally we know that there is actually a neighborhood size k zk 3 such that gk x is maximized by full cooperation when x 3 4 and consequently 3 4 proof we can start by differentiating the group payoff function g k x and finding the critical point at which g k x k 1 2 k 2 k 1 x 0 which is satisfied for k 2 k 1 x 2 1 2 k 1 x 1 k 2 k 1 x 1 2 because gk x is concave we know that this critical point maximizes group payoff when it is feasible and otherwise gk x will increase on 0 1 until reaching an endpoint maximum at 1 combining these cases yields the piecewise expression for the group optimum x k of equation 6 11 furthermore the critical point falls outside the interior of feasible population states in 0 1 when k 1 x 1 2 k 2 or when k 3 2 x 2 1 x so those are the cases in which x k 1 and full cooperation has the highest collective payoff for interactions on a k regular graph there will be a feasible number of neighbors k 3 for which full cooperation is collectively optimal when 3 3 2 x 2 1 x x 3 4 38 when x 1 we can differentiate our expression for x with respect to k to see that x k k 1 k 2 2 1 2 x 0 where the inequality follows from the fact that r p 0 for the pd game and therefore and x 2 1 2 from this calculation we see that interior group optima x increase in their level of cooperation as the number of neighbors k decreases so sparsity of graphs begets a greater importance of higher levels of cooperation now that we have characterized the within group birth death dynamics and the average payoff of group members for games played on k regular graphs we can now define our multilevel dynamics by coupling within group and between group competition we can describe a multilevel selection process with groups having within group interaction on k regular graphs with an update rule ur db bd im using the following pde 6 12 f t x t x x 1 x jurk x f t x f t x gk x g f t we can also describe these multilevel selection more explicitly in terms of our graph and payoff param eters in the following form 6 13 f t x t x x 1 x burk x f t x f t x k 1 x k 2 k 1 x 2 k 1 m f 1 k 2 k 1 m f 2 a distinction from the multilevel dynamics of equation 2 13 defined in terms of our payoff func tions with the structure parameter is that the within group birth and death dynamics are governed by the net flux of cooperators and defectors jurk x derived from the ohtsuki nowak transformation rather than the defector s advantage kd x k c x at the end of the day we are able to under stand formulas in section 2 1 that characterize the steady state behavior of the population by simply plugging in jurk x anywhere we see c x d x but it is helpful to reiterate them in terms of our notation for multilevel selection with interactions on graphs in particular we can see from equation 2 17 the threshold level of between group competition intensity needed to achieve cooperation for a given update rule when full defection dominates within groups is given by k ur jurk 1 gk 1 gk 0 6 14 and we can see from equation 2 22 that the average payoff of the population at steady state is given by g f x gk 1 1 k ur 6 15 when the full defector equilibrium is unstable and the within group dynamics resemble those of a well mixed hd game and we use versions of equation 2 21 and equation 2 22 by replacing the term for defector s advantage in a many cooperator group d 1 c 1 with the net flux of defectors 39 in a many cooperator group jurk 1 in that case the within group dynamics have a stable interior equilibrium xeqk ur satisfying j ur k x eq k ur 0 to achieve level of cooperation greater than xeqk ur via multilevel selection the relative strength of between group competition must exceed the following threshold value k ur jurk 1 gk 1 gk x eq k ur 6 16 and the average payoff at density steady states for k ur is given by g f gk 1 gk 1 gk x eq k ur 6 17 in the subsequent sub sections we will proceed to study the effects of k regular graph structure and the different update rules on the ability to support cooperation through within group selection and through multilevel selection we will quantify the ability for graph dynamics to support cooperation through inequalities for the payoff parameters x 2 and with an emphasis on understanding for which games can a given neighborhood size k and update rule help a population achieve greater cooperation than is possible for well mixed through individual and multilevel selection we will discuss death birth updating in section 6 1 birth death updating in section 6 2 and imitation updating in section 6 3 6 1 death birth updating for a given value of k we can analyze the stability of equilibria for the within group dynamics and the threshold level of between group selection k db using the values of the relative flux of cooperators in the full defector group and the full cooperator group jdbk 0 and j db j 1 for the db updating rule we will focus on pd games in which 0 including the subclass of pds with intermediate payoff optima whose payoff matrices satisfy the further restriction that 2 0 in proposition 6 4 we collect results on conditions on the payoff parameters x 2 and permitting the instability of the full defection equilibrium the stability of the full cooperation equilibrium and a decreased threshold in the intensity of between group competition required to bring about cooperation relative to the within group selection in particular we find threshold levels the maximizer of the group payoff function x to achieve these results beneficial to cooperation which allows us to see whether graph reciprocity can help to produce greater cooperation when the underlying game theoretic optimum favors groups with an intermediate level of cooperation proposition 6 4 consider pd games with 0 and within group dynamics on a k regular graph with db updating for such games there exist the threshold quantities tdb 0 k k 1 2 k k 1 2 6 18 a tdb 1 k k 1 k 1 2 k k 1 2 6 18 b tdb k k 1 2 k 1 k 6 18 c such that the full defector equilibrium is unstable when x tdb 0 k the full cooperator equilibrium is table when x tdb 1 k and multilevel selection is favored for k regular graph interactions relative 40 to well mixed interactions i e k db k when x tdb k furthermore these threshold quantities satisfy the following ranking tdb k t db 0 k t db 1 k remark 6 5 these threshold values illustrate two key differences between multilevel selection with death birth graph reciprocity and multilevel selection with our previous assortment and in direct reci procity mechanism with those mechanisms we saw that any pd game increasing the assortment or punishment probabilities would always help decrease the threshold needed to produce increase co operation via multilevel selection however for db updating games satisfying x tdb k actually experienced an increased threshold k db relative to the threshold for well mixed interactions addition ally because we are considering pd games with 0 and graphs with k 3 we see that k 1 k 1 2 k 1 and k 1 2 0 this tells us that tdb 1 1 1 so consequently no game with intermediate optimum x 1 can achieve local stability of the full cooperator equilibrium this means that for such games the best within group selection with db updating can achieve is a coexistence of cooperators and defec tors this stands in contrast to the behavior of the previous assortment and reciprocity mechanisms for which values of r q or sufficiently close to 1 will guarantee global stability of the full cooperator equilibrium under the within group dynamics in these two senses graph reciprocity can be seen as a weaker mechanism for promoting cooperation through individual and multilevel selection for games with intermediate fitness optima proof we know that the full defector equilibrium become unstable when jdbk 0 2 k k 1 k 2 0 using the fact that 0 we can rearrange this inequality to find that x 2 k 1 2 k 1 2 6 19 a we can similarly derive the condition for stability of the full cooperator equilibrium by knowing that it is stable when jdbk 1 2 k k 1 k 2 0 and rearranging to find that x 2 k 1 k 1 2 k k 1 2 6 19 b to determine whether the threshold k db to achieve steady state cooperation under multilevel selection is less than the threshold for multilevel selection in populations with well mixed interactions we can use equation 6 14 and our expression for to see that this requires jdbk 1 gk 1 gk 0 g 1 g 0 6 19 c 41 noting that gk 1 g 1 and gk 0 0 g 0 we see that it now suffices to show that jdbk 1 2 k k 1 k 2 and furthermore that this reduces to showing that 2 k k 1 k 2 0 6 19 d finally we can rearrange this inequality to show that k db when x 2 k 1 2 1 k 6 19 e now we move on the the ranking of the thresholds to show that tdb k t db 0 k we use the fact that 0 and k 3 to see that tdb 0 k t db k k 1 2 1 k k 2 k 1 2 k 0 similarly to show that tdb 1 k t db 0 k we use that 0 and that k 3 to see that tdb 1 k t db 0 k k 1 k 1 2 k k 1 2 k k 2 k 1 2 k 0 we now illustrate some of the consequences of the threshold quantities we derived in proposition 6 4 in figure 6 1 we illustrate the regions of the payoff parameter space for which within group and between group selection are hindered or favored by placing interactions on a 3 regular graph relative to well mixed interactions from the thresholds in equation 6 18 we are able to characterize these different qualitative regimes through the parameters x 2 and going from left to right the four regions depicted are games that do not satisfy the requirements to be a pd game as x 1 2 so 0 and r p games for which x tdb 3 so within group selection cannot produce cooperation and the threshold to produce cooperation via multilevel selection is higher than the case of well mixed interactions games for which tdb 3 x tdb 0 3 so within group selection can t produce cooperation on its own but the threshold is decreased for promotion cooperation via multilevel selection games for which x tdb 0 3 so cooperation is facilitated both for within group selection and for multilevel selection additionally we notice that all three qualitative regimes for the pd game occupy some portion of the parameter space in which x 1 so games with intermediate levels of cooperation can have individual level selection that is helped unhelped or helped and have multilevel selection that is helped or hurt by placing interactions on a 3 regular graph 42 figure 6 1 regions of payoff parameter space in which multilevel selection and individual level selection is helped or harmed by placing interactions on a k regular graph relative to well mixed social interactions payoff matrices parametrized by values of group optimum x and the ratio top panel provides a parameter regime including both edge and intermediate group optima while right panel focuses on the case of intermediate group optima is and ms stand for individual level selection and multilevel selection respectively to understand the impact of graph structure on within group selection in games with interme diate group payoff optimum x 1 we can make an effort to quantify the portion of games for which interactions with a given neighborhood size k can promote cooperation under death birth updating one notion for describing population structures which are more conducive to cooperation is the volume order introduced by pena et al 61 which in the context of groups of infinite size describes the volume of games in the parameter space of payoff matrices for which a given population structure promotes at least some cooperation at steady state for our k regular graphs and games with intermediate group optima we can introduce a notion of volume order by looking to figure 6 1 and measuring the area a k of the triangle bounded by the x axis the line x 1 and the line tdb 0 k k 1 2 k k 1 2 noting that the x intercept of tdb 0 k is k 1 2 and tdb 0 k intersects with x 1 at 1 k we see that the area of the triangle is given by a k 1 2 1 k 1 2 k 1 k 1 4 k 1 k 2 6 20 differentiating with respect to k we see that a k 1 4 k 2 2 k 1 0 for k 2 43 allowing us to see that a k is maximized by k 3 the sparsest possible k regular graph under consideration in particular this means that having fewer neighbors helps promote cooperation through within group selection for the greatest proportion of games with intermediate payoff optima we further address the issue of threshold relative selection strength k db in figure 6 2 here we plot this threshold quantity as a function of k for three different values of dots and compare these to the threshold selection levels for well mixed interactions dashed lines for 1 black dots and 1 2 we see that there are sufficient small neighborhood sizes k for which the threshold is increased by placing interactions on the k regular graph while for 1 5 we see that the threshold quantities k db are less than the case of well mixed interactions pd for all values of k z 3 for all three cases we see that there are intermediate values of k that minimize the threshold quantity k db telling us that intermediate sparsity of interactions can be most favorable for trying to establish cooperation via multilevel selection for games with intermediate payoff optima x 1 unsurprisingly we see that the thresholds k db approach the threshold of the well mixed case pd in the limit at k figure 6 2 threshold level of selection k db needed to achieve cooperation via multilevel selection as a function of neighborhood size k threshold levels shown for 1 black 1 2 and 1 5 with other parameters fixed as 3 2 1 and 2 the dashed horizontal lines corresponds to the threshold for multilevel selection for well mixed interactions and within group selection with the color of the line corresponding to the value of for the dots of the same color the vertical dashed line corresponds to the minimum neighborhood size k 3 for 1 and 1 2 there are sufficient sparse k regular graphs such that k exceeds the well mixed threshold while the threshold is decreases for all finite neighborhood sizes k when 1 5 we can gain additional understanding of the behavior seen in figure 6 2 by exploring the rela 44 tionship between k db and j db k 1 given by equation 6 14 as seen in equation 6 19 d we know that the threshold to achieve cooperation via multilevel selection is lower for interactions on a k regular graph than in a well mixed population i e k db pd when k 2 6 21 so there exist sufficiently large neighborhood sizes k such that placing interactions on a network can make cooperation easier to achieve because jk db 1 when k we also see that the relative benefit on k db vanishes as k becomes large hinting that there may be intermediate neighborhood sizes k for which the threshold to achieve cooperation is minimized in proposition 6 6 we characterize the pd games for which the neighborhood size k minimizes the threshold for achieving cooperation via multilevel selection k db proposition 6 6 the neighborhood size k satisfies k argminj z 3 k db when the critical point x 2 of the group payoff function g x under well mixed interactions satisfies one of the following inequalities x 5 7 3 7 k 3 b k 1 k x b k k 1 k 4 6 22 where b k k 1 k 2 3 k 2 2 k 2 k 2 2 k k 2 k 2 6 23 proof if we consider two neighborhood sizes k j we see from equation 6 14 that k db j db when bdbk b db j we can use equation 6 2 a to write this condition as 2 k k 1 k 2 2 j j 1 j 2 which we can further rearrange to write as jk 2 j k j 1 k 1 j k 2 j k 1 j k 6 24 using the assumption that j k we see that there is a threshold quantity b k j j 1 k 1 2 jk 2 j k 1 jk 2 6 25 such that dbk db j when x 2 b k j if instead we consider the case of k j we can see by dividing both sides o equation 6 24 by j k that dbk db j when x b k j next we see that b k j is a decreasing function of j as we see that b k j j k 1 2 2 k jk 2 2 2 k k 2 jk 2 2 0 because k 3 and 0 in particular this tells us that x b k k 1 is a sufficient condition to determine that x b k j for j k 1 and that x b k k 1 is a sufficient condition to determine that x b k j for j k 1 putting these two conditions together we see that for k 4 k db j db when b k k 1 x b k k 1 furthermore using equation 6 30 we can 45 see that b k k 1 k k 1 2 k k 2 k 2 1 2 1 2 2 k 2 k 2 k 2 2 0 therefore b k k 1 is a decreasing function of k and we deduce that the interval b k k 1 b k k 1 is non empty because we also see that limk b k k 1 12 there is a k large enough to satisfy x b k k 1 b k k 1 for any critical point x 1 2 and therefore for any pd game with 0 we can do a similar analysis for the case with k 3 in which case we see that 3 db j db for j 3 when x b 3 4 5 7 3 7 for the pd game with 1 we see the condition for the 3 regular graph provide the lowest threshold k db is given by x 5 7 3 7 1 8 7 1 this means that when 1 all pd games with intermediate payoff optima experience a minimum threshold k db for graphs with neighborhood sizes k 3 we can gain some intuition for the fact that intermediate neighborhood sizes are most conducive to promoting cooperation via multilevel selection by turning to the interaction probabilities from the ohtsuki nowak pair approximation because the conditional interaction probabilities qc d and qd c given by equation 6 7 are increasing functions of k we see that intermediate neighborhood sizes will allow for intermediate levels of clustering of cooperations and defectors for games favoring groups with a mix of cooperators and defectors choosing an intermediate k will allow for a greater frequency of the cooperator defector interactions that promote the maximum contribution to collective payoff we can also study the average payoff achieved by the population at steady state in figure 6 3 we compare the average payoff at steady state for multilevel selection with db updating on k regular graphs solid lines with the baseline behavior of the model for the same game with game theoretic interactions in well mixed groups dashed lines we consider graphs with k 3 left and k 5 right neighbors and consider three different values of in each case for both neighborhood sizes we see that the game with 1 10 falls within the regime for which x tdb 0 k resulting in some cooperation arising within groups even for low levels of cooperation and the nonzero average payoff for low and improved average payoff on both k regular graphs relative to the well mixed case for 1 2 we see that tdb 4 x tdb 3 so average payoff is increased relative to the well mixed case when k 4 but diminished when k 3 for 1 x tdb 3 and x tdb 4 so the average payoff at steady state is worse for interactions on both 3 regular and 4 regular graphs than in the well mixed case although the discrepancy is much less for the 4 regular graph 46 figure 6 3 average payoff of the steady state population for various values of relative selection strength for game theoretic interactions taking place on a k regular graph solid lines or in a well mixed group dashed lines number of neighbors on graph is k 3 left or k 5 right and the value of varies between 1 black lines 1 2 blue lines and 1 10 red lines other parameters chosen to be 3 2 1 1 and 2 6 2 birth death updating for birth death updating ohtsuki and nowak showed that full defection remained globally stable for any k regular graph for all of the games they considered 35 in fact one can show that this is true for all pd games and furthermore that the inclusion of graph structured interactions with bd updating increases the threshold relative selection strength needed to achieve cooperation via multilevel selection relative to the case of well mixed interactions we determine the stability of within group equilibria by examining the values of the flux jbdk x at the endpoints x 0 and x 1 for the all defector equilibrium we see that jbdk 0 2 k 2 0 0 because 0 and 2 r s t p 0 for all pd games and that k 3 for the family of k regular graphs under consideration this means that the all defection equilibrium remains stable for all k regular graphs under birth death updating for the all cooperator equilibrium we see that jbdk 1 r t 0 2 k 2 0 0 so the all cooperator equilibrium is unstable for all k under the birth death within group dynamics putting these two stability criteria together we see that defection is dominant under the within group birth death dynamics for any k regular graph this means that placing individual level competition on a k regular graph with birth death updating cannot help achieve cooperation on its own furthermore because the full defection equilibrium is always stable under within dynamics with bd updating we know that we can use equation 6 14 to express the threshold relative selection 47 strength needed to produce density steady states supporting cooperation as k bd jk bd gk 1 gk 0 2 k 2 pd pd is the threshold relative selection needed to support cooperation under well mixed interactions for pd games and therefore we see that a greater intensity of between group selection is needed to facilitate cooperation via multilevel selection when interactions occur on k regular graphs with the bd update rule we illustrate this increased difficulty of achieving cooperation by plotting the threshold levels k bd as a function of k in figure 6 4 where we see that the thresholds decrease monotonically as k increases from 3 approaching the thresholds for well mixed interactions in the limit as k from these increased threshold levels we see that bd updating does not promote cooperation at the individual level but even makes achieving cooperation more difficult when groups are able to compete according to their collective payoffs figure 6 4 threshold level of selection k bd needed to achieve cooperation via multilevel selection as a function of neighborhood size k threshold levels shown for 1 black 1 2 and 1 5 with other parameters fixed as 3 2 1 and 2 the dashed horizontal lines corresponds to the threshold for multilevel selection for well mixed interactions and within group selection with the color of the line corresponding to the value of for the dots of the same color the vertical dashed line corresponds to the minimum neighborhood size k 3 for all values of the threshold is greater on any k regular graph than for multilevel selection with well mixed groups 48 6 3 imitation updating now we discuss the dynamics of the im update rule this rule was shown in ohtsuki and nowak to have similar qualitative behavior to the db update rule for the individual level for several games although having slightly weaker support for cooperation for a given game and neighborhood size k 35 in proposition 6 7 we establish the game parameters x and for which within group and multilevel selection are more capable of producing cooperation with interactions on k regular graphs with im updating relative to the well mixed case the result and proof are analogous to those of proposition 6 4 as one can repeat similar steps by making appropriate use of net flux of cooperation at the endpoint equilbria jimk 0 and j im k 1 as mentioned in remark 6 5 for the db update rule the effect of graph structure on the within group and multilevel dynamics for the im rule differ from those of the assortment and reciprocity mechanisms in that there are some games and neighborhood sizes k for which placing interactions on a network can make cooperation more difficult than for interactions in a well mixed population proposition 6 7 consider pd games with 0 and within group dynamics on a k regular graph with im updating for such games there exist the threshold quantities t im 0 k k 3 2 k k 1 2 6 26 a t im 1 k k 3 k 1 2 k k 1 2 6 26 b t im k k 3 2 k 3 k 6 26 c such that the full defector equilibrium is unstable when x t im 0 k the full cooperator equilibrium is table when x t im 1 k and multilevel selection is favored for k regular graph interactions relative to well mixed interactions i e k im k when x t im k furthermore these threshold quantities satisfy the following ranking t im k t im 0 k t im 1 k remark 6 8 as in the case of the db update rule the combined behavior of the within group dynamics and the multilevel dynamics can be characterized by three possible regimes x t im k graph structure with im rule does not help produce cooperation within groups and multilevel selection for cooperation is hindered by an increased threshold relative selection strength k im t im k x t im 1 k graph structure does not help cooperation through within group selection alone but helps cooperation via multilevel selection by decreasing the threshold x t im 1 k graph structure allows cooperation to be brought about by within group selection alone and achieving additional cooperation via multilevel selection is helped by decreasing the threshold selection strength k im the regime in which multilevel selection is hindered through a decreased threshold k im is similar to the case of the db update rule but is not seen in the assortment and reciprocity models of sections 3 4 and 5 49 now we illustrate some of the consequences of proposition 6 7 for various games and neighbor hoods sizes k in figure 6 5 we illustrate the values of game parameters x and that fall into the different regimes highlighted by remark 6 8 for the cases of k 3 left and k 4 right for the case of k 3 we see that t im 3 1 2 1 and f we reduce from the ranking of threshold quantities that no pd game with intermediate optima x 1 can have cooperation improved relative to the well mixed cases for im updating with k 3 as shown in figure 6 5 left all pd games with intermediate group payoff optima fall into the regime in which individual level selection is not helped and multilevel selection is made more difficult by the addition of graph structure for the k 4 case in figure 6 5 we see that there is a small sliver of games with x 1 with sufficiently small values of such that cooperation can be increased both through individual level on graphs and through decreasing the threshold relative selection needed to achieve density steady states through multilevel selection figure 6 5 regions of payoff parameter space in which multilevel selection and individual level selection are helped or harmed by placing interactions on a k regular graph with the im update rule relative to well mixed social interactions payoff matrices parametrized by values of group optimum x and the ratio with graphs satisfying k 3 left and k 4 when k 3 all pd games with intermediate optima are harmed by within group selection while when k 4 there are some games with intermediate optima in which within group and between group selection are improved relative to well mixed interactions again we can turn to the notion of volume order to quantify the portion of pd games that support cooperation via individual level selection for a given neighborhood size k under im updating looking to figure 6 5 we see that we can characterize games with intermediate group payoff optima x 1 supporting cooperation by the area of the triangle bounded by the x axis the line x 1 and the line t im 0 k k 3 2 k k 1 2 noting that the x intercept of t im 0 k k 3 2 and that t im 0 k intersects x 1 when k 3 k k 1 we see that the area of this triangle is given by a k 1 2 1 k 3 2 k k 3 k k 1 1 4 k 3 k 3 k 2 k 1 6 27 because a 3 0 a k 0 for k 3 and limk a k 0 we see that cooperation is best supported by neighborhood sizes with intermediate values of k by differentiating with respect to k we have a k 1 16 k 3 k 1 2 k 3 27 k 18 50 applying descartes rule of signs to the term in square brackets we see that there is a single positive root k r of a k because a 3 1 96 0 and that limk a k this root k is the global maximizer of a k solving the cubic equation k 3 27 k 18 0 numerically we see that k 5 502 and we therefore test the values a 5 0 026 and a 6 0 0267 to see that a 6 a 5 and conclude that portion of games supporting cooperation a k is maximized by the neighborhood size k 6 unlike the case of death birth updating in which a k was maximized by k 3 we see that an intermediate number of neighbors is most conducive to cooperation via individual level selection over the range of possible pd games with intermediate group payoff optima we now display the effects of graph structure on the threshold relative selection strength k db to enhance cooperation via multilevel selection and the average payoff of the population at steady state gk f in figure 6 6 we plot the threshold level of relative selection strength k im as a function of the number of neighbors k for three different values of and fixed values of and for each of the three values that the threshold selection strength is greater for small neighborhood sizes k than it is for multilevel selection with well mixed interactions whose thresholds are depicted by dashed lines of the same color for sufficiently large k we see that all three of our threshold levels k im drop below the well mixed threshold value pd so placing interactions on k regular graphs can be beneficial for facilitating cooperation via multilevel selection at intermediate values of k unsurprisingly we see that the threshold relative selection strength eventually agrees with the well mixed threshold for sufficiently large k as our formula for k im from equation 6 14 predicts agreement in the limit as k figure 6 6 threshold level of selection k needed to achieve cooperation via multilevel selection as a function of neighborhood size k threshold levels shown for 1 black 1 2 and 1 5 with other parameters fixed as 3 2 1 and 2 the dashed horizontal lines corresponds to the threshold for multilevel selection for well mixed interactions and within group selection with the color of the line corresponding to the value of for the dots of the same color the vertical dashed line corresponds to the minimum neighborhood size k 3 for all values of 0 there are sufficiently sparse neighborhood sizes k such that the threshold needed to achieve cooperation is higher than under multilevel selection with well mixed interactions 51 we can further explore the behavior of figure 6 2 the relationship between k im and j im k 1 given by equation 6 14 as we saw in the case of the db update rule we can use equation 6 19 d to show that the threshold to achieve cooperation via multilevel selection is lower for interactions on a k regular graph than in a well mixed population i e k db pd when k 3 2 6 28 so there exist sufficiently large neighborhood sizes k such that placing interactions on a network can make cooperation easier to achieve because this threshold k is larger than the threshold for db updating it is possible that for small enough neighborhood sizes k that there are games for which k db pd k im in that case placing interactions on k regular graph can make cooperation easier to achieve for db updating and more to difficult to achieve for im updating relative to the case of well mixed within group dynamics as with the case of db updating we can calculate the range of group payoff peaks x for which the threshold selection strength k im is minimized by a given neighborhood size k we describe these ranges in proposition 6 9 and their derivation is analogous to the proof of proposition 6 6 proposition 6 9 the neighborhood size k satisfies k argminj z 3 k im when the critical point x 2 of the group payoff function g x under well mixed interactions satisfies one of the following inequalities x 7 6 4 3 k 3 b k 1 k x b k k 1 k 4 6 29 where b k k 1 k 2 7 k 12 2 k 2 k 6 6 k 1 k 2 k 6 6 30 in particular we notice that the threshold for cooperation k im is minimized by neighborhood sizes k 3 whenever x 7 6 4 3 meaning that k regular graphs with more than three neighbors are more conducive to cooperation than 3 regular graphs for all pd games with intermediate payoff optima this fits with the intuition provided in section 6 1 for the case of db updating and is in agreement with the observation from figure 6 6 that k im was minimzed by intermediate neighborhood sizes in the three examples considered next we turn to exploring the equilibrium behavior of the collective payoff of the group structured population in figure 6 7 we show the average payoffs of the steady state population gk f as a function of relative selection strength for various values of solid line and compare these to the average payoff at steady state for a population with well mixed interactions within groups dashed lines for the case k 3 shown in 6 7 left we see that the average payoff is worse when games are played on 3 regular graphs than in the well mixed population for all of our underlying games this is consistent with the formula from proposition 6 7 that all games with intermediate payoff optima x 1 see an increasing threshold 3 im relative to the well mixed case of well mixed groups for the case k 4 shown in figure 6 7 we see that the steady state payoffs on the 4 regular graph exceed the payoffs for the well mixed population for 1 14 and 1 50 while the graph case does worse than the well mixed case when 1 with our other parameters fixed at 3 2 and 1 these parameters were chosen to fit the three possible regimes for pd games with intermediate payoff optima in the k 4 case the choice 1 corresponds to the case in which x t im and the threshold 4 im pd 1 14 corresponds to the case in which t im x t im 0 in which 52 full defection remains stable within groups but 4 im pd and 1 50 corresponds to the case x t im 0 in which the within group dynamics can favor a small fraction of cooperators and additional cooperation can be facilitated by decreasing the threshold relative selection strength needed to support density valued steady states figure 6 7 average payoff of the steady state population for various values of relative selection strength for game theoretic interactions taking place on a k regular graph under the im update rule solid lines or in a well mixed group dashed lines number of neighbors on graph is k 3 left or k 6 right and the value of varies between 1 black lines 1 2 blue lines and 1 10 red lines other parameters chosen to be 3 2 1 1 and 2 6 4 behavior in the limit of strong between group competition for all three of our update rules we have seen that there exist neighborhood sizes k for which k ur pd and placing interactions on such k regular graphs makes achieving cooperation more difficult via multilevel selection in fact for bd updating the threshold k db is increased relative to the case of well mixed within group interactions for all neighborhood sizes k however we can also consider how within group network structure can change the level of cooperation achieved at steady state for relative selection strengths k ur in particular because we have seen from lemma 6 3 thatpd games with intermediate payoff optima under well mixed interactions can have group payoff functions gk x maximized by x k 1 for sufficiently small neighborhood sizes k we can expect that placing interactions on a sufficiently sparse k regular graph can help to erase the shadow of lower level selection in figure 6 8 we use our characterization of the optimal composition of cooperators x k from equation 6 11 and the characterization of the most abundant group type at steady state in the large limit from equation 2 23 to display the most fit and modal group types at steady state for various numbers of neighbors k for our choice of parameters we see that the most fit and most abundant group types agree at full cooperation between k 3 and k 9 while the most abundant group type at steady state decreases below the optimal level x k as the optimal level falls below full cooperation for larger values of k for even larger values of k the most fit and modal group types tend towards the values achieved by the underlying game in a population with well mixed group interactions in a sense the behavior we see for k between 3 and 9 is a means for eliminating the shadow of lower level selection as introducing graph structured interactions changes the collective payoff scenario from one most favoring an intermediate level of cooperation to one pushing for as much cooperation as possible 53 figure 6 8 comparison between group type with maximal payoff x k blue and most abundant group type at steady state in the limit as relative selection strength green for multilevel selection with the im update rule plotted as a function of the number of graph neighbors k the blue and dashed lines correspond to the corresponding group type with maximal payoff and most abundant group composition at steady state for well mixed interactions or the k limit for this example we used 31 16 and 1 the gray vertical dashed line corresponds to k 9 the largest value of k for which group payoff gk x is maximized by the full cooperator group for our choice of parameters 7 discussion in this paper we have illustrated the synergistic effects of assortment and reciprocity mechanisms with multilevel selection for promoting cooperation in group structured populations in particular we see that the effects of these mechanisms can help to promote cooperation via multilevel selection at structure parameters much smaller than is required to promote cooperation through individual level selection alone and we see that the mechanisms reduce the level of between group selection intensity needed to achieve cooperation relative to well mixed strategic interactions within groups in particular there are examples of k regular graph structures with death birth or imitation updating that cannot promote any cooperation in games with intermediate group payoff optima but yet these games and graphs can see decreased thresholds for relative selection strength to achieve cooperation via multilevel selection these results show us that studying the impact of these mechanisms on group performance provides a new window into the beneficial nature of local population structure further as noted in previous work on multilevel selection 19 pd games with intermediate payoff optima have often given less attention in the literature so these results combining multilevel selection and assortment or reciprocity mechanisms provide more motivation for further study of the promotion of cooperation in games with intermediate collective optima an interesting distinction arises between the effects on multilevel selection for the mechanisms of assortment indirect reciprocity direct reciprocity and the behavior exhibited when interactions 54 are placed on k regular graphs we recall that the the first three mechanisms both decreased the thresholds and increased the peak level of cooperation at steady state achieved in the limit as as the structure paramters r q grew from 0 to 1 the impact of networked interactions and neighborhood size k has a more nuanced impact on the evolution of cooperation as there exist pd games for which placing interactions on certain k regular graphs can increase the threshold of relative selection strength needed to achieve cooperation in addition for the death birth and imitation update rules there exists a range of pd games for which a given neighborhood size k is most conducive to promoting cooperation via multilevel selection this lack of monotonic dependence on the neighborhood size k for quantities describing promotion of cooperation for the graph setting shows that the within group dynamics on k regular graphs are not simply an endogenous version of assortative mechanisms provides a variety of new effects on the promotion of cooperation via individual and multilevel selection by taking a comparative statics approach to study the directional effects of changing population structure for our models of assortment and reciprocity we were also able to glean the impact of changing interaction or punishment probabilities in supporting additional cooperation furthermore because we were analyzing continuous families of parametrized multilevel selection problems the comparative statics approach serves as good motivation to apply the techniques needed to analyze general two level replicator dynamics 19 rather than cherry picking games with solvable within group dynamics because our model for within group structure was paramterized by the discrete degree of the k regular graph we had to take a different approach and consider the threshold to achieve cooperation for each neighborhood size k to unify the approach taken for assortment and reciprocity with models for network connectivity a direction for future work is to consider continuous parametrizes of games on graphons 62 63 or stochastic block models 64 to study the marginal impact of changes in within group network structure on the evolution of cooperation via multilevel selection we can also consider how extensions of existing models of assortment and reciprocity can impact the synergy between within group mechanisms and multilevel selection in facilitating the evolution of cooperation as an example recent models of indirect reciprocity have included three strategies those who always defect those who always cooperate and those who cooperate with high reputation individuals and defect against low reputation individuals 50 santos et al explore the role of indirect reciprocity under a variety of social norms classifying the norms which maximally achieve cooperation 49 one attributed mechanism to actually achieve the optimal norm is multilevel selection 65 66 so a natural question to ask is whether a deterministic model of multilevel selection can be used to determine the evolution of optimal norms to be able to answer such questions analytical or numerical progress needs to be made to analyze extensions of our framework to allow for three possible strategies in which a group s strategic composition is represented as a point on a triangular simplex as such this motivating question about the establishment and maintenance of social norms can motivate new mathematical techniques for multilevel selection on the subject of the shadow of lower level selection the assortment reciprocity and network mechanisms display mixed results we have established that the mechanisms help to lower the threshold to achieve cooperation and served to improve the average payoff of the population and to improve the level of cooperation at steady state for given relative level of selection strength we also see that these mechanisms can even eliminate the discrepancy between the level of cooperation maximizing group payoff and the most abundant level of cooperation at steady state in the limit as however the majority of these mechanisms did not increase maximum possible collective payoff of the population acheived as steady state in particular for the assortment indirect reciprocity and graph models it turned out that g x g 1 the payoff of the full cooperator group with well mixed interactions and therefore we see from equation 2 18 that the collective payoff at steady state is still limited by g 1 the one exception to this was the direct reciprocity model in which 55 g 1 1 1 g 1 but this improvement in collective payoff is somwhat artificial because discounting payoffs over multiple rounds produces a large pie of possible payoff this raises an interesting question for future research as to whether there are mechanisms by which multilevel selection can achieve collective payoffs exceeding the payoff of a full cooperator group such mechanisms would constitute the acheivement or a greater possible collective payoff and would consitute an interesting step towards understanding the role of multilevel selection in major evolutionary transitions and the establishment of cooperative groups acknowledgments this research was supported by nsf grants dms 1514606 and geo 1211972 and by aro grant w 911 nf 18 1 0325 i am thankful to simon levin joshua plotkin carl veller and chai molina for helpful discussions references 1 paulien hogeweg and nobuto takeuchi multilevel selection in models of prebiotic evolution com partments and spatial self organization origins of life and evolution of biospheres 33 4 375 403 2003 2 e rs szathm ry and l szl demeter group selection of early replicators and the origin of life journal of theoretical biology 128 4 463 486 1987 3 e rs szathm ry and john maynard smith the major evolutionary transitions nature 374 6519 227 232 1995 4 gergely boza and szabolcs sz mad beneficial laggards multilevel selection cooperative poly morphism and division of labour in threshold public good games bmc evolutionary biology 10 1 336 2010 5 zachary shaffer takao sasaki brian haney marco janssen stephen c pratt and jennifer h fewell the foundress s dilemma group selection for cooperation among queens of the harvester ant pogonomyrmex californicus scientific reports 6 29828 2016 6 simon van vliet and michael doebeli the role of multilevel selection in host microbiome evolu tion proceedings of the national academy of sciences 116 41 20591 20597 2019 7 michael a gilchrist daniel coombs and alan s perelson optimizing within host viral fitness infected cell lifespan and virion production rate journal of theoretical biology 229 2 281 288 2004 8 simon levin and david pimentel selection of intermediate rates of increase in parasite host systems the american naturalist 117 3 308 315 1981 9 martin a nowak five rules for the evolution of cooperation science 314 5805 1560 1563 2006 10 c athena aktipis amy m boddy gunther jansen urszula hibner michael e hochberg carlo c maley and gerald s wilkinson cancer across the tree of life cooperation and cheating in multicellularity phil trans r soc b 370 1673 20140219 2015 11 david haig intracellular evolution of mitochondrial dna mtdna and the tragedy of the cytoplasmic commons bioessays 38 6 549 555 2016 12 arne traulsen and martin a nowak evolution of cooperation by multilevel selection proceedings of the national academy of sciences 103 29 10952 10955 2006 13 arne traulsen noam shoresh and martin a nowak analytical results for individual and group selection of any intensity bulletin of mathematical biology 70 5 1410 2008 14 marvin a b ttcher and jan nagler promotion of cooperation by selective group extinction new journal of physics 18 6 063008 2016 56 15 shishi luo a unifying framework reveals key properties of multilevel selection journal of theo retical biology 341 41 52 2014 16 matthijs van veelen shishi luo and burton simon a simple model of group selection that cannot be analyzed with inclusive fitness journal of theoretical biology 360 279 289 2014 17 shishi luo and jonathan c mattingly scaling limits of a model for selection at two scales nonlinearity 30 4 1682 2017 18 daniel b cooney the replicator dynamics for multilevel selection in evolutionary games journal of mathematical biology 79 1 101 154 2019 19 daniel b cooney analysis of multilevel replicator dynamics for general two strategy social dilemma bulletin of mathematical biology 82 6 66 2020 20 burton simon a dynamical model of two level selection evolutionary ecology research 12 5 555 588 2010 21 burton simon and aaron nielsen numerical solutions and animations of group selection dynamics evolutionary ecology research 14 6 757 768 2012 22 burton simon jeffrey a fletcher and michael doebeli towards a general theory of group selection evolution 67 6 1561 1572 2013 23 burton simon and michael pilosov group level events are catalysts in the evolution of coopera tion journal of theoretical biology 410 125 136 2016 24 a puhalskii m reiman and b simon a large population limit for a markovian model of group structured populations arxiv preprint arxiv 1712 09119 2017 25 martin kaae jensen and alexandros rigos evolutionary games and matching rules international journal of game theory 47 3 707 735 2018 26 david sloan wilson and lee a dugatkin group selection and assortative interactions the american naturalist 149 2 336 351 1997 27 alan grafen the hawk dove game played between relatives animal behaviour 27 4 905 907 1979 28 ilan eshel and luigi luca cavalli sforza assortment of encounters and evolution of cooperative ness proceedings of the national academy of sciences 79 4 1331 1335 1982 29 theodore c bergstrom the algebra of assortative encounters and the evolution of cooperation international game theory review 5 03 211 228 2003 30 theodore c bergstrom on the evolution of altruistic ethical rules for siblings the american economic review pages 58 81 1995 31 theodore c bergstrom measures of assortativity biological theory 8 2 133 141 2013 32 jorge m pacheco arne traulsen and martin a nowak active linking in evolutionary games journal of theoretical biology 243 3 437 443 2006 33 jorge m pacheco arne traulsen and martin a nowak coevolution of strategy and structure in complex networks with dynamical linking physical review letters 97 25 258103 2006 34 hisashi ohtsuki christoph hauert erez lieberman and martin a nowak a simple rule for the evolution of cooperation on graphs and social networks nature 441 7092 502 505 2006 35 hisashi ohtsuki and martin a nowak the replicator equation on graphs journal of theoretical biology 243 1 86 97 2006 36 martin a nowak and karl sigmund evolution of indirect reciprocity nature 437 7063 1291 2005 37 robert axelrod and william donald hamilton the evolution of cooperation science 211 4489 1390 1396 1981 38 r axelrod the evolution of cooperation basic books 1984 57 39 robert axelrod the complexity of cooperation agent based models of competition and collabora tion volume 3 princeton university press 1997 40 martin a nowak evolutionary dynamics harvard university press 2006 41 david c queller kin selection and frequency dependence a game theoretic approach biological journal of the linnean society 23 2 3 133 143 1984 42 martin a nowak corina e tarnita and tibor antal evolutionary dynamics in structured populations philosophical transactions of the royal society b biological sciences 365 1537 19 30 2010 43 corina e tarnita hisashi ohtsuki tibor antal feng fu and martin a nowak strategy selection in structured populations journal of theoretical biology 259 3 570 581 2009 44 matthijs van veelen benjamin allen moshe hoffman burton simon and carl veller hamilton s rule journal of theoretical biology 414 176 230 2017 45 benjamin allen and martin a nowak games among relatives revisited journal of theoretical biology 378 103 116 2015 46 daniel cooney benjamin allen and carl veller assortment and the evolution of cooperation in a moran process with exponential fitness journal of theoretical biology 409 38 46 2016 47 kira coder gylling and ke br nnstr m effects of relatedness on the evolution of cooperation in nonlinear public goods games games 9 4 87 2018 48 matthijs van veelen the replicator dynamics with n players and population structure journal of theoretical biology 276 1 78 85 2011 49 fernando p santos francisco c santos and jorge m pacheco social norm complexity and past reputations in the evolution of cooperation nature 555 7695 242 2018 50 arunas l radzvilavicius alexander j stewart and joshua b plotkin evolution of empathetic moral evaluation elife 8 e 44269 2019 51 lorens a imhof drew fudenberg and martin a nowak evolutionary cycles of cooperation and defection proceedings of the national academy of sciences 102 31 10797 10800 2005 52 d fudenberg and j tirole game theory mit press mit press 1991 53 matthijs van veelen robustness against indirect invasions games and economic behavior 74 1 382 393 2012 54 martin a nowak and karl sigmund tit for tat in heterogeneous populations nature 355 6357 250 253 1992 55 christian hilbe martin a nowak and karl sigmund evolution of extortion in iterated prisoner s dilemma games proceedings of the national academy of sciences 110 17 6913 6918 2013 56 benjamin allen and corina e tarnita measures of success in a class of evolutionary models with fixed population size and structure journal of mathematical biology 68 1 2 109 143 2014 57 charles g nathanson corina e tarnita and martin a nowak calculating evolutionary dynamics in structured populations plos computational biology 5 12 2009 58 artem kaznatcheev effective games and the confusion over spatial structure proceedings of the national academy of sciences 115 8 e 1709 e 1709 2018 59 artem kaznatcheev jeffrey peacock david basanta andriy marusyk and jacob g scott fi broblasts and alectinib switch the evolutionary games played by non small cell lung cancer nature ecology evolution 3 3 450 456 2019 60 paul e turner and lin chao prisoner s dilemma in an rna virus nature 398 6726 441 1999 61 jorge pe a bin wu and arne traulsen ordering structured populations in multiplayer cooper ation games journal of the royal society interface 13 114 20150881 2016 62 francesca parise and asuman ozdaglar graphon games in proceedings of the 2019 acm con ference on economics and computation pages 457 458 2019 58 63 ren carmona daniel cooney christy graves and mathieu lauriere stochastic graphon games i the static case arxiv preprint arxiv 1911 10664 2019 64 babak fotouhi naghmeh momeni benjamin allen and martin a nowak evolution of coop eration on large networks with community structure journal of the royal society interface 16 152 20180677 2019 65 jorge m pacheco francisco c santos and fabio ac c chalub stern judging a simple success ful norm which promotes cooperation under indirect reciprocity plos computational biology 2 12 e 178 2006 66 francisco c santos fabio acc chalub and jorge m pacheco a multi level selection model for the emergence of social norms in european conference on artificial life pages 525 534 springer 2007 59 1 introduction 2 evolutionary games and replicator dynamics 2 1 generalized dynamics 3 within group assortment 4 indirect reciprocity 5 multilevel selection in a repeated game 6 graph structure within groups 6 1 death birth updating 6 2 birth death updating 6 3 imitation updating 6 4 behavior in the limit of strong between group competition 7 discussion