keep it real tail probabilities of compound heavy tailed distributions igor halperin nyu tandon school of engineering october 4 2017 e mail igor halperin nyu edu abstract we propose an analytical approach to the computation of tail probabilities of compound distri butions whose individual components have heavy tails our approach is based on the contour integration method and gives rise to a representation of the tail probability of a compound distribution in the form of a rapidly convergent one dimensional integral involving a disconti nuity of the imaginary part of its moment generating function across a branch cut the latter integral can be evaluated in quadratures or alternatively represented as an asymptotic expan sion our approach thus offers a viable especially at high percentile levels alternative to more standard methods such as monte carlo or the fast fourier transform traditionally used for such problems as a practical application we use our method to compute the operational value at risk var of a financial institution where individual losses are modeled as spliced distributions whose large loss components are given by power law or lognormal distributions finally we briefly discuss extensions of the present formalism for calculation of tail probabilities of compound distributions made of compound distributions with heavy tails 1 introduction many practical problems in applied science require accurate estimations of tails of compound distributions i e random or non random sums of random variables in particular in the context of financial risk management to compute the operational value at risk var of a financial institution the total loss resulting from aggregation of losses in different lines of business should be calculated at percentile levels of up to 99 9 it is well known that classical methods of calculation of aggregate distributions such as monte carlo fast fourier transform fft or the panjer recursion are all faced with various numerical issues at such high percentiles monte carlo is robust but slow in suppressing the simulation noise likewise the fft and panjer recursion methods become slow and lose accuracy unless some special tricks are used when computing such extreme tails of aggregate loss distributions we propose an analytical approach to calculation of tail probabilities of compound distri butions where individual components have heavy tails our method employs a contour integra 1 ar x iv 1 71 0 01 22 7 v 1 q fi n c p 3 o ct 2 01 7 tion technique to compute tail probabilities expressed in terms of moment generating functions mgfs m z of corresponding distributions as is well known in the case of extreme percentile levels such as 99 9 such contour integral representations of tail probabilities give rise to ex ponentially small tail probabilities that are formally represented by highly oscillating contour integrals we use analyticity in the complex z plane in order to find a suitable deformation of the contour that produces a representation of the tail probability of in the form of a rapidly convergent real valued one dimensional integral our method is inspired by techniques devel oped for similar problems in physics where exponentially small probabilities expressed via highly oscillating contour integrals are encountered in particular in quantum mechanics 6 and quan tum field theory 13 to the best of our knowledge such methods were not previously applied to the problem of computing tail probabilities of compound distributions with heavy tails as our procedure produces a representation of tail probabilities in terms of rapidly convergent integrals the latter can be evaluated in quadratures or alternatively represented as asymptotic expansions our method thus gives rise to a very efficient numerical scheme which avoids numerical issues that arise within the classical methods such as monte carlo or fft when computing such small tail probabilities while the method developed in this paper can be applied in many different problems that re quire accurate computation of tail probabilities for single or compound distributions with heavy tails here we focus on one practical application specifically we consider the problem of com puting the value at risk var for aggregate operational losses of a financial institution in this setting the aggregate compound operational loss of each business unit of the institution can be modeled as a compound poisson process where each individual loss has a spliced distribution whose two component describe small and large losses respectively we consider in details two specifications of a single unit large loss component a power tail pareto or lognormal however the same method can be applied to other severity distributions as well under certain technical conditions to be discussed below furthermore our analytical formulae assist a model selection process by directly capturing the dependence of the tail probability on the body distribution i e the distribution of small losses as will be shown below in models where single loss distributions have heavy tails var at a high percentile level such as 99 9 is nearly independent of small losses where small corrections to the independence law depend for all practical purposes only on the mean and variance of the distribution of small losses but not on its higher moments while the strict asymptotic i e when var is yet much higher than 99 9 decoupling of var from small losses for models with heavy tails was established a while ago in ref 1 1 our method gives an essentially exact solution that is valid for the actual level of 99 9 needed in practice and recovers the result of ref 1 along with all corrections 2 a spliced heavy tailed distribution in this paper we are interested in tail probabilities of compound distributions whose individual components have heavy tails to have a slightly more general framework we model individual 1 this work was subsequently extended to include the first and second order corrections see e g ref 10 and references therein recently a formal perturbative expansion of tail probabilities for heavy tailed distributions was proposed by hernandez et al 5 however their method does not seem to produce a converging or asymptotic expansion 2 components as spliced distributions with the following probability density function pdf f x 1 f 1 x if x x 0 f 2 x if x x 0 1 where both f 1 x and f 2 x are valid pdf s which means in particular that they separately integrate to one while the second component f 2 x has a heavy tail the first component f 1 x can be arbitrary obviously the case of a pure heavy tailed distribution is recovered when 0 and x 0 0 assuming that x 0 in the specific case of operational risk research that motivated the present work a spliced loss distribution 1 can be used to model individual losses in a particular unit of measure uom 2 which further compound to produce the total loss in this uom we note that operational losses that belong in the same uom may be very different from each other if they have qualitatively different origins for example for a large investment bank legal losses can exceed other op erational losses by a few orders of magnitude a spliced loss severity distribution 1 where components f 1 x and f 2 x might have different scales seems appropriate to model such cases while reducing to a pure heavy tailed distributions in other cases where the use of a spliced distribution is not required for this reason we stick in this paper to a more general definition of a heavy tailed distribution as a spliced distribution 1 bearing in mind this application of the presented formalism in what follows we will occasionally refer to the random variable x as the loss severity though it might correspond to another random variable e g the price of a security or a derivative instrument in other settings the two components f 1 x and f 2 x in eq 1 correspond to distributions of small x x 0 and large x x 0 losses respectively where x 0 is a right tail threshold the mixing parameter 0 1 can be chosen e g by the continuity condition 1 f 1 x 0 f 2 x 0 2 alternatively we can integrate eq 1 from 0 to x 0 and replace the unknown cumulative dis tribution f x x 0 f s ds by the empirical distribution this provides a model independent relation 3 1 femp x 0 3 note that if we fix using eq 3 then eq 2 can be considered as a constraint on the low loss distribution f 1 x at the junction point x 0 provided we know distribution f 2 x rather than a condition on in what follows we do not dwell further on the modeling of f 1 x and keep it largely unspecified because as will be shown below var figures are mostly driven by the second high loss component f 2 x the dependence on f 1 x comes only through corrections in an asymptotic expansion in powers of 1 s where s is the var loss level which are expected to be fairly small for sufficiently high percentile levels such as 99 9 in this paper we consider two specifications of the severity distribution a power law and a lognormal law our choice is motivated by the observation that these two distributions seem to provide the best fit of about equal quality to large losses for the majority of uoms of large financial institutions in the next section we concentrate on a power law distribution while the case of a lognormal distribution will be analyzed in sect 4 2 unit of measures is a composition of a business line and type of loss that specifies a loss category 3 we refer to 3 as a model independent relation as according to the glivenko cantelli theorem the empirical distribution femp x 1 n n i 1 xi x converges to the true distribution f x uniformly as n almost surely 3 we consider the following power law distribution for losses above the threshold x 0 f 2 x f x x x 0 1 x 0 x x 0 cx 4 where c 1 x 10 is the normalization constant the tail distribution is f 2 x x ds f 2 x x x 0 1 5 the constant 1 in 4 5 is called the exponent of the power law note that given a choice of x 0 the exponent is the only free parameter in the power law distribution the fitting procedures to compute parameters and x 0 will be described below for now we note that the optimal value of depends on x 0 logarithmically i e mildly power law distributions also known as zipf or pareto distributions are ubiquitous in both nature and society see e g 7 for a review and are often characteristic of complex systems ref 7 gives many examples of power law distributions in language demography commerce computer science information theory physics astronomy geology and so on it seems that among wide distributions i e distributions for random variables that may vary by several orders of magnitude a power law distribution is more often a rule rather than an exception for wide distributions that are not power law ref 7 mentions some not too many examples that are better described by a log normal or a stretched exponential weibull distribution in our experiments with real world operational loss datasets we found that the power law distribution 4 outperforms the weibull and log weibull distributions in terms of both stability and quality of matching the data in the tail while performing about equally well with a lognormal distribution 3 tail probabilities by contour integration 3 1 moment generating functions we start with the moment generation function mgf of the power law pareto distribution m z e e zx 1 zx 0 1 1 zx 0 z 0 6 note that our sign convention is such that the mgf defined by 6 coincides with the laplace transform of the distribution 4 in what follows we will also use the characteristic function cf of f x which is equal to the mgf evaluated at a purely imaginary argument z e eizx m iz 7 note that the upper incomplete gamma function s z has the following asymptotic behavior s z zs 1 e z 1 s 1 z if z arg z 3 2 s zs 1 s z s 1 if z 0 re s 0 8 this implies the following behavior of m z in the limits z 0 and z m z 1 x 0 z e x 0 z 1 x 0 z o z 2 if z arg z 3 2 1 2 x 0 z 1 12 x 0 z o z 2 if z 0 1 9 4 it is more common to define the mgf as e ezx 4 the upper incomplete gamma function s z can be expressed in terms of the confluent hy pergeometric function also known as kummer s function 5 s z s zs s s 1 s z 10 using this in 6 we obtain m z 1 2 x 0 z 2 x 0 z 1 11 note that kummer s function a b z is an analytic holomorphic function of z while a power function in the second term in 11 has a branch cut singularity in the complex z plane which can be chosen to be the interval 0 we note that other heavy tailed distributions including in particular a lognormal distribution have mgfs with similar analytic properties our approach developed below is very general and applies to any distribution whose mgf is analytic in a complex plane with a branch cut singularity while the explicit form of the mgf is not used the only additional requirement for the method to be applicable is that the mgf does not grow too fast in the left semi plane in particular the mgf of the pareto distribution is well behaved in this sense indeed as shown in eq 9 m z grows asymptotically e x 0 z in the left semi plane but this divergence is integrable when calculating the tail probability see below for the spliced distribution 1 the mgf function has a similar form to eq 11 m z r z 2 x 0 z 1 12 where we defined function r z as follows r z 1 2 x 0 z 1 m 1 z 13 where m 1 z stands for the mgf of the body distribution f 1 x we assume that this distri bution has all moments in this case m 1 z is an analytic function of z and therefore function r z is analytic as well note that r 0 1 to compute the mgf of a compound distribution we need to specify a loss frequency model for simplicity we assume that the loss frequency for the time horizon t 1 is given by a poisson distribution with intensity the loss severity and loss frequency processes are assumed to be independent individual losses are independent as well in this case the mgf m z of the compound process a random sum x 1 xn of individual losses where n is randomly drawn from the poisson distribution can be computed explicitly m z n 0 t n n e t m z n e t m z 1 14 note that as ez is an entire function i e it is analytic in the whole complex plane the compound mgf m z is analytic in the complex z plane with the same branch cut singularity as the one present for the single loss mgf m z 5 other notations for this function are m a b z and 1 f 1 a b z 5 3 2 tail probability as a contour integral recall the integral representation of the heaviside step function x x ex 2 i eizx z i dz 15 where 0 is arbitrary in practice it is convenient to employ the limit 0 which is what will be assumed in what follows using the residue theorem it is easy to check that x defined by eq 15 is one when x 0 and zero when x 0 indeed when x 0 we close the contour in the upper semi plane and the integral is one due to the residue at the pole at z i otherwise if x 0 we close the contour in the lower semi plane and the integral equals zero using eq 15 we can write the tail probability of a loss distribution with pdf p x as follows f s p x s 0 dx p x x s 0 dx p x e x s 2 i eiu x s u i du 16 exchanging the order of two integrations we obtain f s e s 2 i e isu u i u i du 17 where z stands for the characteristic function of distribution p x z e eizx 0 dx eizxp x 18 introducing a new variable z by the relation u iz i we obtain f s 1 2 i i i esz z iz dz 1 2 i i i esz z m z dz 19 note that contour of integration in eq 19 runs parallel to the imaginary axis we assume that the mgf m z is such that eszm z 0 for sufficiently large s when z with re z 0 we will return to this point below when we consider specific applications in this case we can produce a closed contour by adding a semi circle c z r re z 0 in the left semi plane to our initial open contour by jordan s lemma the value of the integral over the closed contour is equal to the value of the original integral with the open contour once we have a closed contour we can use the cauchy integral theorem and arbitrarily deform it within the analyticity domain without changing the value of the integral as m z is analytic in the complex z plane with a branch cut on z 0 we can squeeze the integration contour such that it runs first under the cut for to 0 then flips around the origin z 0 and runs back to above the cut f s 1 2 i 0 dz esz z m z 1 2 i 0 dz esz z m z 20 where m z and m z stand for the values of the mgf m z above and below the branch cut respectively see fig 1 the two integrals in eq 20 do not cancel out due to a discontinuity of the imaginary part of m z across the branch cut at z 0 6 setting z xei and z xe i with x 0 at the upper and lower bank of the cut respectively the discontinuity is computed as follows im m x im m xei im m xe i 21 6 the real part of m z should be continuous across the branch cut as the tail probability should be real 6 figure 1 integration contour for integral 19 using this in eq 20 we obtain f s 1 2 0 dx e sx x im m x 22 eq 22 constitutes our first main result in the original complex valued contour integral 19 the integrand becomes a strongly oscillating function when s which makes it difficult to accurately compute the tail probability in this limit on the other hand it is exactly this limit that is relevant for computing var at high percentile levels such as 99 9 using analyticity of the mgf in the complex plane with a cut we have managed to reduce the complex integral 19 to a rapidly convergent integral 22 defined on the real axis the latter integral can be computed very efficiently and accurately in quadratures clearly numerical integration is much faster and more accurate than either monte carlo or a convolution method which are typically subject to a substantial numerical noise when computing tail probabilities at high percentiles using analyticity and contour integration such numerical noise is filtered out in eq 22 note that the relation 22 is very general and applies to any distribution whose mgf m z is analytic in a cut z plane and well behaved at infinity z re z 0 it does not apply to distributions whose moment generating functions do not have a branch cut singularity as in the letter case the discontinuity of the imaginary part of m z would vanish 7 we will next consider uses of eq 22 to compute tail probabilities of both the single loss and compound loss distributions 3 3 tail probability of a single power law distribution as a check of our general relation 22 we apply it to compute the tail probability p x s of the single loss distribution given by eq 1 where the second component f 2 x is chosen to 7 for distribution with both a branch cut singularity and additional singularities in the complex plane such as single poles the present formalism could be extended by taking a proper problem specific care of these additional singularities 7 be a power law distribution 4 clearly the answer in this case can be obtained by elementary means and reads p x s f 2 s where f 2 x is given by eq 5 therefore eq 22 should produce the same result before proceeding with the calculation we note that the mgf of a power law distribution or a distribution with a power law tail as our eq 1 is well behaved at infinity as eszm z 0 when s x 0 and z with re z 0 as can be seen from eq 9 therefore eq 22 can be used in this case to compute the discontinuity of the mgf 12 across the branch cut we note that it arises solely due to the second term in 12 let z xei along the cut such that the path above the cut corresponds to and the path below the cut has on these paths the main branch of the power function x 0 z 1 takes values x 0 x 1 ei and x 0 x 1 e i respectively therefore the discontinuity of im m z across the branch cut at 0 reads 8 im m x 2 x 0 x 1 im ei e i 2 2 sin x 0 x 1 2 1 x 0 x 1 23 where at the last step we used the identity x 1 x sin x 24 introducing a new variable y x 0 x and denoting s s x 0 we obtain for the integral 22 f s 1 0 dy e s y y y 1 s x 0 1 25 we have thus verified that eq 22 correctly reproduces the tail probability for a single loss distribution with a power law tail 3 4 tail probability of a compound power law distribution now we turn to a more interesting application of relation 22 namely we use it to compute the tail probability of the compound distribution whose mgf is given by eq 14 no explicit closed form answer for this quantity is available however we can compare our results with asymptotic expressions in the limit s that are available in the literature as well as verify our results numerically unlike the previous single loss case eq 22 cannot be straightforwardly used to compute the tail probability of the compound distribution as the mgf 14 grows as an exponent of an exponent in the left semi plane as implied by eq 9 however this problem is easy to fix to this end let us identically represent the mgf 14 in the following form m z e t m z 1 n 0 n 0 t n n e t m z n n n 0 1 t n n e t m z n m z m z m z m z m z 26 8 note that as re ei cos is an even function the real part of m z does not have a discontinuity across the branch cut 8 where n 0 b sx 0 c is the largest integer that is smaller or equal to the ratio s x 0 and function m z is a taylor tail of m z m z n n 0 1 t n n e t m z n 27 while function m z is equal to m z with its taylor tail subtracted now the first term m z in eq 26 is well behaved in the left semi plane when s x 0 while the second term m z is well behaved in the right semi plane where the product eszm z 0 as z when s x 0 using eq 26 we can write the contour integral as follows f s 1 2 i i i esz z m z dz 1 2 i i i esz z m z dz 28 we close the contour for the first integral in the left semi plane and deform it following steps that led to eq 22 while for the second integral we close the contour in the right semi plane and apply the residue theorem we obtain 9 f s 1 2 0 dx e sx x im m x m 0 29 here m 0 n n 0 1 t n n e t p x n 0 30 where x po stands for a poisson random variable driven by the poisson law with intensity t thus m 0 is the tail probability of the poisson distribution it can be estimated using the large deviation theory see appendix a for details m 0 p po t n 0 e n 0 t log t 1 31 recalling that n 0 b sx 0 c we see that the m 0 term in eq 29 is exponentially suppressed for large s next we turn to the first term in eq 29 we have m z m z m z e t r z 1 e t 2 x 0 z 1 m z 32 we start with computing the discontinuity of the imaginary part of m z as function r z is analytic the first exponent in 32 is continuous across the branch cut and discontinuity across the cut is due to the second exponent defining the values of the power function on different sides of the branch cut in the same way as was done in the previous section we find the discontinuity of the imaginary part of m z im m x e t r x 1 im e t 2 x 0 x 1 ei 33 2 e t x sin t 1 x 0 x 1 9 note that our method based on using eq 26 to decompose a formally diverging contour integral into an exactly calculable contribution plus a converging term that can be evaluated as an asymptotic expansion is somewhat similar to the celebrated lugannani rice method 8 where a similar trick is used to handle an apparent singularity at z 0 9 where for convenience we introduced function x as follows x r x 2 cos x 0 x 1 1 34 let us now consider the discontinuity of im m z where functionm z is defined in eq 27 to this end we note that for a fixed z eq 27 can be viewed up to a multiplier as the tail probability of a poisson distribution with intensity m z therefore this function can be estimated using the large deviation result 31 provided we substitute m z m z e t m z 1 p po tm z n 0 e t m z 1 e n 0 tm z log t logm z 1 35 we see that m z and hence its imaginary part is exponentially small in the limit s on the other hand the term im m x in eq 29 is only suppressed as a power of 1 s as will be clear below omitting exponentially suppressed contributions in eq 29 and introducing a new variable y x 0 x as before we finally obtain f s 1 0 dy y e s y t y x 0 sin t 1 y 1 36 eq 36 constitutes our second main result we have derived it as an application of our general relation 22 up to exponentially suppressed terms eq 36 provides an exact expression for the large s behavior of a random sum of i i d random variables with power law tails as the integral 36 converges rapidly for s it can be evaluated very efficiently using quadratures alternatively it can be expanded into an asymptotic series as we discuss next 3 5 asymptotic expansion of the tail probability as was mentioned above as the integral 36 converges fast a direct numerical integration is the most straightforward way to evaluate it however to better understand the asymptotic behavior of the tail probability of a compound poisson loss process it is useful to analyze an asymptotic expansion of the tail probability in the limit s that stems from eq 36 in particular such asymptotic expansion allows one to analytically study the impact of a specification of the low loss part of the loss distribution on the resulting var figures we start with an observation that for large s the integral 36 is dominated by small values of y therefore we can evaluate 36 using taylor expansions of functions and sin that enter this expression using eq 13 we have y x 0 1 m 1 y x 0 1 2 y 2 cos y 1 1 37 using the taylor expansion of kummer s function a b z 1 a b z 1 2 a a 1 b b 1 z 2 n 0 1 n a n b n zn 38 where a 0 1 a n a a 1 a n 1 and a general taylor expansion of the low loss mgf m 1 y x 0 m 1 y x 0 1 m 1 y m 2 y 2 39 we obtain the following small y expansions for functions entering eq 36 y x 0 2 cos y 1 c 1 y c 2 y 2 sin t 1 y 1 t 1 y 1 1 3 t 1 y 1 3 40 10 where c 1 1 1 2 1 m 1 c 2 2 1 3 1 m 2 41 as y x 0 0 as y 0 we can additionally expand the exponent in eq 36 as exp t y x 0 1 t y x 0 using this along with eqs 40 we obtain the following asymptotic expan sion of the tail probability 36 f s t s x 0 1 a 1 s x 0 2 1 a 2 s x 0 a 3 s x 0 3 1 a 4 s x 0 2 1 a 5 s x 0 1 42 where a 1 t 2 2 2 2 1 cos 1 2 t 2 2 2 3 2 a 2 t 2 c 1 1 t 2 1 1 2 1 m 1 a 3 2 3 3 3 t 1 3 43 a 4 t 2 tc 1 2 2 1 1 cos 1 2 t 2 t 2 2 2 2 1 2 1 m 1 a 5 t 2 c 2 t 2 c 21 1 1 t 2 1 c 2 t 2 c 21 note that if we only keep the leading term in eq 42 we obtain f s t s x 0 1 t f s s 44 which is a well known result in the literature 1 eq 44 is remarkable in that it shows that in the limit s the tail of the compound distribution with a power law tail decouples from the low loss region as the parameter t entering this expression is the poisson frequency of large losses and is therefore not sensitive to any additional small loss events that happen after the model is initially calibrated now consider the structure of corrections ai in eq 42 first note that when 1 2 the term a 1 is a leading correction while for 2 the term a 2 is a leading correction if 1 2 i e the single loss distribution has an infinite mean we see that the leading correction is still decoupled from the body of the distribution as it only depends on the combination t on the other hand if 2 so that the distribution has a finite mean then the leading correction depends on the body of the distribution through its mean m 1 the sub leading correction depends on m 1 if 1 2 or on both mean and variance m 1 and m 2 if 2 if we set 1 so that there is no low loss body of the distribution our expression for a 1 coincides with an expression given in 10 4 tail probability of a random lognormal sum in this section we analyze random sums of lognormal random variables using a similar approach to that developed in the previous section the added difficulty of analysis of a lognormal 11 distribution is that its mgf is not available in an analytical form but should rather be analyzed using its integral representation along with a saddle point approximation as before we start with the analysis of the tail probability of a single loss distribution 4 1 mgf of a lognormal distribution in the left semi plane a random variable y exp x follows a lognormal distribution with mean and variance 2 if x n 2 is a normal random variable with the same mean and variance the tail probability of a lognormal variable can be computed using elementary means f s p y s p x log s n log s 45 where n x stands for the cumulative normal distribution now we represent the tail probability 45 as an inverse laplace transform of its laplace transform f s 1 2 i i i dzeszf z 46 where f z stands for the laplace transform of the tail probability f z 0 dxe zxn log x 1 z 1 2 2 0 dx x exp zx 1 2 2 log x 2 47 where we used integration by parts to get the second equation comparing eq 46 with eq 19 and using 47 we find the mgf m z 1 2 2 0 dx x exp zx 1 2 2 log x 2 48 which of course can also be obtained directly from the definition of the mgf note that eq 48 defines the mgf m z for re z 0 its value in the left semi plane re z 0 is defined by analytical continuation as described below prior to doing this we note that using the identity x s 1 2 i i i dz z ez s x 49 we can verify that substituting eq 47 into eq 46 interchanging the orders of integrals over z and x and closing the contour in the right semi plane we reproduce 45 now instead of closing the integration contour in eq 46 in the right semi plane we want to use analytical properties of the mgf 48 to produce a different expression for the tail probability 46 to this end we note that the mgf 48 is an analytic function of z in a cut plane with a branch cut for z 0 the branch cut singularity in the z plane arises due to a branch cut singularity of the integrand of 48 in the x plane due to multivaluedness of the logarithm to find the mgf m z in the left semi plane re z 0 one should analytically continue the integral 48 let z ei where z 0 for 2 3 2 the real part of z becomes negative and to keep the integral convergent we have to rotate the integration line in the x plane by this gives m ei 1 2 2 c dx x exp x ei 1 2 2 log x 2 50 12 where the integration contour is a ray c arg x re x 0 changing the variable to y xei we obtain m ei 1 2 2 0 dy y exp y 1 2 2 log y i 2 51 note that m e 0 as therefore if we close the contour in eq 46 in the left semi plane the integral over an infinite semi circle vanishes by jordan s lemma deforming the integration contour in 46 in a similar way to steps taken above in the derivation of eq 22 the tail probability is now expressed in terms of a discontinuity of im m z across the branch cut on z 0 as in eq 22 f s 1 2 0 dx e sx x im m x 52 the discontinuity across the cut can be found using eq 51 im m x im m xei im m xe i 2 exp 2 2 2 2 2 0 dy y exp xy 1 2 2 log y 2 sin 2 log y 2 exp 2 2 2 2 2 dt exp xe t 1 2 2 t 2 sin 2 t 53 note that im m x 0 when x 0 as the integrand in 53 becomes an odd function in this limit moreover all terms of the taylor expansion in the integrand result in converging integrals which all equal zero this is a manifestation of non analyticity of m z at z 0 to produce non vanishing results for both imm xei and rem xei we return to eq 51 where we now set x and change the variable to z log ye m xei dz 2 2 exp 1 2 ez 1 2 z i 2 dz 2 2 exp 1 2 g z 54 where x 2 e and function g z is defined as follows g z ez 1 2 z i 2 55 stationary points of functions g z are zeros of the derivative g z ez z i 56 complex valued stationary points can therefore be computed as z 0 w i 57 where w stands for real valued solutions of the equation w ew 58 in what follows we restrict our analysis to the case when is bounded from above as follows 0 1 e 0 x 1 2 e 1 59 13 which seems sufficient for the analysis of asymptotic behavior at s as the integral 52 is dominated by small values of x in this limit provided 59 is satisfied eq 58 has two real roots w 1 and w 2 that are expressed in terms of lambert functions w 0 z and w 1 z see 3 w 1 w 0 1 w 0 1 w 2 w 1 1 e 0 w 1 1 60 we note that the first saddle point w 1 also appears in a saddle point analysis of m z in the right semi plane re z 0 see ref 11 while in our approach we concentrate on the behavior of m z in the left semi plane re z 0 where the second saddle point w 2 appears in addition to w 1 as will be seen shortly it is the second saddle point w 2 that determines the imaginary part of m z along the branch cut at z 0 the lambert functions w 0 x and w 1 x have the following expansions for small x 3 w 0 x n 1 n n 1 n xn x x 2 3 2 x 3 w 1 x log x log log x 61 note that when 0 i e x 0 we have w 1 1 and w 2 1 so that the two saddle points are well separated from each other in this limit now compute the second derivative g z 0 ez 0 1 ew 1 w 1 62 we see that g w 1 0 while g w 2 1 therefore a saddle point contour should run parallel to the real axis when passing through w 1 and parallel to the imaginary axis when passing through w 2 see below for more detail note that because the two saddle points are well separated in the limit 0 calculations of the integral 54 amounts in the saddle point approximation to a sum of two separate saddle point integrals computed using quadratic approximations of g z in the vicinity of points w 1 i and w 2 i respectively furthermore as g w i w 1 2 w 2 we see that g w 1 i o 1 while g w 2 i as w 2 i e 0 therefore a contribution of the second saddle point w 2 to the real part rem xei is exponentially suppressed in comparison to a contribution of the first saddle point w 1 and thus can be safely neglected in the limit 010 the saddle point approximation is obtained using the standard arguments see e g 9 we expand g z in a taylor series around the saddle point z 0 g z g z 0 1 2 g z 0 z z 0 2 1 3 g z 0 z z 0 3 1 4 g 4 z 0 z z 0 4 63 where the first order term is omitted as g z 0 0 and introduce the following notation g z 0 e i 0 z z 0 tei 64 g z u x y iv x y note that 1 w 1 for z 0 w 1 i and w 2 1 0 for z 0 w 2 i all higher order derivatives g g 4 are real valued at both saddle points using this in eq 63 10 an exponentially suppressed contribution of the second saddle point w 2 to the real part rem xei arises due to integration over the right edge of the first arc in the steepest descent contour 66 see below 14 we obtain u x y u x 0 y 0 1 2 t 2 cos 2 n 4 6 1 n g n z 0 t n cos n v x y v x 0 y 0 1 2 t 2 sin 2 n 3 5 1 n g n z 0 t n sin n 65 a steepest descent path is therefore defined by the constraint cos 2 1 this produces 0 for w w 1 and 2 for w w 2 as dz e i dt near a saddle point this means that dz t near w 1 and dz idt near w 2 therefore the steepest descent contour should run parallel to the real axis at z w 1 i and parallel to the imaginary axis at z w 2 i as was already mentioned above a saddle point contour c that passes through both saddle points and works for both the imaginary and real parts of the integral 54 can be obtained as a composition of three straight lines see fig 2 c x i if re z w 2 w 2 i if re z w 2 0 x if re z w 2 66 note that as cos 2 1 on the saddle point contour c the second equation in 65 implies that v x y v x 0 y 0 along this contour in our case v x 0 y 0 0 for both saddle points therefore v x y im g z 0 on c figure 2 integration contour for integral 54 the last observation that im g z 0 along the steepest descent path c implies that the contribution of the saddle point w 1 i more precisely the whole contribution of the first arc in 66 drops off in the calculation of the imaginary part because both the integrand and the integration contour become real for this integral after a change of variable z x i im w 2 i i dz 2 2 exp ez z i 2 2 2 im w 2 dx 2 2 exp ex 1 2 x 2 2 0 therefore even though the contribution of the second saddle point w 2 i is exponentially suppressed when computing the real part rem xei see below as the saddle point contour is complex valued in the vicinity of w 2 0 i the second saddle point w 2 is the only one that determines the imaginary part of m z along the branch cut the dominant contribution to the imaginary part imm xei comes from integration over the second arc in the contour 66 the integral over the third arc is exponentially suppressed in comparison to a contribution of the second arc see below note that the contribution of w 1 to the imaginary part of m z cancels 15 out precisely due to a judicious choice of the integration contour 66 unless such cancellation occurs an accurate calculation of imm xei would be impossible for all practical purposes as it would require computing an exponentially suppressed quantity with a large numerical noise that would be driven by an error in calculation of the contribution of the first arc in 66 11 the saddle point approximation to this integral produces the following result imm xei 1 2 exp 1 2 w 2 12 w 2 2 w 2 1 1 2 8 w 2 w 2 1 2 o w 22 67 and imm xe i imm xei the extra factor 1 2 in eq 67 is due to the fact that the saddle point contour 66 involves only half 12 of the line w 2 i w 2 i which would otherwise be obtained as a saddle point contour for a problem with a single saddle point at w 2 and g w 2 0 note that eq 67 is an asymptotic expansion valid for small 1 w 2 0 i e for 0 also note non analyticity of this expression in w and hence in which is due to the branch cut singularity of the square root function in 67 to show that the contribution i 3 of the third arc of the saddle point contour 66 to the integral 54 is negligible as was promised above we use the following inequalities i 3 w 2 dx 2 exp ex 1 2 2 x 2 2 2 2 w 2 exp w 2 2 1 2 2 w 22 2 the second inequality here is obtained by noting that the maximum of the function x ex 1 2 x 2 2 is attained at the left boundary x w 2 and expanding x to linear order x w 2 w 2 x w 2 to evaluate the integral we see that im i 3 is exponentially suppressed in comparison with the contribution calculated in eq 67 and thus can be neglected in the limit w 2 i e 0 likewise re i 3 is exponentially suppressed relatively to a contribution due to the first arc of contour 66 as we will see next turning to the calculation of the real part of m z along the branch cut it is now only the first saddle point w 1 i e the first arc of the contour 66 that determines the real part rem xei up to exponentially suppressed terms the saddle point approximation produces the following result rem xei exp 1 2 w 1 12 w 2 1 1 w 1 1 2 8 w 1 1 w 1 2 o w 21 68 expressions 67 and 68 will be used below to compute the tail distribution of a random sum of lognormal variables before doing that we want to verify that eq 67 reproduces the right asymptotic behavior of a tail of a single lognormal loss when substituted in the general expression 52 4 2 tail probability of a single lognormal distribution in this section we check that our contour integral representation correctly reproduces the asymp totic behavior of the tail of the lognormal distribution 45 f s n log s 1 2 log s exp 1 2 2 log s 2 69 11 our approach was inspired by contour integration methods that have been used for similar problems of estimating exponentially suppressed integrals in quantum mechanics see ref 6 51 and in quantum field theory 13 12 after approximating the finite integration limits w 2 i w 2 i by infinite limits w 2 i w 2 i which is justified in the saddle point approximation in the limit w 2 the difference between results obtained with an infinite and finite intervals is exponentially suppressed as 0 and thus should be omitted as long as we omit other exponentially suppressed terms in our derivation 16 as was shown above it is only the second point w 2 that determines the imaginary part imm z along the branch cut therefore to lighten the notation in this section we omit the index of the saddle point and write it simply as w w 2 without any confusion note the integral 52 involves integration over x while the asymptotic expression 67 is valid for an arbitrary fixed and small value x 0 the integral 52 could therefore be calculated after a discretization on a grid xi i 1 2 by computing the saddle point z 0 xi for each value xi on the grid however it is much more convenient to change the integration variable x w using eq 58 as a definition of the change of variables thus avoiding a re calculation of the saddle point for different values on the grid the x variable is found in terms of w as follows x 1 2 e w exp w 70 and the jacobian j of the transformation is j x w 1 2 e w w 1 71 using this in eq 52 along with eq 67 and truncating the integral at x 1 2 e 1 which is justified in the limit s we obtain f s 1 2 0 dx e sx x im m x 1 2 1 2 e 1 0 dx e sx x im m x 1 2 1 dw w w 1 exp 1 2 swe w w 1 2 w 2 1 2 8 w w 1 2 1 2 1 dw w w 1 exp 1 2 w 1 2 8 w w 1 2 72 where w swe w w 1 2 w 2 73 this integral can be computed in the limit s using the saddle point approximation saddle points are found as solutions of the equation d w dw w 1 se w 1 0 74 this equation has two solutions w 1 1 and w 2 log s however it is only the second solution w 2 that corresponds to the minimum of w as can be easily checked by differentiation of eq 74 therefore we pick w 2 as the saddle point w 0 log s 75 note that w 0 1 when s we expand w around this point w w 0 1 2 w 0 w w 0 2 76 we have w 0 1 2 log s 2 w 0 log s 1 77 17 omitting correction terms in 72 the leading order saddle point approximation reads f s 1 2 log s exp 1 2 2 log s 2 78 which coincides with eq 69 we have therefore validated our result 67 using the known expression for the tail probability of a single loss lognormal distribution 4 3 tail probability of a spliced distribution with a lognormal tail now we would like to discuss a practically important case of of a spliced loss severity distribution with a low loss body with a mgf m 1 z and a lognormal tail that starts at a junction point x 0 the mgf ms z of the spliced distribution is therefore ms z m z 1 m 1 z 79 where m z stands for an mgf of a lognormal distribution truncated from below at x 0 as before we assume that the mgf m 1 z of the body is an analytic function of z i e this distribution has all moments the normalized truncated lognormal distribution has the following pdf p x x x 0 2 2 1 x exp 1 2 2 log x 2 1 n log x 0 80 the mgf of a truncated lognormal distribution reads m z x 0 dx 2 2 x exp xz 1 2 2 log x 2 81 note that apart from the constant multiplier the integral 81 only differs in the lower inte gration limit x 0 instead of 0 from the integral 48 that defines the mgf of an un truncated lognormal distribution repeating steps leading to eq 54 but this time with the low bound of x 0 we obtain m xei w 0 dz 2 2 exp 1 2 g z w 0 log x 0 82 where function g z was defined in eq 55 the latter integral can now be evaluated using the saddle point approximation as was done above for an un truncated lognormal distribution however a detailed re calculation is not necessary in this case recall that results of a saddle point approximation are not sensitive to the leading order to precise values of integration bounds as long as the latter are far away from a saddle point this implies that as long as w 0 w 2 where w 2 is defined in eq 60 the result for the imaginary part of ms xei is the same up to a constant multiplier as for m xei see eq 67 imms xei 2 exp 1 2 w 2 12 w 2 2 w 2 1 1 o w 12 w 0 w 2 83 to compute the real part of ms xei we have to separately consider two cases w 0 w 1 and w 0 w 1 in the first case the first saddle point w 1 in eqs 60 lies inside of the integration interval and the result for rems xei reads see eq 68 rems xei 1 rem 1 xei exp 1 2 w 1 12 w 2 1 1 w 1 1 o w 1 w 0 w 1 84 18 on the other hand in the second case w 0 w 1 the saddle point w 1 lies outside of the integration interval in this case the maximum of the integrand is attained at the left boundary of the integration interval the asymptotic expression in this case reads rems xei 1 rem 1 xei 2 exp 1 2 w 0 12 w 2 0 w 0 ew 0 1 o w 1 w 0 w 1 85 note that while in the previous expression 84 the second term depends on x through a de pendence of w 1 on x see eqs 60 the second term in eq 85 is a constant in x so that the x dependence of rems xei in the case w 0 w 1 arises solely due to the x dependence of the mgf m 1 xei of the body of the distribution 4 4 tail probability of a compound distribution with a lognormal tail in this section we use our general relation 22 along with asymptotic relations 83 85 in order to compute the asymptotic expansion of the tail probability of a compound distribution where a single loss distribution is given by a spliced distribution with a low loss body with a mgf m 1 z and a lognormal tail that starts at a junction point x 0 the mgf of a compound distribution with a poisson frequency distribution is therefore m z e t ms z 1 86 where ms z is defined in eq 79 recall that eq 22 can only be applied for mgfs that grow not faster than e x 0 z in the left semi plane this is the case in the present setting as m z 0 when z rei with r and 2 3 2 see eq 51 which means that m z is bounded in the left semi plane the discontinuity of the imaginary part of m z across the branch cut at z 0 reads imm xei 2 e t rems xe i 1 sin t imms xei 87 using this in eq 22 we obtain f s 1 0 dx x e sx t rems xe i 1 sin t imms xei 88 eq 88 together with eqs 83 85 constitute our third main result that provides a rapidly convergent integral for a compound distribution of single loss distributions with lognormal tails similar to eq 36 this integral is dominated by small values of x as s therefore we are justified in using asymptotic relations 83 85 to numerically evaluate the integral 88 in this limit also similar to eq 36 the low loss component f 1 x effectively enters eq 88 only via its lowest moments leading to a decoupling of the tail behavior of the compound distribution from individual small losses 5 compound distributions of compound heavy tailed distribu tions in this section we briefly discuss possible extensions of the present formalism to compute tail probabilities of compound loss distributions where individual components are themselves com pound distributions made of individual loss distributions with heavy tails such problem arise in 19 particular when one computes total var of a financial institution having a number of different uoms let x 1 xn i 1 n be total losses in n different uoms let m i z be cor responding mgf s for compound loss distributions for these uoms and i be their poisson frequencies the simplest assumption about the joint distribution of losses in all uoms is to assume independence between them such assumption can be justified on the grounds of dif fuculties of accurate estimation of correlation measures for operational losses as well as the absence of any obvious mechanisms that would induce loss correlations between different uoms in this case the mgf of the total loss x x 1 xn is given by the product of individual mgfs using eq 14 we obtain m z n i 1 m i z n i 1 exp it mi z 1 exp n i 1 it mi z 1 89 as this expression has the same functional form as eq 14 the tail probability of the compound compound distribution can be computed using the same relation 22 as was used above to compute tail probabilities of individual compound distributions alternatively if explicit modeling of dependencies between individual compound losses of different uoms is deemed desired or necessary there are multiple ways to introduces such de pendences in a tractable way one simple approach is to promote the poisson intensities i into stochastic variables i z that depend on a low dimensional set of m common stochastic factors z when one conditions on a realization of z individual compound losses become independent therefore the conditional tail probability f s z will still be given by eq 22 for each fixed value of z and the unconditional tail probability would be obtained as follows f s z dzp z f s z 90 where p z is the probability density of z finally some standard copula models such as e g the gaussian or student t copula can be cast into an equivalent factor framework which ensures conditional independence of individual component losses the conditional distribution of cumulative loss can be computed analytically using the saddle point method 4 in combination with methods presented above to compute marginal compound distributions details of such construction will be presented elsewhere 6 application to operational risk in this section we consider applications of our approach to calculation of the operational value at risk var for a financial institution we focus on the case where the large loss component of an individual loss distribution is given by a power law distribution which is characterized by two parameters and x 0 once the threshold value of x 0 is specified the value of can be obtained using the expression obtained by the maximum likelihood method see 2 1 n n i 1 log xi x 0 1 91 and the standard error of is 1 n o 1 n 92 20 we illustrate our method with synthetic data produced using realistic model parameters that are similar to what is often observed in calibration to real world datasets we used the following values of parameters u 40 000 x 0 100 000 2 2 20 0 35 the mean and variance of the body distribution are 63 877 92 and 2 625 108 which corresponds to rescaled moments m 1 0 6388 and m 2 0 0131 the result obtained with our approach for the percentile level of 99 9 is shown in fig 3 where we also show results of mc simulation with 100 runs each including 1 000 000 aggregate losses we note that even for such a large number of mc trials the mc results are still quite noisy which in particular makes computation of sensitivities difficult in the mc setting our analytical approach by construction is free of such defficiencies and allows accurate computation of both quantiles and their sensitivities figure 3 integration vs mc simulation 7 summary we have presented an analytical approach to computation of tail probabilities of compound heavy tailed distributions which is based on the contour integration method and gives rise to a representation of the tail probability of a compound distribution in the form of a rapidly conver gent real valued one dimensional integral the latter integral can be evaluated in quadratures or alternatively represented as an asymptotic expansion while we only considered the case of a compound poisson distribution where individual components have power law or lognormal tails our method can be extended to other settings with different specifications of individual compo nent and or frequency distribution as long as its moment generating function has a branch cut singularity in the complex plane we believe that the method proposed in this paper can offer a viable alternative to brute force numerical methods such as monte carlo fft or the panjer recursion interestingly this alternative appears especially attractive for high percentile levels where these traditional approaches struggle while the contour integration method starts to shine even more in the sense that a convergent integral defining the tail distribution converges even faster as the percentile level increases 21 acknowledgements i would like to thank sergey malinin for numerous discussions and collaboration on an earlier version of this manuscript including in particular sharing his ideas for calculations presented in sect 4 i thank andrey itkin for helpful comments references 1 k bo cker and c klo ppelberg operational var a closed form approximation risk december 2005 90 93 2 a clauset c r shalizi and m e j newman power law distributions in empirical data 2007 available at http arxiv org pdf 0706 1062 pdf 3 r m corless g h gonnet d e g hare d j jeffrey and d e knuth on the lambert w function advances in computational mathematics 5 1996 329359 4 i halperin cdo pricing with saddle point method jpm 2005 5 l hernandez j tejero a surez and s carrillo menndez percentiles of sums of heavy tailed random variables beyond the single loss approximation statistics and comput ing 24 3 2014 pp 377 397 available at http arxiv org pdf 1203 2564 pdf 6 l d landau and e m lifshitz quantum mechanics butterworth heinemann 1981 7 m e j newman power laws pareto distributions and zipf s law http arxiv org pdf cond mat 0412004 pdf 8 r lugannani and s rice saddlepoint approximations for the distribution of the sum of independent random variables advances in applied probability v 12 1980 pp 475 490 9 j mathews and r l walker mathematical methods of physics w a benjamin 1964 10 a sahay z wan and b keller operational risk capital asymptotics in the case of heavy tailed severity journal of operational risk v 2 2007 61 72 11 c tellambura and d senaratne accurate computation of the mgf of the lognormal distribution and its application to sum of lognormals iee trans on communications 58 2010 1568 1577 12 s r s varadhan large deviations and applications siam philadelphia 1984 13 j zinn justin the principles of instanton calculus a few applications in recent ad vances in field theory and statistical mechanics les houches xxxix 1982 ed j b zu ber and r stora elsevier science publishers 1984 appendix a large deviations and poisson tail probability to apply the large deviation theory see e g 12 to estimation of the poisson tail probability p po t n k n 1 t k k e t a 1 22 http arxiv org pdf 0706 1062 pdf http arxiv org pdf 1203 2564 pdf http arxiv org pdf cond mat 0412004 pdf we use the equivalence of the poisson event po t n to the event of having n arrivals by time t 1 if zi with i 1 2 stand for exponentially distributed random interarrival times then p po t n is the same as the probability of having the total arrival time for n events to be less less than t 1 p po t n p z 1 zn 1 p z 1 zn n 1 n a 2 to estimate this probability we apply cramer s theorem 12 we compute the rate function i z sup x 0 zx logeexz 1 sup x 0 zx log t t x tz 1 log tz a 3 the cramer theorem then states that p z 1 zn n 1 n e ni 1 e n t log t 1 a 4 23 1 introduction 2 a spliced heavy tailed distribution 3 tail probabilities by contour integration 3 1 moment generating functions 3 2 tail probability as a contour integral 3 3 tail probability of a single power law distribution 3 4 tail probability of a compound power law distribution 3 5 asymptotic expansion of the tail probability 4 tail probability of a random lognormal sum 4 1 mgf of a lognormal distribution in the left semi plane 4 2 tail probability of a single lognormal distribution 4 3 tail probability of a spliced distribution with a lognormal tail 4 4 tail probability of a compound distribution with a lognormal tail 5 compound distributions of compound heavy tailed distributions 6 application to operational risk 7 summary