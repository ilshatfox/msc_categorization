draft version january 11 2022 typeset using latex twocolumn style in aastex 631 nprofit a tool for fitting the surface brightness profiles of star clusters with dynamical models b cuevas otahola 1 y d mayya 1 i puerari 1 and d rosa gonza lez 1 1 instituto nacional de astrof sica o ptica y electro nica 72840 puebla mexico abstract the surface brightness profiles sbps of star clusters hold invaluable information on the dynamical state of clusters the observed sbps of star clusters especially that of globular clusters are in good agreement with the sbps expected for isothermal spheres containing stars of reduced kinetic energies however the sbps of configurations that satisfy these theoretical criteria cannot be uniquely expressed by analytical formulae which had hindered the analysis of dynamical state of observed clusters in external galaxies to counter this shortcoming it has become a practice to use empirical fitting formulae that best represent the core and halo characteristics of theoretical models we here present a general purpose code named nprofit that allows fitting of the surface brightness profiles of extragalactic star clusters to theoretical star clusters defined by dynamical models of king 1966 and wilson 1975 in addition we also incorporated theoretical models that result in power law surface brightness profiles represented by elson et al 1987 the code returns the basic size parameters such as core radius half light radius and tidal radius as well as dynamically relevant parameters such as the volume and surface density profiles velocity dispersion profile total mass and the binding energy for a user fixed mass to light ratio the usefulness of the code in the dynamical study of extragalactic clusters has been already illustrated in cuevas otahola et al 2020 the code which is python based at the user end but makes calls to advanced routines in pyraf and fortran is now available for public use we provide example scripts and mock clusters in the installation package as guide to users 1 introduction structural parameters of star clusters serve as proxies to give insights on their dynamical evolutionary state these parameters namely core radius half mass and half light radius tidal radius and concentration index can be obtained by fitting theoretical intensity profiles to the surface brightness profiles sbp of clusters for instance the king 1962 is one of the most widely used profiles to obtain the structural parameters of old clusters such as globular clusters gcs in the pio neering work king 1966 demonstrated that the ob served form of the profiles of gcs belong to the fam ily of the surface mass density profiles corresponding to self gravitating isothermal spheres of lower kinetic en ergies wilson 1975 proposed a dynamical profile re sembling the structure of a king 1966 profile with a larger halo in order to fit the sbp of elliptical galaxies years later elson et al 1987 found that the sbps of clusters in the large magellanic cloud lmc do not have a noticeable break corresponding to tidal radius of king profiles they found their profiles are better fit by power law functions rather than king profiles in these power law profiles the shapes of the extended haloes are characterised by with 2 corresponding to the profiles of infinite mass isothermal models profiles with 2 are steeper and have finite masses over the last two decades the observed sbps of ex tragalactic star clusters have been analysed in several studies to obtain structural parameters using theoretical profiles the most frequently used tools in these stud ies are ishape larsen 1999 and galfit peng et al 2010 both of which are available for public use both these tools fit two dimensional empirical profiles to the sky subtracted observed 2 d images of the objects un der study geometrical parameters such as position an gle and ellipticities are fitted as well these codes are mainly used to obtain the size parameters such as core radius half light radius rh and tidal radius for as sumed shape of the profile this is the best one can hope to do in images where star clusters are only marginally resolved and the background subtraction errors do not permit an analysis of the shapes of profiles in their ex ternal parts one of the defining parameters of star clusters is their mass which is determined either using photomet ric techniques or using dynamical models the photo metric mass is routinely determined using the observed luminosity along with a value for the mass to light ra tio appropriate to the population of stars in the clus ar x iv 2 20 1 02 88 1 v 1 as tr o ph g a 8 j an 2 02 2 http orcid org 0000 0002 1046 1500 2 cuevas otahola et al ter the mass to light ratio is calculated in population synthesis models and is a function of age and metal licity bruzual charlot 2003 on the other hand the dynamical mass is based on the determination of motions of stars under the influence of the collective force of all its stars and is defined as the virial mass mvir 2 prh g where p is the velocity dispersion projected along the line of sight and is the virial fac tor which depends on the shape of the profile gieles et al 2010 the photometric and dynamical masses do not always agree for clusters for which both the mea surements are available see e g mclaughlin et al 2008 gieles et al 2010 almost a factor of 10 uncertainty in is one of the sources of the disagreements between the photometric and dynamical masses this uncertainty can be avoided by theoretically calculating the radial profiles of dispersion velocities for the model that fits the observed sbp such calculations can be carried out for profiles that have an underlying physical model as il lustrated by barmby et al 2007 and mclaughlin et al 2008 who characterized the sbps of globular clusters in m 31 and ngc 5128 respectively the recent avail ability of high resolution multi object or integral field unit fed spectrographs on large telescopes e g gil de paz et al 2018 make it possible the determination of p of large samples of star clusters in nearby galaxies which calls for the recovery of the p corresponding to the best fit models the hubble space telescope hst images of nearby galaxies distance 5 mpc contain star clusters whose profiles are good enough for a characterisation of the shape of the outer halo using physical models however the absence of a publicly available code is a handicap to analyse the profiles of star clusters in these images the purpose of the present work is to develop a user friendly code that can analyse the sbps of star clusters on the hst images to obtain simultaneously the core and halo parameters in addition to p in order to achieve this we follow the procedure outlined by elson et al 1987 as well as the prescription to fit dynamical models king and wilson adopted by mclaughlin 2000 mclaugh lin van der marel 2005 and sollima et al 2015 we here introduce nprofit profile fitting tool of n objects 1 for fitting dynamical models to 1 d sbps for a user given list of star clusters in a single image the dy namical models considered are king king 1966 wil son wilson 1975 and eff elson et al 1987 for the former two models sbps are generated for dynam 1 nprofit is publicly available in the github repository https github com umbramortem nprofit ically stable isothermal clusters of reduced kinetic ener gies whereas for the latter profile jeans equation and the subsequent poisson s equations are solved to obtain dynamical parameters that are consistent with the ob served sbps from the structural parameters obtained by nprofit scale radius rd for eff or r 0 for king and wilson and shape parameters for eff and w 0 for king and wilson our proposed tool computes dy namically relevant parameters such as mass surface and volume mass densities velocity dispersion and binding energy as well as tidal radius and core radius in 2 we describe the nprofit underlying algorithm starting with the program initialization moving subse quently to the background subtraction sbp extraction and subsequently describing the fitted models and the corresponding parameters derivation following the 2 minimization technique in 4 we introduce the simula tion tool mksample and use it to create a mock clusters sample to illustrate the operation of nprofit finally in 5 we show our conclusions and the future directions for nprofit 2 the algorithm nprofit stands for n profile fitting tool this tool was developed to extract and fit the observed sbps of n objects in an image this task is carried out by follow ing a series of steps implemented in fortran python and pyraf routines in this section we describe the structure of our code 2 1 the scope nprofit is developed to obtain the structural param eters of star clusters on the fits format science images of nearby galaxies taken with the hst such as those in the acs nearby galaxy survey treasury angst dalcanton et al 2009 which has more than 60 galaxies at distances 4 mpc there are two kinds of star clus ters that can be easily detected on the hst images of nearby galaxies gcs and super star clusters sscs these clusters typically have a half light radius less than 10 pc which allows them to be distinguished from stars on the hst images up to distances 5 mpc the cores of star clusters are supported against the gravity by the pressure exerted by the random motions of stars and hence are well modelled as isothermal spheres of finite kinetic energies we hence structured our code to fit the observed sbps with theoretical profiles for families of stable clusters theoretical profiles are defined in mass surface density which is related to the observed sbps through the mass to light ratio which is assumed to be be 1 m l and independent of radius in this work for theoretical clusters containing stars of equal mass https github com umbramortem nprofit nprofit a tool for dynamical models fitting 3 and without internal dust such as those defined by king 1966 models this is a good assumption however real clusters have stars of a range of masses with a ten dency for the most massive stars to sink to the center as the cluster dynamically evolves which produces a color gradient that is bluer towards the center see e g djor govski piotto 1993 given that the bulk of the mass of a cluster is in low mass red stars for kroupa 2001 and other initial mass functions sbp in a red filter is expected to trace the mass density profile better than that in a blue filter filters at longer wavelengths also are less affected by possible presence of differential red dening due to patchy internal dust cardelli et al 1989 among the commonly used hst acs filters f 814 w is the reddest filter and hence we recommend the use of f 814 w images for obtaining sbps morphological analysis of extragalactic star clusters suffers from two problems 1 background variation star clusters are often encountered in zones with varying background values such as in the spiral arms of galax ies which requires a measurement of a local background value for each object and 2 object crowding star clusters are hardly isolated both these facts affect the surface brightness of the profile in its external parts we have built in algorithms in the code to address both these issues 2 2 initialization and data preparation the analysis of sbps of objects depends on a number of data dependent parameters as a first step the code reads an input ascii file containing specific analysis parameters an example of program input can be found in appendix a one of the parameters in the input file is the name of a list containing coordinates of n objects the code obtains 2 d sub images centered on each object in the list each sub image is obtained by trimming the original image of user defined sizes and centred on the coordinates in the object list either world coordinates wcs or in pixels these individual images centred at each object coordinates allow us to study the objects separately since datasets are typically constituted by several objects 2 3 background estimation and subtraction estimating and subtracting the background value ac curately is crucial in the determination of structural pa rameters an erroneous estimation of the background value may result in an overestimation or underestima tion of the derived structural parameters we imple mented two techniques to estimate the background val ues locally in each sub image image which are explained below statistical determination in the corners this strat egy is based on the computation of median values in four corners of each sub image over box sizes of 10 the size of each sub image the use of median rather than the mean ensures that each estimated background value is not much affected by any contaminating object in the corners the availability of four measurements allows us to check the uniformity of the background the min imum of the four median and root mean square rms values are taken as the optimum background and rms values for the object under analysis k clipped images this method uses the whole sub image to obtain an optimum background value for the object a background image is obtained by iteratively rejecting pixels with values above and below k around the median value in user defined small boxes the me dian and rms values of this background image are taken as the optimum background and rms values for the ob ject under analysis the obtained values are found to stabilise after ten clipping iterations with k 3 i e the procedure is performed rejecting values above 3 to estimate the background value for this method to ob tain reliable background value the box size should be at least twice the size of the analyzed object both these methods ignore variations in the back ground value over scales of the sub image in princi ple gradient in the background values over scales of the cluster size can be obtained by including the back ground function while fitting the 1 d sbps mackey gilmore 2003 however we found that the background value determined by this method does not easily con verge to stable values like the two methods described above we have used these two techniques to analyse sscs in m 82 and obtained reliable sbps and therefore accurate structural parameters cuevas otahola et al 2020 2021 the obtained background level values are subtracted to their corresponding 2 d individual images resulting in background subtracted sub images 2 4 masking contaminants in some cases the distance between objects are too small hindering an accurate profile extraction analy sis of such clusters requires setting specific constraints on the fitting procedure by either masking the contam inants or setting smaller fitting radii nprofit uses the masking capability that the ellipse task provides to obtain 1 d sbps of sources without con tribution from close contaminant sources the mask in put file is an ascii file containing the number of circular masks along with their spatial coordinates and radii in pixels 4 cuevas otahola et al we draw particular attention to cases where a con taminant source is located in the corners of the figure causing noticeable variations in the background level if a contaminant source fits the latter scenario it will be masked by nprofit prior the background level estima tion 2 5 surface brightness profile extraction star clusters on the hst images are not resolved enough to obtain sbps using the star count method that is normally used to analyse star clusters in the milky way and the lmc brandl et al 1996 mackey gilmore 2003 we used the ellipse task in the iraf stsdas package jedrzejewski 1987 one of the most widely used tools to extract the sbps from 2 d images for analysing extragalactic star clusters the ellipse task obtains sbps by azimuthally averaging in tensities in elliptical annular zones the task allows for variation of center ellipticity 1 b a where a and b are major and minor axes of the ellipse and position angle pa of the major axis of the successive ellipses linear increments in the semi major axis of the succes sive ellipses were used to calculate the intensity profiles we defined concentric ellipses with their centers fixed at the user supplied object coordinates the and pa were also fixed either to the user provided values or to their asymptotic values in the latter case nprofit com putes the ellipticity value by running the ellipse task without fixing the ellipticity values in a first iteration and obtains the sbps in a second run of ellipse after fixing the values of and pa in this scenario nprofit analyzes the radial profiles of ellipticities from the first run setting the ellipticity and pa values as the ones cor responding to the radius at which the ellipticity values are nearly constant in the majority of the cases the value where the ellipticity stabilizes matches the radius containing half the total cumulative flux i e the effec tive radius during the ellipticity estimation nprofit avoids the most inner radii that does not provide reliable measurements the ellipse task obtains cumulative in tensities in addition to the sbps for every fitted ellipse the k sigma clipped rms fluctuations in the azimuthal intensities for each fitted ellipse are taken as the error on the measured intensities all masked pixels are excluded from the analysis during the ellipse fitting 2 5 1 fitting radius considering that in the majority of datasets clusters and extended objects in general are not isolated it is necessary to remove the contribution of contaminant sources even after masking them in the fitting pro cedure with this aim we define the fitting radius for isolated clusters the background subtracted sbps are 0 2 4 6 8 10 12 in te ns e le ct ro n s rip r 3 1 10 sma pix 0 2 4 6 8 10 12 in te ns e le ct ro n s rip r 3 figure 1 illustration of the choice of the fitting radius the plots show isophotal intensity of two simulated clusters as a function of semi major axes of the ellipses that best fit the isophotes the top and bottom panels show clusters with out and with a nearby contaminating source respectively the axis units correspond to natural units for the processed hst acs images which is in electron s for intensities and pixels of 0 05 arcsec for the semi major axis sma expected to monotonically decrease until the intensity values reach one bg with bg being the dispersion of the measured background value intensity we limit the fitting up to a radius at which the sbp has a value of 3 bg we refer to such a radius as r 3 for objects located in relatively crowded regions the sbps show a bump instead of monotonically decreasing well before the intensity reaches the 3 bg level in such cases we de nprofit a tool for dynamical models fitting 5 fine rip the inflection point such that at rip d 2 i dr 2 0 in fig 1 we illustrate the fitting radius selection in the case of a cluster with a contaminant source nearby as well as for an isolated cluster for each object under analysis nprofit computes both radii and sets as the fitting radius the minimum of r 3 and rip 2 6 dynamical model fitting to observed sbps the main goal of our code is fitting the observed sbps of star clusters to derive the basic structural parameters as well as dynamically relevant parame ters the structural parameters are obtained by fitting the observed sbps with the theoretical sbps for self gravitating static models supported by pressure exerted by the stellar motions we describe the theoretical sbps implemented in nprofit below 3 theoretical sbps the theoretical sbps are related to the surface stellar density distributions sdps through the mass to light ratio of stars clusters are self gravitating and hence the sdps determine the potential of the cluster sdps are obtained based on self consistent potential density pairs given by phase space distribution functions f x v t depending on the positions and velocities of stars at a given time binney tremaine 1987 distribution functions df allows us to derive the cluster s spatial density profile fd 3 v 1 and the mean stellar velocity is defined by vi 1 fvid 3 v 2 is directly related to the luminosity profile through the mass to light ratio associated to the objects age bruzual charlot 2003 and is constrained by the collisionless boltzmann equation f t i ai f vi i vi f xi 0 3 with xi vi and ai the positions velocities and accelera tions of the stars it can be noticed that the boltzmann equation depends on 7 variables which hinders obtain ing a direct solution of the equation in order to simplify the problem the jeans equation is used 1 d v 2 r dr 2 v 2 r r d dr 4 with the degree of anisotropy of the velocity distri bution v 2 r the radial velocity the cluster potential for the sake of this work we assume isotropic velocity distributions for which 0 reducing the previous equation to two terms the jeans equation is obtained by taking moments of the boltzmann equation and in tegrating over all the velocities 3 1 king models king models are based on a modified isothermal sphere the density of the dynamical king models is given by a distribution function king 1966 the king distribution is described as follows f exp 20 1 0 0 0 5 with the relative energy of the system defined in terms of the central gravitational potential and the total sys tem energy as e 0 or equivalently 12 v 2 per unit mass o the model associated velocity disper sion described as follows 20 4 g 0 r 2 0 9 6 with 0 the central density and r 0 the scale factor re ferred to as the king radius in the literature from the poisson s equation eq 7 2 4 g 4 g fd 3 v 7 and eq 5 setting w 2 the density function is obtained in terms of w the dimensionless potential w 15 2 ew erf w w w 3 2 8 with erf x the error function erf x 2 x o e t 2 dt w is obtained by solving 2 w 4 g w with bound ary conditions w 0 w 0 with w 0 the central poten tial and w rt 0 with rt the tidal radius in fig 2 left panel we show the density profiles for 4 king models obtained from the previously described procedure we show concentrated w 0 2 and w 0 6 as well as more extended profiles w 0 10 and w 0 15 3 2 wilson models wilson models are based on isothermal sphere mod els as the king models these models were originally proposed by wilson 1975 to fit the observed surface brightness profiles of elliptical galaxies having larger haloes than the king models produced by an extra term 6 cuevas otahola et al 2 0 2 4 log r r 0 8 6 4 2 0 lo g 0 king models w 0 2 w 0 6 w 0 10 w 0 15 2 0 2 4 log r r 0 wilson models w 0 2 w 0 6 w 0 10 w 0 15 2 0 2 4 log r r 0 moffat eff models 8 4 3 2 figure 2 normalized volume densities corresponding to king left panel wilson middle panel and moffat eff right panel the densities corresponding to isothermal based models king and wilson were computed by nprofit in the energy distribution function the distribution function of these models is as follows f exp 20 1 20 0 0 0 9 with the relative energy of the system and o the model associated velocity dispersion described in eq 6 the corresponding mass density function is obtained proceeding analogously as in the king model and fol lows w ew erf w 2 w 4 w 2 15 2 w 3 1 10 the theoretical surface brightness for king and wilson models can be found from the mass density function by means of the following integral i r r 2 rt r r r 2 r 2 1 2 rdr 11 with the mass to light ratio for the sake of simplicity we assume 1 m l throughout this work in fig 2 middle panel we show the density profiles for 4 wilson models obtained from the previously de scribed procedure we show concentrated w 0 2 and w 0 6 as well as more extended profiles w 0 10 and w 0 15 3 3 moffat eff empirical profiles in the pioneering work by elson et al 1987 king models were used to fit the observed profiles of 10 intermediate age star clusters in the large magellanic cloud that have masses and densities similar to that of old globular clusters portegies zwart et al 2010 they found king models did not provide good fits to the sbps because these clusters displayed more extended haloes instead of truncated outer parts elson et al 1987 proposed an empirical profile based on mof fat moffat 1969 profile henceforth moffat eff where eff stands for elson freeman and fall given by i r 2 ltot 2 r 2 d 1 r rd 2 2 12 with r the observed profile projected semi major axis rd the characteristic radius or model scale radius ltot the total luminosity and the moffat eff index which provides information on the shape of the halo moffat eff profile does not have an implicit distri bution function however its 3 d luminosity density profile can be calculated using the expression j r j 0 1 r 2 r 2 d 1 2 13 3 4 volume density and dispersion velocity profiles for isothermal spheres the king and wilson models compute the r as a function of a numerically defined potential w for isothermal spheres given by equation 8 and 10 respec tively the r and w define the core radius dynam ical mass surface and volume mass densities binding energy bound mass and central velocity dispersion and hence the dynamically useful parameters corresponding to the best fit model are known a priori in order to obtain w it is necessary to solve the following expression obtained from the laplacian oper nprofit a tool for dynamical models fitting 7 ator in spherical coordinates and in terms of the dimen sionless potential w 2 1 r r r w r 14 and since w depends only on r and following the pre scription by king 1966 the poisson s equation follows d 2 w dr 2 2 r dw dr 9 0 15 with r r r 0 with the aim of solving these differen tial equations we proceed to re write the equation with w becoming the independent variable to be consistent with eqs 8 and 10 following king 1966 heggie aarseth 1992 ku pper et al 2011 x d 2 x dw 2 3 2 dx dw 2 9 4 0 dx dw 3 16 with x r 2 following the dependence of on w the first step is to use the 4 th order runge kutta method runge 1895 kutta 1901 to obtain w in terms of x and thus in terms of w for each obtained value from each iteration following yn 1 yn h 6 k 1 2 k 2 2 k 3 k 4 17 where k 1 f xn yn k 2 f xn h 2 yn k 1 2 k 3 f xn h 2 yn k 2 2 k 4 f xn h yn k 3 18 re writing eq 16 as d 2 x dw 2 1 4 x dx dw 2 6 9 dx dw 0 19 and setting y x we have y dx dw and y d 2 x dw 2 the latter expression can be expressed by substituting eq 19 y 1 4 x dx dw 2 6 9 dx dw 0 20 finally we proceed to apply runge kutta two times to obtain the values of w wn 1 wn h 6 k 1 2 k 2 2 k 3 k 4 21 and r n 1 r n h 6 k 1 2 k 2 2 k 3 k 4 22 0 001 0 01 0 1 1 10 r r 0 0 0 0 2 0 4 0 6 0 8 1 0 r 0 moffat eff king wilson figure 3 velocity dispersion profiles for king wilson and moffat eff models with the same tidal radius rt and vol ume density 104 2 m pc 3 the king and wilson pro files have w 0 7 1 and w 0 5 7 respectively and the corresponding index for the moffat eff profile is 2 7 with k 1 k 2 k 3 and k 4 and k 1 k 2 k 3 and k 4 following eq 18 with f y and f y respectively from the values of w the mass volume density of king and wilson models are obtained following eqs 8 and 10 respectively for king and wilson models nprofit calculates the corresponding profiles following the prescription in bin ney tremaine 1987 where v 2 r j 2 j 0 with jn 2 2 0 f vn 2 dv 23 resulting in the following equations for king and wilson profiles respectively v 2 r 6 20 5 w w 2 5 2 w 15 8 15 4 ew erf w w w 3 2 3 4 ew erf w 24 v 2 r 6 20 7 w w 3 7 2 w 2 35 4 w 105 8 105 16 ew erf w w w 2 5 2 w 15 4 15 8 ew erf w 25 in fig 3 we show the velocity dispersion profiles for king and wilson models with w 0 7 1 and w 0 5 7 with the same tidal radius rt for illustration purposes 3 5 potential and velocity dispersion profiles for moffat eff models on the other hand some initially empirical models such as the moffat eff model can be physically moti 8 cuevas otahola et al vated for instance by means of eq 12 the moffat eff volume density yields r 0 1 r 2 r 2 d 1 2 26 where 0 i 0 1 2 2 rd 27 with i 0 the central surface brightness in units of l pc 2 and the usual gamma function we bear in mind that in general mass profiles do not strictly follow light pro files over all radii due to the effects of mass segregation shanahan gieles 2015 baumgardt 2017 resulting in mass functions flatter than the luminosity functions however for the sake of simplicity we assume that mass profiles follow light profiles and convert from such quan tities by means of the mass to light ratios in fig 2 right panel we show the density profiles for 4 moffat eff models obtained from the previously described procedure we show concentrated 4 and 8 as well as more extended profiles 2 and 3 nprofit also computes the theoretical velocity dis persion profile for moffat eff model following the eq 16 in the prescription by elson et al 1987 under the assumption of a spherical cluster under hydrostatic equi librium 2 r g rd 1 r 2 r 2 d 1 2 g r rd r 2 d 4 2 2 1 1 r 2 r 2 d 28 with g x rd x rd m x dx x rd 2 1 x rd 2 1 2 29 and and the circular and epicyclic frequencies of the galaxy at the pericenter of the orbit of the cluster and m x the mass enclosed at radius x in fig 3 we show the velocity dispersion profile for a moffat eff profile with 2 7 compared with king and wilson profiles with the same rt the corresponding potential for moffat eff model is computed by means of the poisson equation in spher ical coordinates resulting in the following equation r 4 g rd 0 1 r 2 r 2 d 1 2 1 r 2 d r 2 1 2 f r where f r 1 2 2 f 1 1 2 1 2 1 2 r 2 d r 2 1 2 1 2 30 with 2 f 1 the hypergeometric function and the usual gamma function 3 6 derived parameters we now use our results for best fit models to extract the most commonly used structural parameter namely core radius and half light radius the latter quantity depends on the concentration parameter for the king and wilson models and on the gamma for the moffat eff profile we also provide three additional parame ters namely projected central velocity dispersion total mass and binding energy of the clusters for an assumed mass to light ratio of 1 0 3 6 1 concentration index c for king 1966 and wilson 1975 models the central potential w 0 is related to the concentration parameter c log rt r 0 obtained by fitting empirical king 1962 formula in figure 4 we show this relation which is obtained from the solutions of the models described in the previous section 3 6 2 core radius rc the scale size of the isothermal spheres r 0 and moffat eff profiles rd are related to the core radius rc this quantity is computed recalling that rc is the radius at which the luminosity density reaches half its peak value for moffat eff profiles rc is given in terms of the characteristic radius or model scale radius rd as follows rc rd 2 2 1 1 2 31 the corresponding values for king and wilson models are obtained by nprofit by interpolating over the pro file density values in the left most panel of fig 5 we show an auxiliar dimensionless value used by nprofit to compute rc for king and wilson models for the sake of completeness we show the same dimensionless function in terms of for moffat eff models nprofit a tool for dynamical models fitting 9 0 5 1 0 1 5 2 0 2 5 3 0 3 5 4 0 c 2 4 6 8 10 12 14 w 0 king wilson figure 4 relation between the concentration index c and the dimensionless potential w 0 computed by nprofit fol lowing the procedure described in sec 3 4 for king and wilson models 3 6 3 half light radius rh for a given core size of isothermal spheres the half mass radius is related to the concentration index we show such a relation in the second panel from left to right in fig 5 with wilson models having larger values at the same rh value due to the more extended profiles of the wilson models mclaughlin 2000 characterized such a relation by fitting a 9 th order polynomial for king models we have also performed a polynomial fitting in this case with a 5 th order polynomial for both king eq 32 and wilson eqs 33 and 34 for values below or equal and above c 3 25 respectively models log rh r 0 0 07105 c 5 0 7433 c 4 2 814 c 3 4 552 c 2 3 754 c 1 226 32 if c 3 25 log rh r 0 0 05389 c 5 0 4788 c 4 1 708 c 3 3 007 c 2 2 79 c 1 253 33 otherwise log rh r 0 50 3330062 c 5 953 958025 c 4 7223 17915 c 3 27312 3861 c 2 51573 8755 c 38906 3596 34 on the other hand for the moffat eff profile the rh is analytically related to the fitted structural parameters rd and rh rd 0 5 1 1 2 1 1 2 35 we show the dimensionless function rh r 0 for illus tration purposes in the second panel from left to right in fig 5 along with the corresponding rh rd relatiion for moffat eff models for the sake of completeness 3 6 4 central velocity dispersion 0 nprofit computes de central velocity dispersion val ues from the previously computed velocity profiles de scribed in sec 3 4 for king and wilson models and 3 5 for moffat eff empirical profiles the central veloc ity dispersion profile projected into the plane of the sky p 0 is computed for isothermal models as well as for moffat eff models following p r 2 i r r jv 2 rrdr r 2 r 2 36 with v 2 r the quadratic velocity dispersion profile com puted in sec 3 4 and 3 5 and i r the sbp 3 6 5 tidal radius rt from the computed velocity dispersion profiles corre sponding to moffat eff models we can compute the tidal radius by finding the radius r at which p r 0 on the other hand we find such quantity for king and wilson models from the concentration parameter and scale radius following the expression for the concentra tion index rt 10 c r 0 3 6 6 total mass mtot another critical parameter these models provide is the total mass for moffat eff models nprofit derives the model mass from the total luminosity ltot using eq 12 and assuming a mass to light ratio the mass corresponding to king and wilson models is computed from eqs 38 and 40 in king 1966 instead resulting in mtot 4 j 0 r 2 0 r t 0 j r 2 dr 37 with j j j 0 expressed as a normalised quantity as obtained in the previous sections r t rt r 0 and r r r 0 in the right most panel in fig 5 we show auxiliar dimensionless function used by nprofit to compute mtot for king and wilson models along with moffat eff profiles for completeness 10 cuevas otahola et al 1 2 3 4 c 0 4 0 5 0 6 0 7 0 8 0 9 r c r 0 king wilson moffat eff 246810 1 2 3 4 c 1 10 100 r h r 0 king wilson moffat eff 246810 1 2 3 4 c 0 8 1 0 1 2 1 4 1 6 1 8 2 0 i 0 j 0 r 0 king wilson moffat eff 246810 1 2 3 4 c 10 100 1000 m to t 0 r 2 0 king wilson moffat eff 246810 figure 5 normalised functions used to compute rc left most panel rh second panel from left to right and auxiliar functions for i 0 jor 0 third panel and mtot right most panel these functions are used by nprofit to speed up calculations 0 5 1 0 1 5 2 0 2 5 3 0 3 5 4 0 c 1 10 100 r t 0 w r r 2 0 r 2 0 d r king wilson figure 6 auxiliar function to compute the integral in eq 39 for the binding energy 3 6 7 binding energy eb following the prescription by mclaughlin 2000 we have also implemented in nprofit the computation of the binding energy eb using their eq 1 nprofit computes eb for moffat eff models sub stituting the potential described in eq 30 along with the density in eq 26 into the following equation eb 1 2 rt 0 4 dr 38 on the other hand for king and wilson models nprofit uses the dimensionless function in the right most panel in fig 6 to compute the integral in the following equation eb 1 2 rt 0 4 r 2 gm rt 20 w r dr 39 3 6 8 central surface magnitude 0 the central surface brightness i 0 in l pc 2 is con verted to observational units f 0 using f 0 mf 21 57 2 5 log i 0 40 with mf the absolute magnitude of the sun in the filter f provided by the user see willmer 2018 3 7 library of dynamical models for king and wilson models nprofit solves the previously described set of differential equations with boundary conditions for w 0 2 15 in steps of 0 1 in terms of r r 0 the latter results in a library constituted by files containing r r 0 w and these libraries are the results of the most computer intensive module of nprofit they are pre evaluated to speed up compu tation times and the corresponding results are used to compute the previously described derived parameters nprofit uses this library for any new fit unless the user specifically asks to solve the equations 3 8 convolution with the point spread function psf the theoretical profiles are convolved with the user provided psf 2 by nprofit using a fortran routine we recall that in general for finite datasets as the mod els we described the convolution operator is given by g h m n n n g n h m n 41 2 psf for the hst images can be obtained using the tinytim tool see https www stsci edu hst instrumentation focus and pointing focus tiny tim hst psf modeling alternatively it can be defined for each frame using the tasks for that purpose in daophot package or sextractor command psfex in the present work we assumed a gaussian profile of fwhm 2 1 pixels which represents well the point sources on the hst acs images nprofit a tool for dynamical models fitting 11 40 20 0 20 40 r pix 0 0 0 2 0 4 0 6 0 8 1 0 i i 0 model psf convolved model figure 7 convolution scheme performed by nprofit the model is wrapped around and the psf is mirrored and zero padding is performed to meet the required size criterion for the fft the plotted example corresponds to 27 128 pix els with g the signal and f the response function which in our case are the dynamical models and the psf respec tively computing eq 41 requires n 2 operations to perform the convolution in order to reduce the number of operations nprofit uses the fast fourier transform fft resulting in n log 2 n operations reducing the number of operations in 65 nprofit computes the fft using the numerical recipes routine convlv press et al 1992 in general the fft splits the convolution expression in terms of odd and even indices in the sum hence fft routines require the input sampled in num ber of points being a power of 2 it is also required for the convlv routine that the psf or response function is wrapped around and filled with zeros to obtain a vec tor with a length of n 1 odd size n is the size of the vector containing the dynamical model which is a power of two the model needs to be mirrored and wrapped around in fig 7 we illustrate the convolution procedure along with the required zero padding and wrapping 3 9 selection of the best fit model from the previously determined fitting radius nprofit proceeds to compute which model provides the most accurate and reliable representation of the ob served sbps to this aim we use the non parametric statistical test 2 bevington et al 1993 the 2 test determines the goodness of a fit to data suitable for observed data with gaussian errors which by virtue of the central limit theorem alexander mcfarlane mood 1974 are good approximations of poisson distributions poisson statistics are crucial in the determination of the data noise having different variances requiring to use a 2 test weighted by errors wall jenkins 2003 2 npts i 1 iobsi i modeli 2 2 i 42 with npts the number of points the azimuthally averaged profile intensities iobsi i the corresponding errors computed during the isophotal fitting and i modeli the psf convolved model intensities at i varying from 1 to npts nprofit performs the 2 minimization technique to find the best fit model in the parameter space for each one of the available theoretical models in nprofit in order to determine which of these models represents most accurately the observed data we imple mented the prescription by mclaughlin van der marel 2005 to compare the obtained best fit models 2 2 alt 2 ref 2 alt 2 ref 43 where 2 ref and 2 alt are the 2 min values of the reference model and the model to be compared respectively this procedure allows to determine in which cases two models are equally good 2 0 2 or whether the al ternative model provides a better fit than the reference model 3 10 determination of errors nprofit computes the errors on the obtained param eters by considering 1 significance regions consid ering that each fit depends basically on three free pa rameters the intervals for a 1 level of confidence are defined by means of the following equation wall jenkins 2003 2 2 min 3 50 44 with 2 min the 2 value of the best fit model and 2 the value corresponding to the rest of the models these in tervals are computed for moffat eff king and wilson models separately the errors on the derived parame ters described in sec 3 6 are computed by nprofit by propagating the errors on the basic parameters for each models namely rd and for moffat eff models and r 0 and w 0 for king and wilson models 4 code illustration with simulated clusters in cuevas otahola et al 2020 2021 we have ap plied the techniques described in this algorithm and 12 cuevas otahola et al compared our results with those obtained using the pub licly available tools galfit and ishape our results for the sample of super star clusters in m 82 were in agree ment with the results obtained by galfit for moffat eff models more specifically in cuevas otahola et al 2021 we computed the derived parameters of the sam ple for moffat eff models in order to illustrate these techniques for king and wilson models as well we sim ulated a sample of 105 clusters following king wilson and for the sake of completeness we also simulated clus ters following moffat eff model profiles with the aim of testing the code in a realistic scenario considering that typically star clusters are embedded in crowded regions we used an archive image as the background of our mock clusters we used an image in f 555 w fil ter extracted from the hst legacy survey provided by the hubble heritage team of the prototype starburst galaxy m 82 which is a complex study case due to its high crowding high inclination angle and background gradient in fig 8 we show a simulated image con taining 105 clusters along with the zoom on sub images around 5 of the clusters in the mock sample the back ground of the mock sample has considerable gradient the mock sample is based on the parameters set in tab 1 simulated several times for different central surface brightness 4 1 sample simulation we have designed and implemented the subroutine mksample to generate a mock sample from user given coordinates and model type mock sample of clusters can be generated using our module mksample from user given coordinates and model type mksample generates 2 d images follow ing the projected profiles of the available models the synthetic profiles data are stored in a 2 d matrix which is generated following a similar procedure as that in the iraf task mkobjects we draw particular attention to the geometrical features of the models as in the case of mkobjects we consider the profiles of models with spherical symmetry however to reproduce the axysymmetry of some observed objects we introduce an artificial ellipticity in the x y model coordinates as table 1 set of initial parameters used to build the mock data with moffat eff m king k and wilson w m rd m w 0 k r 0 k w 0 w r 0 w pix pix pix 1 2 3 4 5 6 2 5 0 5 8 0 5 8 4 0 5 2 7 2 7 8 2 0 9 8 0 9 3 1 3 1 7 8 1 1 7 4 1 1 3 1 3 5 6 4 1 9 6 2 1 9 3 3 3 7 4 6 3 1 4 6 3 1 3 5 4 3 3 8 4 7 5 2 4 9 4 1 5 1 3 8 4 9 7 2 5 1 note description of the columns 1 moffat eff shape parameter 2 moffat eff characteristic radius 3 and 5 king and wilson central dimensionless potential 4 and 6 king radius for king and wilson models respec tively each pair of parameters was simulated for five dif ferent values of central surface brightness mag arcsec 2 18 5 17 0 16 3 15 3 and 14 the varying galaxy back ground reaches values from 22 2 to 18 6 mag arcsec 2 with a median value of 21 mag arcsec 2 resulting in a hetero geneous sample with differences between the central sur face brightness and the background value from 2 to 7 5 mag arcsec 2 with a median value of 4 7 mag arcsec 2 follows xmod xt cos 90 pa 180 yt sin 90 pa 180 ymod xt sin 90 pa 180 yt cos 90 pa 180 ar where xt xi 1 xc yt yj 1 yc 45 with pa and ar ar b a with a and b the semi major and semi minor axis respectively the position angle and axis ratio respectively xi and yj are the i j coordinates in the x and y direction of the image and xc and yc the centers of each object we draw atten tion to the mock elliptic clusters whose parameters are well recovered using spherical models since as we have shown in appendix a in cuevas otahola et al 2020 for the most elongated cluster in m 82 m 82 f the ellip ticity does not considerably affects the integrated profile obtained from the isophotal fitting nprofit a tool for dynamical models fitting 13 figure 8 top panel synthetic clusters 105 green circles superposed on a real hst image which corresponds to the f 555 w image bottom panels zoom in of five clusters of the mock sample in images of 101 x 101 pixels centered in clusters s 24 s 43 s 49 s 93 and s 94 from left to right respectively we show in the images bars indicating 1 kpc and 10 pixels in the top and bottom panels respectively throughout this work we use an image scale of 0 88 pc pixel 1 which corresponds to the physical size of the hst acs pixels at the distance of m 82 3 63 mpc each profile is simulated as follows sim i j s 0 mod mod r par 1 par 2 bg 46 with r x 2 mod y 2 mod mod the selected model moffat eff wilson or king s 0 mod the central sur face brightness used for the simulation par 1 par 2 the model parameters rd and for moffat eff models and r 0 and w 0 for king and wilson models bg is the sim ulated background value for each coordinate for the sake of testing nprofit in a realistic background sce nario we used a real archive image of a galaxy instead of the usual background image drawn from a gaussian dis tribution with mean and sigma values provided by the user we used an image from the hst legacy survey made publicly available by the hubble heritage team mutchler et al 2007 corresponding to the prototype starburst galaxy m 82 located at a distance of 3 63 mpc freedman et al 1994 such a galaxy represents an in terest study case ideal to determine the extents of the code considering that it has a strong background gradi ent a large number of clusters along its disk and nucleus around 600 mayya et al 2008 and a high inclination degree 77 mayya et al 2005 in addition to the re alistic background conditions the mock sample spans a wide range of central surface brightness values span ning around 4 5 mag arcsec 2 from 18 5 mag arcsec 2 to 14 mag arcsec 2 in 5 bins initially set to test the ac curacy of the code and its dependence on the surface brightness profiles of the clusters in fig 8 we show the mock sample constituted by 105 clusters with the m 82 galaxy image in the f 555 w as 14 cuevas otahola et al 3 4 rd pc 3 0 3 2 3 4 3 6 3 8 4 0 4 2 initial fitted moffat 5 mag arcsec 2 0 1 2 3 4 5 r 0 pc 3 5 4 0 4 5 5 0 5 5 6 0 6 5 7 0 7 5 8 0 8 5 9 0 w 0 initial fitted king 5 mag arcsec 2 0 1 2 3 4 5 r 0 pc 4 5 5 0 5 5 6 0 6 5 7 0 7 5 8 0 8 5 9 0 w 0 initial fitted wilson 5 mag arcsec 2 0 1 2 3 4 5 rd pc 2 4 2 6 2 8 3 0 3 2 3 4 3 6 3 8 4 0 4 2 initial fitted moffat 5 mag arcsec 2 0 1 2 3 4 5 r 0 pc 3 5 4 0 4 5 5 0 5 5 6 0 6 5 7 0 7 5 8 0 8 5 9 0 w 0 initial fitted king 5 mag arcsec 2 0 1 2 3 4 5 r 0 pc 4 5 5 0 5 5 6 0 6 5 7 0 7 5 8 0 8 5 9 0 w 0 initial fitted wilson 5 mag arcsec 2 figure 9 initial conditions of the mock simulation along with the values obtained by nprofit with the corresponding 1 confidence intervals for moffat eff left most panels king middle panels wilson right most panels models for faint top panels and bright bottom panels clusters figure 10 azimuthally averaged surface brightness profiles computed by nprofit through the ellipse iraf task for the objects s 93 and s 28 in the left and right panels respectively nprofit a tool for dynamical models fitting 15 figure 11 dynamical models moffat eff king and wilson fitting performed by nprofit to the surface brightness profile of a cluster in the mock sample generated with mksample top panel fitting residuals bottom panel the fitting radius is shown with the vertical dashed line the observed sbp with the empty dots and the fitted models with solid lines table 2 set of initial and fitted parameters obtained by nprofit for the mock sample id im om r 0 i r 0 f w 0 w 0 f rh i rh f rc log m log 0 rt 0 log eb mag arcsec 2 pc pc pc pc pc m m pc 3 pc km s ergs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 s 5 m m 3 5 0 39 3 3 3 1 0 37 0 32 3 3 3 0 0 31 0 29 4 5 4 8 0 75 0 65 2 1 0 13 0 10 5 5 0 07 0 08 3 0 0 10 0 09 11 4 0 48 0 43 3 1 0 69 0 66 46 0 0 68 0 61 s 7 m m 4 7 0 38 4 5 4 3 0 45 0 39 4 1 3 7 0 41 0 35 4 3 4 3 0 94 0 81 2 6 0 11 0 10 5 6 0 03 0 02 3 0 0 09 0 08 5 4 0 61 0 52 3 6 0 78 0 72 43 5 0 86 0 74 s 11 m m 5 5 0 23 3 1 3 1 0 22 0 20 3 1 3 0 0 13 0 16 4 9 4 9 0 43 0 41 2 1 0 10 0 07 6 0 0 01 0 03 3 5 0 06 0 06 21 8 0 26 0 26 5 3 0 51 0 51 46 6 0 36 0 36 s 18 m m 6 5 0 16 3 1 3 2 0 18 0 16 3 1 3 0 0 08 0 13 4 9 4 8 0 33 0 32 2 1 0 10 0 06 6 3 0 04 0 02 3 8 0 05 0 04 31 5 0 20 0 21 7 6 0 44 0 45 47 0 0 28 0 29 s 31 m m 7 3 0 10 2 7 2 8 0 06 0 06 3 1 3 0 0 04 0 05 4 3 4 3 0 12 0 12 1 9 0 03 0 02 6 6 0 01 0 00 4 3 0 02 0 02 18 6 0 07 0 08 11 6 0 27 0 28 47 7 0 10 0 11 s 39 k k 3 5 0 67 1 7 1 9 2 75 3 05 6 4 6 2 1 71 0 79 3 6 3 2 0 94 4 80 2 9 1 38 0 70 5 9 0 45 0 11 2 7 0 40 0 17 38 5 2 55 2 24 2 0 0 27 0 22 46 7 0 08 0 06 s 49 k k 2 5 0 37 4 3 4 0 1 05 1 05 3 8 5 3 0 98 0 72 4 5 5 1 0 33 1 96 2 9 0 81 0 62 6 0 0 49 0 40 2 9 0 43 0 30 49 2 0 80 0 74 5 3 0 06 0 05 46 7 0 13 0 13 s 55 k k 5 3 0 26 4 1 5 0 0 70 0 36 3 8 3 4 0 38 0 81 4 3 4 3 0 27 0 86 2 7 0 42 0 63 6 5 0 53 0 45 3 1 0 05 0 44 26 7 0 34 0 30 7 7 0 02 0 04 49 1 0 01 0 01 s 58 k k 6 1 0 22 0 8 0 8 0 59 0 51 8 2 8 4 0 14 0 11 5 2 5 3 0 14 2 45 3 0 0 11 0 09 7 7 0 03 0 00 4 0 0 01 0 01 67 2 0 55 0 46 3 9 0 04 0 03 49 4 0 01 0 01 s 70 k k 6 8 0 15 4 3 4 7 0 29 0 35 3 8 3 8 0 44 0 37 4 5 4 4 0 29 0 52 2 7 0 36 0 32 6 9 0 25 0 27 3 6 0 21 0 16 29 4 0 21 0 22 13 2 0 02 0 02 49 8 0 01 0 01 s 76 w w 3 8 0 63 4 3 4 7 2 01 0 59 5 2 5 4 0 57 1 72 3 5 3 5 0 36 0 36 2 8 0 65 1 29 5 4 1 02 0 69 2 4 0 10 1 03 165 6 1 72 0 83 3 2 0 09 0 09 45 1 0 33 0 11 s 82 w w 2 5 0 39 2 7 2 9 1 45 1 45 4 6 5 0 1 12 0 78 2 1 2 0 0 28 0 26 2 8 1 00 0 76 6 0 0 39 0 21 3 0 0 34 0 21 73 6 1 34 1 22 4 1 0 10 0 08 46 9 0 04 0 05 s 88 w w 5 6 0 28 1 7 1 8 0 54 0 96 6 2 6 1 0 41 0 22 1 7 1 5 0 47 0 48 2 9 0 34 0 24 6 7 0 11 0 03 3 5 0 09 0 04 117 9 0 82 1 18 4 6 0 05 0 04 47 6 0 02 0 03 s 102 w w 6 4 0 16 1 7 1 8 0 44 0 39 6 2 6 1 0 19 0 20 1 7 1 6 0 21 0 28 2 9 0 17 0 18 7 1 0 06 0 02 3 9 0 04 0 04 124 6 0 59 0 54 7 7 0 02 0 03 48 5 0 01 0 01 s 103 w w 6 9 0 16 2 7 2 9 0 42 0 40 4 6 4 7 0 28 0 27 2 1 2 0 3 63 3 08 2 7 0 26 0 25 6 7 0 10 0 06 3 8 0 08 0 08 64 5 0 35 0 33 9 6 0 02 0 02 48 6 0 01 0 01 note description of the columns 1 simulated cluster id 2 input model 3 output model 4 difference between central surface brightness and local background value 5 and 6 initial and fitted scale radius rd for moffat eff models and r 0 for king and wilson models 7 and 8 initial and fitted shape parameters for moffat eff models and w 0 for king and wilson models 9 and 10 initial and fitted half light radii 11 core radius 12 logarithm of total profile mass 13 logarithm of central volume mass density 14 tidal radius 15 central velocity dispersion 16 logarithm of the binding energy 16 cuevas otahola et al the background image we assumed a mass to light ra tio of 1 resembling that of a population of 2 2 gyr in the f 555 w filter and a zero point magnitude of 25 779 mag the initial structural parameters were simulated con sidering realistic values following the values reported in cuevas otahola et al 2020 2021 resembling clus ters in m 82 to that aim we performed our simula tions chosing the set of initial conditions in fig 9 for moffat eff king and wilson models with cen tral surface brightness values between 14 mag arcsec 2 and 18 5 mag arcsec 2 and with background values be tween 18 6 mag arcsec 2 and 22 2 mag arcsec 2 we per formed the fits using nprofit and find that the ob tained parameters are well within the 1 confidence intervals centred at the initial values in the majority of cases showing fitted values closer to the initial values for brighter clusters our mock sample is constituted by these 21 combinations of structural parameters 7 per each model summarized in tab 1 along with the 5 bins in surface brightness resulting in a mock sam ple of 105 clusters with each combination of structural parameters and rd for moffat eff and w 0 and r 0 for king and wilson models simulated for each one of the initial central surface brightness profiles the mock sample clusters positions were drawn from a uniform distribution limited by the galaxy geometry 4 2 structural parameters of the mock sample we run the nprofit code over our synthetic data and obtained in the first place the sub images centered in each object background subtracted images are sub sequently obtained in fig 10 we show examples of sbps on our simu lated image for two clusters the intensities are given in units of raw counts per second cps on the background subtracted images these are converted to mag arcsec 2 units using the zeropoint and image scale given by the user the profile semi major axis is given in units of pixels which are converted to parsecs using the image scale given by the user to match the theoretical models units for fitting purposes in fig 11 we show an example of an extracted surface brightness profile along with the corresponding best fit model the corresponding residuals are also shown in order to compare in a more homogeneous way the re sults obtained by nprofit we computed one of the most relevant quantities the half light radius rh and compared it with their initial values in order to en sure that the obtained results are reliable regarding the fitted model we determined the best fitting model in each case following eq 43 as we show in fig 12 in panel a we show the comparison between the ref a b c figure 12 2 values to determine the best fitting model setting as a model for comparison moffat eff a king b and wilson c versus percentage error for rh fits performed by nprofit for the clusters initially fitted with the models shown in the figure legend the green horizontal gaps rep resent a difference of 20 between the compared models where the compared fits provide equally good results nprofit a tool for dynamical models fitting 17 a b c d figure 13 percentage error for rh fits performed by nprofit a galfit b ishape c and from an empirical estimate d versus the initial half light radius with the point sizes coded as a function of the difference between central surface brigthness and local background values for each cluster the dotted horizontal line represents errors equal to zero erence models and moffat eff and observe the overall trend of clusters initially modelled with moffat eff not being well fitted in general by king and wilson models in panel b we show the comparison for clusters ini tially modelled with king models resulting in good fits for wilson fits and poor fits for moffat eff models finally in panel c we show the comparison for clus ters initially modelled with wilson models resulting in a similar behavior to that in the middle panel hence from fig 12 we conclude that clusters simulated with moffat eff models are well fitted by moffat eff mod els whereas clusters simulated with king and wilson models are well fitted either by king or wilson models we computed the rh values from the fitted r 0 and w 0 for clusters best fitted either by king or wilson models and from rd and for those best represented by moffat 18 cuevas otahola et al eff models following the prescription in sec 3 6 3 we fit the three models to all the mock sample data regardless of the models they were drawn from in order to test the accuracy of nprofit in fig 13 a we show the difference between the initial rh values and the values obtained by nprofit weighted by the initial rh values and compared with them as a function of the difference between the central surface brightness and the measured background value as expected we observe a better recovery for larger values even for small clusters with larger errors con sidering that the latter ones have sizes close to the limit image resolution for the sake of this analysis we removed extremely faint clusters in very crowded areas resulting in fitting radius values shorter than 8 pixels resulting in a sub sample of 74 clusters on average we notice that the recovered values for clusters with 5 mag arcsec 2 are within 20 of the initial values whereas for clus ters with 5 mag arcsec 2 the recovered values are within 10 of the initial values in order to validate our results and compare them with the corresponding ones obtained by other publicly available tools we carried out the structural parame ters fitting using galfit peng et al 2010 and ishape larsen 1999 in fig 13 b we compare the results ob tained by galfit version 3 0 5 with the initial simu lated values we obtained converging fits for 55 clusters which are on average among the brightest ones we no tice that galfit provides fits comparable to nprofit in all size ranges on the other hand in fig 13 c we compare the results obtained by ishape with the initial simulated values for clusters with large contrast 5 mag arcsec 2 ishape provides equally good results for 70 of the clusters however the rh values values obtained by ishape have larger dispersion and errors for 5 mag arcsec 2 cuevas otahola et al 2020 had demonstrated that the core radii for real m 82 clusters are well reproduced by ishape hence the large error on rh is most likely due to poor recovery of halo parameters in ishape for clusters located in high background regions we have also empirically found the rh values by inte grating the observed surface brightness profiles of each cluster and corrected them by the psf radius and we compare them against the initial rh values in fig 13 d the recovery is especially poor for rh 4 pc with the recovered values systematically larger 5 conclusions in this work we present the numerical code nprofit devoted to obtain the best fit structural parameters of star clusters in the hst images of nearby distance 5 mpc galaxies the code is python based at the user end but uses modules of pyraf and fortran nprofit extracts sub images centered in each analyzed object coordinates subsequently a local background estimation is carried out by nprofit determining the median values in the corners or by scanning the whole images and estimating the background value by a clipping procedure the estimated value is subsequently subtracted from the extracted sbps by nprofit from isophotal fittings psf convolved moffat eff king and wilson models are then fitted to background sub tracted azymuthally averaged surface brightness pro files nprofit uses a 2 minimization technique to fit the models as a result the tool provides the set of basic structural parameters scale parameters rd for moffat eff and r 0 for king and wilson models and shape pa rameters for moffat eff and w 0 for king and wilson models since nprofit fits dynamical models it offers a valuable opportunity to derive physically relevant pa rameters among these parameters are central volume and luminosity densities 0 and j 0 total masses and luminosities m and l central velocity dispersions 0 core radius rc half light radius rh tidal radius rt and binding energy eb we have tested nprofit on simulated clusters su perposed on real hst images for the simulated clus ters the surface brightness difference between the clus ter maximum and the local background varies between 3 to 8 mag arcsec 2 we demonstrate that the input values are recovered within the 1 errors for majority of the simulated clusters for all the three theoretical models we have explored the rh values are recovered within 10 percent for clusters with 5 mag arcsec 2 and 20 percent for clusters with 5 mag arcsec 2 the accuracy of our recovery is comparable to that of gal fit whereas it is clearly better than that with ishape especially for clusters 5 mag arcsec 2 we illustrate that nprofit is a tool suitable to fit the structural pa rameters in samples with considerable crowding such as the m 82 disk providing reliable values for clusters for which a neighbouring cluster does not contribute signif icantly within a distance of 8 hst acs pixels as a final note we clarify that in this work we con sidered that mass profiles follow light profiles over all clusters radii this is a simplification since mass seg regation influences the mass density profiles of clusters as well as their central velocity dispersions causing the mass profiles to depart from the corresponding light pro files for this reason we will include mass segregation prescriptions in the upcoming version of nprofit nprofit a tool for dynamical models fitting 19 acknowledgments bco thanks conacyt for the support that en abled her to carry out the work presented here we also thank conacyt for the research grants cb a 1 s 25070 ydm cb 2014 240426 ip and cb a 1 s 22784 drg that allowed the acquisition of a cluster that was used for computations in this work bco wants to thank the anonymous reviewer for the comments that allowed us to improve this work significantly references alexander mcfarlane mood franklin a graybill d c b 1974 introduction to the theory of statistics 3 rd edn mcgraw hill series in probability and statistics mcgraw hill barmby p mclaughlin d e harris w e harris g l h forbes d a 2007 aj 133 2764 doi 10 1086 516777 baumgardt h 2017 mnras 464 2174 doi 10 1093 mnras stw 2488 bevington p r robinson d k blair j m mallinckrodt a j mckay s 1993 computers in physics 7 415 binney j tremaine s 1987 galactic dynamics princeton university press brandl b sams b j bertoldi f et al 1996 apj 466 254 doi 10 1086 177507 bruzual g charlot s 2003 mnras 344 1000 doi 10 1046 j 1365 8711 2003 06897 x cardelli j a clayton g c mathis j s 1989 apj 345 245 doi 10 1086 167900 cuevas otahola b mayya y d puerari i rosa gonza lez d 2020 mnras 492 993 doi 10 1093 mnras stz 3524 2021 mnras 500 4422 doi 10 1093 mnras staa 3513 dalcanton j j williams b f seth a c et al 2009 apjs 183 67 doi 10 1088 0067 0049 183 1 67 djorgovski s piotto g 1993 in astronomical society of the pacific conference series vol 50 structure and dynamics of globular clusters ed s g djorgovski g meylan 203 elson r a w fall s m freeman k c 1987 apj 323 54 doi 10 1086 165807 freedman w l hughes s m madore b f et al 1994 apj 427 628 doi 10 1086 174172 gieles m sana h portegies zwart s f 2010 mnras 402 1750 doi 10 1111 j 1365 2966 2009 15993 x gil de paz a carrasco e gallego j et al 2018 in society of photo optical instrumentation engineers spie conference series vol 10702 ground based and airborne instrumentation for astronomy vii ed c j evans l simard h takami 1070217 doi 10 1117 12 2313299 heggie d c aarseth s j 1992 mnras 257 513 doi 10 1093 mnras 257 3 513 jedrzejewski r i 1987 mnras 226 747 doi 10 1093 mnras 226 4 747 king i 1962 aj 67 471 doi 10 1086 108756 king i r 1966 aj 71 64 doi 10 1086 109857 kroupa p 2001 mnras 322 231 doi 10 1046 j 1365 8711 2001 04022 kutta w 1901 beitrag zur na herungsweisen integration totaler differentialgleichungen teubner https books google com mx books id k 5 e 6 kqeacaaj ku pper a h w maschberger t kroupa p baumgardt h 2011 mnras 417 2300 doi 10 1111 j 1365 2966 2011 19412 x larsen s s 1999 a as 139 393 doi 10 1051 aas 1999509 mackey a d gilmore g f 2003 mnras 338 85 doi 10 1046 j 1365 8711 2003 06021 x mayya y d carrasco l luna a 2005 apjl 628 l 33 doi 10 1086 432644 mayya y d romano r rodr guez merino l h et al 2008 apj 679 404 mclaughlin d e 2000 apj 539 618 doi 10 1086 309247 mclaughlin d e barmby p harris w e forbes d a harris g l h 2008 mnras 384 563 doi 10 1111 j 1365 2966 2007 12566 x mclaughlin d e van der marel r p 2005 apjs 161 304 doi 10 1086 497429 moffat a f j 1969 a a 3 455 mutchler m bond h e christian c a et al 2007 pasp 119 1 doi 10 1086 511160 peng c y ho l c impey c d rix h w 2010 aj 139 2097 doi 10 1088 0004 6256 139 6 2097 portegies zwart s f mcmillan s l w gieles m 2010 ara a 48 431 doi 10 1146 annurev astro 081309 130834 http doi org 10 1086 516777 http doi org 10 1093 mnras stw 2488 http doi org 10 1086 177507 http doi org 10 1046 j 1365 8711 2003 06897 x http doi org 10 1086 167900 http doi org 10 1093 mnras stz 3524 http doi org 10 1093 mnras staa 3513 http doi org 10 1088 0067 0049 183 1 67 http doi org 10 1086 165807 http doi org 10 1086 174172 http doi org 10 1111 j 1365 2966 2009 15993 x http doi org 10 1117 12 2313299 http doi org 10 1093 mnras 257 3 513 http doi org 10 1093 mnras 226 4 747 http doi org 10 1086 108756 http doi org 10 1086 109857 http doi org 10 1046 j 1365 8711 2001 04022 https books google com mx books id k 5 e 6 kqeacaaj https books google com mx books id k 5 e 6 kqeacaaj http doi org 10 1111 j 1365 2966 2011 19412 x http doi org 10 1051 aas 1999509 http doi org 10 1046 j 1365 8711 2003 06021 x http doi org 10 1086 432644 http doi org 10 1086 309247 http doi org 10 1111 j 1365 2966 2007 12566 x http doi org 10 1086 497429 http doi org 10 1086 511160 http doi org 10 1088 0004 6256 139 6 2097 http doi org 10 1146 annurev astro 081309 130834 20 cuevas otahola et al press w teukolsky s vetterling w flannery b 1992 numerical recipes in fortran 77 the art of scientific computing 2 nd edn cambridge university press runge c 1895 ueber die numerische auflo sung von differentialgleichungen zenodo doi 10 1007 bf 01446807 shanahan r l gieles m 2015 mnras 448 l 94 doi 10 1093 mnrasl slu 205 sollima a baumgardt h zocchi a et al 2015 mnras 451 2185 doi 10 1093 mnras stv 1079 wall j v jenkins c r 2003 practical statistics for astronomers cambridge observing handbooks for research astronomers leiden cambridge univ press willmer c n a 2018 apjs 236 47 doi 10 3847 1538 4365 aabfdf wilson c p 1975 aj 80 175 doi 10 1086 111729 http doi org 10 1007 bf 01446807 http doi org 10 1093 mnrasl slu 205 http doi org 10 1093 mnras stv 1079 http doi org 10 3847 1538 4365 aabfdf http doi org 10 1086 111729 nprofit a tool for dynamical models fitting 21 appendix a nprofit input we show an example of nprofit input nprofit is a modular stand alone code fully adjustable to the user s needs for further details on the routines see the readme file filters dat 1 100 list x 0 y 0 dat 1 no no no 2 yes no mask file dat yes no no no 0 3 no 1 2 yes yes yes nprofit librarypath 3 yes ds 9 path yes filters information file fitting box size option 1 same for all objects 2 table with box size for each object box size if the previous option is 1 fitting box sizes information file if the previous option is 2 objects coordinates coordinate system 1 image pixel 2 wcs cut images into images centered in each object substract sky measure sky sky measurement option 1 for instat 2 for median method see readme for details provide measurements of the sky in a file use pixel mask of contaminants pixel mask file ascii file use given ellipticity and p a for isophotal fitting supplied by the user calculate p a ellipticity for isophotal fitting calculate isophotal fitting restrict ellipticity ellipticity restriction value if previous option is yes convolve model with the psf psf options 1 user given 2 gaussian etc dynamical models fitting options 1 prepare data for fitting 2 data already prepared for fitting fit moffat eff profile fit king dynamical profile fit wilson profile absolute nprofit library path fitting procedure options 1 automatically fit 2 prepare a script to fit later the models 3 fits already performed plot surface brightness profiles and dynamical models fitting ds 9 path if the previous option is yes compute derived parameters 1 introduction 2 the algorithm 2 1 the scope 2 2 initialization and data preparation 2 3 background estimation and subtraction 2 4 masking contaminants 2 5 surface brightness profile extraction 2 5 1 fitting radius 2 6 dynamical model fitting to observed sbps 3 theoretical sbps 3 1 king models 3 2 wilson models 3 3 moffat eff empirical profiles 3 4 volume density and dispersion velocity profiles for isothermal spheres 3 5 potential and velocity dispersion profiles for moffat eff models 3 6 derived parameters 3 6 1 concentration index c 3 6 2 core radius rc 3 6 3 half light radius rh 3 6 4 central velocity dispersion 0 3 6 5 tidal radius rt 3 6 6 total mass mtot 3 6 7 binding energy eb 3 6 8 central surface magnitude 0 3 7 library of dynamical models 3 8 convolution with the point spread function psf 3 9 selection of the best fit model 3 10 determination of errors 4 code illustration with simulated clusters 4 1 sample simulation 4 2 structural parameters of the mock sample 5 conclusions acknowledgements a nprofit input