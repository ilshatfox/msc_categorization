levelness of order polytopes christian haase florian kohl and akiyoshi tsuchiya abstract since their introduction by stanley sta 86 order poly topes have been intriguing mathematicians as their geometry can be used to examine algebraic properties of finite posets in this paper we follow this route to examine the levelness property of order polytopes the levelness property was also introduced by stanley sta 77 and it generalizes the gorenstein property this property has been recently characterized by miyazaki miy 17 for the case of order polytopes we provide an alternative charac terization using weighted digraphs using this characterization we give a new infinite family of level posets and show that deter mining levelness is in co np this family can be used to create infinitely many examples illustrating that the levelness property can not be characterized by the h vector we then turn to the more general family of alcoved polytopes we give a characteriza tion for levelness of alcoved polytopes using the minkowski sum then we study several cases when the product of two polytopes is level in particular we provide an example where the product of two level polytopes is not level 1 introduction partially ordered sets or posets for short are ubiquitous ob jects in mathematics one particularly nice way to study them was introduced by richard stanley in sta 86 he associated two geomet ric objects to every finite poset namely the order polytope o and the chain polytope c these objects encode important infor mation about the underlying poset for instance the vertices of the order polytope are given by the indicator vectors of order filters hence showing that the number of order filters equals the number of vertices of o furthermore for a poset on d elements the ehrhart poly nomial ehro t to zd which counts the number of integer points in dilates of o equals the number of order preserving maps t 1 1 2 t 1 see sta 86 thm 4 1 it is often more convenient to consider the formal 1 ar x iv 1 80 5 02 96 7 v 1 m at h c o 8 m ay 2 01 8 2 christian haase florian kohl and akiyoshi tsuchiya power series ehro z 1 k 1 ehro k z k h z 1 z d 1 which is called the ehrhart series of o finding and understand ing the coefficients of h polynomial is at the heart of ehrhart theory therefore inequalities for the coefficients are of special interest see sta 09 sta 16 hib 90 sta 91 hofscheier kattha n and nill proved a structural result about h polynomials see hkn 16 thm 3 1 where they showed that if the integer points of a lattice polytope span the integer lattice then h cannot have internal zeros there are even some universal inequalities for h vectors see bh 17 in this paper we are particularly interested in the levelness prop erty of order polytopes where we recall that a polytope is level if its canonical module is generated by elements of the same degree see defi nition 3 18 levelness was first introduced by stanley sta 77 p 54 and it generalizes the gorenstein property while the gorenstein property can be completely classified by the h vector being palindromic sta 78 the same is not true for the levelness property see also remark 7 5 however we have the following inequalities proposition 1 1 sta 96 3 3 prop letr i z 0 ri be a standard level k algebra with hilbert series hilb r t h 0 h 1 t h sts 1 t d where h s 6 0 then for all i j with h i j 0 we have h i h jh i j in section 3 we will see that this result implies non trivial inequali ties for the h polynomial of order polytopes that are not satisfied by all lattice polytopes while the gorenstein property has been studied extensively in the past decades the levelness property has only fairly recently been ex amined for certain classes of polytopes with the exception of hib 88 recent examples include ehhsm 15 hy 18 ko 17 in this paper we focus on the levelness property of order polytopes i e the levelness property of the ehrhart ring of the order polytope hibi hib 87 was the first to examine minimal elements of the canonical module of this ehrhart ring which in this context is also known as the hibi ring in particular he characterized gorenstein posets the biggest influ ence on this paper comes from miy 17 where miyazaki examines and characterizes levelness of order polytopes we provide an alternative levelness of order polytopes 3 characterization using weighted digraphs coming from subposets see definition 5 1 for details corollary see corollary 5 4 let be a finite poset is level if and only if for all that do not have a negative cycle the digraph longest chains in does not have a negative cycle this corollary enables us to use the bellman ford algorithm to check levelness as a direct consequence we get that determining levelness is in co np corollary see corollary 5 6 levelness of order polytopes is in co np we show that the necessary condition for levelness of order polytopes in ehhsm 15 thm 4 1 is indeed equivalent to a special case of our characterization furthermore we give an example that was related to us by alex fink showing that this condition is not sufficient see remark 6 3 and figure 5 a theorem see theorem 6 2 let be a finite poset and r codeg o the following are equivalent 1 the inequality height j depth i rank 1 is satisfied for all j m i 2 for all hasse edges j m i there is an integer point x r int o such that xj xi 1 in section 7 we use corollary 5 4 to describe an infinite family of level order polytopes the main ingredient is the ordinal sum of two posets denoted theorem see theorem 7 1 the ordinal sum 1 2 of two posets 1 2 is level if and only if both 1 and 2 are level moreover the ordinal sum operation interacts nicely with the h polynomial proposition see proposition 7 4 let 1 2 be finite posets where 1 2 moreover let h h 1 h 2 be the h polynomial of the ehrhart series of the corresponding order polytopes then h h 1 h 2 as we illustrate in remark 7 5 theorem 7 1 and proposition 7 4 together can be used to create infinitely many examples of pairs of posets that have the same ehrhart polynomial but where one poset is level and the other one is not 4 christian haase florian kohl and akiyoshi tsuchiya we then turn to the more general class of alcoved polytopes we give a minkowski sum characterization of levelness for alcoved polytopes proposition see proposition 8 8 let p rd be an alcoved polytope and let r codeg p then p is level if and only if for any integer k r it follows that kp 1 rp 1 k r p where lp 1 conv lp zd for l r k then we examine when the cartesian product of two alcoved poly topes is level we arrive at the following result theorem see theorem 8 11 let p rd and q re be alcoved polytopes suppose that q is level and r codeg q dimp 1 then p q rd e is level this results shows that under the right assumptions the prod uct of a level polytope with a non level polytope can indeed be guar anteed to be level theorem see theorem 8 12 let be a poset on d elements and 1 m the connected components of if each i is level then is level this theorem tells us that in order to guarantee levelness of a poset it is sufficient to show that all components are level more generally for cartesian products of level polytopes we have theorem see theorem 8 13 let p rd and q re be level poly topes if either 1 codeg q codeg p and q has the integer decomposition prop erty 2 codeg p codeg q and p has the integer decomposition prop erty 3 or if codeg q codeg p then p q is level the assumptions are indeed necessary in remark 8 14 we give an explicit example of two level polytopes whose product is not level the structure of this paper is as follows in section 3 we recall the basics of ehrhart theory relevant to this paper we introduce posets order polytopes and chain polytopes and we show how these relate to combinatorial commutative algebra in section 4 we recall miyazaki s results on level posets we then give an alternative characterization of level posets using weighted digraphs this is done in section 5 in section 6 we show that this characterization generalizes a necessary condition of ene herzog hibi and saeedi in section 7 we use this levelness of order polytopes 5 characterization to examine levelness of series parallel posets in the last section we examine levelness of alcoved polytopes and examine when certain products of polytopes are again level 2 acknowledgements the authors would like to thank francisco santos for valuable feed back and constructive criticism while reading a draft of this article the second author was supported by a scholarship of the berlin math ematical school he would also like to explicitly thank takayuki hibi and the third author for organizing the workshop on convex polytopes for graduate students at osaka university in january 2017 which is where this work began 3 background and notation 3 1 ehrhart theory and lattice polytopes polytopes correspond to solutions of finitely many linear inequalities where the set of solu tions is bounded integral solutions to these inequalities correspond to integer points in polytopes counting the number of these solutions leads directly to ehrhart theory which is the study of the number of integer points in a given polytope in this subsection we give a brief and incomplete introduction to this beautiful area we refer the interested reader to the excellent books br 15 zie 95 a polytope p rd is the convex hull of finitely many points u 1 u 2 ur rd i e p conv u 1 u 2 ur r i 1 iui r i 1 i 1 i 0 for all i the inclusion minimal set v 1 v 2 vs such that p conv v 1 vs is called the vertex set of p and its elements are called the vertices a polytope whose vertex set is contained in zd is called a lattice poly tope we define the dimension of a polytope to be the dimension n of its affine span we then call p an n polytope we remark that some authors reserve the term lattice polytope for polytopes whose vertices are contained in a general lattice however we will only consider the case where ze for appropriate e definition 3 1 let p rd be a d polytope we define the ehrhart function ehrp z 0 z 0 ehrp k kp zd 6 christian haase florian kohl and akiyoshi tsuchiya when p is a lattice polytope we call ehrp the ehrhart polynomial of p the ehrhart series of a lattice polytope p is the formal power series ehrp z 1 k 1 ehrp k z k ehrhart ehr 62 famously proved that the ehrhart function is a quasipolynomial if the vertices of p are rational and it is even a poly nomial if the vertices are lattice points as a direct consequence the ehrhart series can be written as a rational function ehrp z h 0 h dz d 1 z d 1 and the numerator of this rational function is called the h polynomial of p we can actually say more about the coefficients of the numerator polynomial see sta 80 theorem 3 2 stanley s nonnegativity theorem let p be a lattice d polytope then ehrp z h 0 h dz d 1 z d 1 where h 0 h 1 h d z 0 the non negativity of the coefficients of the h polynomial is deeply related to what is called the cohen macaulay property we now define the degree and codegree of a lattice polytope definition 3 3 let p be a lattice d polytope with h polynomial h 0 h dz d the degree of p is defined as deg p max k h k 6 0 the codegree of p is defined as codeg p d 1 deg p remark 3 4 the codegree of a lattice d polytope p is the smallest positive integer c such that cp contains an interior integer point this is a consequence of a reciprocity theorem relating the hilbert series of k p to the hilbert series of the canonical module k p see for instance bg 09 thm 6 41 3 2 two poset polytopes a partially ordered set or poset is a set together with a binary relation that is reflexive an tisymmetric and transitive the relation is called a partial order and when there is no confusion about the poset we simply write an element j is said to cover an element i denoted j m i levelness of order polytopes 7 if i k j implies that either i k or j k one can recover all partial orders from these cover relations therefore it s convenient to illustrate the poset using these cover relations by a hasse diagram see figure 1 ki j figure 1 the hasse diagram of the poset il j m k given a poset we define the poset where i j j and i i j similarly we define where i j i and j i j to every finite poset stanley associated two geometric objects namely the order polytope and the chain polytope definition 3 5 sta 86 def 1 1 the order polytope o of a finite poset is the subset of r f r defined by 0 f i 1 for all i f i f j if i j definition 3 6 sta 86 def 2 1 the chain polytope c of a finite poset is the subset of r g r defined by the conditions 0 g i for all i g i 1 g i 2 g ik 1 for all chains i 1 i 2 ik of remark 3 7 in the following we will use an isomorphism r r to make notation better we define an order filter f of a poset to be a subset f such that if i f and i j then j f to every filter f one can associate a characteristic function 1 f defined as 1 f i 1 if i f 0 otherwise 8 christian haase florian kohl and akiyoshi tsuchiya figure 2 the order and chain polytope of the poset described in figure 1 stanley showed that vertices of o are given by the characteristic functions of order filters corollary 3 8 sta 86 cor 1 3 the vertices of o are the char acteristic functions 1 f of order filters f in particular the number of vertices equals the number of order filters stanley also gave the vertex description of chain polytopes we define an antichain a of a poset to be a subset a of pairwise incomparable elements the characteristic function 1 a of an antichain a is defined similarly to the characteristic function of an order filter theorem 3 9 sta 86 thm 2 2 the vertices of c are given by the characteristic functions 1 a of antichains a in particular the number of vertices of c equals the number of antichains of let be a d element poset and let m z 1 we define m to be the number of order preserving maps 1 2 m where we say that a map f is order preserving if i j implies f i f j these order preserving maps correspond to integer points in dilates of the order polytope as the next theorem shows theorem 3 10 sta 86 thm 4 1 the ehrhart polynomials of o and c are given by ehro k ehrc k k 1 remark 3 11 as is implicit in stanley s proof interior integer points are in bijection with strictly order preserving maps i e maps f that satisfy i j implies f i f j in a poset maximal chains can have different lengths a chain with maximum length is called a longest chain remark 3 12 the codegree of o equals the rank of i e it equals the number of edges in the longest chain of levelness of order polytopes 9 figure 3 edges belonging to longest chain are colored red 3 3 level affine semigroups this subsection is based on bg 09 ch 6 let p rd be a lattice d polytope with vertex set v p and let k be an algebraically closed field of characteristic zero we define the cone over p as cone p spanr 0 v 1 v v p r d r the set s p x x i i i vi 1 for vi p zd and i z 0 i i forms an additive semigroup i e a set that is closed under addition which contains a neutral element and where addition is associative we remark that some authors don t require semigroups to contain the neutral element moreover we define the semigroup cz p cone p zd 1 we say that p has the integer decomposition property idp if s p cz p this semigroup gives rise to the ehrhart ring of p k p k cz p k xp ym p m cz p k x 11 x 1 n y the semigroup cz p is normal i e its semigroup ring k p is normal remark 3 13 since every order polytope has a unimodular triangu lation order polytopes have the integer decomposition property hence we have k p k cz p k s p the ring k p is also a finitely generated k algebra of krull dimension d 1 which inherits a natural z 0 grading given by the y degree therefore we can write it as k p i z 0 k p i where k p i is the k vector space generated by the degree i monomials we consider the hilbert function h z 0 z 0 given by h t dimk k p t as with the 10 christian haase florian kohl and akiyoshi tsuchiya ehrhart function it makes sense to examine the formal power series hk p z t 0 h t zt which we call the hilbert series of k p this hilbert series is in fact a rational function theorem 3 14 bg 09 thm 6 39 6 40 let p be a lattice d polytope then the hilbert series of k p is of the form hk p z n z 1 z d 1 where n is a polynomial with non negative integral coefficients the reader might have noticed that ehrp t hp t and that ehrp z hk p z a fact that is used in ms 05 sec 12 1 to prove the polyno miality of ehrp by a seminal result of melvin hochster hoc 72 k p is cohen macaulay theorem 3 15 bg 09 thm 6 10 let s be a normal affine semi group then k s is cohen macaulay for every field k several important properties of k p can be stated in terms of what is called the canonical module k p sometimes the canonical module is also called the dualizing module let r i z 0 ri be a finitely generated z 0 graded k algebra of krull dimension d suppose that r is local and cohen macaulay definition 3 16 the canonical module of r r is the unique mod ule up to isomorphism such that extdr k r k and ext i r k r 0 when i 6 d we say that r is gorenstein if r r as an r module or equivalently is r is generated by a single element a lattice polytope p is gorenstein if k p is gorenstein however we will only work with semigroup rings k p arising from lattice polytopes p in this case the canonical module has a particu larly nice description which is why we omit a proper definition of the ext functor theorem 3 17 danilov stanley bg 09 thm 6 31 let the nota tion be as above and let k be a field then the ideal generated by the monomials corresponding to interior integer points int cz p is the canonical module of k p we can now state our main definition levelness of order polytopes 11 definition 3 18 we say that a lattice polytope p is level if the k p module k p is as a k p module generated by elements of degree codeg p we say that a finite poset is level if o is level remark 3 19 we would like to remark that this is equivalent to saying that a lattice d polytope p is level if and only if for all x int cone p zd 1 there exists a point y int cone p zd 1 at height codeg p such that x y cone p definition 3 20 we say that x int cone p zd 1 is minimal if the corresponding monomial is a minimal generator of k p example 3 21 let p 0 2 0 1 then the cone over the polytope is cone p x 1 0 0 1 2 0 1 1 3 2 0 1 4 2 1 1 i 0 x 1 x 2 x 3 p figure 4 the box p and its dilate 2 p the cone over p gray and the conical hull of the canonical module blue the semigroup is generated over z by the points 0 0 1 2 0 1 0 1 1 and 2 1 1 there are exactly t 1 2 t 1 many monomials of degree t and thus h t dim k p t t 1 2 t 1 figure 4 shows 12 christian haase florian kohl and akiyoshi tsuchiya the monomials of degree less than three hence the ehrhart series ehrp z equals ehrp z 1 k 1 k 1 2 k 1 zk 1 3 z 1 z 3 thus p is a polytope of degree 1 with codegree 2 the canonical module is generated by the three interior integer points of lowest degree marked red namely 1 1 2 2 1 2 and 3 1 2 this shows that p is level 4 miyazaki s characterization in this section we recall the characterization for levelness of order polytopes which was introduced by miyazaki see miy 17 in order to give a characterization of the level property miyazaki defined sequences with condition n definition 4 1 miy 17 def 3 1 let i 1 j 1 i 2 j 2 it jt be a pos sible empty sequence of elements in a finite poset we say the se quence satisfies condition n if 1 i 1 j 1 i 2 j 2 it jt and 2 for any m n with 1 m n t im jn definition 4 2 let i 1 j 1 i 2 j 2 it jt be a sequence of elements in a finite poset with condition n and set j 0 and it 1 we set r i 1 j 1 it jt t s 1 rank is js 1 rank is js rank it 1 jt moreover set rmax max r i 1 j 1 it jt i 1 j 1 it jt is a sequence with condition n associated to every sequence with condition n miyazaki defines a special element of cone o definition 4 3 miy 17 def 3 6 let i 1 j 1 i 2 j 2 it jt be a se quence of elements in a finite poset with condition n and set j 0 and it 1 we define x i 1 j 1 it jt im t s m rank is 1 js rank is js for 1 m t 1 and y i 1 j 1 it jt k max rank is k x i 1 j 1 it jt is k is for k levelness of order polytopes 13 these elements give rise to an important class of minimal elements as the next lemma shows lemma 4 4 miy 17 lem 3 8 let i 1 j 1 i 2 j 2 it jt be a se quence of elements in a finite poset with condition n and set j 0 and it 1 if r i 1 j 1 it jt rmax then the element y i 1 j 1 it jt is minimal in the sense of definition 3 20 in par ticular it is an interior lattice point in the cone furthermore y i 1 j 1 it jt im x i 1 j 1 it jt im y i 1 j 1 it jt jm 1 rank im jm 1 x i 1 j 1 it jt im for 1 m t 1 in particular y i 1 j 1 it jt j 0 rmax figure 5 illustrates definition 4 1 and lemma 4 4 4 3 2 1 7 6 5 11 10 9 8 i 1 j 1 i 2 j 2 a fink s poset 4 3 2 1 7 6 5 11 10 9 8 x 1 1 x 2 2 x 3 3 x 4 4 x 5 2 x 6 3 x 7 4 x 8 1 x 9 3 x 10 4 x 11 5 b y 9 7 5 3 illustrated figure 5 fink s poset and the minimal element y il lustrated now we can introduce the characterization of miyazaki lemma 4 5 miy 17 thm 3 9 let be a poset and r codeg o then is level is and only if rmax r in this paper we characterize levelness of order polytopes in terms of weighted digraphs given a poset we define the hasse graph h of to be the digraph with nodes coming from and with directed weighted edges i j 1 and j i 1 where i l j in our language a sequence i 1 j 1 it jt with condition n can be reinterpreted as a path p in h from to with the up edges or the down edges coming from longest chains in im jm or im 1 jm where j 0 and it 1 and we say that such a path satisfies condition n more over we set r p r i 1 j 1 it jt and y p y i 1 j 1 it jt we chose the weights of the edges so that r p equals the weighted length 14 christian haase florian kohl and akiyoshi tsuchiya remark 4 6 this special minimal element y p has the property that for every up or down interval i j in the path we have y p i y p j rank i j this is a direct consequence of lemma 4 4 and a brief com putation now we can characterize the level property as the following proposition 4 7 let be a finite poset and r codeg o then is not level if and only if there exists a path p in h with condition n such that r p r proof this directly follows from lemmas 4 5 and 4 4 remark 4 8 even if is level with r codeg o there may exist a path in h of length r the interested reader might construct their favorite counter example 5 a new characterization of levelness in this section we introduce an algorithm for checking levelness of order polytopes first we need to associate a weighted digraph to a poset together with a subposet where we require that il j implies il j definition 5 1 let be a finite poset and let be a subposet of such that il j implies il j let e be the weighted digraph with weighted directed edges 1 i j 1 e if and only if j m i 2 j i 1 e if and only if j m i clearly h if is clear from the context we will write a negative cycle is a directed cycle whose sum of weights is neg ative a wedge of cycles is a closed directed path where repeti tion is allowed whose sum of weights is negative an integer point x int cone o zd 1 is sharp along a covering pair j m i if xj xi 1 next we associate a weighted digraph to every integer point in int cone o the following lemma shows that the associated di graph does not have any negative cycles lemma 5 2 let b int cone o zd 1 be given then the weighted digraph b whose nodes are given by the elements of and whose weighted directed edges are i j 1 il j j i 1 il j bj bi 1 levelness of order polytopes 15 i 1 im i 1 im bi 1 and i 1 m i i 1 m i bi maxj bj does not have any negative cycles in particular every subgraph con tains no negative cycles proof for i j let u i j denote a directed path from i to j where i j and let d l k denote a directed path from l to k where l k let u i 1 i 2 d i 2 i 3 u i 3 i 4 d is i 1 be a directed cycle in b with i 1 i 2 i 3 i 2 i 1 is we first remark that the weights of the down paths d i i 1 are given by 1 bi b 1 1 b 1 b 2 b r 1 b r bi 1 bi bi 1 where we set b maxk bk 1 and b 0 therefore the sum of the weights in the cycle is equal to bi 2 bi 3 bis bi 1 length i 1 i 2 length is 1 is bi 2 bi 1 bis bis 1 length i 1 i 2 length is 1 is 0 since b int cone o implies that bj bi length i j for all i j where length i j is the length of the path from i to j the following theorem uses the bellman ford algorithm which was introduced by bellman and ford see for instance bel 58 we are using this algorithm as a black box instead of explicitly describing it we will merely state some basic facts about it the bellman ford algorithm finds the shortest path from a sink to any other node in a weighted digraph in contrast to other algorithms it can also deal with negative weights assuming that the digraph does not contain any negative cycles that can be reached from the starting node see sch 03 thm 8 5 if there is such a negative cycle the bellman ford algorithm can detect the negative cycle sch 03 thm 8 6 the bellman ford algorithm runs in o v e where v is the vertex set and e is the edge set of the underlying graph see sch 03 thm 8 5 given a path p in h with condition n let p be the subposet of whose covering pairs are given by the up paths of p now we give a new characterization of level order polytopes theorem 5 3 let be a finite poset on d elements and let r codeg o then is level if and only if for any path p in h with condition n such that p has no negative cycles p longest chains in has no negative cycles 16 christian haase florian kohl and akiyoshi tsuchiya proof to show the first direction let s assume o is level asso ciated to p there is a b int cone o zd 1 to see this run the bellman ford algorithm on p the bellman ford algorithm minimizes the distance from to any point i after mul tiplying all entries by 1 the algorithm will return a point b such that for all covering pairs j m i in we have bj bi 1 and moreover for any weighted edge j i 1 in p we have bi bj 1 the first condition implies that b int cone o zd 1 moreover it follows from these conditions that for any weighted edge j i 1 in p we have bj bi 1 since is level there exists a point b int cone o zd 1 on height r such that b b cone o zd 1 this implies that for every covering pair j m i in we have bj bi b j b i hence for any weighted edge j i 1 in p we have b j b i 1 since b is on height r we also know that b is sharp along the longest chains in since g longest chains in is a subgraph of b using lemma 5 2 we get that g does not contain a negative cycle we prove the other direction by contraposition let s assume that is not level then there exists a path p with condition n such that r p rmax r moreover p is a subgraph of y p hence by using lemma 5 2 it follows that p has no negative cycle on the other hand since rank r it follows that p longest chains in has a negative cycle this directly implies the following corollary 5 4 let be a finite poset is level if and only if for all that do not have a negative cycle the digraph longest chains in does not have a negative cycle proof one direction directly follows from theorem 5 3 so we only need to show that if is level and if does not contain a negative cycle then longest chains in does not have a negative cycle however this follows from the proof of theorem 5 3 remark 5 5 for practical purposes this corollary is more convenient than the previous characterization this is due to the fact that it is hard to determine all paths with condition n we will use this corollary to give an infinite family of level posets see theorem 7 1 moreover we get that given the input determining the lev elness of order polytopes is in co np i e the complexity class having levelness of order polytopes 17 a short certificate for rejection for more about complexity classes we refer to sch 86 sec 2 5 corollary 5 6 levelness of order polytopes is in co np proof if o is not level then there exists a short certificate p such that p does not have a negative cycle but p longest chains in has a negative cycle this will be tested by the bellman ford algorithm in polynomial time since we need to run the bellman ford algorithm twice once for p and once for p longest chains in therefore we can verify non levelness in polynomial time we now explicitly describe the algorithm underlying corollarly 5 4 algorithm 5 7 for h run bellman ford for if negative cycle 1 1 else run bellman ford for longest chains in if negative cycle return not level else 1 1 return level theorem 5 8 a poset is level if and only if algorithm 5 7 returns level proof this directly follows from corollary 5 4 6 a necessary condition of ene herzog hibi and saeedi madani we now want to show that ehhsm 15 thm 4 1 is a special case of corollary 5 4 we first need to define the depth and the height of an element where we follow again ehhsm 15 the height of an element i denoted height i is the maximum length of a chain in descending from i similarly we define the depth of an element i denoted depth i to be the maximum length of a chain in ascending from i they show that the following is a necessary condition for levelness 18 christian haase florian kohl and akiyoshi tsuchiya theorem 6 1 ehhsm 15 thm 4 1 suppose is level then 6 1 height j depth i rank 1 for all j m i our next result shows that this is weaker than corollary 5 4 in fact it is equivalent to corollary 5 4 where is a single edge theorem 6 2 let be a finite poset and r codeg o the following are equivalent 1 inequality 6 1 is satisfied by all covering pairs 2 for all hasse edges j m i there is an integer point x r int o such that xj xi 1 proof let s assume that all covering pairs satisfy 6 1 and fix a cov ering pair j m i we remark that rank equals the codegree r of the order polytope o thus we need to show that there exists an inte ger point x r int o such that xj xi 1 to create such an x we can label the elements in using labels from 1 2 r 1 we first label xj height j and hence xi height j 1 for k i j we label xk and then we recursively relabel by 6 2 xk max height k xi length i k if k i height k otherwise to show that this indeed gives an interior integer point in r into we need to show that r xk height k for all k we say a label xk is well defined if it satisfies this condition there are two cases 1 k i then 6 1 ensures that 6 2 only yields well defined labels 2 k i then the recursive definition gives us height k which by definition is well defined this proves the first direction now let assume that for all hasse edges j m i in there exists an integer point x r int o such that xj xi 1 let s fix a covering pair j m i then we have an integer point x r int o with xj xi 1 and it follows that height j xj since we have an integer point in the interior of ro we also get that depth i rank xi putting everything together we obtain height j depth i rank 1 as desired levelness of order polytopes 19 however this result is not sufficient the following example was related to us by alex fink see figure 5 a remark 6 3 let be the poset from figure 5 a we have that codeg o 5 moreover for any covering pair i l j in there is a minimal el ement x on height 5 with xi 1 xj thus by theorem 6 2 the condition of ehhsm 15 thm 4 1 is satisfied however is not level the minimal element y 9 7 5 3 is on height 6 see figure 5 b 7 series parallel posets the goal of this section is to describe a new family of level posets the main character of this section is the ordinal sum we follow the notation of sta 12 sec 3 2 let 1 and 2 be two posets then their ordinal sum 1 2 is the poset with elements from the union 1 2 and with relations s t if s t 2 with s 2 t or s t 1 with s 1 t or s 1 and t 2 posets that can be built up up as ordinal sums of posets are called series parallel posets 1 2 1 2 figure 6 ordinal sum of a chain of length 3 and an antichain of length 2 we want to show the following result theorem 7 1 the ordinal sum 1 2 of two posets 1 2 is level if and only if both 1 and 2 are level proof we prove the first direction by contraposition so let s assume that 1 is not level by corollary 5 4 there exists a weighted digraph 1 with nodes coming from 1 which does not contain a negative cycle but the weighted directed graph 1 longest chains in 1 has a negative cycle however we also get that has a weighted digraph with up edges of weight 1 only coming from up edges of 1 does not 20 christian haase florian kohl and akiyoshi tsuchiya contain a negative cycle but longest chains in contains one proving that 1 2 is not level the case where 2 is not level follows analogously we prove the other direction again by contraposition so let s assume that 1 2 is not level by corollary 5 4 there exists a weighted digraph with nodes coming from such that does not have a negative cycle and longest chains in has a negative cycle where longest chains in is the weighted digraph obtained from by adding down edges of weight 1 along longest chains in in order to show that either 1 or 2 are not level we will construct graphs 1 and 2 without negative cycles such that adding down edges of weight 1 along longest chains creates a negative cycle the following two quotient maps will be essential for this 1 2 q 1 1 2 p 2 p 2 1 1 2 q 2 1 2 p 1 p 1 2 where p 1 p 1 1 and p 2 p 2 2 1 2 1 2 figure 7 original poset on the right and the two quotient posets on the left and in the middle note that these quotient maps also induce weighted directed graphs 1 and 2 on the underlying posets 1 and 2 respectively we will show the following 1 both 1 and 2 do not have a negative cycle 2 either 1 longest chains in 1 or 2 longest chains in 2 or both have a negative cycle this implies that either 1 or 2 or both cannot be level proving the claim the first claim follows by contraposition if either 1 or 2 levelness of order polytopes 21 had a negative cycle then one can lift this cycle to obtain a negative cycle in this is due to the fact that every maximal element in 1 is comparable to every minimal element in 2 together with the fact that every up edge has the same weight namely 1 now let s prove the second claim we remark that longest chains in 1 2 are concatenations of longest chains in 1 and longest chains in 2 and vice versa this means that im 1 longest chains in 1 2 im 1 longest chains in 1 and im 2 longest chains in 1 2 im 2 longest chains in 2 where im 1 or im 2 denotes the image of the quotient map onto 1 or 2 moreover if a negative cycle of longest chains in 1 2 is entirely contained in q 11 1 min elt s of 2 or q 1 2 2 max elt s of 1 then clearly the image also has a negative cycle caveat after form ing the quotient map the cycle might become a wedge of cycles but since the total weight of the original cycle is the sum of the weights of the cycle in the image at least one of these cycles in the wedge has to be negative so we only need to consider the case where a negative cycle contains edges contained in 1 and in 2 we can cover the cycle into the part whose edges are entirely in q 11 1 min elt s of 2 and a part whose edges are in q 12 2 max elt s of 1 note that the edges between 1 and 2 appear in both parts therefore the total weight w of the cycle equals 0 w w 1 w 2 w 1 2 where w 1 and w 2 are the weights of the parts in the preimage of 1 and 2 respectively the weight of the connecting edges between 1 and 2 is denoted w 1 2 this weight is 0 since there are as many up as there are down edges and the weights are 1 and 1 respectively therefore either w 1 or w 2 or both are negative if w 1 is negative applying the quotient map gives us a wedge of cycles in 1 with negative weight hence it contains at least one negative cycle the case where w 2 is negative is similar therefore we have seen that either 1 or 2 is not level proving the claim 22 christian haase florian kohl and akiyoshi tsuchiya for the remainder of this section let 1 2 we will first give a geometric description of the order polytope and the chain polytope of in terms of the order and chain polytopes of 1 and 2 respectively lemma 7 2 let c c 1 c 2 be the chain polytopes of 1 and 2 respectively then 7 1 c conv c 1 0 2 0 1 c 2 c 1 c 2 where is the free sum of c 1 and c 2 proof by theorem 3 9 the vertices of the chain polytope are given by the indicator vectors of antichains now one notices that no antichain can contain elements from both 1 and 2 lemma 7 3 let o o 1 o 2 be the order polytopes of 1 2 respectively then 7 2 o conv 1 2 o 1 o 2 0 1 proof by corollary 3 8 the vertices of the order polytope are given by the indicator vectors of filters now one notices that as soon as a filter contains an element of 1 it contains all elements of 2 moreover we have proposition 7 4 let 1 2 be finite posets where 1 2 moreover let h h 1 h 2 be the h polynomial of the ehrhart series of the corresponding order polytopes then h h 1 h 2 proof by theorem 3 10 the ehrhart series of the chain polytope of a poset is the same as the ehrhart series of the order polytope of in hh 16 lem 3 2 hibi and higashitani show that if the free sum p q of two lattice polytopes p q both containing the origin has the integer decomposition property then h p q h ph q now using lemma 7 2 together with hh 16 lem 3 2 implies the result note that every chain polytope and every order polytope has a unimodular triangulation and thus has the integer decomposition property for the order polytope we directly get a regular unimodular flag triangulation by taking the standard triangulation of the cube and restricting it to the order polytope for the chain polytope stanley sta 86 constructs such a regular unimodular flag triangulation remark 7 5 in hib 88 takayuki hibi gives an example of two order polytopes o 1 o 2 where both have the same h polynomial but 1 is level and 2 is not level this shows that the level property cannot levelness of order polytopes 23 be characterized by the h polynomial we remark that theorem 7 1 together with proposition 7 4 gives a way to create infinitely many such examples 1 3 and 2 3 where 3 is any level poset 8 connected components of level posets in this section we discuss connected components of level posets any connected component of a gorenstein poset is gorenstein this fact naturally leads us consider whether any connected component of a level poset is level however this is not true in general from the following result we know that there exists a level poset such that a connected component of the poset is not level theorem 8 1 ehhsm 15 theorem 4 7 let be a poset on d elements and let cs be a totally ordered set with s elements then the poset on the set cs where elements from and cs are incomparable is level for all s 0 we give an explicit bound for s appearing in theorem 8 1 theorem 8 2 let be a poset on d elements and let cs be a totally ordered set with s elements then the poset on the set cs where elements from and cs are incomparable is level for all s d in order to prove this theorem we consider a more general class of lattice polytopes containing any order polytope definition 8 3 we say that a polytope p rd is alcoved if p is an intersection of some half spaces bounded by the hyperplanes hmi j z 1 zd r d zi zj m for 0 i j d m z where z 0 0 it is known that any order polytope is alcoved after a unimodular change of coordinates every chain polytope is alcoved too further more any alcoved polytope possesses the integer decomposition prop erty for a lattice polytope p x rd ax b rd we set p 1 x rd ax b 1 remark 8 4 if p x rd ax b rd is an alcoved polytope for some m d integer matrix a and some integer vector b zm then since a is a totally unimodular matrix p 1 is a lattice polytope in particular one has p 1 conv int p zd lemma 8 5 let p rd be an alcoved polytope then for any positive integer k kp and p 1 are alcoved 24 christian haase florian kohl and akiyoshi tsuchiya proof since p is alcoved p is a polytope given by inequalities of the form bij zi zj cij for some collection of integer parameters bij and cij hence for any positive integer k kp is a polytope given by inequalities of the form kbij zi zj kcij moreover p 1 is a polytope given by inequalities of the form bij 1 zi zj cij 1 therefore both kp and p 1 are alcoved for two lattice polytopes p and q in rd set cayley p q conv p 0 q 1 rd 1 we say that cayley p q is the cayley polytope of p and q lemma 8 6 let p and q be alcoved polytopes in rd then cayley p q has a regular unimodular triangulation in particular cayley p q has the integer decomposition property proof this is hpps 14 lemma 4 15 since alcoved polytopes have a type a root system this directly implies the following result corollary 8 7 if p q rd are alcoved polytopes then the map p zd q zd p q zd is onto proof we have that 2 cayley p q x 1 xd 1 rd 1 xd 1 1 p q 1 since cayley p q has the integer decomposition property it follows that every integer point in 2 cayley p q can be written as a sum of two integer points in cayley p q however the only way we can get an integer point at height 1 is if we add one integer point at height 0 and at height 1 i e one integer point belongs to p and one belongs to q proving the claim now we give a characterization on levelness of alcoved polytopes proposition 8 8 let p rd be an alcoved polytope and let r codeg p then p is level if and only if for any integer k r it follows that kp 1 rp 1 k r p proof first assume that p is level then from the definition of level ness for any integer k r int kp zd int rp zd k r p zd hence one has kp 1 conv int rp zd k r p zd conv int rp zd conv k r p zd rp 1 k r p levelness of order polytopes 25 conversely assume that for any integer k r kp 1 rp 1 k r p by lemma 8 5 kp 1 rp 1 and k r p are alcoved polytopes hence by corollary 8 7 p is level lemma 8 9 let p rd be a lattice polytope and let r codeg p be an integer assume that there exists an integer k r such that kp 1 r p 1 k r p then for any integer k k r we have k p 1 r p 1 k r p proof assume that there exists an integer k k r such that k p 1 r p 1 k r p in general it follows that k p 1 r p 1 k r p then we have kp 1 k p 1 k k p r p 1 k r p kp 1 hence this is a contradiction on levelness of dilated polytopes the following theorem is known theorem 8 10 bgt 02 theorem 1 3 3 let p be a lattice d polytope then for any integer k d 1 kp is level now we prove the following theorem about levelness of a product of alcoved polytopes theorem 8 11 let p rd and q re be alcoved polytopes suppose that q is level and r codeg q dimp 1 then p q rd e is level proof by theorem 8 10 rp is level hence for any positive integer k one has k rp 1 rp 1 k 1 rp from proposition 8 8 therefore by lemma 8 9 it follows that for any k r we obtain kp 1 rp 1 k r p since q is level for any k r we obtain kq 1 rq 1 k r q fix a positive integer k r since int k p q zd e int kp zd int kq ze k p q 1 kp 1 kq 1 rp 1 k r p rq 1 k r q rp 1 rq 1 k r p q r p q 1 k r p q k p q 1 hence p q is level now we prove theorem 8 2 26 christian haase florian kohl and akiyoshi tsuchiya proof of theorem 8 2 the order polytope of cr is the cartesian product of o and o cr which is the r dimensional unimodular simplex this simplex has codegree r 1 hence by theorem 8 11 the claim now follows conversely we consider posets all of whose connected components are level in fact these posets are always level theorem 8 12 let be a poset on d elements and 1 m the connected components of if each i is level then is level theorem 8 12 follows from the following result theorem 8 13 let p rd and q re be level polytopes if either 1 codeg q codeg p and q has the integer decomposition prop erty 2 codeg p codeg q and p has the integer decomposition prop erty 3 or if codeg q codeg p then p q is level proof let rp codeg p and let rq codeg q without loss of generality we assume codeg q codeg p then r codeg p q max rp rq rp since x xp xq int p q zd e implies that xp int p zd and that xq int q ze let xp xq h cone p q zd e 1 with h r then this point projects to points xp h cone p zd 1 and xq h cone q ze 1 since p is level we have that xp h x p r x p h r where x p r int cone p z d 1 and x p h r cone p zd 1 similarly since q is level we have that xq h x q rq x q h rq where x q rq int cone q z e 1 and x q h rq cone q ze 1 if codeg p codeg q we now get a decomposition xp xq h x p x q r x p x q h r where x p x q r int p q z d e and where x p x q h r p q zd e proving levelness of p q so let s assume codeg q codeg p since q has the integer decomposition property we can express x q h rq as a sum of height levelness of order polytopes 27 1 elements i e x q h rq x 1 q rp rq x 2 q h rp and thus obtain xq h x q rq x q h rq x q x 1 q rp x 2 q h rp where x q x 1 q rp int cone q z e 1 and x 2 q h rp cone q ze 1 therefore we can express xp xq h as xp xq h x p x q x 1 q r x p x 2 q h r where x p x q x 1 q r int p q z d e and where x p x 2 q h r int p q zd e remark 8 14 in theorem 8 13 we really need the assumption that the polytope of lower codegree has the integer decomposition property consider the following example where p conv 0 0 0 1 0 0 0 1 0 1 1 2 and where q conv 0 0 1 0 0 1 then p does not have the integer decomposition property but it is gorenstein and thus level moreover q has the integer decomposition property and it is level since it is gorenstein however the product p q is not level proof we first remark that codeg q 3 and codeg p 2 hence codeg p q 3 there are exactly 4 integer points in the interior of 3 p q namely int 3 p q z 5 1 1 1 1 1 1 2 1 1 1 2 1 1 1 1 2 2 3 1 1 however the integer point 2 2 2 2 1 int 4 p q z 5 cannot be written as a sum 2 2 2 2 1 x 1 x 2 of points x 1 int 3 p q z 5 and x 2 p q z 5 thus p q is not level we end this article with the following criterion for levelness lemma 8 15 if a lattice d polytope p has a covering by unimodular simplices such that every interior face of such a simplex contains an interior sub face of dimension codeg p 1 then p is level proof let b int cone p zd 1 and let r codeg p we will prove levelness by showing that every such b can be written as an integral combination of an interior integer point on height r with integer points on height 1 28 christian haase florian kohl and akiyoshi tsuchiya the unimodular simplices in the covering of p give rise to a covering of cone p by unimodular cones therefore b is in at least one such unimodular cone let conv v 1 v 2 vd 1 be the corresponding unimodular simplex and let cone be the cone over then there is a unique representation 8 1 b d 1 i 1 i vi 1 where i z 0 there are two cases if i 0 for some i i in an index set i then this means that b is contained an d 1 i dimensional face which has to be an interior face then for j 1 d 1 i the face conv vj j j gives rise to a j dimensional cone containing b hence by assumption there is a subset r j with r r such that the point x i r vi 1 is a point in int cone p zd 1 combining this with equation 8 1 we obtain b x b x where b x cone p zd 1 which proves levelness if i 6 0 for all i 1 2 d 1 then we can set x i j vi 1 where j is an interior r 1 dimensional face the claim now follows analogously it would be interesting to see a poset interpretation of this lemma references bel 58 richard bellman on a routing problem quart appl math 16 1958 87 90 mr 0102435 bg 09 winfried bruns and joseph gubeladze polytopes rings and k theory springer monographs in mathematics springer dordrecht 2009 mr 2508056 bgt 02 winfried bruns joseph gubeladze and ngo vie t trung problems and algorithms for affine semigroups semigroup forum 64 2002 no 2 180 212 mr 1876854 bh 17 gabriele balletti and akihiro higashitani universal inequalities in ehrhart theory arxiv 2017 br 15 matthias beck and sinai robins computing the continuous discretely second ed undergraduate texts in mathematics springer new york 2015 integer point enumeration in polyhedra with illustrations by david austin mr 3410115 ehhsm 15 viviana ene ju rgen herzog takayuki hibi and sara saeedi madani pseudo gorenstein and level hibi rings j algebra 431 2015 138 161 mr 3327545 ehr 62 euge ne ehrhart sur les polye dres rationnels homothe tiques a n di mensions c r acad sci paris 254 1962 616 618 mr 0130860 levelness of order polytopes 29 hh 16 takayuki hibi and akihiro higashitani integer decomposition property of free sums of convex polytopes ann comb 20 2016 no 3 601 607 mr 3537921 hib 87 takayuki hibi distributive lattices affine semigroup rings and alge bras with straightening laws commutative algebra and combinatorics kyoto 1985 adv stud pure math vol 11 north holland ams terdam 1987 pp 93 109 mr 951198 hib 88 level rings and algebras with straightening laws j algebra 117 1988 no 2 343 362 mr 957445 hib 90 some results on ehrhart polynomials of convex polytopes dis crete math 83 1990 no 1 119 121 mr 1065691 hkn 16 johannes hofscheier lukas kattha n and benjamin nill ehrhart the ory of spanning lattice polytopes arxiv 2016 hoc 72 m hochster rings of invariants of tori cohen macaulay rings gen erated by monomials and polytopes ann of math 2 96 1972 318 337 mr 0304376 hpps 14 christian haase andreas paffenholz lindsay c piechnik and fran cisco santos existence of unimodular triangulations positive re sults arxiv 1405 1687 2014 hy 18 akihiro higashitani and kohji yanagawa non level semi standard graded cohen macaulay domain with h vector h 0 h 1 h 2 j pure appl algebra 222 2018 no 1 191 201 mr 3681002 ko 17 florian kohl and mccabe olsen level algebras and s lecture hall poly topes arxiv 1710 10892 2017 miy 17 mitsuhiro miyazaki on the generators of the canonical module of a hibi ring a criterion of level property and the degrees of generators j algebra 480 2017 215 236 mr 3633306 ms 05 ezra miller and bernd sturmfels combinatorial commutative algebra graduate texts in mathematics vol 227 springer verlag new york 2005 mr 2110098 sch 86 a schrijver theory of linear and integer programming wiley interscience series in discrete mathematics john wiley sons ltd chichester 1986 a wiley interscience publication mr mr 874114 88 m 90090 sch 03 alexander schrijver combinatorial optimization polyhedra and ef ficiency vol a algorithms and combinatorics vol 24 springer verlag berlin 2003 paths flows matchings chapters 1 38 mr 1956924 sta 77 richard p stanley cohen macaulay complexes higher combinatorics proc nato advanced study inst berlin 1976 nato adv study inst ser ser c math and phys sci 31 reidel dordrecht 1977 pp 51 62 sta 78 hilbert functions of graded algebras advances in math 28 1978 no 1 57 83 mr 0485835 sta 80 decompositions of rational convex polytopes ann discrete math 6 1980 333 342 combinatorial mathematics optimal designs and their applications proc sympos combin math and optimal design colorado state univ fort collins colo 1978 mr 593545 30 christian haase florian kohl and akiyoshi tsuchiya sta 86 two poset polytopes discrete comput geom 1 1986 no 1 9 23 mr 824105 sta 91 on the hilbert function of a graded cohen macaulay domain j pure appl algebra 73 1991 no 3 307 314 mr 1124790 sta 96 combinatorics and commutative algebra second ed progress in mathematics vol 41 birkha user boston inc boston ma 1996 mr 1453579 sta 09 alan stapledon inequalities and ehrhart vectors trans amer math soc 361 2009 no 10 5615 5626 mr 2515826 sta 12 richard p stanley enumerative combinatorics volume 1 second ed cambridge studies in advanced mathematics vol 49 cambridge uni versity press cambridge 2012 mr 2868112 sta 16 alan stapledon additive number theory and inequalities in ehrhart theory int math res not imrn 2016 no 5 1497 1540 mr 3509934 zie 95 gu nter m ziegler lectures on polytopes graduate texts in mathe matics vol 152 springer verlag new york 1995 mr 1311028 fachbereich mathematik und informatik freie universita t berlin germany e mail address haase math fu berlin de fachbereich mathematik und informatik freie universita t berlin germany e mail address fkohl math fu berlin de department of pure and applied mathematics graduate school of information science and technology osaka university suita osaka 565 0871 japan e mail address a tsuchiya ist osaka u ac jp