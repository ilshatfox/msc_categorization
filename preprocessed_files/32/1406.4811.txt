identifiability of the unrooted species tree topology under the coalescent model with time reversible substitution processes site specific rate variation and invariable sites julia chifman department of cancer biology wake forest school of medicine winston salem nc 27157 laura kubatko department of statistics department of evolution ecology and organismal biology mathematical biosciences institute the ohio state university columbus oh 43210 abstract the inference of the evolutionary history of a collection of organisms is a problem of fundamental importance in evolutionary biology the abundance of dna sequence data arising from genome sequencing projects has led to significant challenges in the inference of these phylogenetic relation ships among these challenges is the inference of the evolutionary history of a collection of species based on sequence information from several distinct genes sampled throughout the genome it is widely accepted that each individual gene has its own phylogeny which may not agree with the species tree many possible causes of this gene tree incongruence are known the best studied is incomplete lineage sorting which is commonly modeled by the coalescent process numerous methods based on the coalescent process have been proposed for estimation of the phylogenetic species tree given dna sequence data however use of these methods assumes that the phyloge netic species tree can be identified from dna sequence data at the leaves of the tree although this has not been formally established we prove that the unrooted topology of the n leaf phylogenetic species tree is generically identifiable given observed data at the leaves of the tree that are assumed to have arisen from the coalescent process under a time reversible substitution process with the pos sibility of site specific rate variation modeled by the discrete gamma distribution and a proportion of invariable sites keywords phylogenetics identifiability algebraic statistics preprint submitted to journal of theoretical biology ar x iv 1 40 6 48 11 v 2 q bi o p e 3 j ul 2 01 5 1 introduction the field of evolutionary genetics has benefitted enormously from recent advances in sequencing technology that have led to the availability of dna sequence information for hundreds or thou sands of species these data are commonly used to study evolutionary patterns and processes a fundamental problem in this area is the inference of a phylogenetic species tree that describes the evolutionary relationships among a collection of species for which data have been collected a species phylogeny is a tree with all internal nodes of degree three except for a root node of degree two all edges are treated as directed from the root toward the leaves the tree represents the biological process of speciation in which one population splits into two populations which then evolve independently with no subsequent exchange of genetic material the root node represents the most ancestral population to all sampled species while the leaves also called taxa singu lar taxon represent present day populations an example of a phylogenetic species tree for four species a b c and d is shown by the outlined tree in figure 1 although the goal is generally to estimate the species phylogeny from available dna sequence data these sequence data are only directly informative about the gene tree the phylogenetic tree underlying the gene for which the dna sequences are available it is well accepted that gene trees and species trees may not agree with one another see e g 1 2 with many evolutionary processes known to give rise to variability in gene phylogenies within a fixed species phylogeny examples of such processes are incomplete lineage sorting ils hybridization horizontal gene transfer and gene duplication and loss 1 the best studied of these processes is ils which results when two lineages fail to share a most recent common ancestor mrca represented by an internal node in the gene tree until further back in time than the immediately ancestral population for example in figure 1 a the gene tree embedded within the species tree represents the phylogenetic history of the lineages sampled from species a b c and d which are denoted by a b c and d respectively throughout the text we use uppercase letters to refer to gene lineages and the corresponding lowercase letters to refer to the species from which these lineages are sampled although it is possible for lineages c and d to share their most recent common ancestor in the population labeled p 1 they remain distinct in this population and instead share their mrca corresponding author email addresses jchifman wakehealth edu julia chifman lkubatko stat osu edu laura kubatko 2 in population p 3 thus providing an example of ils note that the topology branching pattern of the gene tree in figure 1 a matches the topology of the species tree figure 1 b gives another example of ils but in this case lineage a coalesces with lineage c in their ancestral population and the gene tree topology does not match the species tree topology one of the reasons that ils has been well studied is that it can be modeled by the coalescent process the coalescent process can be derived as the large sample limit as the population size goes to of the wright fisher and other common population genetics models 3 4 5 the key property of the coalescent model is that the waiting time back into the past for a pair of lineages to find their mrca follows an exponential distribution with a parameter that depends on the sample size the coalescent model thus provides a link between the phylogenetic species tree and the set of gene trees embedded within the species tree that give rise to the actual data for this reason numerous methods based on the coalescent process have recently been proposed for estimation of the phylogenetic species tree one group of methods e g best 6 beast 7 stem 8 mp est 9 assumes that multi locus data are available for inference with the assumption that each locus has a single underlying unobserved gene tree alternatively single nucleotide polymorphism snp data are sometimes used for inference snp data represent sites sampled throughout the genome that are known to be variable with the assumptions that the sites are unlinked and that they each have their own phylogenetic history the software package snapp 10 has recently been developed for species tree estimation from biallelic snp data use of any of these methods assumes that the phylogenetic species tree can be identified from dna sequence data at the leaves of the tree but this has not formally been established note however that allman et al 2011 11 have established identifiability given a collection of gene tree topologies allman et al 2011 12 have considered identifiability given clade probabilities and liu and edwards 2009 13 have established identifiability when the order of ancestral populations and hence the relationships among all rooted triples can be consistently estimated here we prove that the unrooted topology of the phylogenetic species tree is identifiable given observed snp data at the leaves of the tree that are assumed to have arisen from the coalescent process our results hold for data for which a single observation corresponds to recording which of possible states occurs at each leaf these data are modeled by a continuous time markov process that specifies the rates of transitions between states along the phylogeny and that satisfies 3 the condition of time reversibility we also consider models that allow rate variation across sites as modeled by the discrete gamma distribution as well as the possibility of invariable sites for the special case of dna sequence data there are four states i e 4 corresponding to the four nucleotides a c g and t in this case our results hold for the general time reversible gtr 14 model with discrete gamma distributed rate variation and a proportion of invariable sites and all associated sub models in the next section we give the necessary background on the coalescent process and on the process of mutation for general state models pointing out the application to dna sequence data where relevant we also examine some common modifications to site independent sequence substitution models to allow for variation in the rate of evolution across sites we then present our main results and show how they are used to establish identifiability in the general case based on these results we propose a method for inferring species level relationships for empirical data sets consisting of dna sequence data we conclude by suggesting extensions of our current work 2 background in this section we review the models used for both the coalescent process and the mutation process along a phylogenetic tree by a topological tree we mean a tree for which edge length are not specified if a tree rooted or unrooted is endowed with a collection of non negative edge length we will say that a tree is metric let s denote a rooted binary topological n taxon species tree and let 1 2 n 1 be a vector of speciation times looking backward in time 0 j then a pair s represents a phylogenetic rooted metric n leaf species tree similarly let g be a rooted binary n taxon topological gene tree and let t t 1 t 2 tn 1 be a vector of coalescent times where tj is the time from the j th coalescent event to the next speciation event looking forward in time 0 tj for j 1 2 n 1 figure 1 shows examples of gene trees nested within species trees with all of these quantities labeled in addition observe that in figure 1 a upper left image the coalescent event that happens in population p 2 could also happen in population p 3 thus a pair g t will represent a phylogenetic rooted metric n leaf gene tree along with coalescent times that are associated with specific intervals between speciation events on the species tree the set of all such pairs g t conditional on the species tree s will be denoted by gs notice that both 4 a b c d 2 1 3 t 3 t 1 t 2 2 t 1 2 t 3 t 2 3 t 1 2 a b c d 2 t 1 3 t 2 3 t 2 r s p 3 p 1 p 2 speciation event coalescent event a 3 t 1 a b c d 2 1 3 p 2 p 1 p 3 t 3 t 1 t 2 t 2 t 1 a c b d 3 t 1 3 2 t 3 t 2 3 t 2 r s b figure 1 example of two gene trees red nested within a species tree blue in a the gene tree and the species tree have the same topology while in b they do not agree with one another in both subfigures the dotted black horizontal lines represent speciation events in the species tree the times of these events denoted by i are measured backward from the present time portions of the tree that fall between species events represent ancestral populations denoted by pi the dotted horizontal red lines represent coalescent events that occur in the gene trees the times of coalescent events denoted by ti are measured from the most recent looking forward in time speciation event s and g t are ultrametric that is all leaves are equidistant from the root in phylogenetics such trees are said to satisfy the molecular clock here we measure time in coalescent units which are the number of generations scaled by 2 n where n is the population size and is the mutation rate 2 1 the coalescent process the coalescent is a model for the evolutionary history i e sequence of coalescent events of a sample of lineages within a population backward in time from the present to the past 3 4 5 in particular given a sample of j gene lineages the coalescent model specifies that the time tj until 5 the next pair of lineages coalesces follows an exponential distribution with rate j 2 2 1 i e tj has probability density f tj j j 1 2 2 exp j j 1 2 2 tj tj 0 1 where the parameter is the effective population size which is given by 2 n now consider a population within a species tree e g p 1 in figure 1 a which corresponds to a time interval of length 3 1 and let b represent this branch following rannala and yang 2003 let u denote the number of lineages entering the population e g the number of lineages in the population closest to the present time and let v be the number of lineages leaving the population v u the number of coalescent events within the population is u v and the density of the time of each coalescent event can be determined via equation 1 by setting j to be the number of current lineages in the population and following an assumption of the coalescent model that each pair of lineages within a population is equally likely to be the next to coalesce this means that when there are j lineages available to coalesce in the population there are j 2 possible pairs that might be the next to coalesce and the density for the next event should be weighted by the probability of a particular pair coalescing which is 1 j 2 let tbj denote the time from the speciation event that immediately precedes branch b looking backward in time to the coalescent event that reduces the number of lineages on branch b from j to j 1 define tbu 1 to be 0 and let b refer to the length of branch b then we can write the joint density of coalescent times tbu t b u 1 t b v 1 within population p on branch b in the case in which u v as fpb t b u t b u 1 t b v 1 u j v 1 2 exp j j 1 tbj tbj 1 exp v v 1 b tbv 1 2 0 tbj j u 1 u u 1 v 1 the terms inside the product in equation 2 correspond to observed coalescent events while the final term reflects the fact that when v 6 1 the coalescent event that decreases the number of lineages from v to v 1 does not occur within the time remaining in population pb which is b tbv 1 when u v for branch b no coalescent events happen on that branch the probability of this 6 occurring under the model is p no coalescence among v lineages in population pb exp v v 1 b 3 where b is defined as above to be the length of branch b note that when u v 1 as is the case for the branches at the tips of the tree this probability is 1 as an example refer again to figure 1 a for population p 1 we have u v 2 and the probability of this is given by equation 3 as p no coalescence among 2 lineages in population p 1 exp 2 3 1 4 for population p 3 u 3 v 1 t p 3 u t 2 t p 3 u 1 t p 3 v 1 t 3 and the joint density is fp 3 t p 3 u t p 3 v 1 fp 3 t 2 t 3 2 exp 2 t 3 t 2 2 exp 6 t 2 5 for population p 2 u 2 v 1 and t p 2 u t p 2 v 1 t 1 and the joint density is fp 2 t p 2 u fp 2 t 1 2 exp 2 t 1 6 equation 2 and equation 3 describe the coalescent process within a population we now wish to apply the coalescent model to the entire phylogenetic species tree in order to derive the probability density for gene trees nested within the species tree again following rannala and yang 2003 we note that once the number of lineages entering and leaving a population on a species phylogeny is specified the coalescent processes within each of the populations are conditionally independent of one another thus the densities within individual populations can be multiplied to give the overall gene tree density given a particular species tree with speciation time vector f g t s n 1 b 1 fpb t b ub tbub 1 t b vb 1 7 where the index b is over populations e g branches in the species phylogeny s ub is the number of lineages entering population pb and vb is the number of lineages leaving population pb note that the collection of tbi terms across all branches is equivalent to the vector t in g t we emphasize that the notation f g t s for the joint density is chosen to reflect the fact that this is the joint density of the topology and branch lengths of the gene tree g t conditional on the species tree s 7 2 2 the mutation process the process of evolutionary change along a phylogeny is commonly modeled by a continuous time markov process in this section we describe the general case of a markov mutation process on states and then consider the commonly used models for dna sequence data for which 4 we begin by specifying a general time reversible instantaneous rate matrix q such that entry qij i 6 j gives the instantaneous rate of change from state i to state j q 2 1 3 2 1 1 1 3 2 3 1 2 2 3 6 1 1 2 2 3 3 3 6 8 in the matrix above each j term represents the frequency of state j at equilibrium with the constraints that j 0 for j 1 2 and j 1 j 1 the model contains 2 additional parameters 1 1 2 1 that specify the rates of mutation between states with the assumption that j 0 for j 1 2 1 2 the diagonal entries of q are set so that the rows sum to zero note that the l term in the i j th entry is the same as in the j i th entry so that the model satisfies the condition of time reversibility i e iqij jqji the intuition of the model is that a pair of states i and j have the same basic rate of mutating from one to the other represented by l but the rate of moving to state j depends also on the frequency of state j given by j the instantaneous rate matrix is used to compute the transition probability matrix p t such that the i j th entry of p t gives the probability that state i mutates to state j in an interval of time of length t this is done by solving the matrix differential equation p t qp t with initial condition p 0 i to give p t eqt in phylogenetics it is common to refer to the matrix p t as the substitution matrix rather than the transition probability matrix because the word transition has a particular meaning in the process of dna sequence mutation the matrix q is the generalization of the 4 state gtr model for dna sequence data to states in the sense that it allows a separate parameter for mutations between each pair of states all of the models we consider here can then be thought of as special cases of q for example if we 8 specify 1 2 1 2 1 and j 1 for j the resulting model is the state analog of the jukes cantor model 16 which has been called the mk model by lewis 2001 17 when dna sequence data are available at the tips of the tree 4 and we let j 1 2 3 4 correspond to the four nucleotides a c g and t respectively below we list the restrictions on the parameters in q that lead to many of the commonly used substitution models in empirical phylogenetics jc 69 jukes cantor model 16 i 1 4 for i 1 2 3 4 j for all j 1 2 6 k 2 p kimura s 2 parameter model 18 i 1 4 for i 1 2 3 4 1 6 0 2 3 4 5 0 f 81 felsenstein s 1981 model 19 j for j 1 2 6 i 0 1 for i 1 2 3 4 with 4 i 1 i 1 hky 85 hasegawa kishino and yano s 1985 model 20 1 6 0 2 3 4 5 0 i 0 1 for i 1 2 3 4 with 4 i 1 i 1 tn 93 tamura and nei s 1993 model 21 1 0 6 0 2 3 4 5 0 i 0 1 for i 1 2 3 4 with 4 i 1 i 1 gtr general time reversible model 14 j 0 for j 1 2 6 i 0 1 for i 1 2 3 4 with 4 i 1 i 1 two additional modifications of the basic substitution models listed above are commonly used in the analysis of dna sequence data both are designed to model the fact that observed rates of evolution are known to vary across sites in the sequences with some sites evolving more quickly than others and some sites essentially never evolving to capture differential rates of evolution across sites it is common to incorporate a parameter for the rate of evolution at a site traditionally the gamma distribution with shape parameter 0 and rate parameter 0 is used 22 which 9 is generally denoted as the density function for the gamma distribution is g 1 e if 0 0 if 0 9 where is the gamma function in applications it is common for computational purposes to use a discrete gamma model to approximate the continuous gamma distribution which involves specifying a finite number of rate classes 23 in particular the range of is cut into m categories such that each category has equal probability 1 m for each category i m a single rate i is used to assign the rate for that class the rate i is generally chosen to be the mean of the corresponding continuous gamma distribution for that class computed as follows i b a g d b a g d 10 see 23 here a and b represent the endpoints of the interval for category i if a site has rate parameter i then its instantaneous rate matrix becomes iq rather than simply q and the corresponding change to the substitution matrix p t is made we denote the substitution matrix that depends on i by p i t with i j th element p i ij t the second modification models the fact that some sites in a dna sequence are known not to evolve and are thus called invariable to capture this a parameter is incorporated that gives the probability that a site is invariable if a site is invariable none of the states observed at the leaves differs from the state at the root with probability 1 the mutation probabilities at the site follow one of the markov models described above this possibility is typically denoted i in specifying the overall substitution model putting this all together we represent this model by gtr i these models have been considered in work establishing identifiability in the gene tree case 24 25 26 below we give results for gtr i models for which the gamma distributed rates are modeled using the discrete gamma approximation described above thus far we have described the evolutionary model for mutations between states along specific branches of a gene tree we now describe how these models are used to compute the probability distribution of the data at the leaves of a phylogenetic gene tree the key idea in calculating site pattern probabilities is that the states are not observed at the internal nodes of the tree and so the probability must be computed by summing over all possible states for these nodes additionally probabilities along each branch are multiplied together because we assume that the 10 mutation process proceeds independently along each branch finally we point out that we are utilizing what have been called rate matrix models 24 in phylogenetics since we assume that the markov mutation process is homogeneous across branches of the phylogeny v 1 r 1 2 4 3 s v 3 v 2 v 5 v 4 figure 2 four leaf unrooted gene tree consider a gene tree as labeled in figure 2 with branch lengths vi let xy be the state observed for lineage y y 1 2 3 4 with p i vi denoting the substitution matrix for edge vi and considering the tree to be rooted at r the site pattern probability on the gene tree for a particular observation i 1 i 2 i 3 i 4 ij at the tips of the tree with associated site specific rate i is given by p x 1 i 1 x 2 i 2 x 3 i 3 x 4 i 4 r 1 s 1 rp i ri 1 v 1 p i ri 2 v 2 p i rs v 3 p i si 3 v 4 p i si 4 v 5 for the gene tree in figure 1 a we define lineage 1 to be a 2 to be b 3 to be c and 4 to be d and we then have v 1 2 t 1 v 2 2 t 1 v 3 2 t 3 t 2 3 t 1 2 v 4 3 t 2 and v 5 3 t 2 for the gene tree in figure 1 b we define lineage 1 to be a 2 to be c 3 to be b and 4 to be d and we have v 1 v 2 3 t 1 v 3 t 2 t 1 v 4 3 t 2 and v 5 3 2 t 3 t 2 in general lineages 1 and 2 are defined to be those on either side of the root lineage 3 is the next most closely related to these in the gene tree embedded within the species tree and the remaining lineage is assigned label 4 for each category i m we will denote by p i i 1 i 2 i 3 i 4 g t the site pattern probability on the gene tree g t since the rates are unobserved in practice we sum over them with respect to discrete gamma distribution to obtain p i 1 i 2 i 3 i 4 g t 1 m m i 1 p i i 1 i 2 i 3 i 4 g t 11 see 23 define the 4 dimensional array p g t as the probability distribution on all possible site patterns for the gene tree g t under a model that includes rate variation across 11 sites the dimensions of p g t correspond to the ordered taxa of the gene tree and the entries are indexed by the states at the leaves to incorporate the possibility of invariable sites define p i diag to be a 4 dimensional array whose off diagonal entries are 0 and whose diagonal entries are the elements of the vector 1 then the probability distribution p g t in all sites patterns is given by p g t 1 p g t p i 12 the entries of p g t will be denoted by pi 1 i 2 i 3 i 4 g t and we emphasize that each entry is an analytic function 3 the site pattern probability distribution under the coalescent model our goal is to establish identifiability of the n leaf phylogenetic species tree given data at the leaves of the tree to achieve this we first prove identifiability of the 4 taxon species tree and thus dedicate this section to the description of the coalescent model for a fixed species tree s on four leaves with a set of taxa labeled by a b c and d we point out that everything in this section is easily extendable to the n taxon case to compute the site pattern probabilities on the species tree we will use gene tree site pattern probabilities along with the gene tree density given in equation 7 to distinguish site pattern probabilities arising on the species tree under the coalescent model from those arising on a gene tree we will use the notation p i 1 i 2 i 3 i 4 g t s ij to denote site pattern probabilities that come from the species phylogeny s with embedded gene tree g t consider first the case in which g s i e the gene tree and species tree have the same topology see for example figure 1 a in that case for a fixed observation i 1 i 2 i 3 and i 4 at the leaves of a species tree we find p i 1 i 2 i 3 i 4 g t s p xa i 1 xb i 2 xc i 3 xd i 4 t pi 1 i 2 i 3 i 4 g t f g t s dt when g 6 s the labels at the leaves of the species tree may correspond to a different ordering of the labels of the lineages in the gene tree for example in figure 1 b species a and b are sister leaves in the species tree but lineages a and c are sisters in the gene tree hence for a gene tree 12 g t and species tree s in figure 1 b we compute p i 1 i 2 i 3 i 4 g t s p xa i 1 xb i 2 xc i 3 xd i 4 t pi 1 i 3 i 2 i 4 g t f g t s dt it is clear that many observations at the leaves of the species tree will not always result in the same observations at the tips of the embedded gene tree we will use i 1 i 2 i 3 i 4 to represent the observation at the leaves of the gene tree where is a permutation of i 1 i 2 i 3 and i 4 for a fixed gene tree topology nested within a species tree in general we write p i 1 i 2 i 3 i 4 g t s t p i 1 i 2 i 3 i 4 g t f g t s dt 13 equation 13 gives the probability of the event xa i 1 xb i 2 xc i 3 xd i 4 for a fixed gene tree g t and species tree s our goal is to obtain these probabilities conditioning only on the species tree s since the true gene tree is unobserved we must consider all possible gene trees that are consistent with the given species tree and weight the probability of the site pattern of interest appropriately by the probability of each gene tree under the coalescent model we note that the limits of integration will depend on where the coalescent events happen in addition recall that gs denotes the set of all gene trees g t conditional on species tree s this leads to the following expression for the probability that xa i 1 xb i 2 xc i 3 xd i 4 for species tree s p i 1 i 2 i 3 i 4 s g t gs p i 1 i 2 i 3 i 4 g t s g t gs t p i 1 i 2 i 3 i 4 g t f g t s dt 14 we denote the probability distribution on all possible site patterns given species tree s by the 4 dimensional array p s and let p i 1 i 2 i 3 i 4 s ij denote the site pattern probabilities as given in equation 14 we stress again that in general each p i 1 i 2 i 3 i 4 s is not a polynomial but an analytic function let cgtr be the state analytic gtr i model under the coalescent for a 4 leaf species tree with the discrete gamma distribution used to model rate variation across sites the model parameters are the topology of the species tree s the matrix q as described by 8 the vector of speciation times 1 2 3 for s the effective population size the proportion of invariable 13 sites and the parameters of the discrete gamma distribution and for a fixed species tree s we will denote the continuous parameter space of cgtr by an open set us rm then the parameterization map s for the analytic model giving the probability distribution of the variables at the leaves of the 4 taxon species tree s is s us 4 1 15 u 7 p s where 4 1 0 1 4 is the probability simplex 4 1 p 1 p 2 p 4 r 4 4 i 1 pi 1 and pi 0 for all i the image of the map cs s u 4 1 is the coalescent phylogenetic model one can easily see that the model can be extended to any n taxon species tree 3 1 a few remarks about embedded gene trees within a species tree let s be a four taxon symmetric a b c d or asymmetric a b c d species tree with a cherry c d as in figure 1 recalling that the gene trees arising under the coalescent model will all satisfy the molecular clock i e the distance from each tip to the root is identical it might be obvious to some readers that for any observation i 1 i 2 i 3 i 4 at the leaves of s i 1 i 2 i 3 i 4 p i 1 i 2 i 3 i 4 s p i 1 i 2 i 4 i 3 s 16 however if the above relationship is conditioned on a particular gene tree for which c d is not a cherry then the equation will be false as the example below shows example 3 1 let the gene tree g arising from the species tree a b c d be a c b d as in figure 1 b then according to equation 13 for any observation i 1 i 2 i 3 i 4 at the leaves of s we get p i 1 i 2 i 3 i 4 g t s t pi 1 i 3 i 2 i 4 g t f g t s dt p i 1 i 2 i 4 i 3 g t s t pi 1 i 4 i 2 i 3 g t f g t s dt since pi 1 i 3 i 2 i 4 g t 6 pi 1 i 4 i 2 i 3 g t see equations 11 12 and figure 1 we see that p i 1 i 2 i 3 i 4 g t s 6 p i 1 i 2 i 4 i 3 g t s 14 this example demonstrates that in general for many individual gene trees an equation analo gous to equation 16 does not hold yet when the sum is taken over all possible gene trees g t conditional on species tree s the result does hold in this section we would like to clarify why and how the above equation 16 is true under the coalescent model case 1 consider a collection of gene trees with c d as a cherry denoted by gcd then for each g t gcd it is true that p i 1 i 2 i 3 i 4 g t s p i 1 i 2 i 4 i 3 g t s for all i 1 i 2 i 3 i 4 case 2 now consider the set of gene trees for which a b is a cherry and c d is not a cherry there are only two topological gene trees of this form g 1 a b c d and g 2 a b d c since a b is a cherry the coalescent event joining a and b can happen in population p 2 or p 3 for the symmetric tree in figure 1 a while for the asymmetric species tree in figure 1 b a and b can only coalesce in population p 3 this is true for both gene trees g 1 and g 2 let t represent a vector of coalescent times for which a and b coalesce in the same population for both gene trees whereas the other two coalescent events necessarily happen in population p 3 now the probability densities for these two gene trees g 1 t and g 2 t are identical under the coalescent model i e f g 1 t s f g 2 t s then for all i 1 i 2 i 3 i 4 p i 1 i 2 i 3 i 4 g 1 t s t pi 1 i 2 i 3 i 4 g 1 t f g 1 t s dt 17 p i 1 i 2 i 4 i 3 g 2 t s t pi 1 i 2 i 4 i 3 g 2 t f g 2 t s dt 18 now note that pi 1 i 2 i 3 i 4 gu t pi 1 i 2 i 4 i 3 gv t 19 for u v 1 2 u 6 v which gives p i 1 i 2 i 3 i 4 g 1 t s p i 1 i 2 i 3 i 4 g 2 t s p i 1 i 2 i 4 i 3 g 1 t s p i 1 i 2 i 4 i 3 g 2 t s 20 case 3 consider the set of gene trees for which neither a b nor c d are cherries then at least one of the following pairs are cherries a c a d b c b d 15 first suppose that a c is a cherry the case that a d is a cherry is analogous i first suppose that b d is also a cherry and denote this gene tree by g 1 a c b d for the symmetric species tree all coalescent events happen in population p 3 for this gene tree figure 1 a let t 1 be the coalescent time for lineages a and c and t 2 be the coalescent time for lineages b and d one can see that there are two metric gene trees g 1 t t 1 t 2 and g 1 t t 1 t 2 where t is the vector of coalescent times for the asymmetric species tree figure 1 b there are three metric gene trees one in which lineages b and d coalesce in population p 2 and the other two analogous to the symmetric case in which all coalescent events happen in p 3 now consider a second gene tree g 2 in which a d and b c are cherries similar to our discussion above one can show that if the species tree is symmetric there are two metric gene trees while for the asymmetric species tree there are three such pairs let t be a vector of coalescent times consistent with both trees g 1 and g 2 for example if s is the asymmetric tree and the lineages b and d coalesce in p 2 for g 1 then lineages b and c also coalesce in p 2 for g 2 and the other two events occur in population p 3 as in case 2 the probability densities of g 1 t and g 2 t are identical then the relationship in equation 20 holds ii now suppose that b d is not a cherry then two gene trees are possible a c d b and a c b d let g 1 be the tree a c d b the other case is analogous and consider the tree g 2 a d c b for both the symmetric and the asymmetric species trees g 1 and g 2 have all coalescent events happening in p 3 and thus result only in one gene tree pair gi t for each i 1 2 the same arguments as in the previous cases can be used to show that equation 20 holds in this case as well finally we note that the cases for which b c and analogously b d are cherries can be handled in exactly the same manner as above this concludes case 3 it is then straightforward to check that all of the possible histories for both the symmetric and asymmetric species trees are included in exactly one of the cases described above now recall that the probability of any observation i 1 i 2 i 3 i 4 at the leaves of s is the sum over all possible gene trees thus equation 16 is true under the coalescent model if the species tree s is symmetric then in addition we also get p i 1 i 2 i 3 i 4 s p i 2 i 1 i 3 i 4 s for any observation i 1 i 2 i 3 i 4 at the leaves of s i 1 i 2 i 3 i 4 16 4 splits flattenings invariants and identifiability background in this section we provide definitions and results that we will use in subsequent sections let l denote a set of taxa for a tree species or gene e g if s is a species tree in figure 1 then l a b c d definition 4 1 a split of a set of taxa l is a bipartition of l into two non empty subsets l 1 and l 2 denoted l 1 l 2 a split l 1 l 2 is valid for tree t if the subtrees containing the taxa in l 1 and in l 2 do not intersect in general the definition of a split is used for unrooted trees to avoid any ambiguity by a split of a rooted 4 taxon species tree symmetric or asymmetric we will always mean a bipartition of l into two equal subsets i e l 1 l 2 2 in particular for the four leaf species trees a b c d or a b c d figure 1 there are three splits according to our discussion above the split l 1 l 2 ab cd is valid and splits ac bd and ad bc are not valid for the gene tree in figure 1 b the split ac bd is valid while ab cd and ad bc are not this also demonstrates that a valid split for a species tree will not always result in the same valid split for an embedded gene tree splits of a set of taxa provide a natural way to rearrange the n dimensional array p as a matrix definition 4 2 let l 1 l 2 be any split of a set of taxa l a flattening of p denoted by flatl 1 l 2 p is an l 1 l 2 matrix whose rows are indexed by possible states for the leaves in l 1 and columns by possible states in l 2 the entries of flatl 1 l 2 p correspond to the probability of the site pattern specified by the row and column indices for example for 4 and a species tree s as in figure 1 the 16 16 flattening of p s for a split l 1 l 2 ad bc is flatad bc p s p aaaa p aaca p aaga p aata p acaa p atta p aaac p aacc p aagc p aatc p acac p attc p aaag p aacg p aagg p aatg p acag p attg p aaat p aact p aagt p aatt p acat p attt p caaa p caca p caga p cata p ccaa p ctta p taat p tact p tagt p tatt p tcat p tttt 17 a very important concept that will be tied with the minors of the matrix flatl 1 l 2 p is that of invariants consider an asymmetric species tree s a b c d where c and d are sister leaves then p ij s p ji s 0 for all i j where indicates any value in see section 3 1 this is an example of a linear invariant it is termed linear since it is a linear function in the site pattern probabilities more precisely an invariant is a function in the site pattern probabilities that vanishes when evaluated on any distribution arising from the model linear invariants for gene trees have been studied by several authors 27 28 29 30 in general linear invariants for a gene tree are not necessarily invariants for the same species tree intuitively this makes sense since when the sum is taken over all gene trees embedded within a species tree it is quite obvious that some linear invariants will vanish on one gene tree topology but not the other letr be a collection of analytic functions f 1 f 2 fr defined on the common domain d rn an analytic variety v r is a simultaneous zero set of functions in r v r a d fi a 0 1 i r fix a coalescent phylogenetic model cs 4 1 as defined in section 3 then an analytic function f is called a coalescent phylogenetic invariant if f a 0 for all a cs a very powerful and important concept about the zero sets of analytic varieties will play an important role in our arguments about identifiability it is well known that if a real function f is analytic on the connected open set u rn and its zero set is of positive measure then f 0 let a set u rn be of full dimension and set w u v r where r is a finite set of nonconstant analytic functions defined on u if w is a proper subvariety of u then it must be of dimension strictly less than n in particular w is necessarily of lebesgue measure zero a key issue when formulating any statistical model is whether the parameters of that model are identifiable classically identifiability means the following suppose that m p defines a family of probability distributions with parameters the model m is said to be identifiable if the mapping 7 p is injective this definition is rather too strict as for many models this map will not be injective describing a set of parameters on which a model is non identifiable and excluding it from a domain is not always possible especially for identifiability of numerical parameters nonetheless identifiability for parametric models both algebraic and analytic can 18 be proved by demonstrating that the set of parameters on which the model is non identifiable is a subset of a proper subvariety of measure zero in this case we say that model parameters are generically identifiable generic identifiability of a gene tree topology and numerical parameters for many evolutionary models is well studied and established a series of papers by e allman and j rhodes and collaborators 25 26 31 32 have used an algebraic framework to establish identifiability of the unrooted gene tree and associated model parameters for substitution models as general as the general markov model with a proportion of sites invariable gm i as well as for the general time reversible model with rate variation following the gamma distribution gtr for the general state markov model m a flattening of a tensor p is used to prove generic identifiability of a gene tree topology briefly let p be a joint distribution arising from mt on an n leaf gene tree t then i if l 1 l 2 is a valid split for t rank flatl 1 l 2 p and ii if l 1 l 2 is not a valid split for t generically rank flatl 1 l 2 p in particular for a valid split on t the 1 minors of the matrix flatl 1 l 2 p called edge invariants all vanish on mt 5 main results to prove identifiability of a 4 leaf species tree from site pattern probabilities we will use precise formulas for the generalized jukes cantor k state model under the coalescent for symmetric and asymmetric 4 leaf species trees which are described fully in section 6 in theorem 5 1 we establish an identifiability result for unrooted 4 leaf species trees note that the rooted symmetric and the rooted asymmetric species trees yield a single unrooted species tree topology making a distinction between symmetric and asymmetric trees when necessary additional arguments extend this result to n leaf species trees as stated in corollary 5 5 in the next theorem we are going to identify the parameter space us with a full dimensional subset of rm in particular us is an open connected subset of rm also recall that the parameter ization map s defined by 15 is given by analytic functions in section 4 we have stated a result from the theory of analytic functions of several complex variables that will play an important role in our next argument for clarity we rephrase this fact as follows if a real function f is analytic on the connected open set u rn and f is not identically zero then the set z f x u f x 0 has n dimensional lebesgue measure zero for more information about analytic functions of several 19 complex variables and the proof of the above fact the reader is encouraged to consult 33 we will need a few additional results to prove theorem 5 1 let a aij be an n n real symmetric matrix the well known sylvester s criterion states that a is positive definite if and only if all of its principal minors are positive positive definite matrices are invertible the sum of positive definite matrices is positive definite and multiplication of a positive definite matrix by a real positive number is also positive definite in addition recall that a matrix a is strictly diagonally dominant if aii i 6 j aij for all i a symmetric strictly diagonally dominant matrix a with real non negative diagonal entries is positive definite next we would like to make several observations about the discrete gamma distribution that we will use in the proof of theorem 5 1 from the definition of the rates i see equation 10 one can see that 0 1 2 m where m is the number of categories for any fixed m and 1 we show that we can always find 0 such that m n for some positive number n with 1 the rate m becomes m a e d a e d 21 recall that each category has equal probability hence the left most endpoint of the last category corresponds to a cumulative probability of m 1 m now we compute the left most endpoint a for the last category a 0 e d m 1 m 1 e a m 1 m a ln m using this endpoint and substituting into equation 21 we find that m 1 ln m therefore for any fixed number of categories m and 1 if 1 ln m n for some positive real number n then m n in particular all rates i are bounded by n of course in practice such a choice of parameters may not be biologically meaningful but for our proof we only need the existence of a single point to show generic identifiability 20 theorem 5 1 let s be a four taxon symmetric a b c d or asymmetric a b c d species tree with a cherry c d and let l 1 l 2 be one of the splits of taxa ab cd ac bd or ad bc consider the cgtr state analytic gtr i model under the coalescent for a species tree s with the discrete gamma distribution used to model rate variation across sites identify the parameter space us with a full dimensional subset of rm 1 if l 1 l 2 is a valid split for s then for all distributions p s arising from the model rank flatl 1 l 2 p s 1 2 2 if l 1 l 2 is not a valid split for s then for generic distributions p s arising from the model rank flatl 1 l 2 p s 1 2 proof suppose that l 1 l 2 is a valid split for s that is l 1 l 2 ab cd from our discussion in section 3 1 it is clear that for any distribution p s arising from the state model cgtr the entries i j k l and i j l k of the 2 2 matrix flatab cd p s are equal for all k 6 l in particular the columns labeled by the cd indices kl and lk for distinct k l are identical e g columns labeled by 12 and 21 are equal since there are 2 such pairs we get that rank flatab cd p s 2 2 1 2 which establishes 1 now suppose that l 1 l 2 is not a valid split for s let xac bd and xad bc denote the sets of 1 2 1 minors of the 2 2 matrices flatac bd and flatad bc respectively let vac bd be the zero set of xac bd and vad bc be the zero set of xad bc define w as a zero set of real functions f s that are analytic on the connected set us where f vanishes on vac bd vad bc it is clear that w is an analytic subvariety and a subset of us we are going to show that w is a proper subvariety of us by finding u us w with s u vac bd vad bc in particular we show that the ranks of flatac bd and flatad bc are greater than 1 2 for this choice of parameters recall that the continuous model parameters are the vector of speciation times 1 2 3 for s as depicted in figure 1 the effective population size the matrix q the rates of mutation between states 1 2 1 2 1 and relative frequencies of the states at equilibrium 21 1 2 the proportion of invariable sites and the parameters and for the discrete gamma distribution note that for a fixed species tree s the matrices flatac bd p s and flatad bc p s will be identical since for any observation at the leaves of s for i 1 i 2 i 3 i 4 we have p i 1 i 2 i 3 i 4 s p i 1 i 2 i 4 i 3 s thus for simplicity let f flatac bd p s flatad bc p s notice that we can express flattening f as f 1 m m i 1 f i where i 0 is the rate for category i m associated with the discrete gamma distribution and f i is the flattening associated with the fixed rate i also note that all entries in the matrix f i are positive to differentiate between site pattern probabilities on the species tree and site pattern probabilities for a specific rate i on the same species tree we use the notation p i 1 i 2 i 3 i 4 s and p i i 1 i 2 i 3 i 4 s respectively let the proportion of invariable sites be such that 0 next let q be a generalized jukes cantor matrix as described by equation 28 in section 6 and let 2 3 and 1 3 10 since 2 3 then the distributions p s will be the same for both symmetric and asymmetric species trees furthermore let 3 1 0 1 and i 0 1 for all i 1 12 1 first let 2 by using precise formulas for the site pattern probabilities for the generalized jukes cantor as described in section 6 and supplement a and the choice of parameters made above we find that all principal minors of a symmetric matrix f i are positive for any i 0 see mathematica supplementary file for computations this implies that f i is positive definite matrix thus we conclude that f 1 m m i 1 f i is positive definite and hence invertible in particular we have that generically rank f 2 for 3 we further specify parameters associated with the discrete gamma distribution let 1 and 1 ln m 2 for any fixed number m of categories first select all rows and columns from the matrix f i labeled by ac bd indices with distinct a and c and with distinct b and d denote this 1 1 submatrix by f i note that for 4 1 1 2 while for 3 this is clearly false thus at an appropriate point we will have two sub cases one for 4 and one for 3 for which we will add an additional column and row to the submatrix f i by the symmetry of the matrix q the matrix f i will have six distinct entries for 4 see supplement a p i xxyy p i xxyz p i xyxy p i xyxz p i yzxx and p i xyzw 22 note that for 3 there is no entry p i xyzw the diagonal 1 1 blocks of f i will be of the following form p i xxyy p i xxyz p i xxyz p i xxyz p i xxyz p i xxyy p i xxyz p i xxyz p i xxyz p i xxyz p i xxyy p i xxyz p i xxyz p i xxyz p i xxyz p i xxyy the off diagonal 1 1 blocks of f i can be obtained from the block described below by appropriately permuting rows and columns 12 13 14 15 1 21 p i xyxy p i xyxz p i xyxz p i xyxz p i xyxz 23 p i xyxz p i yzxx p i xyzw p i xyzw p i xyzw 24 p i xyxz p i xyzw p i yzxx p i xyzw p i xyzw 25 p i xyxz p i xyzw p i xyzw p i yzxx p i xyzw 26 p i xyxz p i xyzw p i xyzw p i xyzw p i xyzw 2 p i xyxz p i xyzw p i xyzw p i xyzw p i yzxx the submatrix f i is symmetric in addition it is straightforward to show that row column sums are all the same and they are equal to p i xxyy p i xyxy 2 p i xxyz 2 p i xyxz p i yzxx 3 p i xyzw 22 recall that 1 and 1 ln m 2 where m is the number of categories from our earlier discussion this implies that 0 1 2 m 2 first let 4 to show diagonal dominance of the matrix f i we need to show that p i xxyy p i xyxy 2 p i xxyz 2 p i xyxz p i yzxx 3 p i xyzw 0 23 with the choice of parameters made above and using precise formulas for the site pattern prob abilities for the generalized jukes cantor model as described in section 6 and supplement a we show that equation 23 can be simplified to the following form f 1 i 2 f 2 i 3 f 3 i 4 24 23 where each fj is the function of i we find that if i 0 2 then fj i 0 for j 1 2 3 therefore equation 23 is strictly positive and we conclude that f i is strictly diagonally dominant for any i 0 2 and hence positive definite this implies that f 1 m m i 1 f i is positive definite and invertible thus generically rank f 1 see mathematica supplementary files for computations now let 3 in this case the submatrix f i is 6 6 thus we need to add at least one row and column from the flattening f i choose the last row and the last column from f i labeled by index and insert it as the 7 th row and column into f i by removing entries with 11 and 22 indices call this new submatrix f i again using parameters chosen above and precise formulas we find that for any i 0 2 the 6 6 principal submatrix of f i which is just f i is strictly diagonally dominant and also we show that det f i 0 now this implies that all principal minors of f i are positive for any i 0 2 see mathematica supplementary file for computations thus we conclude that f 1 m m i 1 f i is positive definite and hence invertible in particular generically rank f 1 1 note that the interval for i is not tight we simply chose the smallest interval to accommodate all cases since there exists at least one parameter choice in us that does not lie in w then w is a proper analytic subvariety of us for a 4 leaf species tree s and hence of dimension strictly less than the dimension of us we conclude that for a non valid split l 1 l 2 rank flatl 1 l 2 p s 1 2 for generic distributions p s arising from the model establishing 2 remark 5 2 note that the proof of theorem 5 1 2 actually establishes that if l 1 l 2 is not a valid split for s then for generic distributions p s arising from the model and 4 rank flatl 1 l 2 p s 1 remark 5 3 recall that the probability distribution p s arises from a fixed 4 leaf species tree topology s thus we can use the vanishing of the the 1 2 1 minors of the flatl 1 l 2 p s to identify s for generic parameters in particular using the notation of the theorem 5 1 we conclude that the unrooted 4 leaf species tree s is identifiable from p s s u for any parameters u us w 24 in the single 4 leaf gene tree case for the general state markov model under the molecular clock assumption even though the columns of the flattening labeled by the cd indices kl and lk for distinct k l are identical the rank of the flattening for a valid split is less than or equal to thus one might wonder if the rank of the flattening for the species tree under the coalescent model might be less than or equal to for all distributions arising from the model cgtr for a valid split and using our computations for jc 69 state model under the coalescent section 6 we have found several 1 1 minors for 4 that do not vanish identically now we turn our attention to the identifiability of the unrooted n taxon species tree from the induced quartets remark 5 4 let sn be an n taxon species tree we are going to show that the distribution for sn can be marginalized to sn 1 we demonstrate the idea on the 5 taxon species tree s 5 the n taxon case follows easily from the one described below 2 3 4 1 a b c d e t coalescent time for taxon c figure 3 a 5 taxon species tree with one example gene tree embedded let q s 5 be a collection of 4 leaf species trees that are induced by s 5 consider s 5 a b c d e as in figure 3 and let s q s 5 be a b d e we would like to show that we can express each site pattern probability for an induced quartet tree s as p i 1 i 2 i 4 i 5 s x p i 1 i 2 xi 4 i 5 s 5 25 in the equation above 1 2 3 4 denotes the speciation times for s 5 figure 3 and 1 2 4 denotes the speciation times for the induced quartet tree s let t be the coalescent time for taxon c and define t t t where t is a vector of coalescent times for a 5 taxon 25 gene tree g 5 conditional on s 5 thus t is a vector of coalescent times for a 4 taxon gene tree g conditional on s let g 4 and g 5 be sets of all metric gene trees g t and g 5 t respectively now using equation 14 as applied to a 5 taxon species tree s 5 the right hand side of equation 25 is equal to x p i 1 i 2 xi 4 i 5 s 5 x g 5 t g 5 t p i 1 i 2 xi 4 i 5 g 5 t f g 5 t s 5 dt g 5 t g 5 t x p i 1 i 2 xi 4 i 5 g 5 t f g 5 t s 5 dt g 5 t g 5 t p i 1 i 2 i 4 i 5 g t f g 5 t s 5 dt 26 g t g 4 g t g 5 t g 5 t p i 1 i 2 i 4 i 5 g t f g 5 t s 5 dt the second sum in the last expression g t g 5 t g 5 means that for each 4 taxon gene tree g t we sum over all placements of the 5 th taxon essentially we replace a sum over all five taxon trees with a sum over all four taxon trees that includes for each four taxon tree a sum over all placements of the fifth taxon define b to be the branch of s 5 on which t occurs and let b be the set of all branches of s 5 regardless of where t occurs then according to equation 7 we can write the gene tree density given s 5 as f g 5 t s 5 b b fpb tub tub 1 tvb 1 b b b fpb t fpb t t 27 26 substituting 27 into the last expression of 26 we get x p i 1 i 2 xi 4 i 5 s 5 g t g 4 g t g 5 t g 5 t p i 1 i 2 i 4 i 5 g t f g 5 t s 5 dt g t g 4 g t g 5 t g 5 t t p i 1 i 2 i 4 i 5 g t b b b fpb t fpb t t dt dt g t g 4 t p i 1 i 2 i 4 i 5 g t b b b fpb t g t g 5 t g 5 t fpb t t dt dt g t g 4 t p i 1 i 2 i 4 i 5 g t f g t s dt p i 1 i 2 i 4 i 5 s let us 5 denote the continuous parameter space for the species tree s 5 and us the continuous parameter space for the induced 4 leaf tree s from the argument above it is easy to see that we have a commutative diagram of analytic maps with s surjective and s a marginalization map e g we sum over indices for taxon c figure 3 and equation 25 us 5 s 5 s 5 1 s us s 4 1 it is straightforward to extend all of these ideas to the n taxon case by applying an argument similar to that of corollary 3 on page 1109 in allman and rhodes 2006 24 we get the following result corollary 5 5 let csn denote the coalescent phylogenetic model for the n taxon species tree sn then the unrooted species tree sn is identifiable for generic parameters 6 generalized jukes cantor coalescent state model to show generic identifiability in theorem 5 1 we have used precise formulas for the generalized jukes cantor state model under the coalescent for a 4 taxon species tree in this section we describe computations of the jc 69 model for a symmetric and asymmetric 4 leaf species trees 27 as was mentioned in section 2 2 if we let the rates of mutation and relative frequencies of the states at equilibrium be 1 1 2 1 and 1 1 1 in equation 8 respectively then the resulting model is the mk model as described in 17 which is a generalized jukes cantor state model in addition let the proportion of invariable sites be 0 the instantaneous rate matrix q for the state jc 69 model is iq i 1 1 1 1 1 1 1 1 1 28 where is the instantaneous rate of any transition between states and i 0 is the rate of evolution at a site for category i m associated with the discrete gamma distribution the transition probability matrix p i t eq it takes the form p i ij t 1 1 e i t i j 1 1 e i t i 6 j 29 the symmetry of the jukes cantor model makes it possible to write each site pattern probability for a 4 leaf species tree concisely for any 2 6 1 site pattern probabilities gene tree consider a 4 leaf unrooted gene tree labeled as in figure 2 recall that the site pattern probability for a particular observation i 1 i 2 i 3 i 4 ij and the branch length ve e 1 2 3 4 5 is given by p i i 1 i 2 i 3 i 4 r 1 s 1 rp i ri 1 v 1 p i ri 2 v 2 p i rs v 3 p i si 3 v 4 p i si 4 v 5 30 to make notation simpler we let peii p i ii ve be the probability of no change in the state over a time interval of length ve and let p e ij p i ij ve be the probability of a state change along the edge e 1 2 3 4 5 with length ve then the probability of the pattern xxxx where x is p i xxxx 1 p 1 iip 2 iip 3 iip 4 iip 5 ii 1 p 1 iip 2 iip 3 ijp 4 ijp 5 ij 1 p 1 ijp 2 ijp 3 ijp 4 iip 5 ii 31 1 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 1 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij 28 indeed this is easily computed by observing that when r s x in equation 30 then we will have exactly one term of the form p 1 iip 2 iip 3 iip 4 iip 5 ii for r s 6 x we will have 1 terms of the form p 1 ijp 2 ijp 3 iip 4 ijp 5 ij the other three cases for r 6 s are as follows r x and s r then we have 1 terms of the form p 1 iip 2 iip 3 ijp 4 ijp 5 ij s x and r s then we have 1 terms of the form p 1 ijp 2 ijp 3 ijp 4 iip 5 ii r s 6 x then we have 1 2 terms of the form p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij the complete list of all site pattern probabilities on the single gene tree can be found in the supplement a 6 2 site pattern probabilities species tree now we are ready to describe computations for two 4 leaf species trees the symmetric tree a b c d and the asymmetric tree a b c d under the generalized jc 69 coalescent state model for these species trees we have 25 gene tree pairs g t for a symmetric species tree and 34 gene tree pairs g t for an asymmetric species tree vectors 1 2 3 and t t 1 t 2 t 3 denote speciation and coalescent times respectively the gene tree g t in figure 1 a call it ga t is symmetric and is in agreement with the tree s it has one coalescent event happening along the branch of length 3 1 and two other events above the root of the symmetric species tree s in contrast the gene tree in figure 1 b call it gb t is asymmetric with lineages a and c being sister leaves and all coalescent events happening above the root of the asymmetric species tree s using equation 7 we compute the gene tree densities for ga t and gb t gene tree density for ga t f ga t s 2 3 e 2 t 1 e 6 t 2 e 2 t 3 t 2 e 2 3 1 29 gene tree density for gb t f gb t s 2 3 e 2 2 1 e 6 3 2 e 12 t 1 e 6 t 2 t 1 e 2 t 3 t 2 the site pattern probability for the pattern xxxx and gene trees ga t and gb t on symmet ric figure 1 a and asymmetric figure 1 b species trees is now easily computed by appropriately substituting gene tree branch lengths as listed in figure 1 into equations 29 30 and 31 multiplied by the gene tree density function and integrated with respect to t notice the different limits of integration for each gene tree as was mentioned previously the limits depend on the location of coalescent events figure 1 a p i xxxx ga t s 0 t 3 0 3 2 0 p i xxxx ga t f ga t s dt 1 dt 2 dt 3 figure 1 b p i xxxx gb t s 0 t 3 0 t 2 0 p i xxxx gb t f gb t s dt 1 dt 2 dt 3 we perform these computations for all 25 gene tree pairs for the symmetric species tree and for all 34 pairs for the asymmetric species tree sum them up and arrive at the following site pattern probabilities for observation xxxx the complete list for all patterns can be found in supplement a we list site pattern probabilities in the parameterized form for a cleaner output for each i 1 2 3 let xi e i then 1 symmetric species 4 leaf tree p i xxxx s 1 4 1 x 2 i 1 4 1 i 1 x 2 i 2 4 1 i 1 2 x 2 i 1 x 2 i 2 4 1 i 2 4 1 x 2 i 3 4 1 i 4 2 1 x i 1 x 2 i 3 4 1 i 2 i 4 2 1 x i 2 x 2 i 3 4 1 i 2 i 4 2 2 1 x i 1 x i 2 x 2 i 3 4 1 i 2 i 2 2 1 i i 1 i x 2 1 x 2 2 x 4 i 1 3 4 1 i 2 2 i 2 3 i 30 2 asymmetric species 4 leaf tree p i xxxx s 1 4 1 x 2 i 1 4 1 i 2 1 x 2 i 2 4 1 i 2 2 1 x i 1 x 2 i 2 4 1 i 2 i 3 1 x 2 i 3 4 1 i 2 2 1 x i 1 x 2 i 3 4 1 i 2 i 1 2 x 2 i 1 x 2 i 3 4 1 i 2 4 2 1 x i 2 x 2 i 3 4 1 i 2 i 4 2 2 1 x i 1 x i 2 x 2 i 3 4 1 i 2 i 2 2 1 i k i k 1 i x 2 1 x 2 i 1 2 x 2 i 3 4 1 i 2 2 i 2 3 i 7 species tree inference the results presented here can be used to develop methodology for inferring species trees given dna sequence data at the tips of the tree in cases where the coalescent model is appropriate indeed we have recently developed and done some preliminary testing with one such method 34 and we briefly describe the basic ideas behind the method here these ideas are modeled after the work of eriksson 35 for the single gene case in particular consider a data set consisting of r unlinked single nucleotide polymorphisms snps for a collection of n species each snp site is assumed to have its own gene tree and by unlinked we mean that snps on the same chromosome are located far enough apart that their gene trees are independent given the species tree in other words we assume a data set of r observations arising under the model in expression 15 for a given subset of four species from the n species under study we can consider the three possible splits and their associated flattenings in the empirical setting we do not observe the flattening matrices but these matrices can be estimated using the counts of the observed site patterns in the r data points the question of interest is then which of the three possible splits gives a flattening that is closest to a rank 10 matrix the relevant rank is 10 because 4 for dna sequence data and 4 1 2 10 to assess this we compute the distance to the nearest rank 10 matrix in the frobenius norm by defining the svd score for a split l 1 l 2 svd l 1 l 2 to be svd l 1 l 2 16 i 11 2 i 32 where i are the singular values of flatl 1 l 2 p for i 11 16 and flatl 1 l 2 p refers to the flattening matrix for the split l 1 l 2 estimated from the data the split yielding the smallest 31 score of the three possible splits can be inferred to be the valid split for the collection of four taxa we show 34 that the svd score has good ability to infer the correct split under a variety of conditions we note also that although the results presented in this paper apply to unlinked snp data many existing data sets consist of collections of genes for which the entire dna sequence is available for each species this setting is different than that considered here in that each site in the dna sequence for a specific gene is generally assumed to have arisen from the same gene tree when the number of genes is large these multi locus data sets will approximately satisfy the model and we expect that the inference method proposed here will still perform well we tested this using simulation 34 and found that the method was still very effective at distinguishing the valid split to estimate the entire species tree our proposed algorithm works by sampling collections of four taxa at random from those included in the data set for each sampled collection of four taxa the valid split is inferred by computation of the svd score for the three possible splits the collection of valid four taxon splits can then be used in a quartet assembly algorithm to construct the species tree many possible algorithms for quartet assembly have been proposed 36 37 38 we find that the method of snir and rao 2010 38 is a fast and effective technique for constructing the species tree estimate from the collection of inferred splits based on the good performance of this method in our initial study we are currently working on expanding the scope of the data sets to which it can be applied in particular we will consider data sets for which i multiple individuals are sampled within a species ii there are ambiguities in the observed nucleotide at a site and iii sequence data other than dna such as codon or amino acid data have been collected overall the method shows good promise in addressing this important problem in phylogenetic inference under the coalescent process and we believe that it can be effectively used for practical phylogenetic inference 8 conclusions within the last 15 years numerous methods for inferring species level phylogenies from genome scale data have been proposed and several are commonly used in empirical practice e g 6 7 8 9 10 however identifiability of the species tree from sequence data has never been formally established we have shown here that the unrooted n taxon species tree topology is identifiable 32 from the distribution of site pattern probabilities under the coalescent model with a general state time reversible substitution model for the mutational process that allows for a proportion of sites to be invariable and that allows for rate variation across sites under a discrete gamma model this is an important step in understanding phylogenetic estimation under more complicated models of dna sequence evolution and it has already led to the development of a promising new method for inference 34 several important problems in this area remain to be addressed for example open questions include whether the root of the species tree is identifiable and whether other parameters in the species tree e g branch lengths and effective population sizes and in the substitution model e g parameters in the transition probability matrix are identifiable under the model we consider these questions in future work 9 acknowledgements we thank elizabeth allman for helpful comments on an earlier draft of this manuscript and an anonymous reviewer who noticed that our method of proof covered the case of models for site specific rate variation we acknowledge support from the national science foundation under award dms 1106706 to j c and l k from the mathematical biosciences institute at the ohio state university j c and l k and from nih cancer biology training grant t 32 ca 079448 at wake forest school of medicine j c both authors contributed equally to this work 33 references 1 w p maddison gene trees in species trees syst biol 46 1997 523 536 2 p pamilo m nei relationships between gene trees and species trees mol biol evol 5 5 1988 568 583 3 j f c kingman on the genealogy of large populations j appl prob 19 a 1982 27 43 4 j f c kingman the coalescent stoch proc appl 13 1982 235 248 5 s tavare line of descent and genealogical processes and their applications in population genetics models theor popul biol 26 1984 119 164 6 l liu d pearl species trees from gene trees reconstructing bayesian posterior distributions of a species phylogeny using estimated gene tree distributions syst biol 56 2007 504 514 7 j heled a j drummond bayesian inference of species trees from multilocus data mol biol evol 27 3 2010 570 580 8 l s kubatko b c carstens l l knolwes stem species tree estimation using maximum likelihood for gene trees under coalescence bioinformatics 25 7 2009 971 973 9 l liu l yu s edwards a maximum pseudo likelihood approach for estimating species trees under the coalescent model bmc evol biol 10 302 10 d bryant r bouckaert j felsenstein n rosenberg a roychoudhury inferring species trees directly from biallelic genetic markers bypassing gene trees in a full coalescent analysis mol biol evol 29 8 2012 1917 1932 11 e s allman j h degnan j a rhodes identifying the rooted species tree from the distribution of unrooted gene trees under the coalescent j math biol 62 2011 833 862 12 e s allman j h degnan j a rhodes determining species tree topologies from clade probabilities under the coalescent j theoret biol 289 2011 96 106 doi 10 1016 j jtbi 2011 08 006 url http dx doi org 10 1016 j jtbi 2011 08 006 13 l liu s v edwards phylogenetic analysis in the anomaly zone systematic biology 58 4 2009 452 460 14 s tavare some probabilistic and statistical problems in the analysis of dna sequences lectures on mathe matics in the life sciences american mathematical society 17 1986 57 86 15 b rannala z yang likelihood and bayes estimation of ancestral population sizes in hominoids using data from multiple loci genetics 164 2003 1645 1656 16 t jukes c r cantor evolution of protein molecules in h n munro ed mammalian protein metabolism academic press new york 1969 pp 21 123 17 p o lewis a likelihood approach to estimating phylogeny from discrete morphological character data sys tematic biology 50 6 2001 913 925 doi 10 1080 106351501753462876 18 m kimura a simple method for estimating evolutionary rate of base substitution through comparative studies of nucleotide sequences j mol evol 16 1980 111 120 19 j felsenstein evolutionary trees from dna sequences a maximum likelihood approach j mol evol 17 6 1981 368 76 20 m hasegawa h kishino t yano dating of human ape splitting by a molecular clock of mitochondrial dna http dx doi org 10 1016 j jtbi 2011 08 006 http dx doi org 10 1016 j jtbi 2011 08 006 http dx doi org 10 1016 j jtbi 2011 08 006 http dx doi org 10 1016 j jtbi 2011 08 006 http dx doi org 10 1080 106351501753462876 journal of molecular evolution 22 2 1985 160 174 21 k tamura m nei estimation of the number of nucleotide substitutions in the control region of mitochondrial dna in humans and chimpanzees mol biol evol 10 3 1993 512 526 22 z yang maximum likelihood estimation of phylogeny from dna sequences when substitution rates differ over sites molecular biology and evolution 10 1993 1396 1401 23 z yang maximum likelihood phylogenetic estimation from dna sequences with variable rates over sites approximate methods journal of molecular evolution 39 3 1994 306 314 doi 10 1007 bf 00160154 url http dx doi org 10 1007 bf 00160154 24 e s allman j a rhodes the identifiability of tree topology for phylogenetic models including covarion and mixture models journal of computational biology 13 5 2006 1101 1113 25 e s allman c ane j a rhodes identifiability of a markovian model of molecular evolution with gamma distributed rates advances in applied probability 40 2008 228 249 26 e s allman j a rhodes identifying evolutionary trees and substitution parameters for the general markov model with invariable sites mathematical biosciences 211 2008 18 33 27 j a lake a rate independent technique for analysis of nucleic acid sequences evolutionary parsimony molecular biology and evolution 4 2 1987 167 191 28 j a cavender mechanized derivation of linear invariants molecular biology and evolution 6 3 1989 301 316 29 y fu w li construction of linear invariants in phylogenetic inference mathematical biosciences 109 2 1992 201 228 30 y fu linear invariants under jukes and cantor s one parameter model journal of theoretical biology 173 4 1995 339 352 31 e s allman j a rhodes the identifiability of covarion models in phylogenetics ieee acm transactions in computational biology and bioinformatics 6 2009 76 88 32 e s allman s petrovic j a rhodes s sullivant identifiability of 2 tree mixtures for group based models ieee acm transactions in computational biology and bioinformatics 8 3 2011 710 722 33 r gunning h rossi analytic functions of several complex variables ams chelsea publishing ams chelsea pub 2009 url http books google com books id l 0 zjmamx 5 aac 34 j chifman l kubatko quartet inference from snp data under the coalescent model bioinformatics 30 23 2014 3317 3324 doi 10 1093 bioinformatics btu 53 35 n eriksson tree construction using singular value decomposition in l pachter b sturmfels eds alge braic statistics for computational biology cambridge university press 2005 ch 19 pp 347 358 36 k strimmer a von haeseler quartet puzzling a quartet maximum likelihood method for reconstructing tree topologies mol biol evol 13 1996 964 969 37 k strimmer n goldman a von haeseler bayesian probabilities and quartet puzzling mol biol evol 14 1997 210 213 38 s snir s rao quartet maxcut a fast algorithm for amalgamating quartet trees mol phylogen evol 62 http dx doi org 10 1007 bf 00160154 http dx doi org 10 1007 bf 00160154 http dx doi org 10 1007 bf 00160154 http dx doi org 10 1007 bf 00160154 http books google com books id l 0 zjmamx 5 aac http books google com books id l 0 zjmamx 5 aac http dx doi org 10 1093 bioinformatics btu 53 2012 1 8 supplement a main article title identifiability of the unrooted species tree topology under the coalescent model with time reversible substitution processes site specific rate variation and invariable sites julia chifman wake forest school of medicine laura kubatko the ohio state university 1 list of site pattern probabilities for generalized jc 69 coales cent state model in this supplement we provide a list of site pattern probabilities for gene and species trees as described in section 6 of the main article 1 1 four leaf gene tree site pattern probabilities p i xxxx 1 p 1 iip 2 iip 3 iip 4 iip 5 ii 1 p 1 iip 2 iip 3 ijp 4 ijp 5 ij 1 p 1 ijp 2 ijp 3 ijp 4 iip 5 ii 1 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 1 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i xxxy 1 p 1 iip 2 iip 3 iip 4 iip 5 ij p 1 iip 2 iip 3 ijp 4 ijp 5 ii p 1 ijp 2 ijp 3 iip 4 ijp 5 ii 2 p 1 iip 2 iip 3 ijp 4 ijp 5 ij 1 p 1 ijp 2 ijp 3 ijp 4 iip 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ii 2 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i xxyx 1 p 1 iip 2 iip 3 iip 4 ijp 5 ii p 1 iip 2 iip 3 ijp 4 iip 5 ij p 1 ijp 2 ijp 3 iip 4 iip 5 ij 2 p 1 iip 2 iip 3 ijp 4 ijp 5 ij 1 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ii 2 p 1 ijp 2 ijp 3 ijp 4 iip 5 ij 2 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i xyxx 1 p 1 iip 2 ijp 3 iip 4 iip 5 ii p 1 ijp 2 iip 3 ijp 4 iip 5 ii p 1 ijp 2 iip 3 iip 4 ijp 5 ij 2 p 1 ijp 2 iip 3 ijp 4 ijp 5 ij 1 p 1 iip 2 ijp 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 iip 5 ii 2 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i yxxx 1 p 1 ijp 2 iip 3 iip 4 iip 5 ii p 1 iip 2 ijp 3 ijp 4 iip 5 ii p 1 iip 2 ijp 3 iip 4 ijp 5 ij 2 p 1 iip 2 ijp 3 ijp 4 ijp 5 ij 1 p 1 ijp 2 iip 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 iip 5 ii 2 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i xxyy 1 p 1 iip 2 iip 3 iip 4 ijp 5 ij p 1 ijp 2 ijp 3 iip 4 iip 5 ii p 1 iip 2 iip 3 ijp 4 iip 5 ii 2 p 1 iip 2 iip 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 iip 5 ii 2 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 3 3 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij 1 p i xyxy 1 p 1 iip 2 ijp 3 iip 4 iip 5 ij p 1 iip 2 ijp 3 ijp 4 ijp 5 ii p 1 ijp 2 iip 3 ijp 4 iip 5 ij p 1 ijp 2 iip 3 iip 4 ijp 5 ii 2 p 1 iip 2 ijp 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 iip 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 iip 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ii 2 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 3 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i yxxy 1 p 1 iip 2 ijp 3 iip 4 ijp 5 ii p 1 iip 2 ijp 3 ijp 4 iip 5 ij p 1 ijp 2 iip 3 ijp 4 ijp 5 ii p 1 ijp 2 iip 3 iip 4 iip 5 ij 2 p 1 iip 2 ijp 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 iip 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 iip 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ii 2 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 3 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i xxyz 1 p 1 iip 2 iip 3 iip 4 ijp 5 ij p 1 iip 2 iip 3 ijp 4 iip 5 ij p 1 iip 2 iip 3 ijp 4 ijp 5 ii p 1 ijp 2 ijp 3 iip 4 iip 5 ij p 1 ijp 2 ijp 3 iip 4 ijp 5 ii 3 p 1 iip 2 iip 3 ijp 4 ijp 5 ij 3 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ii 2 p 1 ijp 2 ijp 3 ijp 4 iip 5 ij 2 4 5 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i yzxx 1 p 1 ijp 2 ijp 3 iip 4 iip 5 ii p 1 iip 2 ijp 3 ijp 4 iip 5 ii p 1 iip 2 ijp 3 iip 4 ijp 5 ij p 1 ijp 2 iip 3 ijp 4 iip 5 ii p 1 ijp 2 iip 3 iip 4 ijp 5 ij 3 p 1 ijp 2 ijp 3 ijp 4 iip 5 ii 3 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 p 1 iip 2 ijp 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 iip 3 ijp 4 ijp 5 ij 2 4 5 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i xyxz 1 p 1 iip 2 ijp 3 iip 4 iip 5 ij p 1 iip 2 ijp 3 ijp 4 ijp 5 ii p 1 ijp 2 iip 3 ijp 4 iip 5 ij p 1 ijp 2 iip 3 iip 4 ijp 5 ij p 1 ijp 2 iip 3 ijp 4 ijp 5 ii p 1 ijp 2 ijp 3 iip 4 ijp 5 ii 2 p 1 iip 2 ijp 3 ijp 4 ijp 5 ij 2 p 1 ijp 2 ijp 3 ijp 4 iip 5 ij 3 p 1 ijp 2 iip 3 ijp 4 ijp 5 ij 3 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ii 3 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 5 7 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i yxxz 1 p 2 iip 1 ijp 3 iip 4 iip 5 ij p 2 iip 1 ijp 3 ijp 4 ijp 5 ii p 2 ijp 1 iip 3 ijp 4 iip 5 ij p 2 ijp 1 iip 3 iip 4 ijp 5 ij p 2 ijp 1 iip 3 ijp 4 ijp 5 ii p 2 ijp 1 ijp 3 iip 4 ijp 5 ii 2 p 2 iip 1 ijp 3 ijp 4 ijp 5 ij 2 p 2 ijp 1 ijp 3 ijp 4 iip 5 ij 3 p 2 ijp 1 iip 3 ijp 4 ijp 5 ij 3 p 2 ijp 1 ijp 3 ijp 4 ijp 5 ii 3 p 2 ijp 1 ijp 3 iip 4 ijp 5 ij 2 5 7 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i xyzx 1 p 1 iip 2 ijp 3 iip 5 iip 4 ij p 1 iip 2 ijp 3 ijp 5 ijp 4 ii p 1 ijp 2 iip 3 ijp 5 iip 4 ij p 1 ijp 2 iip 3 iip 5 ijp 4 ij p 1 ijp 2 iip 3 ijp 5 ijp 4 ii p 1 ijp 2 ijp 3 iip 5 ijp 4 ii 2 p 1 iip 2 ijp 3 ijp 5 ijp 4 ij 2 p 1 ijp 2 ijp 3 ijp 5 iip 4 ij 3 p 1 ijp 2 iip 3 ijp 5 ijp 4 ij 3 p 1 ijp 2 ijp 3 ijp 5 ijp 4 ii 3 p 1 ijp 2 ijp 3 iip 5 ijp 4 ij 2 5 7 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i yxzx 1 p 2 iip 1 ijp 3 iip 5 iip 4 ij p 2 iip 1 ijp 3 ijp 5 ijp 4 ii p 2 ijp 1 iip 3 ijp 5 iip 4 ij p 2 ijp 1 iip 3 iip 5 ijp 4 ij p 2 ijp 1 iip 3 ijp 5 ijp 4 ii p 2 ijp 1 ijp 3 iip 5 ijp 4 ii 2 p 2 iip 1 ijp 3 ijp 5 ijp 4 ij 2 p 2 ijp 1 ijp 3 ijp 5 iip 4 ij 3 p 2 ijp 1 iip 3 ijp 5 ijp 4 ij 3 p 2 ijp 1 ijp 3 ijp 5 ijp 4 ii 3 p 2 ijp 1 ijp 3 iip 5 ijp 4 ij 2 5 7 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij p i xyzw 1 p 1 iip 2 ijp 3 iip 4 ijp 5 ij p 1 iip 2 ijp 3 ijp 4 iip 5 ij p 1 iip 2 ijp 3 ijp 4 ijp 5 ii p 1 ijp 2 iip 3 iip 4 ijp 5 ij p 1 ijp 2 iip 3 ijp 4 iip 5 ij p 1 ijp 2 iip 3 ijp 4 ijp 5 ii p 1 ijp 2 ijp 3 iip 4 iip 5 ij p 1 ijp 2 ijp 3 iip 4 ijp 5 ii 3 p 1 iip 2 ijp 3 ijp 4 ijp 5 ij 3 p 1 ijp 2 iip 3 ijp 4 ijp 5 ij 3 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ii 3 p 1 ijp 2 ijp 3 ijp 4 iip 5 ij 4 p 1 ijp 2 ijp 3 iip 4 ijp 5 ij 2 5 8 p 1 ijp 2 ijp 3 ijp 4 ijp 5 ij 2 1 2 symmetric four leaf species tree each site pattern probability for a symmetric species 4 leaf tree will be of the following form p i i 1 i 2 i 3 i 4 s c 0 c 1 x 2 i 1 c 2 x 2 i 2 c 3 x 2 i 1 x 2 i 2 c 4 x 2 i 3 c 5 x i 1 x 2 i 3 c 6 x i 2 x 2 i 3 c 7 x i 1 x i 2 x 2 i 3 c 8 x 2 1 x 2 2 x 4 i 1 3 where xi e i i 1 2 3 is the number of states 0 is the effective population size and 0 is the instantaneous rate of any transition between states table 1 lists all the coefficients ci for each pattern under the molecular clock assumption rooted balanced 4 leaf species tree a b c d will have 9 distinct site patterns probabilities p i xxxx p i xxxy p i xxyx p i xyxx p i yxxx p i xyxy p i yxxy p i xxyy p i xyxz p i yxxz p i xyzx p i yxzx p i xxyz p i yzxx p i xyzw table 1 coefficients for site pattern probabilities symmetric species 4 leaf tree xxxx xxxy xyxx c 0 1 4 1 4 1 4 c 1 1 4 1 i 1 4 1 i 1 4 1 i c 2 1 4 1 i 1 4 1 i 1 4 1 i c 3 1 2 4 1 i 2 1 4 1 i 2 1 4 1 i 2 c 4 4 1 4 1 i 2 2 4 1 i 2 2 4 1 i c 5 4 2 1 4 1 i 2 i 4 2 4 1 i 2 i 2 2 2 4 1 i 2 i c 6 4 2 1 4 1 i 2 i 2 2 2 4 1 i 2 i 4 2 4 1 i 2 i c 7 4 2 2 1 4 1 i 2 i 2 4 2 2 4 1 i 2 i 2 4 2 2 4 1 i 2 i 2 c 8 2 1 i i 1 i 4 1 i 2 2 i 2 3 i 2 i i 1 i 4 1 i 2 2 i 2 3 i 2 i i 1 i 4 1 i 2 2 i 2 3 i xyxy xxyy xxyz c 0 1 4 1 4 1 4 c 1 1 4 1 i 1 4 1 i 1 4 1 i c 2 1 4 1 i 1 4 1 i 1 4 1 i c 3 1 4 1 i 2 1 2 4 1 i 2 1 4 1 i 2 c 4 2 2 4 1 i 4 4 1 i 4 4 1 i c 5 4 2 4 1 i 2 i 4 2 4 1 i 2 i 8 4 1 i 2 i c 6 4 2 4 1 i 2 i 4 2 4 1 i 2 i 4 2 4 1 i 2 i c 7 8 2 4 1 i 2 i 2 4 2 2 4 1 i 2 i 2 8 2 4 1 i 2 i 2 c 8 i 2 2 3 2 i 2 2 i 2 2 4 1 i 2 2 i 2 3 i 2 i i 2 4 1 i 2 2 i 2 3 i 2 i 2 2 i 4 1 i 2 2 i 2 3 i 3 yzxx xyzx xyzw c 0 1 4 1 4 1 4 c 1 1 4 1 i 1 4 1 i 1 4 1 i c 2 1 4 1 i 1 4 1 i 1 4 1 i c 3 1 4 1 i 2 1 4 1 i 2 1 4 1 i 2 c 4 4 4 1 i 4 4 1 i 4 4 1 i c 5 4 2 4 1 i 2 i 2 4 4 1 i 2 i 8 4 1 i 2 i c 6 8 4 1 i 2 i 2 4 4 1 i 2 i 8 4 1 i 2 i c 7 8 2 4 1 i 2 i 2 4 4 4 1 i 2 i 2 16 4 1 i 2 i 2 c 8 2 i 2 2 i 4 1 i 2 2 i 2 3 i i 2 2 2 i 4 1 i 2 2 i 2 3 i 2 i 3 3 4 1 i 2 2 i 2 3 i one checks that for all observations i i 1 i 2 i 3 i 4 ij i p i i s p i xxxx 2 1 p i xxxy 2 1 p i xyxx 1 p i xxyy 2 1 p i xyxy 1 2 p i xxyz 4 1 2 p i xyxz 1 2 p i yzxx 1 2 3 p i xyzw 1 1 3 asymmetric four leaf species tree each site pattern probability for a asymmetric species 4 leaf tree will be of the following form p i i 1 i 2 i 3 i 4 s c 0 c 1 x 2 i 1 c 2 x 2 i 2 c 3 x i 1 x 2 i 2 c 4 x 2 i 3 c 5 x i 1 x 2 i 3 c 6 x 2 i 1 x 2 i 3 c 7 x i 2 x 2 i 3 c 8 x i 1 x i 2 x 2 i 3 c 9 x 2 1 x 2 i 1 2 x 2 i 3 where xi e i i 1 2 3 is the number of states 0 is the effective population size and 0 is the instantaneous rate of any transition between states table 2 lists all the coefficients ci for each pattern under the molecular clock assumption rooted asymmetric 4 leaf species tree a b c d will have 11 distinct site patterns probabilities p i xxxx p i xxxy p i xxyx p i xyxx p i yxxx p i xyxy p i yxxy p i xxyy p i xyxz p i xyzx p i yxxz p i yxzx p i xxyz p i yzxx p i xyzw 4 table 2 coefficients for site pattern probabilities asymmetric species 4 leaf tree xxxx xxxy xyxx yxxx c 0 1 4 1 4 1 4 1 4 c 1 1 4 1 i 1 4 1 i 1 4 1 i 1 4 1 i c 2 2 1 4 1 i 2 4 1 i 2 4 1 i 2 1 4 1 i c 3 2 1 2 4 1 i 2 i 2 2 4 1 i 2 i 2 2 4 1 i 2 i 2 1 2 4 1 i 2 i c 4 3 1 4 1 i 2 3 4 1 i 2 3 4 1 i 3 4 1 i c 5 2 2 1 4 1 i 2 i 2 2 4 1 i 2 i 2 2 1 4 1 i 2 i 2 2 4 1 i 2 i c 6 1 2 4 1 i 2 1 4 1 i 2 1 4 1 i 2 1 4 1 i 2 c 7 4 2 1 4 1 i 2 i 2 2 2 4 1 i 2 i 4 2 4 1 i 2 i 4 2 4 1 i 2 i c 8 4 1 2 2 4 1 i 2 i 2 4 2 2 4 1 i 2 i 2 4 2 2 4 1 i 2 i 2 4 2 2 4 1 i 2 i 2 c 9 2 1 i i 1 i 4 1 i 2 2 i 2 3 i 2 i i 1 i 4 1 i 2 2 i 2 3 i 2 i i 1 i 4 1 i 2 2 i 2 3 i 2 i i 1 i 4 1 i 2 2 i 2 3 i 5 xxyy xyxy xxyz yzxx c 0 1 4 1 4 1 4 1 4 c 1 1 4 1 i 1 4 1 i 1 4 1 i 1 4 1 i c 2 2 4 1 i 2 4 1 i 2 4 1 i 2 4 1 i c 3 2 2 4 1 i 2 i 2 2 4 1 i 2 i 4 4 1 i 2 i 2 2 4 1 i 2 i c 4 3 4 1 i 3 4 1 i 3 4 1 i 3 4 1 i c 5 2 2 4 1 i 2 i 2 2 4 1 i 2 i 4 4 1 i 2 i 2 2 4 1 i 2 i c 6 1 2 4 1 i 2 1 4 1 i 2 1 4 1 i 2 1 4 1 i 2 c 7 4 2 4 1 i 2 i 4 2 4 1 i 2 i 4 2 4 1 i 2 i 8 4 1 i 2 i c 8 4 2 2 4 1 i 2 i 2 8 2 4 1 i 2 i 2 8 2 4 1 i 2 i 2 8 2 2 4 1 i 2 i 2 c 9 2 i i 2 4 1 i 2 2 i 2 3 i i 2 2 3 2 i 2 2 i 2 2 4 1 i 2 2 i 2 3 i 2 i 2 2 i 4 1 i 2 2 i 2 3 i 2 i 2 2 i 4 1 i 2 2 i 2 3 i 6 xyxz yxxz xyzw c 0 1 4 1 4 1 4 c 1 1 4 1 i 1 4 1 i 1 4 1 i c 2 2 4 1 i 2 4 1 i 2 4 1 i c 3 4 4 1 i 2 i 2 2 4 1 i 2 i 4 4 1 i 2 i c 4 3 4 1 i 3 4 1 i 3 4 1 i c 5 2 2 4 1 i 2 i 4 4 1 i 2 i 4 4 1 i 2 i c 6 1 4 1 i 2 1 4 1 i 2 1 4 1 i 2 c 7 2 4 4 1 i 2 i 2 4 4 1 i 2 i 8 4 1 i 2 i c 8 4 4 4 1 i 2 i 2 4 4 4 1 i 2 i 2 16 4 1 i 2 i 2 c 9 i 2 2 2 i 4 1 i 2 2 i 2 3 i i 2 2 2 i 4 1 i 2 2 i 2 3 i 2 i 3 3 4 1 i 2 2 i 2 3 i one checks that for all observations i i 1 i 2 i 3 i 4 ij i p i i s p i xxxx 2 1 p i xxxy 1 p i xyxx 1 p i yxxx 1 p i xxyy 2 1 p i xyxy 1 2 p i xxyz 2 1 2 p i xyxz 2 1 2 p i yxxz 1 2 p i yzxx 1 2 3 p i xyzw 1 7 mathematica i for ease of notation we will use in place of i in addition recall that in the proof of theorem 5 1 we set 3 2 this implies that the asymmetric species tree will coincide with the symmetric species tree i e site patterns will be the same thus below we list only site patterns probabilities for a symmetric species tree with parameter choices made in our proof and 0 all site patterns pijkl 0 2 mathematica supplemental file nb computations below demonstrate that all principal minors of a matrix f are positive for 0 which establishes that f is positive definite see main article and the proof of theorem 5 1 for the definition of the matrix f define principal submatrices of the matrix m 4 f first we compute principal minors m 1 m 2 m 3 and m 4 mathematica supplemental file nb 3 from the above computations it is clear that m 1 pxxxx 0 and det m 4 0 for any real 0 next we rewrite determinants for m 2 and m 3 4 mathematica supplemental file nb notice that each of the expressions above will be positive for all real numbers 0 if terms in parenthe ses which are the sums of exponential functions are all greater than zero on the same interval it is a straightforward exercise to see that terms in parenthesis are all positive for 0 0 0 0 0 0 0 to be more convincing we also use reduce function to compute intervals on which these terms are positive mathematica supplemental file nb 5 now we can rewrite det m 2 and det m 3 as follows now it is quite obvious that d 2 and d 3 are strictly positive for any real 0 one also checks that d 2 and d 3 are equivalent to det m 2 and det m 3 respectively 0 10 20 30 40 50 0 00 0 05 0 10 0 15 0 20 0 25 0 30 m 1 6 mathematica supplemental file nb 0 10 20 30 40 50 60 70 0 000 0 005 0 010 0 015 m 2 0 10 20 30 40 50 0 0000 0 0002 0 0004 0 0006 0 0008 m 3 0 10 20 30 40 50 0 00000 0 00005 0 00010 0 00015 m 4 mathematica supplemental file nb 7 computations below demonstrate that all principal minors of a matrix f are positive for 0 which establishes that f is positive definite see main article and the proof of theorem 5 1 for the definition of the matrix f define matrix f call it a principal 6 x 6 submatrix f is highlighted in blue call it b next we show that b is strictly diagonally dominant all row sums of matrix b are the same 8 mathematica supplemental file nb we would like to show that h 2 0 on some interval 0 n for positive real number n notice that h 2 is continuous for all real numbers 0 the computation of real zeros of h 2 and the graph of the function indicate that h 2 0 for 0 8 0 2 4 6 8 0 000 0 002 0 004 0 006 0 008 0 010 h 2 next we compute det a symbolically and then substitute site pattern probabilities mathematica supplemental file nb 9 there are several products of functions in the above expression two of them are clearly positive for any real number 0 they are listed below 0 and 0 10 mathematica supplemental file nb we have to check if the other three products are positive first we define them as p 0 p 1 and p 2 mathematica supplemental file nb 11 by rewriting p 0 one can easily see that p 0 0 for any real number 0 next collect and simplify p 1 notice that expression below will be positive for all real numbers 0 if terms in parentheses which are the sums of exponential functions are all greater than zero on the same interval it is easy to see that these terms are positive for 0 0 0 0 to be more convincing we also use reduce function to compute intervals on which these terms are positive thus we see that p 1 0 for any real 0 12 mathematica supplemental file nb next we collect and simplify p 2 and investigate if functions in parentheses which are the sums of exponential functions are positive for all real numbers 0 use reduce function to compute intervals on which these terms are positive mathematica supplemental file nb 13 14 mathematica supplemental file nb this computations show that p 2 0 for 0 this implies that det a 0 for any real 0 since the matrix b is diagonally dominant and it is symmetric with positive entries for 0 8 then it is positive definite this means that all principal minors of b are positive on the interval 0 8 in addition det a 0 for any real 0 therefore we conclude that the matrix a is positive definite and invertible for 0 8 we show that for our choice of parameters pxxyy pxyxy k 2 pxxyz 2 pxyxz pyzxx k 3 pxyzw 0 which establishes that f is strictly diagonally dominant and hence generically invertible one can see that the expression simplifies into the following form f 1 k 2 f 2 k 3 f 3 k 4 mathematica supplemental file nb 15 we would like to show that there is an interval 0 n for some positive real number n on which f i 0 notice that fi are continuous for all real numbers 0 the computation of real zeros of f 1 the interval on which it is positive and the graph of the function indicate that f 1 0 for 0 2 0 0 0 5 1 0 1 5 2 0 0 00 0 01 0 02 0 03 0 04 f 1 16 mathematica supplemental file nb next we simplify and collect like terms of f 2 and investigate if functions in parentheses are positive for all real numbers 0 the above equivalent expression for f 2 is a sum of functions it is clear that f 2 will be positive if the terms in parentheses which are the sums of exponential functions are positive for 0 but it is easy to see that those terms are greater than zero for any real number 0 0 0 0 0 0 mathematica supplemental file nb 17 to be more convincing we also use reduce function to compute intervals on which these terms are positive this computations show that f 2 0 for any real number 0 below is the graph of f 2 0 20 40 60 80 100 120 140 0 0 0 5 1 0 1 5 2 0 f 2 18 mathematica supplemental file nb now we repeat same procedure for f 3 the above equivalent expression for f 3 is a sum of functions it is clear that f 3 will be positive if the terms in parentheses which are the sums of exponential functions are positive for 0 it is easy to see that those terms are greater than zero for 0 0 0 0 0 0 mathematica supplemental file nb 19 to be more convincing we also use reduce function to compute intervals on which these terms are positive this computations show that f 3 0 for any real number 0 below is the graph f 3 0 50 100 150 200 0 0 0 5 1 0 1 5 2 0 f 3 thus we see that f 1 k 2 f 2 k 3 f 3 k 4 0 for any real number in the 0 2 interval we conclude that f is strictly diagonally dominant and hence positive definite for 0 2 20 mathematica supplemental file nb 1 introduction 2 background 2 1 the coalescent process 2 2 the mutation process 3 the site pattern probability distribution under the coalescent model 3 1 a few remarks about embedded gene trees within a species tree 4 splits flattenings invariants and identifiability background 5 main results 6 generalized jukes cantor coalescent state model 6 1 site pattern probabilities gene tree 6 2 site pattern probabilities species tree 7 species tree inference 8 conclusions 9 acknowledgements