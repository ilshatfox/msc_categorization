ar x iv 1 20 5 46 51 v 2 qu an t ph 2 7 m ay 2 01 2 optimal representation of the bath response function fast calculation of influence functional coefficients in open quantum systems with bathfit 1 nikesh s dattani 1 david m wilkins 1 and felix a pollock 2 1 physical and theoretical chemistry laboratory department of chemistry university of oxford oxford ox 1 3 qz uk 2 clarendon laboratory department of physics university of oxford oxford ox 1 3 pu uk dated september 3 2018 today s most popular techniques for accurately calculating the dynamics of the reduced density operator in an open quantum system either require or gain great computational benefits from representing the bath response function t in the form t k k pk e k t for some of these techniques the number of terms k in the series plays the lead role in the computational cost of the calculation and is therefore often a limiting factor in simulating open quantum system dynamics we present an open source matlab program called bathfit 1 whose input is any spectral distribution function j or bath response function and whose output attempts to be the set of parameters pk k kk 1 such that for a given value of k the series k k pk e k t is as close as possible to t this should allow the user to represent t as accurately as possible with as few parameters as possible the program executes non linear least squares fitting and for a very wide variety of forms for the spectral distribution function competent starting values are used for these fits for most forms of j these starting values and the exact t corresponding to the given j are calculated using the recent pad decomposition technique therefore this program can also be used to merely implement the pad decomposition for these spectral distribution functions and it can also be used just to efficiently and accurately calculate t for any given j the program also gives the j corresponding to a given t which may allow one to assess the quality in the domain of a representation of t being used finally the program can calculate the discretized influence functional coefficients for any j and this is computed very efficiently for most forms of j by implementing the recent technique published in 1 we also provide a mathematica program that can perform this last calculation along with calculating an analytic form for these discretized influence coefficients for a given analytic representation of t http arxiv org abs 1205 4651 v 2 2 it is often useful to represent the bath response function t in the form t k k pk e k t 1 setting the most popular open quantum system oqs model is currently the feynman vernon model in the feynman vernon model the oqs denoted by the operator s is coupled linearly to a set of quantum harmonic oscillators qk h hoqs hoqs bath hbath 2 hoqs c sq m q 2 m 2 q 2 3 in most models the quantum harmonic oscillators qhos span a continuous spectrum of frequencies and the strength of the coupling between the qho of frequency and the oqs is given by the spectral distribution function j j 2 c 2 m 4 for the hamiltonian of the feynman vernon model the bath response function t is the following integral transform of j t 1 0 j coth 2 cos t i sin t d 5 1 j exp 2 2 sinh 2 e i td j j 6 1 j 1 exp e i td j j 7 where equation 7 can be written in terms of the bose einstein distribution function with x fbose einstein x 1 1 exp x 8 contents non linear least squares fitting of the bath response function to the form k k pk e k t the goal is to represent t by the series k k pk e k t as accurately as necessary with as low as possible a value of k given a value of k a non linear least squares fitting algorithm can be used to represent t by that series very accurately matlab has two such algorithms implemented for easy use trust region reflective and levenberg marquardt our matlab code allows the user to choose either method this least squares fitting for a chosen value of k can then be repeated for larger values of k until the resulting r d has converged to satisfaction since the least squares fitting algorithm attempts to minimize the function t k k pk e k t with respect to the parameters pk k we call t k k pk e k t the objective function objective functions and starting values the objective function can be obtained for any spectral distribution function from equation 5 by numerical integration but for many classes of spectral distribution functions it can be obtained much faster by evaluating analytic formulas for the first three classes of spectral distribution functions below the pad decomposition scheme first described in 6 7 can already represent t by the series k k pk e k t very accurately with a small number of terms in the series so one can evaluate t k k pk e k t with larger and larger values of k until convergence is reached using the expressions for the parameters pk k given below for the fourth class of spectral distribution functions below the objective function t can be calculated very quickly with the closed form analytic expression 3 presented in that section there are obviously other spectral distribution functions for which there are closed form expressions for t or analytic series representations but the forms covered in the four subsections below are enough to represent a wide range of physically relevant spectral distributions when no closed form expression or analytic series is obtainable for the t for a particular form of j one can obtain t from equation 5 by numerical integration non linear least squares fitting algorithms also typically require starting values for the present case these are values for the parameters pk k such that t k k pk e k t is close to its global minimum with respect to pk k for the first three spectral distribution function forms below since the pad decomposition scheme mentioned above already represents t by the desired series very accurately with a small number of terms we can use the analytic expressions for pk k from this scheme given below as starting values for the non linear least squares fit we are not aware of schemes which represent t by the desired series for the final two forms of j listed below so choosing good starting values for these cases will not be as simple the final two subsections below discuss potentially useful strategies for guessing good starting values for these cases respectively although these are not expected to bring t k k pk e k t as close to its global minimum with respect to pk k as are the starting values derived from the pad decomposition for the first three cases the expressions given below were first presented in the table 1 in the apprendix of 1 spectral distribution functions of the generalized lorentz drude debye gldd form j h h h h 2 h h 2 h h 2 h h 2 9 t k k pk e k t 10 where pk k range k 1 n n 2 n 2 k 2 n 2 k i k k 2 k i k k 0 h k 1 n n 2 n 2 k 2 n 2 k i k k 2 k i k k h 1 2 h k k k 2 h k h j k k k k j 4 k k h h h h 2 k h 2 2 k 2 h 2 k k 2 h 1 k j j j k j 2 h k j j j j k here n n are the n 1 n pad parameters for the bose einstein distribution function expressions for them are given in table i spectral distribution functions of the thermally scaled generalized lorentz drude debye tgldd form j 1 tanh 2 h h h h 2 h h 2 h h 2 h h 2 11 t k k pk e k t 12 where pk k range h 2 i 2 h n n n h 2 n 2 h k i k k 0 h h 2 i 2 h n n n h 2 n 2 h k i k k h 1 2 h k k k 2 h k h j k k k k j i 4 k h h h h 2 k h 2 2 k 2 h 2 k k 2 h 1 k j j j k j 2 h k j j j j k here n n are the n 1 n pad parameters for the fermi dirac distribution function expressions for them are given in table i spectral distribution functions of the meier tanor mt form j 2 h h h 2 h h 2 2 h h 2 13 4 t k k pk e k t 14 where pk k range h 2 i 2 h n n n h 2 n 2 h k i k k 0 h h 2 i 2 h n n n h 2 n 2 h k i k k h 1 2 h k k k 2 h k h j k k k k j i 4 k h h h h 2 k h 2 2 k 2 h 2 k k 2 h 1 k j j j k j 2 h k j j j j k here n n are the n 1 n pad parameters for the bose einstein distribution function expressions for them are given in table i j a se c 15 t a s 1 s z t s z t 1 ia s 1 z t s 1 where 16 z t 1 1 c it and 17 s z ds 1 dzs 1 ln z 18 for s n 0 ie if s is a non negative integer our definition of s z in equation 18 is a well known representation for the polygamma function where z is the well known gamma function for these values of s the current versions of matlab and mathematica have a built in implementation of the polygamma function that evaluates it in real time however there are various different generalizations of the polygamma function for negative and non integer values of s some popular examples can be found in 2 and in 5 mathematica s generalization of the polygamma function for s n 0 does not in fact give s z as defined in equation 18 fortunately paul godfrey s implementation of the polygamma function in his matlab function psin s z does give s z as defined in equation 18 for all s c with s 0 and the evaluation is computed in real time this function can be found on its own 3 or in paul godfrey s bigger special functions package 4 both which are available for free at matlab central s file exchange for this spectral distribution function our recommendation for the starting values is less straightforward than for the above three cases it may be possible to represent t as a sum of complex weighted complex exponentials analytically but unlike the above three cases where these series were derived from the clever pad decomposition which is mathematically expected to converge with very few terms in the series we do not know of any such series that represents t for this j such that convergence will be achieved with very few exponentials therefore we recommend that the objective function t is calculated using the analytic formula presented above and that the starting parameters are chosen based on observing some of its properties such as its frequency of oscillation and damping rate guidelines for choosing starting parameters this way are presented in the subsection below other spectral distribution function forms when j is only known in a form such that t is not easily represented by equation 1 as for the case in subsection or if j is only known numerically it can be much harder to find good starting values for the non linear least squares fit it might be useful to fit j to a form for which good starting parameters are easy to choose such as the first three forms presented above but if this is not easy one can calculate the objective function t by numerical integration of equation 5 and as mentioned towards the end of subsection one can use properties of t as a guide to choose starting values for pk k our recommendation for the starting values for pk is based on the fact that at t 0 equation 1 gives us the relation 0 k k pk 19 we recommend to first attempt to fit one term p 1 e 1 t to the objective function t with p 1 0 according to equation 19 bear in mind that p 1 will then be 0 because sin 0 0 will nullify the right side of equation 5 the strating parameter for 1 can then be chosen by looking at a plot of the objective function t and comparing it to the expressions 5 t p 1 e 1 cos 1 t 20 t p 1 e 1 sin 1 t 21 based on equation 5 we see that as the temperature gets higher t becomes more and more different from t and therefore more than one damping rate k and more than one angular frequency k will be needed for a good fit however as a crude estimate we can choose the starting value of 1 to be an average of the angular frequencies 2 t t period of oscillations of the real and imaginary parts of the objective function t since the effect of j on t will cause the frequency of oscillations of t to be less and less sinusoidal over time we recommend to estimate t of each complex component of t based on the time it takes that component to get to the first quarter or half of its first oscillation with this starting value for 1 the starting value of 1 can then be chosen to be an average of the damping rates of the real and imaginary parts of the objective function t for the real part of t the damping rate 1 can be estimated by observing the time t 1 at which t attains its first minimum 1 and then solving the equation 1 exp 1 t 1 cos 1 t 1 whose solution is 22 1 ln 1 p 1 cos 1 t 1 t 1 23 which is an estimate of 1 similarly the damping rate of the imaginary part of t which we denote by 1 can be estimated by 1 1 ln 1 p 1 sin 1 t 1 t 1 24 1 is then estimated as an average of 1 and 1 we can then fit the one term function p 1 e 1 t to the objective function and then use the resulting fitted values of p 1 and 1 as starting values for a fit of the two term series p 1 e 1 t p 2 e 2 t to the objective function since p 2 and 2 are expected to be of the same order of magnitude as p 1 and 1 respectively we can multiply p 1 and 1 by random numbers near 1 in order to get crude estimates of suitable starting values for p 2 and 2 respectively in our matlab program these random numbers are obtained using 1 randn in matlab rather than rand or randn so that these random numbers are more likely to be close to 1 rather than to 0 the resulting values of p 1 1 p 2 and 2 from this fit can then be used as starting values for a three term fit with starting values for p 3 and 3 chosen as p 2 and 2 were for the two term fit fits to series with larger numbers of terms can be done in a similar way although when there are many terms in the series it may be more appropriate based on equation 19 for the starting value of p 1 to be 0 k instead of just 0 though the other starting values would likely also have to be adjusted which would not be straightforward note about implementation constraints scaling step sizes and weights putting constraints on the fitting parameters can help speed up the fits and can prevent the fitting program from getting lost in a far from optimal local minimum or the fitted values form becoming grossly unphysical for example it helps to implement the constraint k 0 so that t is not likely to diverge adding this as a constraint to the fit will prevent the fitting program from bothering to try values that we know are expected to give bad results and will therefore speed up the fitting caluclation and could potentially prevent the fitting program from getting lost in a region far from the desired global minimum we have implemented these constraints in bathfit s fitting routine when k is small it may also help to implement the constraint p 1 0 since according to equation 19 and 5 if k 1 p 1 0 since matlab s fitting routines are most easily implemented when the step sizes are the same size we scale the objective function s range to be between 0 and 1 and its domain is mapped to t 0 1 which significantly helps preventing the fitting program from getting lost in regions far from the desired global minimum after the fit is complete we then scale pk k back to si units we also provide the user with the option of assigning weights to each datapoint of the objective function for example if the user requires the first 100 fs of t to be represented very accurately and does not require t to be represented very accurately after 500 fs the user can assign weights accordingly often this can also help to get a graphically better fit since the local minimum found by bathfit won t always be the closest to the global minimum or even if the global minimum is attained it may have been influenced too strongly by certain parts of t which are not so important 1 since this expression uses the amplitude p 1 which is derived from t and t is expected to deviate more and more from t as the temperature is increased based on equation 5 this estimate is expected to be best at low temperatures 6 analytic coefficients for the discretized influence functional once t is represented in the form of equation 1 the difs discretized influence functional coefficients which are required if using a feynman integral to calculate the r d of open quantum systems modeled by the feynman vernon model can be calculated very quickly by the analytic formulas which were presented in 1 these formulas are listed again below along with analogous formulas for spectral distribution functions of the form j a se c for this latter form for the spectral distribution function t can once again be fitted to the form of equation 1 and the difs can therefore be calculated with the first set of formulas below but since we have an exact analytic form for t that can easily be integrated with respect to t we have also presented analytic forms for the difs for this form of j which do not require t to first be fitted to the form of equation 1 spectral distribution functions with bath response functions of the form t k k pk e k t trotter splitting kk 4 k k 1 pk 2 k sinh 2 k t 2 e k k k t 0 k k n and 25 kk 2 k k 1 pk 2 k sinh k t 2 e k t 2 1 2 k t 0 k n 26 strang splitting n 0 4 k j 1 pk 2 k e k t t 2 sinh 2 k t 4 27 00 nn 2 k j 1 pk 2 k e k t 4 sinh k t 4 t j 4 28 k 0 4 k j 1 pk 2 k sinh k t 2 sinh k t 4 e k k t t 4 29 nk 4 k j 1 pk 2 k sinh k t 2 sinh k t 4 e k t k t t 4 30 spectral distribution functions with exponential cut offs quapi when the bath is nearly adiabatic it is helpful to rewrite equation 3 as 8 9 h hoqs hdisplacement hoqs bath hbath hdisplacement 31 hoqs c 2 s 2 2 m 2 c sq m q 2 m 2 q 2 c 2 s 2 2 m 2 32 hoqs displaced c sq hbath displaced 33 hdisplacement is called the counter term and can also be represented in terms of the spectral distribution function by recognizing that when the qhos span a continuous spectrum of frequencies we have the relation remembering equation 4 c 2 2 m 2 1 0 j d 34 a feynman integral used to calcualte the r d for an oqs denoted by the hamiltonian hoqs displaced is called a quapi which stands for quasi adiabatic propagator feynman 2 integral for quapi calculations all coefficients remain the same as for a 2 the term path integral is used more commonly than feynamn integral here but this term is ambiguous currently the first result on the search engine at www google com when the search query path integral is entered is a wikipedia page that currently links to three different meanings of the word path integral 1 line integral 2 functional integration and 3 path integral formulation only the third of these is unambiguously the feynman integral discussed in this paper the line integral is an integral over a path rather than over a set of paths and the term functional integral can refer to at least three types of functional integrals 1 the wiener integral 2 the l vy integral and 3 the feynman integral 7 feynman integral used to calculate the r d for an oqs whose hamiltonian has not been displaced according to equations 313233 except for the kk coefficients when k k k 0 n which change to see supplementary material of 1 quapi kk kk i t 0 j d for k 0 n 35 kk i t 36 where in the last line we have defined the bath reorganization energy by an analytic expression exists for for most forms of j presented in this paper j gldd j h h h h 2 h h 2 h h 2 h h 2 h h h mt 2 h h h 2 h h 2 2 h h 2 2 8 2 2 0 h h h a se c q s 0 c 0 q 0 a q sc s q appendix table i n 1 n pad parameters for the bose einstein and fermi dirac distribution functions first presented in 7 and in more detail in 6 n n can be calculated easily for all n for arbitrary values of n in our open source matlab program that supplements this paper the matrix is a 2 n 2 n and is a 2 n 1 2 n 1 the indices n run from 1 to half the number of non zero eigenvalues of the corresponding matrix the number of non zero eigenvalues will always be even because the eigenvalues of these particular matrices come in pairs for example n n and for matrices with an odd number of eigenvalues the unpaired eigenvalue will always be 0 n 2 eigenvalues n 2 eigenvalues bose einstein fermi dirac mn m n 1 2 m 1 2 n 1 mn m n 1 2 m 1 2 n 1 mn m n 1 2 m 3 2 n 3 mn m n 1 2 m 1 2 n 1 n n 2 3 2 n n 1 n 1 2 n 2 n n n 6 n 2 n 2 n n n 2 1 2 n n 1 n 1 2 n 2 n n n 6 n 2 n 2 n acknowledgements n s d thanks the clarendon fund and the nserc crsng of du canada for financial support f a p thanks the leverhulme trust for financial support nike dattani chem ox ac uk david wilkins seh ox ac uk felix pollock physics ox ac uk 1 nikesh s dattani felix a pollock and david m wilkins analytic influence functionals for numerical feynman integrals in most open quantum systems quantum physics letters 1 1 35 45 2012 2 olivier espinosa and victor h moll a generalized polygamma function integral transforms and special functions 15 2 101 115 april 2004 3 paul godfrey polygamma function of arbitrary order valid complex plane 2004 4 paul godfrey special functions math library matlab central file exchange 2004 5 nathaniel grossman polygamma functions of arbitrary order siam journal on mathematical analysis 7 3 366 april 1976 6 jie hu meng luo feng jiang rui xue xu and yijing yan pad spectrum decompositions of quantum distribution functions and optimal hierarchical equations of motion construction for quantum open systems the journal of chemical physics 134 24 244106 june 2011 7 jie hu rui xue xu and yijing yan communication pad spectrum decomposition of fermi function and bose function the journal of chemical physics 133 10 101106 september 2010 8 a leggett s chakravarty a dorsey matthew fisher anupam garg and w zwerger dynamics of the dissipative two state system reviews of modern physics 59 1 1 85 january 1987 9 n makri improved feynman propagators on a grid and nonadiabatic corrections within the path in tegral framework chemical physics letters 193 5 435 445 june 1992 mailto nike dattani chem ox ac uk mailto david wilkins seh ox ac uk mailto felix pollock physics ox ac uk optimal representation of the bath response function fast calculation of influence functional coefficients in open quantum systems with bathfit 1 abstract setting contents non linear least squares fitting of the bath response function to the form kpet objective functions and starting values note about implementation constraints scaling step sizes and weights analytic coefficients for the discretized influence functional spectral distribution functions with bath response functions of the form t kpet spectral distribution functions with exponential cut offs quapi appendix acknowledgements references