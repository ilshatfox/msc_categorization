ar x iv 2 00 3 06 46 5 v 2 m at h p r 2 2 d ec 2 02 0 optimal stopping of stochastic transport minimizing submartingale costs nassif ghoussoub young heon kim and aaron zeff palmer abstract given a stochastic state process xt t and a real valued submartingale cost process st t we characterize optimal stopping times that minimize the expectation of s while realizing given initial and target distributions and i e x 0 and x a dual optimization problem is considered and shown to be attained under suitable conditions the optimal solution of the dual problem then provides a contact set which characterizes the location where optimal stopping can occur the optimal stopping time is uniquely determined as the first hitting time of this contact set provided we assume a natural structural assumption on the pair xt st t which generalizes the twist condition on the cost in optimal transport theory this paper extends the brownian motion settings studied in 15 16 and deals with more general costs contents 1 introduction 1 2 weak duality and dynamic programming 4 2 1 notation and definitions 4 2 2 dual formulation 5 2 3 dynamic programming dual formulation 6 3 pointwise bounds 8 4 dual attainment in the discrete setting 10 5 dual attainment in hilbert space 11 5 1 when the cost is the expected stopping time 14 6 the general twist condition 14 appendix a recurrent processes 16 a 1 dual attainment 17 a 2 when the cost is the expected stopping time 20 appendix b path monotonicity 21 references 21 1 introduction given a state process xt t valued in a complete metric space o an initial distribution and a target distribution on o we consider the set t of possibly randomized stopping times that satisfy x 0 and x where here and in the sequel the notation y means that the law of the random variable y is the probability measure the problem of finding such stopping times i e when t is non empty is known as the skorokhod embedding problem and has a long history ever since it was initiated by skorokhod 27 in the early 1960 s in the case where xt t is brownian motion wt t and o r and followed by date december 24 2020 the first two authors are partially supported by the natural sciences and engineering research council of canada nserc 2020 by the author 1 http arxiv org abs 2003 06465 v 2 2 nassif ghoussoub young heon kim and aaron zeff palmer important contributions from root 25 rost 26 chacon walsh 8 and others in this case the set t of embedding stopping times is empty unless and satisfies a certain order that is r x dx r y dy for all subharmonic functions 0 this condition is indeed sufficient and illustrates a duality principle of embedding stopping times which is given here as corollary 3 1 to the duality theorem 2 3 see 3 as well as 13 since then the problem and its variants were investigated by a large number of researchers and have led to several important results in probability theory and stochastic processes we refer to ob loj 24 for an excellent survey of the subject for our present purpose we note that no special role is played here by o r or by xt t being brownian motion and the skorokhod embedding theorem was eventually extended to more general state spaces and markov processes see the previously related works of baxter chacon 1 falkner 11 strassen 28 rost 26 dellacherie meyer 9 etc for example the result holds generally when is the infinitesimal generator of a diffusion process xt t our analysis here will distinguish between two cases processes that are absorbed into a cemetery state and those that are ergodic we shall detail the absorbing case in the main body of the paper and repeat the results for ergodic processes in appendix a given now a real valued cost process st t the optimal skorokhod embedding problem is to minimize the expected cost over all such embedding stopping times cf 3 ps inf e s x 0 x 1 1 the optimization problem 1 1 and its variants have been considered in mathematical finance for ex ample with applications to option pricing by hobson 19 beiglbo ck and juillet 4 ghoussoub kim lim 14 13 beiglbo ck cox huesmann 3 many applications consider processes beyond brownian motion and the cost processes possessing a variety of structural properties a starting point for our work is that the cost should be a submartingale in other words a process that increases in conditional expectation for each increment there are two particular cases of submartingale costs that have already been analyzed when the state process xt wt is a multi dimensional brownian motion st t 0 l s ws ds where the lagrangian l is non negative was analyzed in 15 16 st c w 0 wt where y c x y is subharmonic i e yc x y 0 which was analyzed in 16 note that the first case is markovian while the second is not though it depends only on initial final position the dual problem to ps has been expressed in 3 as ds sup mt t as o y dy ep m 0 1 2 where p is the distribution of xt t with initial x 0 and as consists of the end potential o r and a martingale mt t that satisfies m x s for any stopping time almost surely on the probability space in general the dual maximization problem can be reduced to a maximization of as m 0 can be deter mined from using the snell envelope of xt st t which we denote by g t t in other words g t is the conditional expected value of the optimal stopping problem that maximizes x s over stopping times t the martingale m t t such that m t t as can be recovered from g t t by the doob meyer decomposition these results are covered by lemma 2 2 and theorem 2 3 the optimizer of the dual problem characterizes an optimal embedding stopping time t by the following verification principles of theorem 2 4 i the value process does not change predictably before g t t is a martingale ii the terminal value is given by the end potential minus the cost g x s the first focus of this paper is on the attainment of the dual maximization problems ds which so far has been elusive in one dimension dual attainment has been achieved for brownian motion in 6 and 18 and has been extended to the multi dimensional case in 15 and 16 we also note an alternate approach to attainment has been undertaken by weakening the dual formulation in 5 our analysis identifies natural structural situations that yield bounds hence compactness in suitable function spaces on the end optimal stopping of stochastic transport 3 potential some structure is required since if the cost is the supermartingale st w 0 wt then the dual maximizer does not exist 4 see also 14 for related results in 3 we prove bounds on under the following set of assumptions the state process xt t is a stationary feller process with an absorbing state c o the initial and target distribution are in the order prescribed by xt t i e o x dx o y dy whenever is x subharmonic or x 0 where we abuse the notation and let denote the generator of x e c for c inf t xt c and s s c for c this is naturally satisfied when the process is either killed exponentially or by an absorbed state the cost process st t is a submartingale with s 0 0 and s c k proposition 3 3 provides the essential normalization for absorbing processes which shows that the end potential can be restricted to values in k 0 this procedure also restricts to have 0 value on c and any absorbing state of the markov process these bounds are sufficient for dual attainment if o is discrete theorem 4 1 to illustrate the generality of our approach we shall also handle the case where the time is discrete in 5 we aim for a more refined bound and make the following assumptions the state process xt t is symmetric with dirichlet form e that satisfies a poincare inequality f 22 o f x 2 m dx cp f 2 h where f 2 h e f f o f x f x m dx we also assume e satisfies a regularity property that makes the viscosity and variational formulations of supersolutions equivalent the initial distribution lies in the dual space h the cost process st t is such that dt st t is also a submartingale for some d 0 in other words e sr ft st d r t for r t we then obtain a uniform superharmonic estimate on the end potentials of the form x d for all x o which translates to a uniform bound of h by combining lemma 2 5 with viscosity and weak solution theory in proposition 5 6 and prove semi continuity of the dual value with respect to the topology of bd in proposition 5 5 with these results we prove attainment of optimal in the hilbert space for ergodic processes the situation is different the dual potentials are no longer bounded above and are no longer limited to the hilbert space h we still however prove dual attainment in a suitable space b d where the truncated potentials min x m live in the hilbert space for each m 0 see theorem a 11 the differences between the absorbing and ergodic processes can be better understood by examining the case of minimizing the expectation of embedding stopping times in the absorbing case the expectation of the stopping time is determined solely by and as long as it has finite expectation proposition 5 8 for ergodic processes the minimum expected time is given by a remarkable duality see theorem a 12 the dual is obtained as the potential of a point mass which does not belong to the underlying hilbert space which characterizes the optimal stopping times by requiring that their local time at that point is zero corollary a 13 finally a novel result of 16 was to identify a stochastic twist condition on cost processes of the form st c x 0 xt which guarantees that the optimal stopping time is a hitting time of a barrier in the product space of the current and initial position we provide in section 6 a new and more general twist condition on the pair st xt to consolidate these previous results we suppose that the cost decomposes as st at xt where a x is a u o valued stationary feller process u being an auxiliary differentiable manifold and u o r is measurable and differentiable in the first variable then we say that the 4 nassif ghoussoub young heon kim and aaron zeff palmer cost is a x twisted if a stopping time is 0 whenever e a x a a x a a x for any a u and any x o we note how the previously known examples fall into this class for example the root and rost embeddings are optimizers if at t and the cost is an increasing strictly convex or concave function of time the monge costs considered in 16 and the stochastic twist condition considered there also fits in this context with at x 0 further generalizations of the root embedding of 12 can also be considered here we shall prove that a unique optimizer is then given by the hitting time of a barrier in the space u o given an additional regularity assumption on the processes and possibly and under these assumptions we have that the stopping time is unique and given by the hitting time of a set in the product space of u o which is determined by the dual problem 2 weak duality and dynamic programming 2 1 notation and definitions we mostly follow the general formulation of 17 and introduce more detailed assumptions later we let r be the nonnegative real numbers o be complete metric space and oc o c be the space with a cemetery state c that is distance 1 from all other points we suppose f ft t r p f p is a filtered probability space with a polish space and p a borel measure such that x d r oc is a continuous map onto the skorokhod space of ca dla g paths equipped with the skorokhod path space metric i e the paths xt t r are continuous from the right with limits from the left we suppose the filtration f is right continuous and f 0 contains the null sets of p we suppose that x is adapted to f for a probability measure on a polish space a and integrable f we use the notation e f a f a da and for a algebra contained in the algebra of measurable sets we take the conditional expectation e f to be the unique measurable function on a such that b e f a da b f a da for all sets b we let c inf t xt c denote the killing time of the process we suppose that ep c and for any r x c holds for p a e such that c i e the path remains in the cemetery state after being killed with probability one we let s denote the set of nonrandomized stopping times and suppose also that for every open set q o there exists s such that e p 1 x q 0 we suppose the source distribution a borel probability measure on o is the initial marginal of p i e x 0 p we consider a target distribution a borel probability measure on oc and the set of randomized stopping times t that embed into the process x these correspond to measures p on r we let t and xt x and f be the extended filtration with f t containing b for borel subsets b 0 t such that i p p for the projection ii the process 7 g x is uniformly integrable over all stopping times s for all g cb oc iii we assume that t c holds with probability 1 iv xt p equivalently xt p optimal stopping of stochastic transport 5 we will always consider the topology given by weak convergence of the distribution of t on r and the distribution of xt on oc for which t is compact 2 we also denote by t the randomized stopping times with initial distribution and free stopping distribution i e satisfying i ii and iii but not necessarily iv and tt the randomized stopping times in t with t t c almost surely we let lscb oc be the set of bounded lower semicontinuous functions on oc and we let b to be the processes that are jointly measurable with the borel algebra on r and the borel algebra completed with p null sets on and uniformly integrable with respect to p for all stopping times we always assume the cost process s b is adapted to the filtration f even if s were not adapted it would not change the problem by replacing s with its optional projection with respect to the filtration remark 2 1 all of our results can be easily adapted to discrete time where the statements and proofs are the same with less technicalities in appendix a we see that the uniform integrability can be easily relaxed to allow for unbounded costs 2 2 dual formulation we define as m cb oc b 2 1 x m s s and p a e m is a f p martingale the martingale condition is simply e p m fs ms p a s for all stopping times ss s s the dual problem is ds sup m as o y dy ep m 0 2 2 we note that if x is markov then the set as does not depend on the initial distribution which will only appear in the cost of 2 2 we consider the following assumptions to make the optimization problem well posed first we require lower semicontinuity a 0 we suppose that t 7 st is right lower semicontinuous for p a e and its predictable projection is left lower semicontinuous and s is bounded below a 1 we suppose that st s c for t c holds p a s and s is class d i e uniformly integrable over stopping times which implies ep s c the assumption a 0 is made in 7 with upper semicontinuity and can be considered as a lower semicontinuous version of ca dla g processes the assumption a 1 is standard and includes two important general cases and restricts us to a compact set of stopping times t c one case is that the domain is an open set of a larger space o o for which c is the exit time at which time the process enters the cemetery state c in some cases the problem on o can be reduced to this by noting that there are states that cannot be reached with finite cost see 15 where xt is brownian motion and o r d is a bounded convex set the second case is that the process is killed exponentially at rate 0 we let p be the distribution of the process on o without killing then we have e p 1 xt o at e tep at for all processes at and thus e c r t e tdt 1 6 nassif ghoussoub young heon kim and aaron zeff palmer the cost st is uniformly integrable with respect to p if e tst is uniformly integrable with respect to p the admissible target measures will be restricted as the constraint becomes for f cb oc with f c 0 e p f xt e p e t f xt o f x dx and in particular if 6 we require o dx 1 equivalently c 0 2 3 dynamic programming dual formulation this section employs the dynamic programming prin ciple in a manner analogous to the double convexification procedure of optimal transportation we first note that the problem ds may be reduced to a concave maximization problem of we define the value process g to be the snell envelope of xt st t r given by g t sup st e p x s ft t 2 3 sup p tt e p xt st f t t given we can now define m by the doob meyer decomposition of g that is g t m t a t 2 4 where a t is an increasing process with a 0 0 this theory has been developed in 22 for which we refer also to 7 unfortunately the theory is stated with slightly different assumptions so we reproduce the results we need lemma 2 2 we suppose a 0 and a 1 the dual problem has the equivalent expression ds sup lscb oc oc y dy ep g 0 2 5 in particular for every cb oc we have that m as and p almost surely g m for all m as and s moreover g c s c holds p almost surely whenever c proof we fix lscb oc and consider an increasing sequence i cb oc that converges pointwise to for each i the process i xt st t r satisfies the assumptions of 7 in view of a 0 making g i a regular supermartingale i e e p g i k ep g i whenever k from the right we clearly have that g g i for s there is that attains the value of g such that e p g ep x s and e p g g i ep x i x which converges to zero by the dominated convergence theorem in particular we have inf x oc x ep s ep g sup x oc x inf t st so g is uniformly integrable the supermartingale property for g follows simply from noting that g t e p g ft for any st by setting t we see that g t xt st we takem t to be defined as the unique martingale of the doob meyer decomposition 2 4 andm t g t and it follows m as with m 0 g 0 when cb oc finally we may find cb oc with and arbitrarily close cost by lower semicontinuity of which implies the inequality of 2 5 for each m with m as and for all p tt we have mt e p mt f t t ep xt st f t t thus mt g t which completes the proof of 2 5 optimal stopping of stochastic transport 7 that g t c s c holds p almost surely whenever t c follows directly from 2 3 a 1 and the assumptions on x we now state the duality that is central to our analysis which slightly extends the duality of 3 in some ways although is simplified by our assumption of bounds from the killing time a 1 see also a similar proof in a more specific setting in 15 theorem 2 3 we suppose a 0 and a 1 then including the possible value of ds ps and if ps there is p t such that ps e p st proof the proof is a standard application of convex duality which we sketch for completeness we let v ps and we have that v is convex since if p 0 t 0 and p 1 t 1 then a 1 p 0 p 1 t 1 0 1 and the cost is linear in p furthermore 7 v is lower semicontinuous because the randomized stopping times with t c is compact and the cost is lower semicontinuous by a 0 we can express the legendre transform as v sup m oc oc y dy v sup p t e p xt st and v sup cb oc oc y dy sup p t e p xt st sup cb oc oc y dy ep g 0 where the second line follows from lemma 2 2 since v v by convexity and lower semicontinuity this completes the proof that that ds ps as relaxing to lscb oc does not change the cost as in lemma 2 2 when ps by compactness of t and a 0 we have the existence of a minimizer p we have the following verification type result for the dual optimizer theorem 2 4 suppose a 0 and a 1 and that lscb oc attains the maximum of ds and p t minimizes 1 1 then p maximizes e p xt st 2 6 over p t furthermore for any maximizer p t of 2 6 we have 1 g t xt st holds p almost surely 2 g t t is a f p martingale i e m t t g t t holds p almost surely for all t r proof we note that sup p t e p xt st ep g 0 ep xt st by the duality of theorem 2 3 thus p is a maximizer of 2 6 for any maximizer p t of 2 6 by definition of g with p probability 1 we have g t xt st and by the supermartingale property of g we have e p g t e p g 0 e p xt st 8 nassif ghoussoub young heon kim and aaron zeff palmer where the last equality is due to the fact that p the maximum thus we have g t xt st holds p almost surely since holds almost surely and holds in expectation this proves 1 it also implies that e p g t e p g 0 then for t r from the supermartingale property we have e p g t t e p g t e p g 0 yielding ep g t t e p g 0 since t 7 g t t is a supermartingale this last property implies that it is a martingale since m t g t it immediately follows that they are equal p almost surely proving 2 the final lemma in this section selects a maximal max given which also does not decrease the value this will play an important role later for attainment of the problem 2 5 at this point max is not necessarily bounded above but when we apply the lemma we will have a natural upper bound of 0 lemma 2 5 we suppose a 0 a 1 and lscb oc we let max y sup cb oc y x g s s p a e then we have the following i max y y for all y oc ii g max g s p a e proof we immediately note that max is bounded below and lower semicontinuous as the supremum of continuous functions furthermore can be expressed as the supremum of continuous functions which satisfy x g s thus max and i follows the inequalityg max g is obvious from i the pointwise inequality max x g s is maintained in the limit so in particular thus g max t sup st e p max x s ft sup st e p g ft g t using the supermartingale property of g so ii follows 3 pointwise bounds we establish in this section pointwise bounds on the dual functions which will be crucial in dual at tainment in the later sections we first introduce some additional structure to the processes we recall that a stationary feller process is given by a probability transition semigroup such that for each t 0 the distribution of xt given x 0 x is given by p t x satisfying for 0 s t p t x oc p t s y p s x dy and that limt 0 oc f y p t dy f uniformly for all f cb oc we note that the processes beginning at xt x are independent processes in a fixed probability space f px we let ex denote expectation with respect to this probability space we let sx denote the nonrandomized stopping times given in this probability space for additional references on optimal stopping in this setting see 20 chapter 2 and references therein as well as 10 we define re to be the re duite of this function corresponds to the superharmonic envelope when the process is brownian motion for lscb oc re x sup sx e x x 3 1 we say that balayage holds or if oc y dy oc x dx for all supermedian functions i e whenever re optimal stopping of stochastic transport 9 we first show a uniform pointwise bound assuming the following additional assumptions b 0 x is a stationary feller process furthermore we suppose that for all cb oc the re duite function of 3 1 is continuous and bounded re cb oc the second assumption holds for all feller processes if oc is compact see 10 b 1 we suppose that s 0 0 and s is a f p submartingale the following corollary of theorem 2 3 recovers a result of rost 26 corollary 3 1 given b 0 there exists p t if and only if proof we fix s 0 in which case g t re xt if then for any lscb oc by lemma 2 2 and the definition of re and the balayage we have o y dy ep g 0 o re y dy o re x dx 0 it follows from theorem 2 3 that ps 0 and there exists p t if 6 then there exists a supermedian function which satisfies o y dy o x dx 0 in which case g t xt for any 0 taking to we see that ds and from theorem 2 3 we have that t is empty the next lemma in this section verifies a mean value type property for the re duite re which asserts that re xt is a martingale up until the set where it touches the obstacle which is an extension of theorem 2 4 in the case that s 0 lemma 3 2 assume b 0 and that cb oc then the first hitting time inf t xt re xt attains the supremum of 3 1 with e x x re x and x re x 3 2 moreover for any randomized stopping time p t x we have the mean value property e p re xt re x 3 3 proof the proof is standard but we give it here for completeness first by continuity of and re from b 0 and right continuity of the paths of xt we have that re x x to check that attains the supremum of 3 1 notice that if p t x is an optimal randomized stopping time for 3 1 then p almost surely xt re xt by the dynamic programming principle as in the proof of theorem 2 4 hence t therefore the supermedian property implies ep re xt e x re x showing attains the supremum of 3 1 namely re x ex re x using the supermedian property again we get for any randomized stopping time p t x re x ep re xt ex re x re x proving 3 2 and 3 3 we now normalize the value process g by the re duite of the following provides a key ingredient in our dual attainment argument which generalizes proposition 4 6 of 16 with essentially the same proof in this more general setting proposition 3 3 suppose a 0 a 1 b 0 b 1 and cb oc if we let re then we have g t g t re xt 10 nassif ghoussoub young heon kim and aaron zeff palmer proof first we show which is an easy step and does not require s to be a submartingale we let p tt attain the supremum of the definition of g t 2 3 i e g t e p xt st ft thus by the supermedian property of re and the definition of g t g t re xt e p xt st re xt ft g t for the other direction we let inf s t xs re xs as in lemma 3 2 we have that is a ft stopping time because x is adapted to ft we let p tt attain the supremum of the definition of g t then by the definition of g and using from lemma 3 2 that re xt e p re xt e p xt st ft ep xt st ft re xt g t re xt also from lemma 3 2 we have ep x ep re x so e p xt xt ft 0 and by the submartingale property of s ep st st ft 0 it follows that g t e p xt st ft ep xt st ft ep xt xt ft ep st st ft g t re xt completing the proof 4 dual attainment in the discrete setting we illustrate the results in the previous section in the simple case of discrete markov process theorem 4 1 suppose that o is a discrete set i e with at most countable elements and that s satisfies a 0 a 1 b 1 and b 0 holds i e x is markov furthermore we assume that s c is uniformly bounded i e s c k for p a e then the dual problem is attained at cb oc with k 0 and c 0 proof given cb oc we let re as in proposition 3 3 from 0 and the submartingale property of s we have g t sup p tt e p xt st ft st on the other hand g t st e p x s st ft ep s st ft where inf s t xs re xs as in lemma 3 2 notice that e p s st ft k from the boundedness assumption on s with respect to stopping times these show that k g s 0 we now follow the maximization procedure of lemma 2 5 to obtain max then k max 0 follows from k g s 0 and that fact that for any open neighborhood q of y there is s such x q has positive probability finally proposition 3 3 combined with lemma 2 5 implies that the dual value for optimal stopping of stochastic transport 11 max is greater than or equal to the value for we have restricted the optimization problem to the set of cb oc where k 0 and c 0 this subset of cb oc is compact since either k 0 n rn or k 0 r is compact the dual value is upper semicontinuous as the infimum of continuous linear functionals in particular ep g 0 inf p t ep xt st and dual attainment follows as the maximization of an upper semicontinuous function on a compact set 5 dual attainment in hilbert space this section gives attainment of the dual problem 2 5 which is equivalent to 1 2 the dual optimizer is found in a hilbert space which we define using a dirichlet form as follows let o be equipped with a positive finite borel measure m we ignore the cemetery state c as we will assume from here on out that all functions have value 0 on c assume that there is a symmetric semi definite dirichlet form e l 2 o m l 2 o m r we let h u l 2 o m e u u note h is in general a hilbert space with the inner product e u v o u x v x m dx but we will consider when the dirichlet form defines a hilbert space without the additional l 2 product i e the poincare inequality holds we let h denote the dual space of linear functionals with respect to the l 2 inner product in particular we will say a measure belongs to h if there exists u h such that o f x dx e f u f cb o h in which case h u h we abuse the notation and let denote the generator of the dirichlet form and h 0 be the set of f cb o h such that f cb o l 2 o m in other words for f h 0 and g h we have e f g o g x f x m dx we suppose that generates xt in the sense that for each f h 0 and s x f x ex f x 0 f xt dt 5 1 we say that g lscb o is a supersolution to g h for h lscb o in the viscosity sense if whenever f h 0 touches g from below at x o i e f x g x and f y g y y o then f x h x we say that g h is a supersolution to g h for h l 2 o m in the weak sense if e f g o h x f x m dx for all f h 0 with f 0 we list the assumptions we need for our main results c 0 poincare inequality cp 0 such that e u u c 1 p o u x 2 m dx for all u h in particular we take the norm and inner product on h to be given solely by e c 1 continuity variational equivalence for h lscb o l 2 o m we have lscb o satisfies h in the viscosity sense if and only if h is bounded above and satisfies h in the weak sense c 2 semi supermartingale there is d 0 such that the cost satisfies ep s ft st e p d t ft for all st and p almost surely 12 nassif ghoussoub young heon kim and aaron zeff palmer c 3 balayage we have h and example 5 1 1 o rd 2 the state process xt is a d dimensional diffusion process generated by a smooth uniformly elliptic operator d i 1 d j 1 iaij j with killing rate 0 3 e u v rd d i 1 d j 1 aij x iu x jv x u x v x dx where m is lebesgue measure on rd and h h 1 rd 4 the cost process st t 0 l t xt dt where l is continuous and 0 l t x d the killing rate that enforces the poincare inequality also causes ep c example 5 2 1 o a geodesically convex bounded domain in a non positively curved riemannian manifold 2 xt is the riemannian brownian motion 3 is the laplace beltrami operator with dirichlet boundary conditions on o 4 e u v o g u x v x volg dx where g is the riemannian metric and volg is the correspond ing volume form 5 the cost process st c x 0 xt where 0 yc x y d for all x y o in both of these examples one can check the non trivial c 1 by viscosity solution theory as in 16 example 5 3 in example 5 1 the uniformly elliptic operator can be replaced with the fractional laplacian yielding fractional brownian motion on rd in this section we prove the main result of the paper on the attainment of the dual problem ds we recall that ds is defined as a supremum over the class as cb oc b however by lemma 2 2 is equal to the supremum over lscb oc of the concave functional u o y dy ep g 0 5 2 we first introduce a subset bd lscb o h which plays a key role in our method we always extend these functions to lscb oc by 0 on c definition 5 4 we say that bd if the following properties hold 1 lscb o h 2 y 0 for all y o 3 x d in the weak sense note that with assumption c 1 the last condition follows if x d in the sense of viscosity notice that bd is compact in the weak topology of h because of the uniform bound given by c 0 e f d o f x m dx d m o f l 2 o m d m o cp f h and the banach alaoglu theorem we now prove that u bd r is concave and upper semicontinuous proposition 5 5 we suppose a 0 a 1 b 0 b 1 c 0 c 3 the map 7 u is concave and upper semicontinuous on bd with the weak topology of h optimal stopping of stochastic transport 13 proof concavity and upper semicontinuity follow from the structure as the infimum over linear functionals since ep g 0 inf p t e p xt st it suffices to show that the map 7 ep xt is a continuous linear functional on bd for any p t this fact follows from the fact that xt and that implies h h indeed for cb o h we have that re cb o h with re 2 h e re re e 2 h by c 0 and c 1 since c 1 implies that re minimizes e u u over functions u h with u thus by considering cb o h with h 1 we have o y dy o re y dy o re x dx h upper semicontinuity follows from h cf c 3 proposition 5 6 we suppose a 0 a 1 b 0 b 1 c 0 c 3 given lscb oc with y 0 for all y o and c 0 we consider max as in lemma 2 5 then in the sense of viscosity max y d 5 3 and max bd consequentially the dual problem ds is reduced to bd that is ds sup bd u for the functional u of 5 2 proof from proposition 3 3 we can always normalize to 0 with c 0 after which we normalize to max as in lemma 2 5 we note that as in theorem 4 1 we have max y 0 for all y o suppose that h 0 touches max from below at x then for any 0 and 0 there is s and a set a f with nonzero probability and d x x such that x g s for p a e a then we have for all s 0 using c 2 that for p a e a e p x s f ep g s s s f g s ds x ds because x is a stationary feller process with generator e p s xr dr f ds for all s 0 and p a e a let 0 then continuity of implies that x d and max x d in the sense of viscosity by c 1 we have that max bd and the dual value has not decreased this completes the proof we now state our main theorem on attainment of the dual problem which follows immediately from the two preceding propositions theorem 5 7 we assume a 0 a 1 b 0 b 1 c 0 c 3 then there is bd that is a maximizer of ds that is o y dy ep g 0 ds 14 nassif ghoussoub young heon kim and aaron zeff palmer proof by proposition 5 6 we may restrict to a maximizing sequence i bd with i i max as noted above bd is compact in the weak topology of h and the result of proposition 5 5 implies that for a subsequence i k bd and u lim k u ik ds completing the proof 5 1 when the cost is the expected stopping time the case that st t c is critical for under standing this problem for a thorough exposition of related results for brownian motion beginning at the origin in 1 d see 23 proposition 5 8 we assume a 0 b 0 c 0 c 3 there is a unique function up to an additive constant h h 0 with h 1 in the weak sense on o such that for any p t we have e p t o h x dx o h x dx in particular any such p is optimal for cost st t c and the dual problem is solved by h and mt g h t h xt st proof existence and uniqueness up to additive constant of such h in h with h 1 is immediate by the property of the generator of a stationary feller process from h 1 clearly h cb o l 2 o m and that h cb o follows from c 1 we then calculate simply that e p t ep t 0 h xt dt o h x dx o h x dx taking h we find that ght h xt st and since o h x dx ep g h 0 o h x dx o h x dx ep t h is optimal for the dual problem 6 the general twist condition we suppose now that the pair a x is a stationary feller process with generator a x and the cost decomposes as st at xt we assume that a takes values in r d and a 7 a x is differentiable with a x 7 a a x continuous we interpret a as an auxiliary parameter which will provide structure for the optimal solutions in the examples below a might be the time at t the initial position at x 0 or a stochastic process coupled with x the form of the cost is inherited by the value process g lemma 6 1 we suppose a 0 a 1 b 0 and the cost is given by st at xt as above then for any lscb o the value process decomposes as g t h at xt where h rd o r is the a x re duite of proof this lemma is simply a restatement of the definition of g under the additional structure given by st at xt indeed g t sup st e p x a x ft sup sat xt e at xt x a x which is the definition of the re duite of we assume that satisfies a a x twist condition namely we suppose that optimal stopping of stochastic transport 15 d 0 for sa x the equation e a x a a x a a x 6 1 implies 0 if is continuous then h is the continuous viscosity solution of the quasivariational inequality max a xh a x x a x h a x 0 6 2 rather than giving details on the processes we make an assumption directly on solutions of 6 2 d 1 for any bd and p t that maximizes e p xt at xt we have that the map for h rd h 7 h at h xt is differentiable p almost surely we also suppose that the stopping time given by inf t h at xt xt at xt satisfies h a x x a x p almost surely examples the lagrangian case is when at t we set l t x a x t x t t x t x to be the lagrangian then is a x twisted if t 7 l t x is either strictly increasing or decreasing because e t x t t x t t x e t x t tl t r xr dr is either strictly positive or strictly negative if 6 0 this has been studied in 15 for the case when xt wt is d dimensional brownian motion in the case that t 7 l is decreasing to obtain the result we must assume that and are disjoint otherwise d 1 would fail the recent work 12 provides a manner to generalize the previous example to the case where a is an additive function of x and a 7 l a x is strictly increasing considering costs where at x 0 and thus st c x 0 xt generalizes the study in 16 where xt wt is d dimensional brownian motion here we list additional possible cases the previous cases can be mixed with a t x 0 this makes it easier to satisfy d 0 although it may be difficult to check differentiability d 1 in general suppose a x is generated by a uniformly elliptic operator and suppose that a 7 a x a a x is strictly monotone then d 0 holds and we expect differentiability d 1 from elliptic regularity possible example taking the process at sups 0 t xs possibly generalizes the aze ma yor embedding a x a and xt wt is one dimensional brownian motion it is clear that d 0 holds if a 7 a x is increasing and strictly concave or convex however satisfying d 1 is highly nontrivial in this case and the assumption c 2 on the cost will not hold so more work is needed to understand these problems we now state and prove our final theorem theorem 6 2 we suppose all the assumptions of the paper a 0 a 1 b 0 b 1 c 0 c 3 and in particular d 0 that s is a x twisted and d 1 hold then there is a unique minimizer to ps given by inf t h at xt xt at xt where bd is a dual maximizer 16 nassif ghoussoub young heon kim and aaron zeff palmer proof we let be a dual maximizer cf theorem 5 7 for any p t that maximizes e p xt at xt 6 3 we have h at xt xt at xt holds p a s by the dynamic programming principle of theorem 2 4 since h a x x a x it follows that ah at xt a at xt at points of differentiability which occur p a s by d 1 also from d 1 we have that h a x x a x and t holds p almost surely so since h at xt is a supermartingale x a x e p xt at xt f and is also a maximizer of 6 3 we also have that from the supermartingale property of h h a h x e p h at h xt f and equality holds at h 0 therefore taking a derivative by d 1 we get p almost surely a a x ah a x ep ah at xt f ep a at xt f it then follows from d 0 that any such maximizer is given by t since the optimal stopping time p t to ps is a maximizer of 6 3 by theorem 2 4 it is uniquely given by appendix a recurrent processes we will repeat the results of our paper under alternate assumptions for ergodic processes under these assumptions there is no cemetery state and instead of a 1 we require an assumption of coercivity of the cost a 1 we suppose that for any t 0 s is uniformly integrable over stopping times t and lim inf t inf s e t e s we first recover lemma 2 2 the proof is similar but we mention the details that change lemma a 1 we suppose a 0 and a 1 for every lscb o we have that m as and ds sup lscb o o y dy ep g 0 a 1 in particular p almost surely g m for all m as and s proof when verifying the properties of g we must first cut off at a finite time so that the cost is uniformly integral we introduce the approximation for t t g t t sup st e p x t s t it is clear from the argument of lemma 2 2 that g t is a regular supermartingale and g t t xt st for t t we clearly have that g g i t since t is an admissible stopping time for s there is that attains the value of g using assumption a 1 such that e p g ep x s then we have that e p g g i t ep x i x t s s t optimal stopping of stochastic transport 17 which converges to zero as i and t by a 0 and the dominated convergence theorem the remainder of the proof is the same as lemma 2 2 we continue to adapt the proof of theorem 2 3 with a 1 theorem a 2 we suppose a 0 and a 1 if ps ds ps and there is p t such that ps e p st proof the proof is identical to that of theorem 2 3 except that the set t is no longer compact however a 1 implies that if ps then we can restrict to p t with e p t t for a constant t which is compact this implies in particular that 7 ps is lower semicontinuous and that if ps then the minimum is attained we also repeat the following verification type result for the dual optimizer theorem a 3 suppose a 0 and a 1 and that lscb o attains the maximum of ds and p t minimizes 1 1 then p maximizes e p xt st a 2 over p t furthermore for any maximizer p t of a 2 we have 1 g t xt st holds p almost surely 2 g t t is a f p martingale i e m t t g t t holds p almost surely for all t r proof the proof is identical to the proof of theorem 2 4 we finally repeat lemma 2 5 lemma a 4 we suppose a 0 a 1 and lscb o we let max y sup cb o y x g s s p a e then we have the following i max y y for all y o ii g max g s p a e proof the proof is identical to lemma 2 5 a 1 dual attainment we now assume m is the invariant distribution o of the process xt the invariant measure satisfies o x dx 0 a 3 for all h 0 the results of section 3 hold and theorem 4 1 follows if we assume the discrete markov chain has finite recurrent time between any two points we replace assumption c 0 with the following c 0 poincare inequality cp 0 such that e u u c 1 p o u x 2 dx for all u h with o u x dx 0 equation a 3 implies that the superharmonic functions are all constant make the balayage assumption of c 3 trivial we need a stronger assumption on c 3 we suppose that h and that d d cb o we also assume a maximum principle type property 18 nassif ghoussoub young heon kim and aaron zeff palmer c 4 we suppose there is a constant such that if u 1 for u lscb and o u x dx 0 then u x for all x o we list a few examples of ergodic processes example a 5 1 o rd is open and bounded with smooth boundary 2 x is reflecting brownian motion the generator is the laplacian with neumann boundary conditions i e the set h 0 are the functions with h c o and h n 0 on o where n is the normal vector 3 the dirichlet form is e u v 1 2 o u x v x dx and dx 1 o dx is proportional to lebesgue measure example a 6 1 o is a closed riemannian manifold with unit volume 2 x is brownian motion with the generator as the laplace beltrami operator 3 the dirichlet form is e u v o g u x v x dx where is the volume form here is a possible additional case example a 7 1 o rd 2 xt is brownian motion with confining potential v that is smooth and coercive i e the ornstein uhlenbeck process for v x 1 2 x 2 the generator is the laplacian with drift i e h d i 1 2 h x 2 i v h 3 the dirichlet form is e u v o u x v x dx where dx m dx ce v x dx 4 this example violates c 1 and c 4 and would require more careful handling of the behavior as x when we address dual attainment in general we will not be able to use the upper bound as we did in section 5 to circumvent this we will use a truncation procedure by defining m x min x m it is clear that if is lower semicontinuous bounded below and a viscosity supersolution then so is m we give an analogy to the space bd definition a 8 we say that b d if the following properties hold 1 is lower semi continuous and m h for all m 2 o x dx 0 3 x d in the sense of viscosity optimal stopping of stochastic transport 19 we define the weak topology on b d to be the topology of weak convergence in h for m for all m assumption c 4 is necessary for this space to be compact if b d then d so m l 1 o is uniformly bounded and e m m o m x m m x dx dm o dx d 2 by the uniform bound above b d is compact with this topology we make use of a second regularization of the process by introducing a killing term with rate 0 as xt is generated by the dirichlet form e u v the modified process with the killing rate is generated by the dirichlet form e u v defined as e u v e u v o u x v x dx for x that satisfies c 0 x satisfies c 0 we let s be the cost that is left continuous and constant on c for a probability measure on o with d d s cb o we let u h 0 denote the potential function that satisfies o u x dx 0 and u x 1 s x a 4 we now give an analogy of proposition 5 5 proposition a 9 we suppose a 0 a 1 b 0 b 1 c 0 c 1 c 2 and c 3 the map 7 u o y dy ep g 0 is concave and upper semicontinuous on b d with the weak topology proof concavity and upper semicontinuity follow from the structure as the supremum over linear function als we first note that e p g 0 sup m 0 sup 0 sup p t e p m x t s t where t is the set of stopping times of the process x t starting from the distribution the inequality is obvious for the other inequality we note that because a 1 the stopping time that achieves the value of ep g 0 has finite expectation and thus is approximated well when is small by exactly the same reason as in the proof of proposition 5 5 u 7 ep u x t is a continuous linear functional on b d for any p t this shows that the map b d 7 e p m x t s t is continuous thus the map 7 ep g 0 is upper continuous in b d finally continuity of 7 o x dx o x u x dx follows from c 3 proposition a 10 we suppose a 0 a 1 b 0 b 1 c 0 c 1 c 2 and c 3 given lscb o we consider max as in lemma a 4 then in the sense of viscosity max y d a 5 and max o x dx b d 20 nassif ghoussoub young heon kim and aaron zeff palmer consequentially ds sup b d u proof the proof is the same as proposition 5 6 we now restate our main theorem on attainment of the dual problem which follows immediately from the two preceding propositions theorem a 11 we assume a 0 a 1 b 0 b 1 c 0 c 1 c 2 c 3 and c 4 then there is b d that maximizes ds that is o y dy ep g 0 ds proof again the proof is essentially identical to that of theorem 5 7 a 2 when the cost is the expected stopping time we now give a counterpart of proposition 5 8 a similar result has appeared in 1 theorem 4 7 theorem a 12 we assume b 0 c 0 c 1 and c 3 we have that inf p t e p t sup x o u x u x a 6 if we assume additionally c 4 then the value of a 6 is finite proof by proposition a 10 for the case st t we can restrict the dual potential to b d with d x 1 as a consequence of a 3 we have that x 1 s x for s d d for some probability measure we have thus found that the dual problem can be restricted to potential functions u for any probability measure also as 1 the value process is always given in this case by g t xt t we then have that for each u o x dx ep g 0 o u x dx o u x dx o u x u x dx sup x o u x u x from this a 6 follows finally given c 4 we have that u is bounded below and u is bounded above as u cb thus the supremum is bounded furthermore the point where the maximum is attained on the righthand side of a 6 defines a halting point which characterizes the stopping times that minimize the expected time this result first appears in 21 theorem 5 1 and we give a short proof for completeness corollary a 13 we assume b 0 c 0 c 1 c 3 and c 4 and we suppose p t and x o then we have optimality of p and x in a 6 if and only if p almost surely the local time of xt at x before t is 0 p almost surely proof we let u as defined in a 4 for a probability measure with d d s cb o approxi mating x as 0 then we use the definition of and the generator to obtain e p t ep t 0 xt s xt dt o x dx o x dx ep t 0 s xt dt optimal stopping of stochastic transport 21 taking the limit as 0 we have e p t u x u x lim 0 e p t 0 s xt dt the final term can be identified as the local time of xt at x for t t it follows from theorem a 12 that for the optimizers p and x we have zero local time conversely if the local time is 0 then equality holds in a 6 so that optimality of p and x follows appendix b path monotonicity the value function and dynamic programming principle is closely related the path monotonicity principle of 3 analogous to the relationship between convex functions and cyclic monotonicity indeed the dual attainment and verification results of our paper recover the result that the support of the minimizing stopping time satisfies the path monotonicity principle more precisely the set r t xt g t st satisfies the path monotonicity property definition 1 5 of 3 the following is an extension of 16 theorem b 1 where it was proved for the case xt bt the brownian motion to show that r satisfies the path monotonicity property we prove that there is no a stop go pair in the sense of definition 1 4 of 3 for this we suppose there is a path 1 that continues optimally at 1 t 1 i e 1 t 1 r in the notation of 3 that is there is a stopping time st with 6 0 so that e p st 1 ft 1 1 g t 1 1 e p xt 1 ft 1 1 and another pair 2 t 2 r that stops optimally so that st 2 2 g t 2 2 xt 2 2 and xt 1 1 xt 2 2 on the other hand from the definition of g t we have the inequalities st 1 1 g t 1 1 xt 1 1 and e p st 2 ft 2 2 g t 2 2 e p xt 2 ft 2 2 notice that from the markov property of xt and xt 1 1 xt 2 2 e p xt 1 ft 1 1 xt 1 1 e p xt 2 ft 2 2 xt 2 2 combining all these we get that e p st 1 ft 1 1 st 2 2 st 1 1 e p st 2 ft 2 2 since 6 0 this shows that 1 t 1 and 2 t 2 cannot be a stop go pair which implies the path monotonicity principle for r references 1 john r baxter and rafael v chacon stopping times for recurrent markov processes illinois journal of mathematics 20 3 467 475 1976 2 john r baxter and rafael v chacon compactness of stopping times probability theory and related fields 40 3 169 181 1977 3 mathias beiglbo ck alexander mg cox and martin huesmann optimal transport and skorokhod embedding inventiones mathematicae 208 2 327 400 2017 4 mathias beiglbo ck and nicolas juillet on a problem of optimal transport under marginal martingale constraints the annals of probability 44 1 42 106 2016 5 mathias beiglbo ck marcel nutz and florian stebegg fine properties of the optimal skorokhod embedding problem arxiv preprint arxiv 1903 03887 2019 6 mathias beiglbo ck marcel nutz and nizar touzi complete duality for martingale optimal transport on the line the annals of probability 45 5 3038 3074 2017 22 nassif ghoussoub young heon kim and aaron zeff palmer 7 jean michel bismut potential theory in optimal stopping and alternating processes in stochastic control theory and stochastic differential systems pages 285 293 springer 1979 8 rafael v chacon and john b walsh one dimensional potential embedding lecture notes in math 511 19 23 1976 9 claude dellacherie and paul andre meyer probabilities and potential volume 29 of north holland mathematics studies north holland publishing co amsterdam new york north holland publishing co amsterdam new york 1978 10 n el karoui jp lepeltier and a millet a probabilistic approach to the reduite in optimal stopping probabability and mathematical statistics 13 1 97 121 1992 11 neil falkner on skorohod embedding in n dimensional brownian motion by means of natural stopping times in se minaire de probabilite s xiv 1978 79 pages 357 391 springer 1980 12 paul gassiat harald oberhauser and christina z zou a free boundary characterisation of the root barrier for markov processes arxiv preprint arxiv 1905 13174 2019 13 nassif ghoussoub young heon kim and tongseok lim optimal brownian stopping between radially symmetric marginals in general dimensions arxiv e prints https arxiv org abs 1711 02784 2018 14 nassif ghoussoub young heon kim and tongseok lim structure of optimal martingale transport plans in general dimensions annals of probability 47 1 109 164 2019 15 nassif ghoussoub young heon kim and aaron zeff palmer pde methods for skorokhod embeddings calculus of variations and partial differential equations volume 58 article number 113 16 nassif ghoussoub young heon kim and aaron zeff palmer a solution to the monge transport problem for brownian martingales 2019 17 gaoyue guo xiaolu tan and nizar touzi on the monotonicity principle of optimal skorokhod embedding problem siam j control optim 54 5 2478 2489 2016 18 pierre henry labordere and nizar touzi an explicit martingale version of the one dimensional brenier theorem finance and stochastics 20 3 635 668 july 2016 19 david hobson the skorokhod embedding problem and model independent bounds for option prices in paris princeton lectures on mathematical finance 2010 pages 267 318 springer 2011 20 damien lamberton optimal stopping and american options ljubljana summer school on financial mathematics https www fmf uni lj si finmath 09 shortcourseamericanoptions pdf 2009 21 la szlo lova sz and peter winkler efficient stopping rules for markov chains in proc 27 th acm symp on the theory of computing citeseer 1995 22 jean franc ois mertens the orie des processus stochastiques ge ne raux applications aux surmartingales probability theory and related fields 22 1 45 68 1972 23 itrel monroe on embedding right continuous martingales in brownian motion the annals of mathematical statistics pages 1293 1311 1972 24 jan ob lo j the skorokhod embedding problem and its offspring probability surveys 1 321 392 2004 25 david h root the existence of certain stopping times on brownian motion the annals of mathematical statistics 40 2 715 718 1969 26 hermann rost the stopping distributions of a markov process inventiones mathematicae 14 1 1 16 1971 27 anatoliy v skorokhod studies in the theory of random processes translated from the russian by scripta technica inc addison wesley publishing co inc reading mass 1965 28 volker strassen the existence of probability measures with given marginals the annals of mathematical statistics pages 423 439 1965 nassif ghoussoub young heon kim and aaron zeff palmer department of mathematics university of british columbia vancouver v 6 t 1 z 2 canada email address nassif math ubc ca yhkim math ubc ca azp math ubc ca 1 introduction 2 weak duality and dynamic programming 2 1 notation and definitions 2 2 dual formulation 2 3 dynamic programming dual formulation 3 pointwise bounds 4 dual attainment in the discrete setting 5 dual attainment in hilbert space 5 1 when the cost is the expected stopping time 6 the general twist condition appendix a recurrent processes a 1 dual attainment a 2 when the cost is the expected stopping time appendix b path monotonicity references