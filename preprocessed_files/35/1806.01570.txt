june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical and astrophysical fluid dynamics vol 00 no 00 00 month 2018 1 25 modelling supernova driven turbulence f a genta d m m mac lowb m j ka pyla c a g r sarsond and j f hollinsd a resolve centre of excellence dept computer science aalto university fi 00076 aalto finland b dept of astrophysics american museum of natural history new york ny 10024 5192 usa center for computational astrophysics flatiron institute new york ny 10010 usa cmax planck institute for solar system research d 37707 go ttingen germany dschool of mathematics statistics and physics newcastle university newcastle upon tyne ne 1 7 ru uk submitted may 2018 high mach number shocks are ubiquitous in interstellar turbulence the pencil code is particularly well suited to the study of magnetohydrodynamics in weakly compressible turbulence and the numerical in vestigation of dynamos because of its high order advection and time evolution algorithms however the high order algorithms and lack of riemann solver to follow shocks make it less well suited to handling high mach number shocks such as those produced by supernovae sne here we outline methods required to enable the code to efficiently and accurately model sne using parameters that allow stable simulation of sn driven turbulence in order to construct a physically realistic galactic dynamo model these include the resolution of shocks with artificial viscosity thermal conductivity and mass diffusion the correction of the mass diffusion terms and a novel generalization of the courant condition to include all source terms in the momentum and energy equations we test our methods with the numerical solution of the one dimensional 1 d riemann shock tube sod j comput phys 1978 27 also extended to a 1 d adiabatic shock with parameters and mach number relevant to sn shock evolution including shocks with radiative losses we extend our test with the three dimensional 3 d numerical simulation of individual sn remnant evolution for a range of ambient gas densities typical of the interstellar medium and compare these to the analytical solutions of sedov taylor adiabatic and the snowplough and cioffi mckee and bertschinger astrophys j 1988 334 results incorporating cooling and heating processes we show that our new timestep algorithm leads to linear rather than quadratic resolution dependence as the strength of the artificial viscosity varies because of the corresponding change in the strength of interzone gradients keywords numerical methods high mach number shocks artificial diffusivity supernova driven turbulence instabilities 1 introduction astrophysical turbulence often occurs in highly compressible flows such as the interstellar medium ism where turbulence is driven by repeated supernova sn explosions elmegreen and scalo 2004 scalo and elmegreen 2004 the pencil code 1 brandenburg and dobler 2002 has been extensively applied to weakly compressible flows such as occur in stellar turbulence haugen et al 2004 a stellar magnetoconvection ka pyla et al 2008 2009 2012 2016 bushby et al 2018 stellar and planetary dynamos dobler et al 2006 mcmillan and sarson 2005 and accretion disks de val borro et al 2006 ka pyla and korpi 2011 the pencil code is well suited to the investigation of dynamos both small scale fluctuation or random modes and large scale mean or system wide modes it uses sixth order in space and third order in time advection algorithms to capture the flow with near spectral accuracy and is optimized for excellent performance on clusters of superscalar processors corresponding author email frederick gent aalto fi 1 https github com pencil code ar x iv 1 80 6 01 57 0 v 3 as tr o ph g a 1 8 ju n 20 19 june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 2 gent et al this code has been applied to the study of sn driven ism turbulence and the galactic dynamo gent et al 2013 a b ka pyla et al 2018 building on more idealised pencil code experiments with high mach numbers haugen et al 2004 a b from these results a large scale dynamo lsd was obtained for a system resembling the solar neighbourhood of the milky way but the parameters chosen resulted in magnetic prandtl numbers varying strongly by phase with the result that a small scale dynamo ssd was only present in the hot phase here we shall report on improvements to the hydrodynamic part of the pencil code model which include using only the minimum artificial viscosity needed to permit the resolution of strong shocks with mach numbers of order 100 improvement of the mass diffusion algorithm and force dependent time constraints to improve the stability of the code and test the results for various shocks spectral methods are effective for accurately solving initial value problems without discon tinuities and well suited for elliptic equations reframing the problem as a superposition of basis equations can however be computationally intensive handling shocks still must occur in real space applying similar tools as finite difference and volume element schemes in this space either artificial diffusion or a riemann solver is normally required regardless of the order of accuracy of the various codes artificial viscosity effectively reduces to a first order method in the vicinity of the shock an alternative is to use godunov methods to solve for the fluxes at zone boundaries these rely on exact or approximate solutions to the riemann problem at each zone boundary although accurate they are computationally expensive and sensitive to the addition of new physics that can change the signal propagation characteristics in this article we shall explain the methods and parameter choices required for the pencil code to handle the 1 d riemann shock tube test section 2 and report its performance for various levels of shock reaching above mach 100 see section 3 we then describe some addi tional steps required to handle highly compressible sn driven turbulence including radiative cooling and in section 4 present the results of sedov taylor and snowplough tests for sn remnant evolution across a range of ambient gas density and model resolution in section 4 4 we describe some additions to the pencil code timestepping control to maintain numerical stability for these challenging simulations and the interplay between the different timestep criteria in realistic models finally we summarise our work in section 5 2 method our strategy to model strong shocks is to use upwind differencing effectively a form of hyperdiffusion when solving each partial differential equation pde to ensure the system is resolved at the grid scale and to apply artificial viscosity and thermal diffusivity at the shock fronts following stone and norman 1992 to avoid discontinuities in the derivatives by smoothing the shock profile the fifth order implemetation of the upwind differencing applied here is detailed in the pencil code manual 1 section h 2 the current implementation of artificial diffusivities is adapted from the earlier treatments of haugen et al 2004 b and mee 2007 2 1 artificial shock viscosity in the momentum equation the shock capturing viscosity is applied as du dt u 1 1 http pencil code nordita org doc manual june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 3 where u denotes velocity gas density and d dt t u 2 is the material derivative the viscous coefficient takes the form shock fshock 3 where fshock max 5 u min x y z 2 4 taking only positive values of u and otherwise zero at any point the maximum value within two zones in any direction is applied 1 this field is then smoothed using a seven point smoothing polynomial with gaussian weights 1 9 45 70 45 9 1 180 to obtain fshock hence the artificial viscosity is applied only locally at the shocks and has quadratic dependence on the divergence the dimensionless constant shock 1 an additional source term in the equation of energy arises from the viscous heating produced by the artificial viscosity we solve the energy equation in the form of the specific entropy s so we have t ds dt u 2 5 where t denotes temperature 2 2 thermal diffusion including a similar artificial thermal diffusion to the energy equation significantly damps numerical oscillations arising behind the shock front with negligible effect on the overall struc ture of the shock solutions in the nonadiabatic system particularly where cooling produces thermally unstable regimes thermal diffusion can confine thermal instabilities to the limits of the numerical resolution the thermal diffusion takes the form t ds dt cp t 6 where cp denotes the gas specific heat at constant pressure and the thermal diffusivity coeffi cient takes the form shockfshock 7 this coefficient is calculated using local maxima and smoothing fshock as for the artificial viscosity above a modest value shock 0 5 is adequate for weak to moderate adiabatic shocks 2 3 mass diffusion finally we consider the inclusion of mass diffusion of course there is no physical mass diffusion term in the continuity equation so this is a purely artificial numerical device mass diffusion is not necessary to model even strong shock solutions with the pencil code as considered in detail in section 3 although its use does tend to damp the oscillations in the wake of the shock however experiments with sn driven turbulence show that interacting 1 at sixth order accuracy we may apply a maximum from within one two or three zones with three yielding more stability at the expense of increased smoothing empirical trials of sn driven turbulence as discussed in section 4 4 indicate two zones to be sufficient june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 4 gent et al shocks in that context are prone to local numerical instabilities effectively wall heating where the density drops and the temperature rises without limit producing a hot zone the application of mass diffusion suppresses this problem with mass diffusion in the absence of sinks or sources the continuity equation becomes d dt u d 2 d 8 where d dshock fshock 9 with fshock as defined in 4 and dshock 1 adding a non physical diffusion to the equation has consequences for the conservation of momentum and energy hence corrections to each equation are required if we consider the momentum and energy equations absent the artificial diffusion we have du dt rhs de dt rhs d dt u u d dt rhs d dt e e d dt rhs d dt u u u rhs d dt e cv t u rhs where e cv t denotes the internal energy and cv is the specific heat at constant volume when we include the mass diffusion in the continuity equation we obtain d dt u u u d 2 d 6 rhs 10 d dt e cv t u d 2 d 6 rhs 11 hence to conserve the properties of momentum and energy we must also subtract these extra terms from the respective rhs for momentum we have du dt u d 2 d 12 and for energy we have t ds dt cv t d 2 d 13 we define an array of artificial diffusion coefficients as cshock dshock shock shock 2 4 timestep determination the pencil code uses an explicit finite difference scheme which can be faster than implicit schemes but is not unconditionally stable a necessary although not necessarily sufficient stability condition is to satisfy various courant conditions on the time step such as for advection and diffusion for advection this condition reads 1 t max umax c t xmin 14 where c t 1 is the courant number dedicated to the control of the advective timestep xmin min x y z is the minimum grid spacing at each location and for the mhd case umax max u c 2 s v 2 a 15 june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 5 cs and va denote the sound speed and alfve n speed respectively with maximal speeds of order 103 km s 1 typical of such turbulence however this is rarely significant in determining the maximum timestep we also must account for the artificial diffusion terms we have introduced to resolve shocks the diffusive time step is controlled by the courant condition 1 t max max c t v x 2 min 16 where c t v 1 is a courant coefficient for the diffusive timestep max max d is the maximum diffusive coefficient acting at each point in the grid in the mhd case magnetic diffusivity may also be included in max it has previously been observed that strong heat sources or sinks can cause stresses on the numerical solvers that the conventional timestep control described above does not address in the context of ism simulations and sn driven turbulence the effect of cooling and heating can cause numerical instability if not also accounted for minimum cooling times are typically around 100 yr for the temperature and density ranges commonly considered in ism simula tions but can be as low as 10 yr this is not usually a problem as other processes often require shorter time resolution heating by sn is instant and therefore presents a challenge primarily through heat diffusion timescales the main source of heating driving the timestep due to the supersonic flows is viscous heating to ensure the heating cooling time is resolved the net heating h is summed and the timestep t constrained by its absolute maximum throughout the grid as 1 t max h max c t s e 17 where c t s 1 controls the fractional change of energy permitted in any cell in weakly compressible flows the largest values on the right hand side of the entropy equa tion can be adequately resolved in time but for the highly compressible flows of sn driven turbulence the sum of all changes to the energy can be many orders of magnitude greater than the evolving entropy of order unity to address this the hmax in equation 17 is instead replaced by the maximal sum of the right hand side of the entropy equation df s so that 1 t max df s max c t s cv 18 is used to constrain the timestep with the maximum fractional change in entropy given by c t s we find empirically that this time step constraint dominates immediately after sn explosions during sn driven turbulent runs the momentum equation must also be considered as a whole similar to the treatment of the energy equation 18 the troublesome contribution to the code stability is to be found in viscous force in general expressed as du dt 2 u 3 u 2 s ln u u 19 involving the rate of strain tensor s of the form 2 sij ui xj uj xi 2 3 ij u 20 note also the viscous heat applying to the energy equation is proportional to s 2 sijsij in the diffusive timestep only the coefficients and are considered the gradients in the expression are ignored and in the case of sn turbulence these contributions can be of order 107 109 km s 1 gyr 1 increasing viscosity to smooth the gradients can be counter produc tive making the viscous forces even larger instead we limit the total change in momentum june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 6 gent et al df u with a newly developed time step limitation of 1 t max df u max c t f u nom 21 where c t f 1 is a courant number applying to control of the forcing timestep and unom is a sufficiently small nominal velocity in practice c t f u nom 20 km s 1 is stable an alternative approach might be to reduce c t v 1 but this would reduce the the timestep under all circumstances whereas the forcing timestep control is more flexible and limits the timestep only when needed the impact of this timestep control on a turbulent ism simulation is considered in section 4 4 2 5 sound speed dependent shear viscosity the numerical solutions to the experiments included in this article are adequately modelled without any prescription for viscosity other than the artificial shock dependent viscosity al ready described however in the turbulent sn driven system the numerical stability has been found to benefit from viscosity proportional to the speed of sound cs the ism is typified by huge variation in temperature and associated characteristic turbulent velocities together with the artificial viscosity this applies a numerically stable constraint on the mesh reynolds num ber whilst little is understood about the behaviour of turbulent viscosity in the ism such temperature dependent behaviour for the ism can be argued to more closely approach the molecular spitzer viscosity 1 t 2 5 than the usual application of constant various applications of physical viscosity may be considered such as laplacian for 2 u or bulk which applies to the trace omitted from the rate of strain tensor s here we apply shear viscosity arising from the divergence of the traceless rate of strain tensor in this form the contribution of in 19 is nonzero and additional viscous heating 2 s 2 applies to the energy equation the sound speed dependent viscosity is not included in section 3 to demonstrate that these results hold for the prescription we intend for the modelling of sn turbulence we include this viscosity in the form cs x throughout section 4 3 riemann shock tube test 3 1 weak and moderate shocks to assess the quality of the shock handling scheme we consider the riemann shock tube test using the standard setup described by sod 1978 based on the exact analytical solution obtained by e g hawley et al 1984 results from a weak and a moderate shock test in a one dimensional grid over 256 points with closed boundaries are depicted in figures 1 and 2 respectively for direct comparison with caunt and korpi 2001 their figures 11 and 12 we use the adiabatic index 1 4 in each case an initial discontinuity in density and energy is located at x 0 5 with zero velocity and on the right the dimensionless density 0 125 and pressure p 0 1 in the weak shock in figure 1 the density and pressure on the left are both 1 0 and for the moderate shock in figure 2 they are 10 the analytic solutions are included for comparison for these parameters a reasonable solution can be obtained with the artificial diffusivities shock 4 0 and shock 0 5 and with no mass diffusion dshock 0 however if the initial discontinuity in mass and energy is not smoothed then significant oscillations occur in the wake of the shock which in stronger shocks can lead to artificial hot zones forming due to wall heating which crash the code the initial discontinuity profile has june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 7 0 0 0 2 0 4 0 6 0 8 1 0 x 2 5 2 0 1 5 1 0 0 5 0 0 0 5 ln analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 0 0 0 2 0 4 0 6 0 8 1 0 1 2 p analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 0 2 0 0 0 2 0 4 0 6 0 8 1 0 u analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 1 6 1 8 2 0 2 2 2 4 2 6 2 8 3 0 e analytic numeric figure 1 weak riemann shock tube test sod 1978 with 256 grid points at t 0 245 where the density and pressure on the left is initially set to p 1 0 1 0 and on the right p 0 125 0 1 figures show density pressure velocity u internal energy e and the analytic solution orange line the diffusivity coefficients used are cshock 0 4 0 5 colour online 0 0 0 2 0 4 0 6 0 8 1 0 x 3 2 1 0 1 2 3 ln analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 0 2 4 6 8 10 12 p analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 0 5 0 0 0 5 1 0 1 5 2 0 u analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 1 0 1 5 2 0 2 5 3 0 3 5 4 0 4 5 e analytic numeric figure 2 moderate shock tube test sod 1978 with 256 grid points at t 0 150 where the density pressure on the left is initially set to p 10 0 10 0 and on the right p 0 125 0 1 figures show density pressure velocity internal energy and the analytic solution orange line the diffusivity coefficients used are cshock 0 4 0 5 colour online the form here for density x left left right 2 1 tanh x n x 22 where the smoothing length n x in figure 3 we show the results at the shock front and contact discontinuity of applying 0 2 5 x the shock front profiles in the right panels retain a similar shape but delayed with increased initial smoothing this is where the artificial june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 8 gent et al 0 68 0 69 0 70 0 71 0 72 0 73 0 74 0 75 0 76 0 77 x 1 4 1 3 1 2 1 1 1 0 0 9 0 8 ln analytic 2 5 x 2 0 x 1 5 x 1 0 x 0 5 x 0 0 x 0 90 0 91 0 92 0 93 0 94 0 95 x 2 1 2 0 1 9 1 8 1 7 1 6 1 5 1 4 1 3 ln analytic 2 5 x 2 0 x 1 5 x 1 0 x 0 5 x 0 0 x 0 68 0 69 0 70 0 71 0 72 0 73 0 74 0 75 0 76 0 77 x 1 6 1 8 2 0 2 2 2 4 2 6 2 8 3 0 e analytic 2 5 x 2 0 x 1 5 x 1 0 x 0 5 x 0 0 x 0 90 0 91 0 92 0 93 0 94 0 95 x 2 0 2 2 2 4 2 6 2 8 e analytic 2 5 x 2 0 x 1 5 x 1 0 x 0 5 x 0 0 x figure 3 the weak shock tube test sod 1978 detailed in figure 1 with cshock 0 4 0 5 at t 0 245 resolved with 512 grid points zoomed in profiles show contact discontinuity left and shock front right for initial discontinuity smoothing scale 0 2 5 x for gas density upper and internal energy lower colour online viscosity is present throughout the evolution in contrast the left panels show stronger high frequency wiggles forming at the contact discontinuity for the unsmoothed initial profiles an optimal smoothing scale is 1 5 x and this is used for the weak and moderate shock tube tests in this paper in simulations of sn driven turbulence with sn shocks introduced to a highly nonuniform ambient ism we have no such fine tuning over the level of discontinu ity smoothing but we apply a 3 d gaussian profile for the initial injection of energy in the sn experiments rather than steeper or discontinuous profiles to miminise such numerical instabilities forming in the contact discontinuities behind the shock fronts in figures 1 and 2 with mach numbers about 1 and 2 5 respectively we see the main de viation from the analytic solution is smoothing at the transitions particularly at the contact discontinuities between x 0 6 and 0 8 most evident in the plots for gas density and internal energy with increasing resolution which we show in figure 4 the numerical solution asymp totically approaches the analytic solution we consider grid sizes between 32 and 2048 for the moderate shock and zoom in on the shock front and the contact discontinuity 3 2 high mach number shock the standard shock tube tests indicate that the code can adequately cope with weakly com pressible flows for shocks associated with sn driven turbulence however this is not sufficient simulations of the ism commonly include minimal temperatures near 100 k sound speed 0 5 km s 1 and maximal velocities above 1000 km s 1 even if we exclude the improbable extrema of mach 2000 associated with sn explosions deep within molecular clouds we regu larly encounter mach 100 shocks in these simulations depending on the ambient temperature around each sn location in figure 5 we show the results of a riemann shock test exceeding mach 100 the adiabatic index is 5 3 the pressure discontinuity is about five orders of magnitude as well as increasing the artificial viscosity and thermal diffusivity coefficients to shock 6 0 shock 2 0 we also include an artificial diffusion to the continuity equation as described in section 2 3 in this example we set dshock 1 0 june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 9 0 70 0 75 0 80 0 85 0 90 0 95 1 00 x 2 5 2 0 1 5 1 0 0 5 0 0 0 5 ln analytic nx 2048 nx 512 nx 256 nx 128 nx 64 nx 32 0 70 0 75 0 80 0 85 0 90 0 95 1 00 x 0 0 0 1 0 2 0 3 0 4 0 5 0 6 0 7 0 8 p analytic nx 2048 nx 512 nx 256 nx 128 nx 64 nx 32 0 70 0 75 0 80 0 85 0 90 0 95 1 00 x 0 5 0 0 0 5 1 0 1 5 2 0 u analytic nx 2048 nx 512 nx 256 nx 128 nx 64 nx 32 0 70 0 75 0 80 0 85 0 90 0 95 1 00 x 1 0 1 5 2 0 2 5 3 0 3 5 4 0 4 5 5 0 e analytic nx 2048 nx 512 nx 256 nx 128 nx 64 nx 32 figure 4 the moderate shock tube test sod 1978 detailed in figure 2 at t 0 150 with grid resolution between 32 and 2048 zoomed in shock front near x 0 9 applying shock dependent artificial diffusion with diffusivity coefficients cshock 0 4 0 5 initial discontinuity profile smoothing scale 1 5 x and hyperdiffusion in the form of upwind differencing figures show gas density pressure velocity and internal energy colour online 0 0 0 2 0 4 0 6 0 8 1 0 x 2 5 2 0 1 5 1 0 0 5 0 0 0 5 ln analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 0 5000 10000 15000 20000 25000 30000 35000 40000 45000 p analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 50 0 50 100 150 200 250 u analytic numeric 0 0 0 2 0 4 0 6 0 8 1 0 x 0 10000 20000 30000 40000 50000 60000 70000 e analytic numeric figure 5 high mach number shock tube test sod 1978 with 256 grid points at t 0 0014 where the density pressure on the left is initially set to p 1 0 6 4 10 10 and on the right p 0 125 4 8 10 15 figures show gas density pressure velocity internal energy and the analytic solution orange line the diffusivity coefficients used are cshock 1 6 2 colour online in the density profile of figure 5 there is a small overshoot in energy behind the shock accompanied by some numerical oscillation at the contact discontinuity whether the spikes or dips are the larger depends on the level of smoothing relative to the strength of the dis continuity profile as mentioned earlier we have little control of the structure of the shock injections in the turbulent ism environment so we expect some such artifacts to be present but choose coefficients to optimally dampen such oscillations the post shock density does june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 10 gent et al 0 75 0 80 0 85 0 90 0 95 1 00 x 2 0 1 5 1 0 0 5 ln analytic nx 2048 nx 512 nx 256 nx 128 nx 64 nx 32 0 75 0 80 0 85 0 90 0 95 1 00 x 0 1000 2000 3000 4000 5000 6000 7000 8000 p analytic nx 2048 nx 512 nx 256 nx 128 nx 64 nx 32 0 75 0 80 0 85 0 90 0 95 1 00 x 50 0 50 100 150 200 250 u analytic nx 2048 nx 512 nx 256 nx 128 nx 64 nx 32 0 75 0 80 0 85 0 90 0 95 1 00 x 0 5000 10000 15000 20000 25000 30000 35000 e analytic nx 2048 nx 512 nx 256 nx 128 nx 64 nx 32 figure 6 results for various grid resolutions 32 2048 grid points for the high mach number 100 riemann shock tube test shown in figure 5 figures show gas density pressure velocity and internal energy and the analytic solution the diffusivity coefficients used are cshock 1 6 2 colour online 10 3 10 2 x 10 3 10 2 10 1 100 fig 4 x 0 96 fig 6 x 0 74 figure 7 convergence study for the moderate shock tube test shown in figure 4 and the strong shock tube test shown in figure 6 fit values are shown in legend points with same color were run at same resolution in the two different models colour online not quite reach the analytic value we consider the effect of resolution in figure 6 by zooming in on the shock front at this same moment in its evolution for resolution below 128 grid points the numerical solution is a poor approximation of the analytic solution we see that the post shock density is slightly lower than the analytic solution with correspondingly higher energy we shall show in section 3 3 that this asymptotic disparity with the analytic result is due to the mass diffusion term apart from the smoothed profile at the shock front x 0 91 the greatest numerical error arises for density and energy at the contact discontinuity x 0 81 where a further step function evolves as the resolution increases the distribution converges to a profile more closely aligned with the analytical solution even at the contact discontinuity the errors mostly reduce except for enhanced extrema nearest the discontinuity further investigation is required to address this latter detail to test the convergence of the scheme we compare for each resolution the l 1 error norm june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 11 0 75 0 80 0 85 0 90 0 95 1 00 x 2 0 1 5 1 0 ln analytic shock 8 0 shock 6 0 shock 4 0 shock 2 0 shock 1 0 0 75 0 80 0 85 0 90 0 95 1 00 x 0 1000 2000 3000 4000 5000 6000 7000 8000 9000 p analytic shock 8 0 shock 6 0 shock 4 0 shock 2 0 shock 1 0 0 75 0 80 0 85 0 90 0 95 1 00 x 50 0 50 100 150 200 250 u analytic shock 8 0 shock 6 0 shock 4 0 shock 2 0 shock 1 0 0 75 0 80 0 85 0 90 0 95 1 00 x 0 5000 10000 15000 20000 25000 30000 35000 e analytic shock 8 0 shock 6 0 shock 4 0 shock 2 0 shock 1 0 figure 8 variation of solution for high mach number shock tube figure 5 with varying shock viscosity coefficient shock 1 2 4 6 8 compared to the analytic solution zoomed in near the shock front at t 0 0014 and 256 zone resolution figures show gas density pressure velocity internal energy and the analytic solution orange line the diffusivity coefficients are cshock 1 shock 2 colour online given by see e g stone and norman 1992 n i 1 qi q i n 23 with n qi and q i denoting the number of gridpoints the numerical solution and analytical solution respectively the errors are shown in figure 7 for the moderate shock tube test figure 4 and the high mach number shock tube resolution comparisons displayed in figure 6 for the moderate solution we find the convergence rate x 0 96 while for the high mach number solution this reduces to x 0 74 so the higher order accuracy of the pencil code is restricted to first order accuracy for the shock handling however this is very localised and the modelling of the turbulence for which these methods are intended still mainly benefits from the higher order capabilities of the code 3 3 dependence on diffusivity and mass diffusion correction the analytic solutions to the weak and moderate shock tube tests are reasonably satisfied with modest artificial viscosity and artificial thermal diffusivity without any requirement to introduce artificial mass diffusion to the continuity equation first we shall consider the effects of the two former applications of diffusivity on the numerical solution and then we shall discuss the motivation and consequences of adopting mass diffusion when we consider the effect of the artificial viscosity for the strong shock tube test mach 100 illustrated in figure 8 we see that for shock 1 0 an instability appears to over pressure the shock spreading the faster shock front and reducing its density as the viscosity coefficient increases the solution approaches the analytic value for the post shock density and energy although more smoothed at the corners the pressure and velocity shock fronts con verge to the analytic position although also slightly broadened but as seen in the resolution comparisons of figure 6 the solution improves as resolution increases as can be seen from shock 6 and 8 the numerical solution does not continue to broaden but approaches an june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 12 gent et al 0 75 0 80 0 85 0 90 0 95 1 00 x 2 0 1 5 1 0 ln analytic shock 8 0 shock 6 0 shock 4 0 shock 2 0 shock 1 0 shock 0 0 0 75 0 80 0 85 0 90 0 95 1 00 x 0 1000 2000 3000 4000 5000 6000 7000 8000 p analytic shock 8 0 shock 6 0 shock 4 0 shock 2 0 shock 1 0 shock 0 0 0 75 0 80 0 85 0 90 0 95 1 00 x 50 0 50 100 150 200 250 u analytic shock 8 0 shock 6 0 shock 4 0 shock 2 0 shock 1 0 shock 0 0 0 75 0 80 0 85 0 90 0 95 1 00 x 0 5000 10000 15000 20000 25000 30000 35000 e analytic shock 8 0 shock 6 0 shock 4 0 shock 2 0 shock 1 0 shock 0 0 figure 9 variation of solution for high mach number shock tube figure 5 with varying shock thermal diffusivity coefficient shock 0 1 2 4 6 8 at t 0 0014 and 256 zone resolution figures show gas density pressure velocity internal energy and the analytic solution orange line zoomed in near the shock front the diffusivity coefficients are cshock 1 6 shock colour online asymptotic profile further increases do not significantly smooth the shock profiles but can reduce the timestep and induce nonlinear instabilities due to increased viscous forces or vis cous heating as discussed in section 4 4 these solutions adequately suppress the wiggles in the wake of the shock now consider the dependence of the solution on the shock thermal conductivity shock shown in figure 9 in all profiles we find weak dependence on the strength of shock the artificial thermal diffusion could reasonably be neglected except for the density and energy extrema in the wake of the contact discontinuity compared to the dependence on artificial viscosity increases in the shock thermal diffusion beyond shock 4 or 8 appear to cause less additional diffusion these values do not appear strongly advantageous over values of 1 and 2 yet we know from experiments with sn turbu lence and the higher resolution snowplough tests reported in section 4 that the slightly larger oscillations illustrated in the density profile for shock 0 are sufficient to lead to numerical instability we recommend a nonzero value of shock for moderately compressible turbulence shock 1 0 and for highly compressible turbulence shock 2 0 higher values should be avoided to limit diffusion particularly in energy in figure 10 we display results for varying values of dshock when this is set to zero the lag in the position of the shock front is largest but the post shock density approaches the analytic value most closely there does not appear to be convergence to an asymptotic profile as dshock increases with tests using values above 50 showing greater diffusion at both the shock and the contact discontinuity larger magnitude extrema at the contact discontinuity may even appear for higher values in all the experiments presented in this paper the mass diffusion does not improve the numerical solutions however the sn driven turbulence experiments are susceptible to nu merical instabilities near interacting shocks and artificial mass diffusion has been found to suppress these effects to investigate the underlying process we applied a shock tube test with three initial discontinuities designed to induce collisions between shock waves the initial density velocity and energy profiles are displayed in figure 11 alongside their june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 13 0 75 0 80 0 85 0 90 0 95 1 00 x 2 0 1 5 1 0 ln analytic dshock 8 0 dshock 4 0 dshock 2 0 dshock 1 0 dshock 0 0 0 75 0 80 0 85 0 90 0 95 1 00 x 0 1000 2000 3000 4000 5000 6000 7000 8000 p analytic dshock 8 0 dshock 4 0 dshock 2 0 dshock 1 0 dshock 0 0 0 75 0 80 0 85 0 90 0 95 1 00 x 50 0 50 100 150 200 250 u analytic dshock 8 0 dshock 4 0 dshock 2 0 dshock 1 0 dshock 0 0 0 75 0 80 0 85 0 90 0 95 1 00 x 0 5000 10000 15000 20000 25000 30000 35000 e analytic dshock 8 0 dshock 4 0 dshock 2 0 dshock 1 0 dshock 0 0 figure 10 variation of solution for high mach number shock tube figure 5 with varying shock mass diffusion coefficient dshock 0 1 2 4 8 at t 0 0014 and 256 zone resolution figures show gas density pressure velocity internal energy and the analytic solution zoomed in near the shock front the diffusivity coefficients are cshock dshock 6 2 colour online 0 0 0 2 0 4 0 6 0 8 1 0 x 4 5 4 0 3 5 3 0 2 5 2 0 1 5 1 0 0 5 0 0 ln t 0 0006 t 0 dshock 0 0 dshock 1 0 0 0 0 2 0 4 0 6 0 8 1 0 x 5 4 3 2 1 0 1 ln t 0 0015 t 0 dshock 0 0 dshock 1 0 0 0 0 2 0 4 0 6 0 8 1 0 x 400 300 200 100 0 100 200 u t 0 0006 t 0 dshock 0 0 dshock 1 0 0 0 0 2 0 4 0 6 0 8 1 0 x 300 200 100 0 100 200 u t 0 0015 t 0 dshock 0 0 dshock 1 0 0 0 0 2 0 4 0 6 0 8 1 0 x 0 10 20 30 40 50 60 70 e 0 0 0 t 0 0006 t 0 dshock 0 0 dshock 1 0 0 0 0 2 0 4 0 6 0 8 1 0 x 0 20 40 60 80 100 120 140 e 0 0 0 t 0 0015 t 0 dshock 0 0 dshock 1 0 figure 11 results with 256 grid points for high mach number riemann shock tube interacting triplet numerical solutions for density velocity and energy are compared for mass diffusion coefficient dshock 0 and 1 at t 0 0006 left panels and 0 0015 right panels cshock dshock 6 2 colour online june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 14 gent et al evolved profiles at t 0 0006 and 0 0015 for dshock 0 and 1 at 0 0006 the energy peak near x 0 5 is near the convergent flow and subject to the viscosity applying near the shock the energy near the compression is not more enhanced without mass diffusion at t 0 0015 the spike in energy at x 0 4 is almost an order of magnitude higher than at t 0 0006 and is not near the compressive flows at x 0 5 and 0 3 the energy spike is significantly enhanced without mass diffusion and is associated with a deeper local minimum in the density we conclude from this analysis that modest artificial viscosity and thermal diffusivity allow a reasonable representation of adiabatic shocks with high mach number the lag in shock position and thickness of the shock front in the lowest resolution runs are not significantly dependent on the values of the diffusion coefficients and are both resolution artifacts the mass diffusion spreads the mass in the shock front beyond the analytic region numerical instability in the full turbulent simulations seems to occur at interacting shocks that produce wall heating and density deficits inclusion of mass diffusion likely regularizes these points inhibiting numerical instability dshock 1 or 2 is recommended and appears sufficient to avoid numerical instability 4 3 d supernova remnants previous tests of sn modelling with the pencil code are reported in gent 2012 appendix a these included higher shock diffusivity coefficients explicit shear viscosity and thermal conductivity and suppression of the cooling near shock fronts we now use access to greater computational resources to apply the tests across a wider range of ambient densities and grid resolution with enhanced timestep control the improved treatment of artificial viscosity described here and without unphysical suppression of radiative cooling numerical results are compared with analytic solutions for an sn remnant expanding into a perfect homogeneous monatomic gas at rest for these experiments we apply adiabatic index 5 3 the sn energy is injected into the existing density distribution in a sphere with an initial nominal radius of r 0 the energy injection radial profile follows e r e 0 exp r r 0 2 24 with normalising coefficient e 0 set such that the volume integral of e r is 10 51 erg the remnant origin is located on a grid point and r 0 5 grid zones this provides a sufficiently smooth initial shock front which can also be handled in a highly nonuniform turbulent injec tion site while the remnant formed has a reasonably uniform internal temperature although the minimum initial radius is at least 5 grid zones a further constraint is to expand the injection radius to ensure at least 50 m is present to limit extreme heating of the gas and corresponding drops in the time step as well as numerical instability consequently the 0 001 cm 3 model has an initial radius of 78 pc for these tests the low density models can cope with smaller injection radii but in the turbulent system we need to ensure there is enough total mass to avoid local numerical instability some authors avoid the additional complications of turbulent injection sites by smoothing the gas to a uniform density for example joung and mac low 2006 adjust the radius to enclose 60 m then smooth the volume to a uniform density to handle explosions in high density regions where delayed evacuation of the remnant interior induces excess cooling that can inhibit the power of the sn one solution is simply to delete enough mass inside the injection site to allow high enough temperature or to move the mass to the remnant shell at injection so far we have been able to avoid such measures and particularly when evolving the dynamo would prefer not to unphysically remove the gas from the magnetic field or consider also rearranging its ambient vector potential field june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 15 10 1 100 t myr 0 10 0 04 0 06 sh el l r ad iu s k pc n 0 10 1 cm 3 n 0 1 cm 3 n 0 5 cm 3 sedov taylor figure 12 time evolution of remnant shell radius in the adiabatic sedov taylor regime for ambient gas number density between 0 1 and 5 cm 3 with resolution along each side of 4 pc the diffusivity coefficients used are cshock 1 6 2 and viscosity 0 004 cs kpc km s 1 colour online 4 1 adiabatic remnant the early stages of sn evolution are approximately adiabatic for a uniform ambient medium they are well described by the sedov taylor analytic solution taylor 1950 sedov 1959 r esn 0 1 5 t 2 5 25 where r is the remnant radius esn the explosion energy 0 the ambient gas density and the dimensionless parameter 2 026 for 5 3 ostriker and mckee 1988 in figure 12 for a range of ambient ism densities we compare the radial evolution of the remnant shell between our numerical models and the analytic solution described by 25 the coefficients used are cshock 1 6 2 as explained in section 2 5 we also include for all sn remnant experiments viscosity cs x to verify that the numerical solution remains valid for the parameters relevant to modelling sn driven turbulence the power law growth of the radius is in reasonable agreement with the analytic prediction while only slightly more retarded as the ambient density increases from 19 we see a contribution to the viscous forces from the gradients of ln and u the net effect is negative becoming more relevant as density increases 4 2 momentum conserving pressure driven and momentum driven snowplough when radiative cooling processes are included the sn evolution changes the pencil code currently has two implementations of radiative cooling associated with sn turbulence both based on piecewise power law dependence of the cooling coefficient on temperature these are described in gent et al 2013 a see their figure 1 and are based on rosen et al 1993 rb and a combination of wolfire et al 1995 and sarazin and white 1987 wsw the contribution from fuv heating follows wolfire et al 1995 see gent et al 2013 a which is truncated for temperatures above 104 k as the remnant expands and the shock front accumulates more gas from the ambient ism cooling becomes more efficient in the increasingly dense shell with the loss of energy the shell speed falls the standard momentum conserving snowplough solution for a radiative sn remnant has the form r r 0 1 4 r 0 r 0 t t 0 1 4 26 june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 16 gent et al where r 0 is the radius of the sn remnant at the time t 0 of the transition from the adiabatic stage and r 0 is the shell expansion speed at t 0 the transition time is determined by woltjer 1972 to align with half of the sn energy being lost to radiation this happens when r 0 230 km s 1 n 0 1 cm 3 2 17 esn 1051 erg 1 17 27 with n 0 the gas number density of the ambient ism the transitional expansion speed thus depends very weakly on parameters cioffi et al 1988 obtained numerical and analytical solutions for an expanding sn remnant with special attention to the transition from the sedov taylor stage to the radiative stage these authors adjusted an analytical solution for the pressure driven snowplough stage to fit their numerical results to an accuracy of within 2 and 5 in terms of r and r respectively their numerical resolution was 0 1 pc in the interstellar gas and 0 01 pc within ejecta they thus obtained r rp 4 3 t tp 1 3 3 10 28 where the subscript p denotes the radius and time for the transition to the pressure driven stage the estimated time of this transition is tp 13 myr esn 1051 erg 3 14 n 0 1 cm 3 4 7 29 this continues into the momentum driven stage with r rp 4 3 63 t tm tp 1 29 tp tm 0 17 rm rp 4 30 where subscript m denotes the radius and time for this second transition r 4 m 4 66 t tp 1 0 939 t tp 0 17 0 153 t tp 1 31 and tm 61 tp r ej 103 km s 1 3 esn 1051 erg 3 14 n 0 1 cm 3 3 7 32 where r ej 5000 km s 1 is the initial velocity of the 4 m ejecta the shell momentum in the latter solution tends to a constant and the solution thus converges with the momentum conserving snowplough see 26 but depending on the ambient density the expansion may become subsonic and the remnant merge with the ism beforehand to ultimately follow the analytical solution we require the injection radius to be significantly less than rp so that the early evolution remains adiabatic although in most cases our remnant injection site is sufficiently compact and diffuse to evolve to follow the analytical solution for low resolution and high ambient density r 0 may be near or even beyond rp in such cases an adjustment needs to be made to compensate for the radiative losses that would have preceeded we follow the approach of simpson et al 2015 their eq 16 to define a fraction fkin of esn injected as kinetic energy fkin 3 97 10 6 x 2 n 0 esn r 7 p t 2 p 33 where is the mean molecular weight and rp and tp themselves depend on n 0 and esn and metallicity z which we assume to be 1 rp tp and esn are normalised by pc 10 3 yr and june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 17 10 1 100 101 t myr 0 10 0 04 0 06 0 20 0 40 0 60 sh el l r ad iu s k pc n 0 10 3 cm 3 n 0 10 1 cm 3 n 0 1 cm 3 n 0 5 cm 3 cioffi et al figure 13 time evolution of remnant shell radius following cooling function of rb for ambient gas number density between 0 001 and 5 cm 3 with grid cell resolution of 4 pc the diffusivity coefficients used are cshock 1 6 2 and 0 004 cs kpc km s 1 colour online 1051 erg respectively following kim and ostriker 2015 we normalise n 0 by 0 1 4 mh assuming 10 helium abundance and mh the hydrogen atomic mass this fraction can be greater than 1 and a high fraction of kinetic energy makes the model more vulnerable to numerical instability so we apply a cap of 0 075 and apply only where rp 1 5 r 0 for x 1 pc the remnant shell radial profiles are computed for the ambient densities n 0 0 001 0 01 0 1 1 5 cm 3 used in the tests reported here although these semi analytical models are a useful comparison to examine the accuracy of our numerical models there are differences to consider the cioffi et al 1988 1 d analysis was conducted for ambient ism with number density 0 1 cm 3 and ambient temperature 10 k to ensure the blast wave re mained strong their cooling follows a different piecewise power law fit raymond et al 1976 than we use and is truncated below 1 2 104 k and they do not include uv heating they use resolution 0 1 pc outside the remnant and 0 01 pc to resolve the ejecta because heating and cooling apply in our models at lower temperatures for each density and each cooling func tion the ambient temperature is set at thermal equilibrium so the external pressure remains constant over time results for the rb cooling curve are illustrated in figure 13 the power law is a good fit for the ambient density 0 1 cm 3 most closely matching the cioffi et al 1988 setup although the shell radius is somewhat retarded in our model in figure 14 we see better agreement with cioffi et al 1988 for the combination cooling model except for ambient density n 0 5 cm 3 this is accounted for by the truncation in the cooling applied by cioffi et al 1988 for comparison we tested the combination cooling model with cooling truncated below 1 2 104 k and obtain excellent agreement with the analytic solution at all ambient densities as shown in figure 14 the cooling at all temperatures is faster for the rb model than the combination wsw cooling model so it is understandable that the remnants in the former case would expand slower we note that the ambient temperatures vary between the model cooling function and its truncated version since we applied a thermostatic equilibrium to the ambient ism and hence the truncated models have merger with the ism earlier at the higher sound speed the time at which the remnant reaches mach 2 non truncated cooling is added to indicate how close the numerical solution is to the analytic solution when the remnant is near to becoming subsonic with respect to the ambient medium the relationship between cooling temperature and density is nonlinear so it is not clear that the relations derived by cioffi et al 1988 for 0 1 cm 3 ambient ism should also apply for the other densities nonetheless the results at all ambient densities seem reasonable for higher densities above 1 cm 3 at this resolution the inclusion of fkin is required june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 18 gent et al 100 t m r 0 04 0 06 sh el l r ad iu s k pc mach 2 n 0 5 cm 3 truncated cooling cioffi et al 10 1 100 t myr 0 04 0 06 sh el l r ad iu s k pc mach 2 n 0 1 cm 3 truncated cooling cioffi et al 10 1 100 t myr 0 10 0 06 sh el l r ad iu s k pc mach 2 n 0 10 1 cm 3 truncated cooling cioffi et al 10 1 100 t myr 0 20 0 40 0 60 sh el l r ad iu s k pc mach 2 n 0 10 3 cm 3 truncated cooling cioffi et al figure 14 time evolution of remnant shell radius following cooling function of wsw and for the same cooling function but truncated below t 1 2 104 k for ambient gas number density between 10 3 and 5 cm 3 at grid resolution of 4 pc the cioffi et al 1988 analytic solution is indicated for comparison the diffusivity coefficients used are cshock 1 6 2 and 0 004 cs kpc km s 1 the time is marked at which the shell speed has slowed to mach 2 for the non truncated cooling model colour online 4 3 effects of ambient density resolution and diffusivity snapshots of the remnant density temperature and velocity distributions at 4 pc resolution for ambient densities 5 0 1 and 0 01 cm 3 are displayed in figure 15 the 3 d simulations are on a cartesian grid with the sn origin at 0 as the profile is symmetric unnecessary duplication is avoided by displaying a quarter plane the snapshots are at times when the shell expansion is near mach 2 in the middle column the cooling shell is faintly visible for 5 cm 3 where its temperature has dropped below the ambient medium while in the lower density runs the shell has not yet cooled below the ambient ism although visibly cooler than the external shocked region for ambient density 1 cm 3 we explore the effects of resolution at this density the thermal equilibrium with the wsw cooling and heating occurs at about 2185 k which is on a thermally unstable branch of the cooling curve in developing the numerical model this density proved to be more vulnerable to instabilities than either lower or higher densities it therefore was of most interest for the resolution tests in figure 16 we compare the time evolution of the shell radius for grid resolutions of 0 5 4 pc at ambient density 1 cm 3 there is convergence towards the analytic result with increasing resolution in comparing these results we apply resolution dependent optimal radius r 0 7 9 8 5 9 2 and 17 pc respectively with increasing zone size and with fkin 0 alternatively fixing r 0 17 pc the minimum size required to resolve a sphere at 4 pc resolution yields solutions that are consistently slower with increasing resolution this is because the remnant shell reaches higher densities permitting more efficient cooling although a radius r 0 17 pc sphere covers 4 25 grid zones at 4 pc resolution this is not ideal to represent a sphere on a cartesian grid the evolving spherical shell is adequate with a radius of r 0 24 pc but with purely thermal energy injection is subject to excessive energy losses including the kinetic energy adjustment with fkin 0 produces excellent agreement at all resolutions as intended such a solution at 4 pc resolution is included in figure 16 to illustrate the effectiveness of the june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 19 0 00 0 02 0 04 0 06 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 y k pc 10 2 12 10 1 61 10 1 10 10 0 58 10 0 07 100 44 100 96 n c m 3 0 00 0 02 0 04 0 06 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 101 91 102 23 102 55 102 87 103 18 103 50 103 82 t k 0 00 0 02 0 04 0 06 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 4 08 myr 5 3 2 0 2 3 5 u x k m s 1 a ambient density 5 cm 3 0 00 0 05 0 10 x kpc 0 00 0 02 0 04 0 06 0 08 0 10 0 12 0 14 y k pc 10 2 89 10 2 51 10 2 13 10 1 76 10 1 38 10 1 00 10 0 62 n c m 3 0 00 0 05 0 10 x kpc 0 00 0 02 0 04 0 06 0 08 0 10 0 12 0 14 103 91 104 24 104 58 104 91 105 24 105 57 105 91 t k 0 00 0 05 0 10 x kpc 0 00 0 02 0 04 0 06 0 08 0 10 0 12 0 14 0 97 myr 41 27 14 0 14 27 41 u x k m s 1 b ambient density 10 1 cm 3 0 0 0 2 0 4 x kpc 0 0 0 1 0 2 0 3 0 4 0 5 y k pc 10 4 75 10 4 38 10 4 01 10 3 63 10 3 26 10 2 89 10 2 51 n c m 3 0 0 0 2 0 4 x kpc 0 0 0 1 0 2 0 3 0 4 0 5 104 32 104 66 104 99 105 33 105 67 106 00 106 34 t k 0 0 0 2 0 4 x kpc 0 0 0 1 0 2 0 3 0 4 0 5 3 20 myr 53 35 18 0 18 35 53 u x k m s 1 c ambient density 10 3 cm 3 figure 15 two dimensional quarter slices from the z 0 plane depicting gas number density temperature and x component of velocity ambient gas number density is top 5 cm 3 middle 0 1 cm 3 and bottom 10 3 cm 3 each snapshot corresponds to the time at which the remnant shell speed falls to mach 2 for the ambient ism note the resulting order of magnitude change in the size scale and thus numerical resolution of the shock from top to bottom the diffusivity coefficients used are cshock 1 6 2 and 0 004 cs kpc km s 1 colour online 0 5 1 0 1 5 2 0 2 5 3 0 3 5 4 0 t myr 0 03 0 04 0 05 0 06 0 07 0 08 0 09 sh el l r ad iu s k pc mach 2 cioffi et al x 4 0 pc x 2 0 pc x 1 0 pc x 0 5 pc fkin 0 x 4 0 pc figure 16 time evolution of remnant shell radius following the combined cooling function of wsw for unit ambient density at grid resolution of 0 5 4 pc with increasing resolution the numerical solution converges to the semi analytic solution of cioffi et al 1988 the diffusivity coefficients used are cshock 1 6 2 and cs x the time is marked at which the shell speed has slowed to mach 2 for comparison at 4 pc resolution we show the effect of including a fraction fkin of the sn energy as kinetic colour online june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 20 gent et al 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 02 0 04 0 06 0 08 y k pc 10 3 81 10 3 14 10 2 47 10 1 79 10 1 12 10 0 45 100 22 n c m 3 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 102 42 102 69 102 95 103 22 103 48 103 74 104 01 t k 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 1 27 myr 12 8 4 0 4 8 12 u x k m s 1 a resolution x 4 0 pc 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 02 0 04 0 06 0 08 y k pc 10 2 92 10 2 36 10 1 80 10 1 25 10 0 69 10 0 14 100 42 n c m 3 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 102 17 102 63 103 08 103 53 103 98 104 44 104 89 t k 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 1 19 myr 15 10 5 0 5 10 15 u x k m s 1 b resolution x 2 0 pc 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 02 0 04 0 06 0 08 y k pc 10 2 95 10 2 34 10 1 72 10 1 11 10 0 50 100 12 100 73 n c m 3 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 101 98 102 52 103 06 103 60 104 14 104 68 105 22 t k 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 1 19 myr 19 13 6 0 6 13 19 u x k m s 1 c resolution x 1 0 pc figure 17 varying resolution models with a x 4 pc b 2 pc and c 1 pc two dimensional quarter slices from the z 0 plane depicting gas number density temperature and x component of velocity are shown ambient gas number density is 1 cm 3 the diffusivity coefficients used are cshock 1 6 2 and cs x colour online adjustment slices of snapshots from these runs while the shell is expanding at mach 2 into the ambient ism are displayed in figure 17 at 4 pc resolution we see that the shell has not yet started to cool below the ambient ism temperature figure 17 a middle panel while at 2 pc and below cooling occurs in previous pencil code sn driven turbulence at 4 pc resolution cold gas below 100 k was present but this result suggests they arose primarily from compression fronts at remnant interactions and general turbulent shocks the reverse shocks seen in the remnant interior at moderate resolution in figures 15 and 17 occur because the ambient pressure is non zero and the energy input is not an idealized point source in the diffuse interior with low momentum these velocities can be higher than the remnant shell speed the effect reduces with increasing resolution since the coarse cartesian grid defining the injection sphere exacerbates this effect slices of the highest resolution model of 0 5 pc grid spacing are shown in figure 18 for snaphots at the time when the shell reaches mach 2 for models including shear viscosity and without with 0 we see the emergence of the vishniac ostriker bertschinger vish niac 1983 vishniac et al 1985 overstability arising from the cooling reducing the thickness of the shell the overstability can be seen entering the nonlinear phase in the thin dense cooled shell see mac low and norman 1993 for a detailed analysis but this is suppressed june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 21 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 02 0 04 0 06 0 08 y k pc 10 2 87 10 2 23 10 1 58 10 0 94 10 0 30 100 35 100 99 n c m 3 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 101 95 102 55 103 15 103 75 104 35 104 95 105 55 t k 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 1 19 myr 25 17 8 0 8 17 25 u x k m s 1 a cs x kpc km s 1 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 02 0 04 0 06 0 08 y k pc 10 3 17 10 2 48 10 1 79 10 1 10 10 0 41 100 28 100 97 n c m 3 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 101 95 102 60 103 24 103 89 104 53 105 17 105 82 t k 0 00 0 02 0 04 0 06 0 08 x kpc 0 00 0 01 0 02 0 03 0 04 0 05 0 06 0 07 0 08 1 20 myr 63 42 21 0 21 42 63 u x k m s 1 b 0 figure 18 varying diffusivity coefficients cshock 1 6 2 and 5 10 4 cs kpc km s 1 upper and 0 lower two dimensional quarter slices from the z 0 plane depicting gas number density temperature and x component of velocity are shown ambient gas number density is 1 cm 3 and the grid resolution is 0 5 pc the bottom panel shows vishniac ostriker bertschinger overstability which is absent in the top panel where the shear viscosity suppresses the effect colour online 0 0000 0 0005 0 0010 0 0015 0 0020 0 0025 0 0030 0 0035 0 0040 t gyr 10 7 10 6 t g yr x 4 0 pc x 2 0 pc x 1 0 pc x 0 5 pc 0 0000 0 0005 0 0010 0 0015 0 0020 0 0025 0 0030 0 0035 0 0040 t gyr 10 3 10 2 10 1 u m ax g yr 1 x 4 0 pc x 2 0 pc x 1 0 pc x 0 5 pc figure 19 first panel timestep evolution in unit ambient density single sn explosion runs with grid resolution of 4 2 1 and 0 5 pc second panel evolution of the maximal value of convergence included in the artificial diffusion coefficients colour online with 0 0005 cs 4 4 timestep dependence the timestep for snowplough tests see section 4 3 with grid resolution 0 5 4 pc is plotted in the first panel of figure 19 based on the diffusive timestep control the dependence on resolution would be expected to be quadratic in the change in x such that the timestep for the x 0 5 pc run would be four times smaller than that of the x 1 pc run in these relatively simple single sn expanding shocks the magnitude of the viscous forces does not much exceed 106 km s 1 gyr 1 and the timestep control is dominated by the artificial thermal diffusivity from the second panel of figure 19 it is evident that the maximal convergence and therefore also approximately halves for each doubling in resolution this indicates june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 22 gent et al 0 0000 0 0002 0 0004 0 0006 0 0008 0 0010 0 0012 0 0014 0 0016 t gyr 10 8 10 7 t g yr ratio t 2 44 x 0 78 pc x 1 56 pc 0 0000 0 0002 0 0004 0 0006 0 0008 0 0010 0 0012 0 0014 0 0016 t gyr 10 1 100 u m ax g yr 1 x 0 78 pc x 1 56 pc figure 20 first panel timestep evolution in sn driven turbulent simulations in unstratified periodic boxes with grid resolution of 1 56 and 0 78 pc dotted lines indicate the average timestep for each simulation dshock shock shock 1 4 4 second panel evolution of the maximal value of convergence included in the artificial diffusion coefficients colour online that the explicit artificial diffusivities are inversely proportional to the grid resolution thus the timestep appears to drop only linearly with grid cell size rather than with the quadratic dependence expected for constant diffusivity to demonstrate the effect on timestep in evolved turbulent systems where the viscous forces and temperature gradients are large enough to impact the stability the timestep and maximum convergence are plotted in figure 20 for simulations with grid spacing of 1 56 pc and 0 78 pc the models apply random sn forcing to an unstratified magnetized ambient ism with gas number density 1 cm 3 in a periodic slab the time series are extracted from a statistical steady turbulent system in which the mag netic field has saturated at a strength of a few g temporal mean rms velocity maximum velocity and gas density and temperature extrema have similar values in each simulation the timestep with the increased resolution is on average 2 44 times smaller the magnitude of the maximal convergence displayed in the second panel of figure 20 does not differ much due to resolution as in the case of the single sn simulations the drop in timestep remains approximately linear with grid cell size but not due to the lower strength of convergence the timestep is most often controlled by the gradients in the flow and the temperature both are typically higher with increased resolution but the cost is again lower than the quadratic dependence associated with constant diffusivity 5 summary of results in order to stabilize shocks in the high order pencil code we have demonstrated the use of a von neumann artificial viscosity as implemented for example by stone and norman 1992 in combination with the application at the shock front of artificial thermal diffusivity and mass diffusion to the energy and continuity equations this combination reduces the vulnerability of the pencil code to numerical instability while significantly reducing the overall diffusivity of the model previously applied by gent 2012 to sn driven turbulence in the ism the inclusion of artificial mass diffusion alters the determination of momentum and energy and we implement a correction term to each equation to consistently conserve their properties similar artifical mass diffusion has been applied by for example ryutov et al 2005 and johansen et al 2006 2009 but without explicit corrections to the momentum and energy equations we have also introduced novel additional tools for controlling the timestep depending on the sum of all terms on the right hand side of the momentum equation and the energy equation these stabilize the code by constraining the time step based on the maximal change in time of the force and heating at each iteration empirically we find the viscous forces viscous june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent geophysical astrophysical fluid dynamics 23 heating and temperature gradients tend to be extremely high in the sn turbulence and can introduce numerical instabilities if the timestep is not sufficiently small to resolve the time evolution the alternative of just reducing the courant number for the diffusive timestep may work but as it is based on the diffusion coefficients alone tend to reduce the timestep more universally the adaption to the maximal forces or heating acts only when they are largest often in the aftermath of an sn so the timestep can recover subsequently another advantage is that the timestep can be less sensitive to decreases in grid spacing compared to the diffusive timestep which scales inversely with the square of the grid spacing this is because the unified time steps tend to be proportional to the size of the cell to cell velocity gradients which decrease with decreasing cell size hence increases in resolution need not be so comparatively numerically expensive the code reaches reasonable agreement with the riemann shock tube test for shocks ex ceeding mach 100 for a range of resolutions a minimum value of shock 4 is required for the artificial viscosity coefficient for such high mach numbers and some artificial thermal dif fusivity is required to dampen instabilities in the wake of the shock front the replication of the strong shock profile is relatively insensitive to changes in the coefficients shock and shock in the range 4 8 grid resolution rather than the size of the artificial diffusivity coefficients is the primary determinant of the level of smoothing present in the numerical shock profiles the divergence of the flow is inversely proportional to the grid size so the effective artificial diffusivity as function of resolution scales approximately as shock x 1 the capacity of the code to model sn blast waves was tested against the sedov taylor an alytic and cioffi et al 1988 semi analytic solutions simulations were evolved until the blast wave becomes subsonic with respect to the ambient ism the models give good agreement with the sedov taylor t 2 5 power law for the sn remnant shell radius evolution over a range of ambient ism gas number density 0 1 5 cm 3 even for a coarse grid resolution of 4 pc when cooling is included the numerical models agree reasonably with thecioffi et al 1988 offset power law for the shell radial expansion rate for ambient gas number densities 1 cm 3 and below making allowances for preceding cooling losses by applying a fraction of the energy as kinetic kim and ostriker 2015 simpson et al 2015 our models with 4 pc grid resolution and more dense ambient ism also yield good agreement with the analytic solutions this is for both cooling functions tested and notwithstanding that the semi analytic solution was derived from simulations with a different cooling prescription and were only performed for ambient density 0 1 cm 3 we demonstrate that differences between the numerical and ana lytical solutions are well explained by the differences in the efficiency of the cooling function models the effect of resolution was examined and convergence to the semi analytic solution was evident for increases in grid resolution from 4 pc to 0 5 pc in the fiducial 1 cm 3 model using less than five grid cells to resolve the initial remnant radial profile tends to be insufficient to approximate a spherical energy source on the cartesian domain including the sphere origin explicitly as a gridpoint yields the optimal spherical evolution of the remnant at high resolution a smaller injection radius improves convergence but a larger number of grid zones than five to model the injection radial profile is required to retain a stable solution for grid resolution below 1 0 pc vishniac ostriker bertschinger thin shell overstability begins to appear if no shear viscosity is implemented to directly induce cooling below the ambient temperature in the remnant shell as opposed to relying on shock interactions a grid resolution of 2 pc or better is required however for the purposes of modelling turbulence and the dynamo where it is adequate to capture the appropriate forcing energy velocities and length scales to drive the turbulence even the lowest grid resolution considered here provides good agreement with the analytic solutions this detailed analysis of the treatment of strong shocks and minimal diffusivity enables the code to now combine the large scale dynamo processes already present in gent et al june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent 24 references 2013 b with a prescription capable of supporting the small scale turbulent dynamo as present for example in balsara et al 2004 further investigation of the dependence and effect of individual sn explosions in idealised uniform and stably stratified ism with magnetic fields and cosmic rays is a natural extension of the present study acknowledgement the authors wish to acknowledge csc it center for science finland for computational resources and the financial support by the academy of finland to the resolve centre of excellence project no 307411 m mml was partly supported by us nsf grant ast 18 15461 we thank the anonymous referees for their constructive comments references balsara d s kim j mac low m m and mathews g j amplification of interstellar magnetic fields by supernova driven turbulence astrophys j 2004 617 339 349 brandenburg a and dobler w hydromagnetic turbulence in computer simulations comput phys com mun 2002 147 471 475 bushby p j ka pyla p j masada y brandenburg a favier b guervilly c and ka pyla m j large scale dynamos in rapidly rotating plane layer convection astron astrophys 2018 612 a 97 caunt s e and korpi m j a 3 d mhd model of astrophysical flows algorithms tests and parallelisation astron astrophys 2001 369 706 728 cioffi d f mckee c f and bertschinger e dynamics of radiative supernova remnants astrophys j 1988 334 252 265 de val borro m edgar r g artymowicz p ciecielag p cresswell p d angelo g delgado donate e j dirksen g fromang s gawryszczak a klahr h kley w lyra w masset f mellema g nelson r p paardekooper s j peplinski a pierens a plewa t rice k scha fer c and speith r a comparative study of disc planet interaction mon not r astron soc 2006 370 529 558 dobler w stix m and brandenburg a magnetic field generation in fully convective rotating spheres astrophys j 2006 638 336 347 elmegreen b g and scalo j interstellar turbulence i observations and processes ann rev astron astro phys 2004 42 211 273 gent f a shukurov a fletcher a sarson g r and mantere m j the supernova regulated ism i the multiphase structure mon not r astron soc 2013 a 432 1396 1423 gent f a shukurov a sarson g r fletcher a and mantere m j the supernova regulated ism ii the mean magnetic field mon not r astron soc 2013 b 430 l 40 l 44 gent f a supernova driven turbulence in the interstellar medium ph d thesis newcastle university school of mathematics and statistics 2012 haugen n e l brandenburg a and dobler w simulations of nonhelical hydromagnetic turbulence phys rev e 2004 a 70 016308 haugen n e l brandenburg a and mee a j mach number dependence of the onset of dynamo action mon not r astron soc 2004 b 353 947 952 hawley j f smarr l l and wilson j r a numerical study of nonspherical black hole accretion i equations and test problems astrophys j 1984 277 296 311 johansen a klahr h and mee a j turbulent diffusion in protoplanetary discs the effect of an imposed magnetic field mon not r astron soc 2006 370 l 71 l 75 johansen a youdin a and klahr h zonal flows and long lived axisymmetric pressure bumps in magne torotational turbulence astrophys j 2009 697 1269 1289 joung m k r and mac low m m turbulent structure of a stratified supernova driven interstellar medium astrophys j 2006 653 1266 1279 ka pyla m j gent f a va isa la m s and sarson g r the supernova regulated ism iii generation of vorticity helicity and mean flows astron astrophys 2018 611 a 15 ka pyla m j ka pyla p j olspert n brandenburg a warnecke j karak b b and pelt j multiple dynamo modes as a mechanism for long term solar activity variations astron astrophys 2016 589 a 56 ka pyla p j and korpi m j magnetorotational instability driven dynamos at low magnetic prandtl numbers mon not r astron soc 2011 413 901 907 ka pyla p j korpi m j and brandenburg a large scale dynamos in turbulent convection with shear astron astrophys 2008 491 353 362 ka pyla p j korpi m j and brandenburg a large scale dynamos in rigidly rotating turbulent convection astrophys j 2009 697 1153 1163 june 19 2019 geophysical and astrophysical fluid dynamics ggaf 2018 0035 gent references 25 ka pyla p j mantere m j and brandenburg a cyclic magnetic activity due to turbulent convection in spherical wedge geometry astrophys j lett 2012 755 l 22 kim c g and ostriker e c momentum injection by supernovae in the interstellar medium astrophys j 2015 802 99 mac low m m and norman m l nonlinear growth of dynamical overstabilities in blast waves astrophys j 1993 407 207 218 mcmillan d g and sarson g r dynamo simulations in a spherical shell of ideal gas using a high order cartesian magnetohydrodynamics code phys earth planet int 2005 153 124 135 mee a j w studies of interstellar hydromagnetic turbulence ph d thesis newcastle university school of mathematics and statistics 2007 ostriker j p and mckee c f astrophysical blastwaves rev mod phys 1988 60 1 68 raymond j c cox d p and smith b w radiative cooling of a low density plasma astrophys j 1976 204 290 292 rosen a bregman j n and norman m l hydrodynamical simulations of star gas interactions in the interstellar medium with an external gravitational potential astrophys j 1993 413 137 149 ryutov d d cohen b i cohen r h hooper e b and sovinec c r the effect of artificial diffusivity on the flute instability phys plasmas 2005 12 084504 sarazin c l and white iii r e steady state cooling flow models for normal elliptical galaxies astrophys j 1987 320 32 48 scalo j and elmegreen b g interstellar turbulence ii implications and effects ann rev astron astrophys 2004 42 275 316 sedov l i similarity and dimensional methods in mechanics 1959 new york academic press simpson c m bryan g l hummels c and ostriker j p kinetic energy from supernova feedback in high resolution galaxy simulations astrophys j 2015 809 69 sod g a a survey of several finite difference methods for systems of nonlinear hyperbolic conservation laws j comput phys 1978 27 1 31 stone j m and norman m l zeus 2 d a radiation magnetohydrodynamics code for astrophysical flows in two space dimensions i the hydrodynamic algorithms and tests astrophys j suppl ser 1992 80 753 790 taylor g the formation of a blast wave by a very intense explosion i theoretical discussion proc roy soc lond a 1950 201 159 174 vishniac e t the dynamic and gravitational instabilities of spherical shocks astrophys j 1983 274 152 167 vishniac e t ostriker j p and bertschinger e explosions in the early universe astrophys j 1985 291 399 416 wolfire m g hollenbach d mckee c f tielens a g g m and bakes e l o the neutral atomic phases of the interstellar medium astrophys j 1995 443 152 168 woltjer l supernova remnants ann rev astron astrophys 1972 10 129