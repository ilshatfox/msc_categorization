ar x iv 1 90 9 04 81 4 v 1 m at h o c 1 1 s ep 2 01 9 stochastic optimal transport with free end time samer dweik nassif ghoussoub young heon kim and aaron zeff palmer abstract we consider a stochastic transportation problem between two prescribed prob ability distributions a source and a target over processes with general drift dependence and with free end times first and in order to establish a dual principle we associate two equivalent formulations of the primal problem in order to guarantee its convexity and lower semi continuity with respect to the source and target distributions we exhibit an equiv alent eulerian formulation whose dual variational principle is given by hamilton jacobi bellman type variational inequalities in the case where the drift is bounded regularity results on the minimizers of the eulerian problem then enable us to prove attainment in the corresponding dual problem we also address attainment when the drift component of the cost defining lagrangian l is superlinear l u p with 1 p 2 in which case the setting is reminiscent of our approach in a previous work on deterministic controlled transport problems with free end time we finally address criteria under which the optimal drift and stopping time are unique namely strict convexity in the drift component and monotonicity in time of the lagrangian contents 1 introduction 1 2 stochastic formulations 4 2 1 basic assumptions and notations 4 2 2 the weak stochastic formulation 5 2 3 the convex stochastic formulation 5 3 duality and dynamic programming 10 4 eulerian formulations 13 4 1 strong and convex eulerian formulations 13 4 2 regularity 15 5 dual attainment 17 6 hitting times and strong solutions 25 references 27 1 introduction the problem of transporting a distribution from a given source to a prescribed target has been studied since the pioneering work of monge in 1781 see 26 and has many applications in analysis probability theory and partial differential equations in this paper we consider an optimal transportation problem for stochastic processes with controlled dynamics and date september 12 2019 n ghoussoub and y h kim are partially supported by the natural sciences and engineering research council of canada nserc c 2019 by the author 1 http arxiv org abs 1909 04814 v 1 2 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer free end time where the transport cost is given by a general lagrangian l on r rd rd as follows if and are two probability measures then the stochastic transport problem is formally stated as pl inf e 0 l t xt t dt dxt t dt dwt x 0 x 1 1 more precise definitions will be given later but for now we mention that the minimization is over all suitable drifts and all stopping times the notation x 0 means that the initial position of the path has as its distribution and x means that the processed stopped at the random time has as its distribution in 23 25 30 the authors consider problem 1 1 in the case where the end time is fixed 1 i e they minimize inf e 1 0 l t xt t dt dxt t dt dwt x 0 x 1 1 2 under some assumptions on the lagrangian l they establish a weak duality principle for 1 2 namely that the primal value of 1 2 equals the value of the following dual problem sup rd y dy rd j 0 x dx j solves 1 4 1 3 where 1 4 tj t x 1 2 j t x h t x j t x 0 in 0 1 rd j 1 x x on rd whereh is the hamiltonian associated to l a special case that has received recent attention is when the lagrangian is of the form l t x u 1 2 u 2 v x which has connections with the schro dinger bridge problem 20 6 24 the existence of optimal has also been established for the case when l has quadratic growth in u and the target distribution is smooth with 0 for a version of the problem including a mean field cost posed on the torus 27 28 which makes use of the variational structure and energy estimates on the other hand stopping uncontrolled processes with distribution constraints has a vast literature in particular pertaining to applications in finance for some of the approaches related to 1 1 see 1 2 3 17 coming back to problem 1 1 we shall pose the initial problem in a weaker sense so that it involves randomized stopping times and weak solutions to the sde analogous to the kantorovich relaxation of the optimal transport 18 problem the ultimate goal is to obtain minimizers involving true stopping times and representing strong solutions to the sde for that we shall give two formulations of the stochastic transport problem see section 2 which we will ultimately prove equivalent a weak stochastic formulation that poses the optimization problem over weakly controlled processes and randomized stopping times a convex stochastic formulation which poses the optimization over probability mea sures on a space of randomly stopped paths for both state and drift under appropriate conditions on l the latter equivalent formulation renders the problem l s c and convex in this will allow us to identify a corresponding dual problem which can be described as follows dl sup rd y dy rd j 0 x dx 1 5 stochastic optimal transport with free end time 3 where j can be viewed as the viscosity solution equivalently minimal supersolution of the following second order hamilton jacobi bellman quasivariational inequality 1 6 tj t x 1 2 j t x h t x j t x 0 in r rd x j t x 0 on r rd where h is again the hamiltonian associated to l we then establish the weak duality principle see section 3 1 7 dl pl the most crucial part of the analysis is to find an optimal end potential hence j for the dual problem 1 5 in fact there is no general result in the literature about the attainment in the dual problem 1 3 however one of the main advantages of considering 1 1 instead of 1 2 is that the constraints on the potentials j are now somehow relaxed i e we have j on r rd instead of j 1 and so this will allow us to replace by an end potential that satisfies 1 2 x inf t r h t x x 0 and we get some sobolev ho lder estimates on we note that this attainment in tandem with the weak duality 1 7 allows through a verification type theorem to characterize both the optimal process and the stopping time that resolve the primal problem in our quest to prove attainment in the dual problem we will focus on two cases 1 when the drift is bounded the distribution of the process then possesses addi tional sobolev regularity due to the diffusion however the dual potential may be unbounded with singularities similar to the fundamental solution of the laplace equation we find that a sufficient condition to solve the problem is for the target distribution to lie in the dual to an appropriately weighted l 1 space this case builds upon the sobolev space approach for the skorokhod problem without drift studied in 13 2 when the drift is strong that is if 1 p 2 there is no additional regularity on the density due to the possibility of local controllability i e the ability to trans port to a dirac mass with finite cost however this local controllability allows for uniform bounds and ho lder estimates on the end potential as in 5 and generalizes the approach for deterministic control problems 11 in particular any compactly supported target measure may be reached with finite cost in either case we shall prove attainment in the dual problem section 5 but for that we need to introduce two eulerian formulations see section 4 for the weak stochastic formulation of the primal problem 1 1 the strong eulerian formulation which poses the problem with a velocity field and the solution to a fokker planck equation with stopping more precisely pel inf m v e r rd l t x v t x m t x dxdt r d 1 8 where a triplet m v belongs to e if the following hold is a probability measure on r rd mt is a nonnegative density in the sobolev space h 1 rd for 4 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer each time t r and v is a measurable velocity field and for all smooth test functions on r rd we have the following r rd t t x m t x t x v t x m t x 1 2 m t x dxdt r rd y d dy rd 0 x dx 1 9 the convex eulerian formulation which poses the problem over phase space distri butions satisfying a convex set of inequalities more precisely p e l inf e r rd rd l t x u t dx du dt r d 1 10 where a pair of density process and stopping time e if is a measurable map from r to nonnegative measures on rd rd is a probability measure on r rd and for all smooth test functions on r rd r rd rd t t x 1 2 t x t x u t dx du dt r rd y d dy rd 0 x dx 1 11 we shall prove the latter to be equivalent to the primal problem 1 1 first by embedding phase space distributions into the stochastic formulation and then showing the reverse in equality by using weak duality we then prove that when the drift is bounded the strong eulerian formulation is also equivalent by using suitable sobolev estimates after proving attainment in the dual problem see section 5 we proceed to obtain useful information on the primal problem and in some special cases e g when t 7 l t x u is monotone we show see section 6 that the unique optimizer is given by the hitting time to a space time barrier inf t j t xt xt which is reminiscent of the graphical structure describing the optimizers in the deterministic mass transports problems studied by brenier 4 gangbo mccann 10 and others 2 stochastic formulations 2 1 basic assumptions and notations we shall assume throughout the paper that the lagrangian t x u r rd u 7 l t x u r where u rd is a continuous function of time position and drift uniformly continuous in t x uniformly with respect to u and is convex with respect to the drift i e u 7 l t x u is convex for all t x r rd in addition we assume either that u rd and the lagrangian l is superlinear with respect to the drift and bounded from below i e there is some c 0 and p 1 such that 2 1 c u p 1 l t x u for all t x u r rd rd or that u is a bounded convex subset of rd let c r rd be the space of continuous paths from r to rd xt t r be the canonical process i e xt t for every and f ft t r be the canonical filtration generated by x let be two probability measures on rd the two equivalent formulations of the stochastic transport problem are the following stochastic optimal transport with free end time 5 2 2 the weak stochastic formulation we say that the triplet p belongs to a if the following conditions hold i f p is a filtered probability space ii the initial distribution is given by i e x 0 p which means that x 0 p iii the drift r u is f progressively measurable and locally integrable i e for each the map l 1 0 u which is given by t t for every t 0 satisfies is f measurable and e p l 1 0 u iv the process w given by w t xt x 0 t 0 s ds for every t r is the standard brownian motion i e w p is the wiener measure on with w 0 0 in other words xt has the following semimartingale decomposition xt x 0 t 0 s ds w t 2 2 v m r where m r is the space of measures on r is a randomized stopping time or equivalently at 0 t is increasing right continuous adapted to f with a 0 0 and limt at 1 let p d d d p d denote the measure on r corresponding to the variable the constraint x p is equivalently defined by x p i e we have r g d p d rd g y dy for all g cb r d 2 3 now we let a p a x p the cost defined on a with possible value of is given by the following jl p e p 0 l t xt t dt 2 4 r 0 l t xt t dt d p d we can state our primal stochastic transportation problem as the minimization of the stochastic transport cost jl p among all admissible p a i e pl inf jl p p a 2 5 with the convention that pl if a in fact we will prove in section 5 that under some assumptions on and this set a is non empty 2 3 the convex stochastic formulation with this formulation we seek to linearize the functional in 2 4 by considering probability measures p on this idea is due to haussmann 14 and it is used later by tan touzi 30 in other words let x b be the canonical process on i e xt bt b t b t for every b and let f be the corresponding canonical filtration we now have a process 2 6 w t b xt x 0 bt b 6 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer which will play the role of w in the definition of a we denote by p x the projection onto the first component of and p b the projection onto the second component we say that p a if the following conditions hold i f p is a filtered probability space ii we have x 0 p x which means that x 0 p x iii for p b almost every b b is differentiable and b is locally integrable i e for each the map l 1 0 u defined by b t t b satisfies e p l 1 0 rd iv the process w defined in 2 6 is a standard brownian motion i e w p is the wiener measure on with w 0 0 v m r is a randomized stopping time equivalently a t b b 0 t is increasing right continuous adapted to f with a 0 0 and limt a t b 1 we also define p to be the associated probability measure on r and p t x its projection onto the first two components the constraint x p t x is similarly defined by r g b d p d db rd g y dy for all g cb r d 2 7 now we say that p a if p a and x p t x the cost is similarly given by the following j l p e p 0 l t xt t dt 2 8 r 0 l t xt t b dt b d p d db then we consider the following relaxation of 2 5 again we let p l if a is empty 2 9 p l inf j l p p a we now show that problems 2 9 and 2 5 are equivalent in the sense that the two problems have the same minimal values first we show that the convex stochastic problem 2 9 is a relaxation of the weak stochastic formulation 2 5 and then show that there is a projection from the convex stochastic problem back onto the weak stochastic formulation that does not increase the cost more precisely we have the following proposition 2 1 with the above notations the following hold 1 for every p a there exists p a with p t x p and jl p j l p 2 conversely for every p a we can find such that p x a with p t x p x and jl p x j l p 3 in particular we have pl p l proof take p a and define b t t 0 s ds we set p x b p and b we can easily check the five properties defining a stochastic optimal transport with free end time 7 i f p is clearly a filtered probability space ii since p x p we are also dealing with the same initial distribution x 0 p x x 0 p iii we have that e p l 1 0 rd ep l 1 0 rd iv note that w b w and therefore w p w p is the wiener measure on with w 0 0 v it is easy to check that is still a randomized stopping time on the extended space on the other hand we also have p t x p from the definitions of jl and j l we have j l p r 0 l t xt t b dt d x b p d db r 0 l t xt t dt d p d and so it follows that jl p j l p for the second claim take p a and set p p x we define by disintegration in such a way that p t x p and by the conditional expectation t ep t f xt here f xt is the filtration generated by process x again we have the following five properties i f p is a filtered probability space ii since p x p we still have the same initial distribution iii by jensen s inequality we have that e p ep f xt l 1 0 rd ep l 1 0 rd iv from 31 theorem 4 3 we have that the following process is a standard brownian motion w t xt x 0 t 0 e p s f xs ds v finally it is straightforward to verify that is a randomized stopping time on the other hand using the definitions of p and and jensen s inequality we get that jl p j l p since we have identity of the distributions p p t x it follows that the values of the primal weak stochastic and convex stochastic problems are equal the convex problem 2 9 satisfies a compactness property for a suitable topology on the measures p on r we note that a simple truncation of the stopping time allows us to restrict to a compact domain in time and space we define the truncation for p a by considering the randomized stopping corresponding to sup t x r i e t r s t r where s t r sup t t t xt r we set st r w s t r w w 8 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer lemma 2 2 for any p a the truncation with t r r satisfies p t r a with t r is supported on 0 t and xt w r almost surely furthermore lim t r jl p t r jl p and for all g cb r d lim t r e t r p g x e p g x proof since the range of st r is contained in 0 t it is clear that t r is supported on 0 t and xt w r holds t r p almost surely we then have that p t r a since st r is continuous and maps 0 into 0 for all r and leaves p and unchanged so that the decomposition 2 2 holds furthermore it follows by the monotone convergence theorem that the limit of jl p t r is jl p and that the end measure is also recovered before we have compactness we also need a truncation of the measure p so that weak limits do not lead to measures associated with badly behaved drifts after the end time proposition 2 3 the set p p a is convex moreover given any se quence p i i a i with i there is a p a such that j l p lim inf i j l p i i proof the convexity follows immediately from 16 corollary iii 2 8 now for each r let us define the map s by s b b 2 10 where t t b t b t and b t b t notice that for every r the map s is invariant for w in the sense that w t s b t 0 b t t 0 b t w t b we define the pair q i i by duality such that r h b i b d q i d db r h b i b d p i d db for all h cb r in particular the truncated measure q i satisfies f b q i d db r f b i b d p i d db for allf cb now we will show that q i i a with the same cost first it is not difficult to check that the properties i ii iii iv and v in the definition of a hold in fact for all g cb we have g w q i d g w b q i d db r g w b i b d p i d db g w b p i d db stochastic optimal transport with free end time 9 thus w q i w p i on the other hand we have r f i b d q i d db r f i b d p i d db r f i b d p i d db f d for all f cb r d this implies that x i q i t x similarly we see that the cost does not change since r 0 l t xt t b dt i b d q i d db r 0 l t xt t b dt i b d p i d db r 0 l t xt t b dt i b d p i d db the advantage of this truncation is that we now have that r t b pdt q i d db r r t b pdt i b d p i d db r 0 t b pdt i b d p i d db c 1 j l p i i where the last inequality comes from the fact that the lagrangian l is superlinear or in the case that u is bounded this holds for any p with c inf t x u r rd u l t x u u p furthermore we have i b r q i d db 1 cr r 0 l t xt t b dt i b d q i d db 1 cr j l q i i then by 22 32 we infer that the sequence i q i is tight and so there is some p a such that ik q ik p in particular this implies that ik q ik t x p t x and x p t x now we define u 1 if sups 0 t s xs w xt w 0 otherwise using the fact that l is uniformly continuous in t x and by jensen s inequality it is not difficult to check that when u 1 we have 0 l s xs 1 s s t b dt ds 0 l t xt t b dt c 10 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer where c is the modulus of uniform continuity of the lagrangian l with respect to t and x then we get j l q i i e i q i u 0 0 l s xs 1 bs b bs b ds c the map w b 7 u w 0 0 l s xs w 1 bs b bs b ds is lower semi continuous and i q i p so passing to the limit when i we get lim inf i j l q i i e p u 0 0 l s xs 1 bs b bs b ds c letting 0 and using fatou s lemma as well as the continuity of c we infer that lim inf i j l q i i j l p c which completes the proof since 0 is arbitrary and thanks to the fact that j l p i i j l q i i for every i n as a consequence we get corollary 2 4 the problem 2 5 reaches a minimum moreover the map 7 pl is convex and lower semi continuous proof let pi i be a minimizing sequence in problem 2 5 and p i i be the corre sponding measures such that j l p i i jl p i i see proposition 2 1 by proposition 2 3 there is a p such that lim inf i j l p i i j l p this yields that the pro jection p of p see again proposition 2 1 is a minimizer for 2 5 the second statement can be proved in a similar way using propositions 2 1 2 3 3 duality and dynamic programming in this section we verify a duality principle for the stochastic transportation problem 2 5 more precisely we consider the following maximization principle 3 1 dl sup zl rd y dy rd x dx where zl is the set of functions on r d with cb r d continuous and bounded and b r d measurable w r t the borel field on rd completed by such that the following holds x e p x 0 l t xt t dt for all p a x a e x r d we can characterize the dual problem further using the dynamic programming principle we first define a translation map t t x c t rd where t t x s s t x given cb r d we introduce the function j t x sup p at x e p x t l s xs s ds stochastic optimal transport with free end time 11 where at x t t 0 p p a x here the pushforward on p is as a measure and on and are given respectively by t t 0 1 and t t 0 1 for all c t rd moreover we note that j t x sup p a t x e p x t l s xs s ds where a t x t t 0 p p a x with t t 0 w b s w s t b s t and t t 0 t t 0 1 b for all b c t rd rd for any zl we have that j 0 x x for a e x r d so the dual problem 3 1 becomes dl sup cb r d rd y dy rd j 0 x dx we first prove a lemma that verifies a basic level of regularity for j needed in the proof of theorem 3 2 such a result is standard see 30 for a setting similar to ours lemma 3 1 we suppose that cb r d then the map t x 7 j t x is lower semi continuous and bounded from below in addition we have rd j 0 x dx sup p a e p x 0 l t xt t dt 3 2 proof we first note that we can express j t x as j t x sup p a 0 e t t x p x t l s xs t t x s ds sup p a 0 e p x x 0 l s t xs x s ds for each p a 0 this defines a continuous function of t and x by the continuity of the translation maps t t x the uniform continuity of l and the bound on and so j t x is the supremum over all these functions making it lower semi continuous clearly j t x is bounded below by x we also note that j t x is bounded above by supx to prove 3 2 we first note that any p a disintegrates w r t by the map s 0 and yields using the definition of j that rd j 0 x dx e p x 0 l t xt t dt furthermore for each 0 the set x p p a x e p x 0 l s xs s ds j 0 x is non empty for a e x and closed by propositions 2 1 2 3 and thanks to the lower semi continuity of j thus by the kuratowski and ryll nardzewski selection theorem we may find a borel measurable map q x x px with px x x a x and 12 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer e x px x 0 l s xs x s ds j 0 x for a e x therefore we may consider p a such that p disintegrates w r t as q x i e p q thus we have rd j 0 x dx e p x 0 l t xt t dt which proves the equality 3 2 when 0 the scheme to prove duality is by now standard in convex analysis we refer for instance to 8 the idea is that if 7 v pl is l s c and convex then v v where v denotes the legendre fenchel transform of v the value v is the minimal value of our stochastic primal problem 2 5 while v is identified with the maximal value of the dual problem 3 1 this strategy was already used by many authors to establish dual principles for various optimal transport problems that do not fit in the monge kantorovich theory see 25 30 theorem 3 2 the following equality holds pl dl proof first it is clear that the maximal value of the dual problem is less than or equal to the minimal value of the primal one since for all admissible p a and zl we have rd y dy rd x dx e p x x 0 e p 0 l t xt t dt and so it follows that dl pl for the other direction we have that v is convex and lower semi continuous see corollary 2 4 then we have v v sup cb r d rd x dx v where v sup m rd rd x dx v sup p a e p x 0 l t xt t dt note that we used that if is not a probability measure then a and v which does not affect the supremum in the definition of v we then have by lemma 3 1 that v rd j 0 x dx and pl v sup cb r d rd y dy rd j 0 x dx by setting x j 0 x we have zl and we have shown the reverse inequality that is dl pl which completes the proof stochastic optimal transport with free end time 13 on the other hand by the standard dynamic programming principle we get that j is a viscosity solution of the following dynamic programming equation see for instance 30 min j t x x tj t x 1 2 j t x h t x j t x 0 where the hamiltonian h is given by the legendre dual of l i e we have h t x z sup u u z u l t x u for all t x z r rd rd this viscosity solution j can be viewed as the minimal supersolution given by the infimum of the smooth supersolutions of 3 3 tj t x 1 2 j t x h t x j t x 0 in r rd x j t x on r rd finally we get the following proposition 3 3 we have dl sup cb r d rd y dy rd j 0 x dx sup cb r d j c 1 2 b r rd rd y dy rd j 0 x dx j satisfies 3 3 4 eulerian formulations in this section we express two eulerian formulations for 2 5 the strong eulerian formu lation poses the problem with a velocity field and the solution to a fokker planck equation with stopping while the convex eulerian formulation poses the problem over phase space distributions satisfying a convex set of inequalities we prove the later to be equivalent to 2 5 by embedding the stochastic formulation and showing a weak duality inequality we then prove that when the drift is uniformly bounded the strong eulerian formulation is also equivalent by sobolev estimates we note that these estimates will be used to prove dual attainment in the next section 4 1 strong and convex eulerian formulations first consider strong eulerian formu lation we say that m v belongs to e if the following holds m l 1 r rd l 2 loc r h 1 rd with mt l 1 rd 1 v l r rd rd is a probability measure on r rd for all smooth with compact support in r rd we have r rd t t x m t x t x v t x m t x 1 2 m t x dxdt r rd y d dy rd 0 x dx 4 1 then we consider the following problem pel inf m v e r rd l t x v t x m t x dxdt r d 4 2 now let us introduce the following convex eulerian formulation definition 4 1 we say that e if the following holds 14 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer is a measurable map from r to sub probability measures on rd u is a probability measure on r rd the following equation holds for all smooth with t and uniformly bounded on r rd r rd u t t x 1 2 t x t x u dt dx du r rd y d dy rd 0 x dx 4 3 we let p e l inf e r rd u l t x u dt dx du r d 4 4 it is clear that p e l p e l because if m v e then for dt dx du v t x du m t x dtdx we have e with the same cost and target distribution the following proposition shows that from a probability distribution drift and stopping time p a we can construct an admissible pair e proposition 4 1 given p a there is a pair e such that r rd u l t x u dt dx du e p 0 l t xt t dt in particular we have p e l pl proof given p a we find the pair from riesz representation given by the formula r rd u t x u dt dx du e p 0 t xt t dt for all cb r rd u and r rd h y d dy e p h x for all h cb r rd then one can check easily that the pair e in fact if t is the disintegration of with respect to the lebesgue measure on r then for every smooth with compact support in r rd we have using ito s formula the following r rd u t t x 1 2 t x u t x t dx du dt e p 0 t t xt t t xt 1 2 t xt dt e p x 0 x 0 rd r y d dy rd 0 x dx clearly we have that if x p then r d moreover we have the following r rd u l t x u dt dx du e p 0 l t xt t dt which completes the proof that p e l pl on the other hand we have the following duality for the convex eulerian problem 4 4 stochastic optimal transport with free end time 15 theorem 4 2 the following equalities hold dl p e l pl proof take an admissible pair e with r d and let j satisfy 3 3 then we have rd y dy rd j 0 x dx r rd j t x dt dx rd j 0 x dx r rd u tj t x 1 2 j t x u j t x t dx du dt r rd u l t x u dt dx du this shows that dl p e l in view of proposition 3 3 we have shown that p e l pl in proposition 4 1 and that pl dl in theorem 3 2 which completes the chain of equalities 4 2 regularity we will now partly complete the equivalence between the strong and the convex eulerian formulations by addressing the strong eulerian formulation in the case where the drift is bounded we first need a result on the truncation in time and space of pairs e we make use of the truncation in time and space of lemma 2 2 theorem 4 3 suppose that dx for l 2 rd then for any e with compact support in r rd u 0 t t x r u u there is a m v e such that t dx r d m t x dx and m v has a cost less than or equal to that of moreover we have the following uniform estimate t 0 rd m t x 2 dx dt 2 2 l 2 rd ct 4 5 where the constant c depends only on the bound of the drift u and the dimension d in particular f 7 rd t 0 f x d dx is a continuous linear functional of h 1 rd finally when the drift is bounded we have p e l p e l proof first we use convolution to approximate the pair by smooth densities and the measure by with e we define m t x rd t x u du and v t x rd u t x u du m t x 16 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer with v t x 0 if m t x 0 we note that m v e by jensen s inequality the cost of m v is less or equal to that of within a factor of then using m as a test function in 4 1 we obtain rd t 0 m y d dy rd x 2 dx t 0 rd 1 2 t m t x 2 1 2 m t x 2 v t x m t x m t x dx dt then 1 2 t 0 rd m t x 2 dx dt 1 2 2 l 2 rd u t 0 rd m t x m t x dx dt yet we have t 0 rd m t x m t x dx dt 1 2 t 0 rd m t x 2 1 m t x 2 dx dt for the last term using gagliardo nirenberg sobolev embedding and an interpolation of the l 1 and l 2 norms we have m t l 2 rd m t l 2 rd c m t l 1 rd which implies that t 0 rd m t x 2 dx dt 2 2 t 0 rd m t x 2 dx dt 2 c 2 t 0 rd m t x dx 2 dt yet m t l 1 rd 1 for every t then choosing 0 small enough we get 4 5 for m in particular the uniform estimates imply that m converge weakly to m in l 2 loc r h 1 rd such that m t rd t du dx we then define the field v t x by the vector valued radon nikodym derivative v t rd u t du mt dx it is then straightforward to see m v e which by jensen s inequality has lesser or equal cost than for any f h 1 rd we have rd r f x d dx rd f x x dx t 0 rd 1 2 f x m t x v t x f x m t x dx dt and the similar estimates imply that f 7 r rd f x d dx is a linear functional of h 1 rd finally to conclude equivalence of the convex and strong formulations we use proposi tion 4 1 and lemma 2 2 to construct t r t r with compact support in time and space for any p a corresponding to the truncation of lemma 2 2 with t r r we then have corresponding mt r vt r t r e when t 1 t 2 and r 1 r 2 we have t 2 r 2 t 2 r 2 t 1 r 1 t 1 r 1 on 0 t 1 b 0 r 1 and thus there exists a density stochastic optimal transport with free end time 17 m v e taking the limit as t r with the same cost and end distribution as p thus we have shown that pel pl and applying the result of theorem 4 2 completes the proof of equivalence we will also need the following moment bound proposition 4 4 suppose that c u p x q 1 l t x u or c x 1 l t x u and u is uniformly bounded for c 0 we assume that satisfies rd x 2 dx then for any e with finite cost we have rd r y 2 d dy rd x 2 dx c r rd u l t x u t dx du dt proof to prove that we simply apply 4 3 with the test function w y y 2 rd r y 2 d dy rd x 2 dx r rd u d u 2 x t dx du dt r rd u d h t x 2 x l t x u t dx du dt c r rd rd l t x u t dx du dt where we have used that h t x 2 x c x q c l t x u in the case that c x l t x u and u is uniformly bounded the proof is simpler using that u x u c l t x u and the result follows 5 dual attainment in this section we prove dual attainment in the cases where either the lagrangian l u p with 1 p 2 or the drift is uniformly bounded u u this relies on a normalization that makes as a supersolution to an hjb equation first we define h x z inf t r h t x z for all x z rd rd and l x u sup t r l t x u for all x u rd u we suppose strengthening assumption 2 1 that there are constants c c 0 such that l satisfies c u p x q 1 l t x u c u p x q 1 5 1 for all t x u r rd u or equivalently there are constants c c 0 such that h satisfies z q c x q 1 h t x z z q c x q 1 for all t x z r rd rd in the case where the drift is bounded this becomes c x 1 l t x u c x 1 for all t x u r rd u 18 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer and z c x 1 h t x z z c x 1 for all t x z r rd rd proposition 5 1 for cb r d we define x sup p a x e p x 0 l xt t dt then is lower semi continuous and bounded with j j and thus greater or equal dual value furthermore satisfies in the viscosity sense 1 2 x h x x 0 5 2 proof from the definition of we have obviously and we get as in lemma 3 1 that is lower semi continuous and bounded the standard viscosity solution theory implies that is a viscosity supersolution of 5 2 from the definition of j we get that j j let us prove the reverse inequality that is j j so that we get j j first we note that x j t x for every t x r rd which follows from the definitions after noting that l l now suppose that p at x is within of optimality for j then we have the following j t x e p x t l s xs s ds e p j x t l s xs s ds j t x where the last inequality is a result of dynamic programming principle 19 theorem 6 ch 3 for j taking to zero proves the desired inequality the following proposition proves a quadratic lower bound on supersolutions to 5 2 as well as an ho lder continuity in the case that l u p with 1 p 2 proposition 5 2 we assume 5 1 holds suppose is bounded lower semi continuous and satisfies 5 2 suppose d 1 and 1 p 2 fix 0 2 p 1 then for each x 0 r d there are two constants b and e depending only on p d c and x 0 such that x 0 x 1 b x 1 x 0 e x 1 x 0 2 for all x 1 r d 5 3 in particular is uniformly ho lder continuous on compact sets and under the assump tion that 0 0 is uniformly globally bounded from below by a quadratic function in the case d 1 the result holds with 1 for all p 1 proof we will prove that for each x 0 the function w x a b x x 0 e x x 0 2 with appropriate constants a b and e will touch from below at x 0 by computing w at x 6 x 0 we see that w x q b 1 x x 0 q 1 b 2 x x 0 q where b 1 q bq and b 2 2 qeq stochastic optimal transport with free end time 19 notice that as is l s c and bounded we can by adjusting the constant a let the function w touch from below at some point suppose w touches from below at x 1 6 x 0 then from the equation 5 2 and the assumption 5 1 we have that c x 1 q 1 1 2 w x 1 w x 1 q b 1 x 1 x 0 q 1 b 2 x 1 x 0 q b 2 d 2 x 1 x 0 2 de to draw a contradiction we will select two constants b and e such that the following holds b 1 x 1 x 0 q 1 b 2 x 1 x 0 q 3 max b 2 d 2 x 1 x 0 2 de c c x 1 q now it is clear that the inequality with the first and the second item in the maximum is satisfied for large enough b and e such that min b 1 b 2 3 max b 2 d 2 de c for the third item note that x 1 q 2 qmax x 1 x 0 x 0 q thus we may choose b and e large enough depending on x 0 such that b 1 3 c 1 x 0 q and b 2 3 c 2 qmax 1 x 0 q and these choices of b and e yield a contradiction thus we must have that w touches from below at x 1 x 0 and it follows that 5 3 holds for all x 0 and x 1 we note that in particular fixing x 0 this establishes a global quadratic lower bound on which becomes uniform in as soon as 0 0 the proof for d 1 is simpler with 1 since the laplacian of the second term of w vanishes theorem 5 3 suppose that d 2 1 p 2 rd x 2 dx has a compact support and l satisfies 5 1 then the dual problem dl is attained at c loc rd 0 2 p and is globally bounded below by a quadratic function furthermore in this case there exists p a with finite cost proof we take a maximizing sequence i we assume that for each i n i is l s c bounded i 0 0 and i satisfies 5 2 this is possible thanks to proposition 5 1 and we apply proposition 5 2 then by arzela ascoli i converges uniformly on compact sets to with 0 0 furthermore these i are uniformly bounded below by a quadratic function with the target measure compactly supported for such a limit function to have the maximal dual value it is enough to show that 5 4 lim inf i rd j i 0 x dx rd j 0 x dx but again we have rd j i 0 x dx sup e r rd i y dt dy r rd u l t x u dt dx du for each e with finite cost proposition 4 4 implies that such has finite second moment thus the uniform quadratic lower bound on i implies that lim inf i r rd i y dt dy r rd y dt dy 20 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer this yields 5 4 finally the existence of p a with finite cost follows from duality theorem 3 2 in 1 d the result holds for all values of p 1 theorem 5 4 let d 1 assume that rd x 2 dx has a compact support and l satisfies 5 1 then the dual problem is attained at which is locally lipschitz continuous and bounded below quadratically proof the proof follows as in theorem 5 3 using the lipschitz estimates in 1 d from propo sition 5 2 in order to better handle the behavior as x in the case that p is large for instance assume that p which means that the drift is bounded u u we will introduce a weighting measure on rd we consider now a smooth convex function v such that rd e v x dx 1 and 1 2 v for instance v x x m we assume that 2 is easily seen to fit all the criteria we will require we define the norm f lq v rd rd f x qe v x dx 1 q set w 1 q v rd f f lq v rd f lq v rd we denote f v rd f x e v x dx we note that if v is a radially increasing function then we have for any q 1 the following poincare inequality see for example 9 7 f f v lq v rd c f lq v rd then we define b f l 1 v r d f is l s c and quadratically bounded from below 5 5 we will say that f h 1 v r d w 1 2 v rd satisfies 5 2 in a weak sense if for all compactly supported h h 1 v r d with h 0 we have rd 1 2 f x h x h x f x h x dx 0 then we have the following proposition 5 5 suppose that h is uniformly continuous in x uniformly w r t z and satisfies 5 1 let be a supersolution to 5 2 lower semi continuous and bounded from below with v 0 then for any m 0 the truncation of satisfies m h 1 v r d and solves 5 2 in a weak sense more precisely there exists a uniform constant c which does not depend on such that w 1 1 v rd c 5 6 c 1 x 2 5 7 stochastic optimal transport with free end time 21 and for every m 0 there is a constant c m again uniform in such that the following holds m h 1 v rd c m 5 8 on the other hand if the truncation m h 1 v r d solves 5 2 weakly for all m 0 then is l s c proof first we fixm 0 and show there is a sequence m such that m is 1 lipschitz and semi concave m m in h 1 v r d and m satisfies in a strong sense 5 9 1 2 m x h x m x c m set m x infz rd z m 1 2 2 x z 2 for all x rd we let zx depending also on m be such that m x zx m 1 2 2 x zx 2 which is well defined for sufficiently small by lower semi continuity and the lower bound on fix 0 and x rd and let be a smooth function such that m with x m x we define w y y x zx 1 2 2 x zx 2 we have w zx zx m and w m hence by 5 2 and that h x 0 0 1 2 w zx h zx w zx 0 yet w zx x and w zx x using also the fact that h is uniformly continuous we get 1 2 x h x x c x zx moreover we have zx m 1 2 2 x zx 2 x m hence x zx c m and it follows that m is a supersolution in the viscosity sense with error c m where c m 0 as 0 but also in the sense of distributions thanks to the semi concavity of m using e v as a test function we obtain c m rd 1 2 m x h x m x e v x dx 1 2 rd m x v x e v x dx m l 1 v c yet 2 then we infer that m l 1 v rd c which shows the estimate 5 6 after taking 0 for the uniform quadratic lower bound let us consider as in proposition 5 2 the function w y a e 2 y 2 that touches 0 from below at x we then have that d 2 e e x c x 1 c which implies that for sufficiently large e x is in a ball of radius c 1 c 1 d c e we note that the constant e can be taken independent of x then 0 y inf x c 1 0 x e 2 x 2 e 2 y 2 22 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer to bound 0 near the origin we will consider a construction that will be useful for the remainder of the proof for any x we let qx r denote the uniform distribution on the ball of radius r centered at x fix 0 r 1 r 2 and assume that the drift equals zero then we can find a pair m 0 e qx r 1 qx r 2 such that m has support in 0 t qx r 2 from 4 3 we have rd y x 2 d qx r 2 dy r rd rd t dy du dt rd y x 2 d qx r 1 dy which implies that r rd m t y dy dt c r 22 r 2 1 define m r x rd m y qx r dy as m t h 1 rd see theorem 4 3 for each t 0 t with compact support then again by 4 3 and thanks to the fact that h is uniformly continuous w r t x we have m r 2 x rd r m y d dy rd m y qx r 1 dy 1 2 r rd m y m t y dy dt m r 1 x r rd h y m y m t y dy dt m r 1 x c x r 2 2 r 2 1 letting r 1 0 and r 2 1 we find a uniform lower bound for with x c 1 using 5 6 and the poincare inequality to bound on balls of radius 1 this concludes the proof of 5 7 we now use m m as a test function in 5 9 so we get rd c m m m x e v x dx rd m m x 1 2 m x h x m x e v x dx rd 1 2 m x 2 m m x 1 2 m x v x h x m x e v x dx rd 1 2 m x 2 m m x l x 1 2 v x e v x dx using the uniform quadratic lower bound on m the bounds on l and the estimate 5 6 we get m 2 l 2 v rd m c c m c which yields the estimate 5 8 to see that m is a distributional solution to 5 2 we fix a smooth compactly supported test function h 0 and consider the limit 0 lim 0 rd 1 2 m x h x h x m x h x dx rd 1 2 m x h x h x m x h x dx stochastic optimal transport with free end time 23 where the second inequality follows from convexity of h and hence weak lower semi continuity of the integral for the last statement assume that m solves 5 2 weakly for all m 0 recalling the previous estimates we have m r 2 x c x r 22 m r 1 x c x r 21 it follows that r 7 m r x c x r 2 is monotonically decreasing which implies that m and so is lower semi continuous see 29 remark 5 6 in the case that h 1 v r d bounded above and satisfies 5 2 in a weak sense is lower semi continuous by proposition 5 5 and will satisfy 5 2 in the viscosity sense arguments for this can be found in 21 and 15 to sketch an argument for this we note that r x rd y qx r dy satisfies r x e p x 0 l xt t dt for all p a qx r taking the limit as r 0 we have x limr 0 r x and any p a x can be translated to p r r r a qx r showing that x lim r 0 e r pr x 0 l xt t dt e p x 0 l xt t dt which implies that solves 5 2 in the sense of viscosity lemma 5 7 the map t x 7 j t x is lower semi continuous for all b more over under the assumptions of proposition 5 5 we have for any l 2 v r d 7 rd j 0 x dx is lower semi continuous with respect to the strong l 1 v convergence on b m h 1 v c m for any m 0 proof the proof that t x 7 j t x is lower semi continuous is the same as for lemma 3 1 for l 2 v r d lemma 3 1 and theorem 4 2 imply that rd j 0 x dx sup e rd r x d dx r rd rd l t x u t dx du dt by lemma 2 2 using the truncation m m this becomes sup mt r vt r t r e m 0 rd r m x t r d dx r rd l t x vt r mt r dxdt since we have that lim inf t r m rd r m x t r d dx rd r x d dx by lower semi continuity of the quadratic lower bound 5 7 on and the quadratic moment bound for see proposition 4 4 we will show that for each mt r vt r t r e with finite cost and m 0 7 rd r m x t r d dx is lower semi continuous which follows from demonstrating that the map without the truncation is a continuous linear functional of h 1 v r d we now take mt r vt r t r 24 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer e then for every f h 1 v r d we have rd r f x t r d dx rd f x dx t 0 b 0 r f x v t x mt r t x 1 2 mt r t x and it follows from the estimates on mt r see theorem 4 3 that this is a continuous linear functional completing the proof now we are ready to prove attainment in the dual problem 1 5 theorem 5 8 we suppose that the lagrangian l is bounded l 2 v r d ev l rd then the dual problem is attained at b furthermore the set a is non empty and the minimizer p of the stochastic primal problem pl satisfies e p x 0 l t xt t dt rd j 0 x dx 5 10 proof let k k cb r d be a maximizing sequence in the dual problem 1 5 with k v 0 for all k by proposition 5 1 we can assume that for each k k is lower semi continuous and satisfies 5 2 in the sense of viscosity thanks to proposition 5 5 we also have k w 1 1 v rd c k c 1 x 2 and mk h 1 v rd c m in particular this implies that dl sup b rd y dy rd j 0 x dx pl which means that dl sup b rd y dy rd j 0 x dx moreover there is a function l 1 v r d such that up to a subsequence k in l 1 v as ev l rd then we have rd k x dx rd x dx and it is easy to see that for each m 0 m is in h 1 v r d and is a weak supersolution of 5 2 we then have that b thanks again to proposition 5 5 on the other hand by lemma 5 7 we have that lim inf k rd j k 0 x dx rd j 0 x dx then the existence of a maximizer for the dual problem 1 5 follows finally notice that rd j 0 x dx rd x 0 dx 0 h 1 v rd h 1 v rd then dl this implies that pl is finite by theorem 3 2 and a is non empty the equation 5 10 follows directly from the duality dl pl and the existence of optimizers for both problems 1 1 1 5 stochastic optimal transport with free end time 25 6 hitting times and strong solutions in this section we address the additional structure of monotonicity of t 7 l t x u in this case the set r t x j t x x has the structure of a barrier in particular if t 7 l t x u is increasing then for t x r and s t we have s x r and if t 7 l t x u is decreasing then for t x r and s t we have s x r in either of these cases strict monotonicity implies uniqueness of the optimizer the monotonicity of r in t follows the same argument in 11 proposition 6 1 if t 7 l t x u is increasing then t 7 j t x is nonincreasing and if t 7 l t x u is decreasing then t 7 j t x is nondecreasing proof we suppose t 7 l t x u is increasing and select 0 t s we can express the value function at time s by j s x sup p at x e p x t l r t s xr r dr sup p at x e p x t l r xr r dr j t x the proof in the case that t 7 l t x u is decreasing is the same with the inequality reversed we require a verification type theorem that will allows us to characterize the optimal process and stopping time by the dual optimizer theorem 6 2 suppose the dual problem dl is attained at j and that p a minimizes the primal problem pl then j x x p almost surely 6 1 and mt j t xt t 0 l s xs s ds 6 2 satisfies for any t s e p mt f s ms p almost surely 6 3 proof we first note that j t x x for all t x and mt is a supermartingale then by the duality of theorem 3 2 we have 0 e p x j 0 x 0 0 l t xt t dt 6 4 e p x j x m m 0 6 5 and 6 1 6 3 follow we can now state a theorem that consolidates our results to show a structure to opti mizers under these monotonicity conditions on l 26 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer theorem 6 3 we suppose duality and dual attainment following from either theorem 5 8 5 3 or 5 4 and that u 7 l t x u is strictly convex in addition assume t 7 l t x u is strictly increasing and j are continuous then the optimizer p a is unique and the optimal stopping time is given by inf t j t xt xt 6 6 alternatively if t 7 l t x u is strictly decreasing and and have disjoint support then the optimizer is unique and also give by 6 6 proof we first show that the optimal p for pl satisfies i the process stops in r e p 1 x r 1 ii and e p 0 1 t xt r dt 0 we then show that there is a unique p that minimizes jl p subject to i and ii and the unique optimal randomized stopping time is given by by theorem 6 2 we immediately have i from 6 1 we let pt x t x t x at x be the conditional expectation i e satisfying for each t and g cb r rd rd e p t g s xs s rd e t x pt x t g s xs t x s t dx r d then 0 e p m mt rd e t x pt x x j t x t l s xs t x s ds t dx r d and it follows that j t x e t x pt x x t l s xs t x s ds for all t and t a e x if j t x x and either t 7 l t x u is strictly increasing and s t for 0 or t 7 l t x u is strictly decreasing and 0 s t for 0 then t t s 0 s x ps x will satisfy j t x e s x ps x x s l r s t xr s x r s t dr which is only satisfied if s with probability one and ii follows we now consider p a that satisfies i and ii and we have e p 0 l t xt t dt e p x j 0 x 0 e p 0 l t xt t dt by the definition of j optimality of p and theorem 3 2 which implies that p optimizes the cost over policies in a that satisfy i and ii given p and let be the randomized stopping time corresponding to defined in 6 6 we then have that i and ii are satisfied by p using continuity of and j furthermore the cost of p is less than or equal to the cost of p because stochastic optimal transport with free end time 27 l is nonnegative furthermore since the cost is equal this implies that finally uniqueness of p and follow from strict convexity of l remark 6 4 the assumption that and j are continuous in theorem 6 3 is satisfied if 1 p 2 as in theorem 5 3 and is probably not needed if the drift is bounded p as in theorem 5 8 if one pursues further the sobolev regularity of the stopping distribution for as was done in 13 12 from the control theory point of view it is a natural question whether the optimal control policy satisfies the pontryagin maximum principle namely t dzh t xt j t xt and solves the sde dxt xt dt dwt in a strong sense this seems to require j to be c 1 1 we leave it as an open question references 1 erhan bayraktar and christopher w miller distribution constrained optimal stopping mathematical finance 29 1 368 406 2019 2 mathias beiglbo ck manu eder christiane elgert and uwe schmock geometry of distribution constrained optimal stopping problems probability theory and related fields 172 1 2 71 101 2018 3 mathias beiglboeck alexander mg cox and martin huesmann optimal transport and skorokhod embedding inventiones mathematicae 208 2 327 400 2017 4 yann brenier polar factorization and monotone rearrangement of vector valued functions communi cations on pure and applied mathematics 44 4 375 417 1991 5 piermarco cannarsa and pierre cardaliaguet ho lder estimates in space time for viscosity solutions of hamilton jacobi equations communications on pure and applied mathematics 63 5 590 629 2010 6 yongxin chen tryphon t georgiou and michele pavon on the relation between optimal transport and schro dinger bridges a stochastic control viewpoint journal of optimization theory and applications 169 2 671 691 2016 7 bart lomiej dyda and moritz kassmann on weighted poincare inequalities ann acad sci fenn math in print see also http arxiv org abs 1209 3125 2013 8 ivar ekeland and roger temam convex analysis and variational problems volume 28 siam 1999 9 a r elcrat and h a maclean weighted wirtinger and poincar inequalities on unbounded domains indiana university mathematics journal 29 321 332 1980 10 wilfrid gangbo and robert j mccann the geometry of optimal transportation acta mathematica 177 2 113 161 1996 11 nassif ghoussoub young heon kim and aaron zeff palmer optimal transport with controlled dy namics and free end times siam journal on control and optimization 56 5 3239 3259 2019 12 nassif ghoussoub young heon kim and aaron zeff palmer a solution to the monge transport problem for brownian martingales submitted pages 1 23 2019 13 nassif ghoussoub young heon kim and aaron zeff palmer pde methods for optimal skorokhod embeddings calc of variations and pdes pages 1 33 2019 14 ug haussmann existence of optimal markovian controls for degenerate diffusions in stochastic dif ferential systems pages 171 186 springer 1986 15 hitoshi ishii on the equivalence of two notions of weak solutions viscosity solutions and distribution solutions funkcial ekvac 38 1 101 120 1995 16 jean jacod and albert shiryaev limit theorems for stochastic processes volume 288 springer science business media 2013 17 sigrid ka llblad a dynamic programming principle for distribution constrained optimal stopping arxiv preprint arxiv 1703 08534 2017 18 leonid vitalievich kantorovich on the translocation of masses in dokl akad nauk ussr ns volume 37 pages 199 201 1942 19 nikolaj vladimirovic krylov controlled diffusion processes springer verlag 1980 20 christian le onard from the schro dinger problem to the monge kantorovich problem journal of func tional analysis 262 4 1879 1920 2012 28 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer 21 pierre louis lions optimal control of diffusion processes and hamilton jacobi bellman equations part 2 viscosity solutions and uniqueness communications in partial differential equations 8 11 1229 1276 1983 22 paul andre meyer and wa zheng tightness criteria for laws of semimartingales in annales de l ihp probabilite s et statistiques volume 20 pages 353 372 1984 23 toshio mikami optimal control for absolutely continuous stochastic processes and the mass transporta tion problem electronic communications in probability 7 199 213 2002 24 toshio mikami monge s problem with a quadratic cost by the zero noise limit of h path processes probability theory and related fields 129 2 245 260 2004 25 toshio mikami and michele thieullen optimal transportation problem by stochastic optimal control siam journal on control and optimization 47 3 1127 1139 2008 26 gaspard monge me moire sur la the orie des de blais et des remblais histoire de l acade mie royale des sciences de paris 1781 27 alessio porretta on the planning problem for a class of mean field games comptes rendus mathema tique 351 11 12 457 462 2013 28 alessio porretta on the planning problem for the mean field games system dynamic games and applications 4 2 231 256 2014 29 luis sylvestre viscosity solutions of elliptic equations lecture notes in second chicago summer school in analysis http math uchicago edu luis preprints viscosity solutions pdf 2015 30 xiaolu tan nizar touzi et al optimal transportation under controlled stochastic dynamics the annals of probability 41 5 3201 3240 2013 31 e wong representation of martingales quadratic variation and applications siam j control 9 621 633 1971 32 wa zheng tightness results for laws of diffusion processes application to stochastic mechanics in annales de l ihp probabilite s et statistiques volume 21 pages 103 124 1985 samer dweik nassif ghoussoub young heon kim and aaron zeff palmer department of mathematics university of british columbia vancouver v 6 t 1 z 2 canada e mail address dweik math ubc ca nassif math ubc ca yhkim math ubc ca azp math ubc ca 1 introduction 2 stochastic formulations 2 1 basic assumptions and notations 2 2 the weak stochastic formulation 2 3 the convex stochastic formulation 3 duality and dynamic programming 4 eulerian formulations 4 1 strong and convex eulerian formulations 4 2 regularity 5 dual attainment 6 hitting times and strong solutions references