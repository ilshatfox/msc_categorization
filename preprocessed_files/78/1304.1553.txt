ar x iv 1 30 4 15 53 v 2 ph ys ic s op ti cs 2 2 m ay 2 01 3 transformation inverse design david liu 1 lucas h gabrielli 2 michal lipson 2 3 and steven g johnson 4 1 department of physics mit cambridge ma 02139 usa 2 school of electrical and computer engineering cornell university ithaca ny 14853 usa 3 kavli institute cornell university ithaca ny 14853 usa 4 department of mathematics mit cambridge ma 02139 usa daveliu mit edu abstract we present a new technique for the design of transformation optics devices based on large scale optimization to achieve the optimal effective isotropic dielectric materials within prescribed index bounds which is computationally cheap because transformation optics circumvents the need to solve maxwell s equations at each step we apply this technique to the design of multimode waveguide bends realized experimentally in a previous paper and mode squeezers in which all modes are transported equally without scattering in addition to the optimization a key point is the identification of the correct boundary conditions to ensure reflectionless coupling to untransformed regions while allowing maximum flexibility in the optimization many previous authors in transformation optics used a certain kind of quasiconformal map which overconstrained the problem by requiring that the entire boundary shape be specified a priori while at the same time underconstraining the problem by employing slipping boundary conditions that permit unwanted interface reflections 2013 optical society of america ocis codes 120 4570 optical design of instruments 130 2790 guided waves 000 3860 mathematical methods in physics 160 3918 metamaterials references and links 1 a j ward and j b pendry refraction and geometry in maxwell s equations j mod opt 43 4 773 793 1996 2 u leonhardt optical conformal mapping science 312 1777 1780 2006 3 j b pendry d schurig and d r smith controlling electromagnetic fields science 312 1780 1782 2006 4 h chen c t chan and p sheng transformation optics and metamaterials nat mater 9 387 396 2010 5 y liu and x zhang recent advances in transformation optics nanoscale 4 17 5277 5292 2012 6 n i landy and w j padilla guiding light with conformal transformations opt express 17 17 14872 14879 2009 7 m heiblum and j h harris analysis of curved optical waveguides by conformal transformation j quantum electron 11 2 75 83 1975 8 y g ma n wang and c k ong application of inverse strict conformal transformation to design waveguide devices j opt soc am a 27 968 972 2010 9 s han y xiong d genov z liu g bartel and x zhang ray optics at a deep subwavelength scale a transformation optics approach nano lett 8 12 4243 4247 2008 10 k yao and x jiang designing feasible optical devices via conformal mapping j opt soc am b 28 5 1037 1042 2011 11 t han c qiu j dong x tang and s zouhdi homogeneous and isotropic bends to tunnel waves through multiple different equal waveguides along arbitrary directions opt express 19 14 13020 13030 2011 12 d a roberts m rahm j b pendry and d r smith transformation optical design of sharp waveguide bends and corners appl phys lett 93 251111 2008 http arxiv org abs 1304 1553 v 2 13 j huangfu s xi f kong j zhang h chen d wang b wu l ran and j a kong application of coordinate transformation in bent waveguides j appl phys 104 014502 2008 14 h xu b zhang y yu g barbastathis and h sun dielectric waveguide bending adapter with ideal trans mission opt express 29 6 1287 1290 2012 15 z l mei and t j cui experimental realization of a broadband bend structure using gradient index metama terials opt express 17 20 18354 18363 2009 16 z l mei and t j cui arbitrary bending of electromagnetic waves using isotropic materials j appl phys 105 104913 2009 17 m rahm d a roberts j b pendry and d r smith transformation optical design of adaptive beam bends and beam expanders opt express 16 15 11555 11567 2008 18 b vasic g isic r gajic and k hingerl coordinate transformation based design of confined metamaterial structures phys rev b 79 085103 2009 19 c garc a meca m m tung j v gala n r ortun o f j rodr guez fortun o j mart and a mart nez squeezing and expanding light without reflections via transformation optics opt express 19 4 3562 3757 2011 20 x zhang h chen x luo and h ma transformation media that turn a narrow slit into a large window opt express 16 16 11764 11768 2008 21 o ozgun and m kuzuoglu utilization of anisotropic metamaterial layers in waveguide miniaturization and transitions ieee microw wirel compon lett 17 754 2007 22 b zhang y luo x liu and g barbastathis macroscopic invisibility cloak for visible light phys rev lett 106 033901 2011 23 z liang x jiang f miao s guenneau and j li transformation media with variable optical axes new j phys 14 103042 2012 24 z l mei y s liu f yang and t j cui a dc carpet cloak based on resistor networks opt express 20 23 25758 25764 2012 25 s wang and s liu controlling electromagnetic scattering of a cavity by transformation media opt express 20 6 6777 6785 2012 26 d schurig j j mock b j justice s a cummer j b pendry a f starr and d r smith metamaterial electromagnetic cloak at microwave frequencies science 314 5801 977 980 2006 27 x chen y luo j zhang k jiang j b pendry and s zhang macroscopic invisibility cloaking of visible light nat commun 2 176 2011 28 j mei q wu and k zhang multimultifunctional complementary cloak with homogeneous anisotropic mate rial parameters j opt soc am a 29 10 2067 2073 2012 29 a v novitsky inverse problem in transformation optics j opt 13 035104 2011 30 j li and j b pendry hiding under the carpet a new strategy for cloaking phys rev lett 101 203901 2008 31 q wu j p turpin and d h werner integrated photonic systems based on transformation optics enabled gradient index devices light science and applications 1 e 38 2012 32 c garcia meca a martinez and u leonhardt engineering antenna radiation patterns via quasi conformal mappings opt express 19 24 23743 23750 2011 33 h f ma and t j cui three dimensional broadband and broad angle transformation optics lens nat com mun 1 124 2010 34 n i landy n kundtz and d r smith designing three dimensional transformation optical media using quasiconformal coordinate transformations phys rev lett 105 193902 2010 35 z l mei j bai and t j cui illusion devices with quasi conformal mapping j electromagn waves app 24 17 2561 2573 2010 36 n kundtz and d r smith extreme angle broadband metamaterial lens nat mater 9 129 132 2010 37 r liu r c ji j j mock j y chin t j cui and d r smith broadband ground plane cloak science 323 5912 366 369 2009 38 j valentine j li t zentgraf g bartal and x zhang an optical cloak made of dielectrics nat mater 8 568 571 2009 39 l gabrielli j cardenas c b poitras and m lipson silicon nanostructure cloak operating at optical frequen cies nat photonics 3 461 463 2009 40 t ergin n stenger p brenner j b pendry and m wegener three dimensional invisibility cloak at optical wavelengths science 328 5976 337 339 2010 41 m yin x y tian h x han and d c li free space carpet cloak based on gradient index photonic crystals in metamaterial regime appl phys lett 100 124101 2012 42 z chang x zhou j hu and g hu design method for quasi isotropic transformation materials based on inverse laplace s equation with sliding boundaries opt express 18 6 6089 6096 2010 43 p markov j g valentine and s m weiss fiber to chip coupler designed using an optical transformation opt express 20 13 14705 14712 2012 44 l h gabrielli and m lipson transformation optics on a silicon platform j opt 13 024010 2011 45 z l mei j bai and t j cui experimental verification of a broadband planar focusing antenna based on transformation optics new j phys 13 063028 2011 46 l tang j yin g yuan j du h gao x dong y lu and c du general conformal transformation method based on schwarz christoffel approach opt express 19 16 15119 15126 2011 47 j p turpin a t massoud z h jiang p l werner and d h wener conformal mappings to achieve simple material parameters for transformation optics devices opt express 18 1 244 252 2010 48 d r smith y urzhumov n b kundtz and n i landy enhancing imaging systems using transformation optics opt express 18 20 21238 21251 2010 49 w r frei h t johnson and k d choquette optimization of a single defect photonic crystal laser cavity j appl phys 103 033102 2008 50 c y kao and f santosa maximization of the quality factor of an optical resonator wave motion 45 4 412 427 2008 51 d c dobson and f santosa optimal localization of eigenfunctions in an inhomogeneous medium siam j appl math 64 3 762 774 2004 52 j vuckovic m loncar h mabuchi and a scherer design of photonic crystal microcavities for cavity qed phys rev e 65 016608 2002 53 j lu and j vuckovic inverse design of nanophotonic structures using complementary convex optimization opt express 18 4 3793 3804 2010 54 j s jensen and o sigmund topology optimization for nano photonics laser photon rev 5 2 308 321 2011 55 l frandsen a harp th p borel m kristensen j jensen and o sigmund broadband photonic crystal waveguide 60 bend obtained utilizing topology optimization opt express 12 24 5916 5921 2004 56 w r frei h t johnson and d a tortorelli optimization of photonic nanostructures comput method appl m 197 41 3410 3416 2008 57 j s jensen and o sigmund systematic design of photonic crystal structures using topology optimization low loss waveguide bends appl phys lett 84 12 2022 2024 2004 58 j andkjaer and o sigmund topology optimized low contrast all dielectric optical cloak appl phys lett 98 021112 2011 59 p borel a harp th l frandsen m kristensen p shi j jensen and o sigmund topology optimization and fabrication of photonic crystal structures opt express 12 9 1996 2004 60 s j cox and d c dobson maximizing band gaps in two dimensional photonic crystals siam j appl math 59 6 2108 2120 1999 61 j s jensen and o sigmund topology optimization of photonic crystal structures a high bandwidth low loss t junction waveguide j opt soc am b 22 6 1191 1198 2005 62 j riishede and o sigmund inverse design of dispersion compensating optical fiber using topology optimiza tion j opt soc am b 25 1 88 97 2008 63 c y yao s osher and e yablonovitch maximizing band gaps in two dimensional photonic crystals by using level set methods appl phys b 81 2 235 244 2005 64 w r frei d a tortorelli and h t johnson topology optimization of a photonic crystal waveguide termi nation to maximize directional emission appl phys lett 86 111114 2005 65 y tsuji and k hirayama design of optical circuit devices using topology optimization method with function expansionbased refractive index distribution ieee phot tech lett 20 12 982 984 2008 66 c y kao and s osher incorporating topological derivatives into shape derivatives based level set methods j comp phys 225 1 891 909 2007 67 p seliger m mahvash c wang and a f j levi optimization of aperiodic dielectric structures j appl phys 100 034310 2006 68 y watanabe n ikeda y sugimoto y takata y kitagawa a mizutani n ozaki and k asakawa topology optimization of waveguide bends with wide flat bandwidth in air bridge type photonic crystal slabs j appl phys 101 113108 2007 69 j h lee j blair v a tamma q wu s j rhee c j summers and w park direct visualization of optical frequency invisibility cloak based on silicon nanorod array opt express 17 15 12922 12928 2009 70 u leonhardt and t tyc broadband invisibility by non euclidian cloaking science 323 5910 110 112 2009 71 a greenleaf m lassas and g uhlmann anisotropic conductivities that cannot be detected by eit physiol meas 24 413 413 419 2003 72 a greenleaf m lassas and g uhlmann on nonuniqueness for caldero n s inverse problem math res letters 10 5 685 693 2003 73 u leonhardt and t philbin geometry and light the science of invisibility dover 2010 74 v liu and s fan compact bends for multi mode photonic crystal waveguides with high transmission and suppressed modal crosstalk opt express 21 7 8069 8075 2013 75 a mekis j c chen i kurland s fan p r villeneuve and j d joannopoulos high transmission through sharp bends in photonic crystal waveguides phys rev lett 77 3787 3790 1996 76 c ma q zhang and e v keuren right angle slot waveguide bends with high bending efficiency opt express 16 19 14330 2008 77 v liu and s fan compact bends for multi mode photonic crystal waveguides with high transmission and suppressed modal crosstalk opt express 21 7 8069 8075 2013 78 a chutinan m okano and s noda wider bandwidth with high transmission through waveguide bends in two dimensional photonic crystal slabs appl phys lett 80 10 1698 1699 2002 79 a chutinan and s noda highly confined waveguides and waveguide bends in three dimensional photonic crystal appl phys lett 75 24 3739 3741 1999 80 b chen t tang and h chen study on a compact flexible photonic crystal waveguide and its bends opt express 17 7 5033 5038 2009 81 y zhang and b li photonic crystal based bending waveguides for optical interconnections opt express 14 12 5723 5732 2006 82 j smajic c hafner and d erni design and optimization of an achromatic photonic crystal bend opt express 11 12 1378 1384 2003 83 m schmiele v s varma c rockstuhl and f lederer designing optical elements from isotropic materials by using transformation optics phys rev a 81 033837 2010 84 d schurig j b pendry and d r smith transformation designed optical elements opt express 15 22 14772 14782 2007 85 m rahm s a cummer d schurig j b pendry and d r smith optical design of reflectionless complex media by finite embedded coordinate transformations phys rev lett 100 063903 2008 86 d smith j mock a starr and d schurig gradient index metamaterials phys rev e 71 036609 2005 87 d r smith j b pendry and m c k wiltshire metamaterials and negative refractive index science 305 5685 788 792 2004 88 f xu r c tyan p c sun y fainman c c cheng and a scherer fabrication modeling and characteri zation of form birefringent nanostructures opt lett 20 24 2457 2459 1995 89 h kurt and d s citrin graded index photonic crystals opt express 15 3 1240 1253 2007 90 b vasic r gajic and k hingerl graded photonic crystals for implementation of gradient refractive index media j nanophotonics 5 051806 2011 91 u levy m abashin k ikeda a krishnamoorthy j cunningham and y fainman inhomogenous dielectric metamaterials with space variant polarizability phys rev lett 98 243901 2007 92 l gabrielli and m lipson integrated luneburg lens via ultra strong index gradient on silicon opt express 19 21 20122 20127 2011 93 y wang c sheng h liu y j zheng c zhu s m wang and s n zhu transformation bending device emulated by graded index waveguide opt express 20 12 13006 13013 2012 94 r ulrich and r j martin geometric optics in thin film light guides appl opt 10 9 2077 2085 1971 95 f zernike luneburg lens for optical waveguide use opt commun 12 4 379 381 1974 96 b u chen e marom and a lee geodesic lenses in single mode linbo 3 waveguides appl phys lett 31 4 263 1977 97 j brazas g kohnke and j mcmullen mode index waveguide lens with novel gradient boundaries developed for application to optical recording appl opt 31 18 3420 3428 1992 98 w rudin real and complex analysis mcgraw hill 1986 99 g e shilov elementary real and complex analysis mit 1973 100 j li and j b pendry private communication 2013 101 w yan m yan and m qiu necessary and sufficient conditions for reflectionless transformation media in an isotropic and homogenous background arxiv 0806 3231 2008 102 l bergamin electromagnetic fields and boundary conditions at the interface of generalized transformation media phys rev a 80 063835 2009 103 w yan m yan z ruan and m qiu coordinate transformations make perfect invisibility cloaks with arbitrary shape new j phys 10 043040 2008 104 o weber a myles and d zorin computing extremal quasiconformal maps symp geom process 31 5 1679 1689 2012 105 k astala t iwaniec and g martin elliptic partial differential equations and quasiconformal mappings in the plane princeton university 2008 106 a papadopoulos editor handbook of teichmu ller theory volume 1 european mathematical society 2007 107 r ku hnau editor handbook of complex analysis geometric function theory volume 2 elsevier b v 2005 108 l bers an extremal problem for quasi conformal mappings and a problem of thurston acta math 73 98 1978 109 l v ahlfors lectures on quasiconformal mappings american mathematical society 1966 110 z balogh k fa ssler and i platis modulus of curve families and extremality of spiral stretch maps j anal math 113 1 265 291 2011 111 k astala t iwaniec and g martin deformations of annuli with smallest mean distortion arch rational http arxiv org abs 0806 3231 mech anal 195 899 921 2010 112 z balogh k fa ssler and i platis modulus method and radial stretch map in the heisenberg group ann acad sci fenn 38 1 149 180 2013 113 j p boyd chebyshev and fourier spectral methods dover 2001 114 s boyd and l vandenberghe convex optimization cambridge university 2004 115 l gabrielli d liu s g johnson and m lipson on chip transformation optics for multimode waveguide bends nat commun 3 1217 2012 116 u leonhardt and t g philbin transformation optics and the geometry of light prog opt 53 69 152 2009 117 j d jackson classical electrodynamics wiley 1998 118 j plebanski electromagnetic waves in gravitational fields phys rev 118 5 1396 1408 1960 119 u leonhardt and t g philbin general relativity in electrical engineering new j phys 8 10 2006 120 l ahlfors on quasiconformal mappings j anal math 3 1 1 58 1953 121 w zeng f luo s t yau and x d gu surface quasi conformal mapping by solving beltrami equations proc math surfaces xiii 391 408 2009 122 j f thompson b k soni and n p weatherill handbook of grid generation crc 1999 123 p knupp and s steinberg fundamentals of grid generation crc 1994 124 s g johnson m l povinelli m soljac ic a karalis s jacobs and j d joannopoulos roughness losses and volume current methods in photonic crystal waveguides appl phys b 81 283 293 2005 125 a w snyder and j d love optical waveguide theory chapman and hall 1983 126 w c chew waves and fields in inhomogeneous media ieee 1995 127 m j d powell a direct search optimization method that models the objective and constraint functions by linear interpolation adv optim numer anal 1994 128 m j d powell direct search algorithms for optimization calculations acta numer 7 287 336 1998 129 s g johnson the nlopt nonlinear optimization package http ab initio mit edu nlopt 2007 130 a logg k a mardal and g n wells automated solution of differential equations by the finite element method springer 2012 131 a oskooi a mutapcic s noda j d joannopoulos s p boyd and s g johnson robust optimization of adiabatic tapers for coupling to slow light photonic crystal waveguides opt express 20 19 21558 21575 2012 132 a mutapcica s boyd a farjadpour s g johnson and y avniel robust design of slow light tapers in periodic waveguides eng optim 41 4 365 384 2009 133 t f chan j cong t kong and j r shinnerl multilevel optimization for large scale circuit placement ieee icad 171 176 2000 134 k w chun and j ra fast block matching algorithm by successive refinement of matching criterion proc spie vis commun image process 1818 552 560 1992 135 s g johnson p bienstman m a skorobogatiy m ibanescu e lidorikis and j d joannopoulos adiabatic theorem and continuous coupled mode theory for efficient taper transitions in photonic crystals phys rev e 66 066608 2002 136 c manolatou s g johnson s fan p r villeneuve h a haus and j d joannopoulos high density integrated optics j lightwave technol 17 9 1682 1692 1999 1 introduction in this work we introduce the technique of transformation inverse design which combines the elegance of transformation optics 1 5 to with the power of large scale optimization inverse design enabling automatic discovery of the best possible transformation for given design criteria and material constraints we illustrate our technique by designing multimode waveguide bends 6 18 and mode squeezers 17 21 then measuring their performance with finite element method fem simulations most designs in transformation optics use either hand chosen transformations 3 11 14 19 22 29 which often require nearly unattainable anisotropic materials or quasiconformal and conformal maps 2 6 10 19 30 48 which can automatically generate nearly isotropic transformations either by solving partial differential equations or by using grid generation techniques but still require a priori specification of the entire boundary shape of the transformation further neither technique can directly incorpo rate refractive index bounds on the other hand most inverse design in photonics involves re peatedly solving computationally expensive maxwell equations for different designs 49 68 transformation inverse design combines elements of both transformation optics and inverse design while overcoming their limitations first the use of optimization allows us to incor http ab initio mit edu nlopt fig 1 three possible applications of transformation optics for multimode waveguides squeezer expander and bend dark areas indicate higher refractive index porate arbitrary fabrication constraints while at the same time searching the correct space of transformations without unnecessarily underconstraining or overconstraining the problem second instead of solving maxwell s equations we require only simple derivatives to be computed at each optimization step this is because transformation optics works by using a coordinate transformation x x that warps light in a desired way e g mapping a straight waveguide to a bend or mapping an object to a point or the ground for cloaking applica tions 3 30 37 40 69 70 73 and then employing transformed materials which are given in terms of the jacobian j i j x j xi to mathematically mimic the effect of the coordinate trans formation this transforms all solutions of maxwell s equations in the same way as opposed to non to multimode devices which often have limited bandwidth and or do not preserve relative phase between modes 57 68 74 82 and is therefore particularly attractive for designing mul timode optical devices 17 31 83 85 such as mode squeezers expanders splitters couplers and multimode bends with no intermodal scattering before to was first used for cloaking electrostatic cloaking using anisotropic conductivities 71 72 had been proposed examples of such transformations are shown in fig 1 for a more comprehensive treatment of the physical and mathematical ideas of transformation media used in this paper see 73 one major difficulty with transformation optics is that most functions x x yield highly anisotropic and magnetic materials in principle these transformed designs can be fabricated with anisotropic microstructures 26 86 88 or naturally birefringent materials 22 27 how ever in the infrared regime where metals are lossy it is far easier to instead fabricate effec tively isotropic dielectric materials provided that the refractive index falls within the given bounds nmin and nmax of the fabrication process for example subwavelength nanostructures 33 38 40 44 69 86 89 91 or waveguides with variable thickness 92 97 this requirement means that we would prefer to consider the subset of transformations that can be mapped to approximately isotropic dielectric materials the theory of transformation optics with nearly isotropic materials is intimately connected to the subjects of conformal maps which are isotropic by definition 2 98 99 and quasicon formal maps which in mathematical analysis are defined as any orientation preserving trans formation with bounded anisotropy as quantified in sec 2 4 however in transformation optics the term quasiconformal has become confusingly associated with only a single choice of quasiconformal map suggested by li and pendry 30 in that work li and pendry proposed minimizing a mean anisotropy with slipping boundary conditions defined in sec 2 4 which turns out to yield a transformation that is essentially conformal up to a constant stretching and thus anisotropy everywhere this map which also happens to minimize the peak anisotropy given the slipping boundary conditions 30 100 is sometimes confusingly called the quasi conformal map 6 34 36 38 40 however we point out in sec 2 4 that slipping boundary conditions are not the correct choice if one wishes to ensure a reflectionless interface between transformed and untransformed regions instead for interfaces to be reflectionless requires at least continuity of the transformation x at the interface 85 101 103 and as we show in sec 2 3 for the case of isotropic dielectric media continuity of the jacobian j as well if one fixes the transformation on part or all of the boundary instead of just the corners and minimizes the peak anisotropy the result is called in analysis an extremal quasiconformal map 104 109 we point out in sec 2 2 that this extremal quasiconformal map can never be conformal except in trivial cases additionally previous work in quasiconformal transfor mation optics underconstrained the space of transformations in one way but overconstrained it in another li and pendry s method along with other work on extremal quasiconformal maps in mathematical analysis assumed that the entire boundary shape of the transformed domain is specified a priori even if the value of the transformation at the boundary is not specified in contrast transformation inverse design allows parts of the boundary shape to be freely chosen by the optimization only fixing aspects of the boundary that are determined by the underlying problem e g the input output facets of the boundary in fig 1 as explained in secs 3 2 allowing a much larger space of transformations to be searched also for such stricter boundary conditions minimizing the mean anisotropy is not equivalent to minimizing the peak anisotropy 105 110 112 and we argue below that the peak anisotropy is a better figure of merit for transformation optics in general we solve all of these problems by using large scale numerical optimization to find the trans formation with minimal peak anisotropy that exactly obeys continuity conditions at the bound ary with untransformed regions this allows the input output interfaces to transition smoothly and continuously into untransformed devices while also satisfying fabrication constraints e g bounds on the attainable refractive indices and bend radiii a large space of arbitrary smoothly varying transformations that satisfy the continuity conditions and fabrication constraints is explored quickly and efficiently by parametrizing in a spectral basis 113 114 of fourier harmonics and chebyshev polynomials the optimized transformation is then scalarized as in the case of previous work on quasiconformal transformation optics into an isotropic dielectric material that guides modes with minimal intermodal scattering and loss in the case of a multi mode bend for which our design was recently fabricated and characterized 115 we achieve intermodal scattering at least an order of magnitude smaller than a conventional non to bend in sec 2 1 we review the equations of transformation optics in sec 2 2 we describe situa tions where the transformation designed material can be mapped to isotropic media in sec 2 3 we point out that such isotropic transformations due to their analyticity always have undesir able interface discontinuities when coupled into untransformed regions in secs 2 4 and 2 5 we review the techniques of quasiconformal mapping as used in both the transformation optics and mathematical analysis literature and scalarization of nearly isotropic transformations we show that the inherent restrictions of quasiconformal mapping can be circumvented by directly optimizing the map using transformation inverse design in secs 3 1 and 3 2 we design a nearly isotropic transformation for a 90 bend by perturbing from the highly anisotropic circular bend transformation in secs 3 3 and 3 4 we set up the bend optimization problem and the spec tral parameterization in sec 4 we present the optimized structure which reduces anisotropy by several orders of magnitude compared to the circular to bend in sec 4 1 we present fi nite element simulation results comparing our optimized design to the conventional non to bend and the circular to bend in secs 4 2 we show that minimizing the mean anisotropy can lead to pockets of high anisotropy which in turn leads to greater intermodal scattering while minimizing the peak does not in secs 4 3 we discuss the tradeoff between the bend radius and the optimized anisotropy in sec 5 we briefly present methods and results for applying transformation inverse design to optimize mode squeezers 2 mathematical preliminaries 2 1 transformation optics the frequency domain maxwell equations fields e i t without sources or currents in linear isotropic dielectric media x 0 are h i x e e i 0 h 1 consider a coordinate transformation x x with jacobian ji j x j xi we define the primed gradient vector as x y z j 1 and the primed fields as e j 1 e and h j 1 h one can then rewrite eq 1 after some rearrangement 1 116 as h i e e i h 2 where the effects of the coordinate transformation have been mapped to the equivalent tensor materials 0 j tj detj x j tj detj 3 this equivalence has become known as transformation optics to it is actually the specific case of a much more general result from general relativity 118 for a further discussion of space time transformations and connections to negative refraction see 73 and 119 most useful applications of to require that the transformation be coupled to untransformed regions e g the input and output straight waveguides in the case of a bend transformation or the surrounding air region for the case of a ground plane cloaking transformation however in order for to to guarantee that the interface between transformed and untransformed regions be reflectionless the transformation must be equivalent to a continuous transformation of all space that is the identity x x x in the untransformed regions as depicted in fig 2 more gen erally the untransformed regions can be simple rotations or translations but when examining a particular interface we can always choose the coordinates to be x x at that interface it is clear by construction that continuous x is sufficient for reflectionless interfaces 85 102 103 and this is in fact a necessary condition as well 101 although a general anisotropic trans formation need only have x x continuous at the interface we show below that an isotropic transformation will also have a continuous j at the interface these boundary conditions are essential for designing useful transformations without interface reflections 2 2 transformations to isotropic dielectric materials for the vast majority of transformations the materials in eq 3 are anisotropic tensors how ever for certain transformations the tensors are effectively scalar suppose that the transforma fig 2 the interface between the transformed and untransformed region must have x con tinuous in order for there not to be any interface reflections tion x x is 2 d z z and x z 0 makingj block diagonal with the zz element independent of the xy block then the xy block of j tj is isotropic if and only if the diagonal elements are equal and the off diagonal elements vanish x 2 y 2 0 x y 0 4 in this case the j part of eq 3 becomes j tj detj 1 1 1 detj 5 this isotropy has different implications for transverse magnetic tm polarized modes in 2 d which have e ez and h z 0 versus transverse electric te polarized modes which have e z 0 and h hz for tm polarized modes the fields e h in the primed coordinate system are also tm polarized and eq 2 becomes h i x detj e e i 0 h hence for tm modes an isotropic transformation can be exactly mapped to an isotropic di electric material similarly for te polarized modes the equivalent material is isotropic and magnetic however if detj varies slowly compared to the wavelengths of the fields then the transformation can approximately still be mapped to an isotropic dielectric material by making an eikonal approximation as in 117 ch 8 10 and commuting 1 with one of the curls in the maxwell equations in particular eq 2 can be written e 2 0 0 detj e o detj where the last term can be neglected for slowly varying transformations because the tm case is conceptually simpler and does not require this extra approximation we work with it exclusively for the rest of this paper also because the non trivial aspects of the transformation occur in the xy plane we hereafter use j to denote the xy block 2 3 conformal maps and uniqueness if a transformation has an isotropic j then the transformation preserves angles in the xy plane additionally if detj 0 then the transformation also preserves handness and orientation the combination of these two properties is called a conformal map 98 and is the only case where the situation in sec 2 2 can be realized we only consider transformations with detj 0 in order to restrict ourselves to dielectric materials also a detj 0 transformation coupled continuously to an untransformed detj 1 region would require singularities detj 0 at some points conformal maps are described by analytic functions which are of the form x iy w w where w x iy is the untransformed complex coordinate and whose real and imaginary parts satisfy the cauchy riemann equations of complex analysis 98 99 however true conformal maps cannot directly be used for transformation optics in typical applications because of the impossibility of coupling them to untransformed regions with the boundary conditions discussed in sec 2 1 in particular the uniqueness theorem of analytic functions 99 thm 10 39 tells us that if w w w in some region then w w w everywhere similarly for a simple rotation or translation in some regions as a corollary in the limit where a transformation becomes more and more isotropic in the neighborhood of an interface it must have a continuousj not just a continuous x x it is easy to see this explicitly in the example of fig 2 continuity of x x at the interface requires that x x 1 0 on both sides of the interface which determines the first row of j the isotropy of j tj then forces j i therefore in the sections that follow where we search for approxi mately isotropic maps we will impose the condition of continuous j as a boundary condition on our transformations the resulting transformations are nearly isotropic in the interior and exactly isotropic on the interfaces this condition discussed at the end of sec 2 5 also has the useful consequence of producing a continuous refractive index n 2 4 quasiconformal maps and measures of anisotropy because true conformal maps cannot be used one widely used alternative is to search for a nearly isotropic transformation which can be approximated by an isotropic material at the cost of some scattering corrections to the exactly transformed modes of the nearly isotropic material to do this one must first quantify the measure of anisotropy that is to be minimized the isotropy condition of eq 4 is equivalent to 1 2 where 1 x y 2 x y are the two eigenvalues of j tj while 1 2 works as a measure of anisotropy it is convenient for optimization purposes to define differentiable measures that can be expressed directly in terms of the trace and determinant of j and precisely such quantities have been developed in the literature on quasiconformal maps 104 105 109 120 121 a general transformation is an arbitrary function of x and y or equivalently an arbitrary function w w w of w and w x iy which may not be analytic in w the anisotropy can be related to the beltrami coefficient 105 109 b w w w w w w 1 the term quasiconformal map refers to any map that has bounded b 1 which includes all non singular sense preserving detj 0 transformations it can be shown that the linear distortion k 104 105 satisfies k 1 b 2 1 b 2 1 2 1 various other measures of anisotropy have been defined in the grid generation literature 122 123 including the winslow and modified liao functionals which are given by d 2 x k 1 k and d 2 x k 2 1 k 2 respectively however for the rest of this work we refer to the quantity k 1 0 as the anisotropy where k is the distortion function 104 105 defined as k x y 1 2 k 1 k trj tj 2 detj 1 6 the tensor j t j detj is known as the distortion tensor 105 as mentioned in the introduction an extremal quasiconformal map is one that minimizes the peak anisotropy given the shape of the transformed region and the values of the transfor mation on some or all of the boundary 104 105 109 120 because k k 1 k and b are all monotonic functions of one another they are equivalent for the purpose of finding an extremal quasiconformal map however k is numerically convenient because it is a differen tiable function of the entries of j these quantities are not generally equivalent for minimizing the mean anisotropy 105 110 112 and we argue in sec 4 2 that the peak anisotropy is a better figure of merit however in the special case where the value of the transformation is only fixed at the corners of the domain and is allowed to vary freely in between a slipping boundary condition li and pendry showed that it is equivalent to minimize the mean either winslow or modified liao or the peak anisotropy and that these yield a constant anisotropy map a uniform scaling of a conformal map 100 that they and other authors have used for transformation optics 6 19 31 45 however the slipping boundary will generally lead to re flections at the interface between the transformed and untransformed regions because of the resulting discontinuity in the transformation which can only be reduced by making the trans formation domain very large in cases e g cloaking with localized deformations in order to design compact transformation optics devices especially for applications such as bends where the deformation is nonlocalized we will instead impose continuity of the transformation and or its jacobian on the input output facets of the domain while at the same time allowing the shape of some or all of the boundary to vary unlike all previous work on quasiconformal maps to our knowledge 2 5 scalarization errors for nearly isotropic materials the minimum anisotropy quasiconformal map is then scalarized as in 30 by approximating it with an isotropic dielectric material as shown in sec 2 2 a perfectly isotropic 2 d transfor mation of a geometry with an isotropic dielectric material that guides tm modes e 0 h 0 can be mapped to a transformed material and geometry that is also isotropic dielectric and guides tm modes e 0 h 0 this is exact for k 1 but for a nearly isotropic transformation with k 1 the equivalent permeability is i where the anisotropic part is proportional to k 1 to lowest order while 6 0 cannot be fabricated using dielectric gradient index processes one can neglect this small correction so that the actual fabricated material has per meability approx i in practice we absorb any into by multiplying by the average eigenvalue of 1 2 2 1 2 trj tj 2 detj 7 but this does not change the o k 1 error a born approximation 124 126 tells us that given an exact transformation with no scatte ring any small error of and will generically lead to scattered fields with magnitudes of o and scattered power ofo 2 2 the modes of the approximate scalar ized material approx approx are then the exact guided modes plus scattered power corrections of o 2 o k 1 2 a similar analysis explains why we must explicitly impose continuity of j at the input output facets of the domain as explained in sec 2 3 a purely isotropic transformation in the neigh borhood of the interface along with a continuity of x would automatically yield continuous j so one might hope that minimizing anisotropy would suffice to obtain a nearly continu ous j unfortunately as we show in the appendix the resulting discontinuity in detj and hence the discontinuity in the refractive index is of order o k 1 which would lead to o k 1 power loss due to reflections much larger than the o k 1 2 power scattering from anisotropy in the interior this would make it pointless to minimize the anisotropy in the interior since the boundary reflections would dominate in fact our initial implementation of the bend optimization in sec 3 4 did not enforce continuity of j and we obtained a large 2 index discontinuity at the endfacets for maxxk 1 0 0005 therefore in sec 3 4 we impose continuity of j explicitly 2 6 general optimization of anisotropy in this paper we directly minimize k using large scale numerical optimization while keeping track of constraints on the transformation x and its jacobian j as well as the engineering fab rication bounds nmin and nmax by using numerical optimization we can in principle achieve both a lower mean anisotropy and a lower peak anisotropy than by traditional quasiconformal mapping since the optimization is also free to vary the boundary shape with at most the in put output interfaces fixed although in some cases their locations and shapes are allowed to vary as well the minimization problem can be written for example as min x x k x subject to x j continuousat input output interfaces nmin n x nmax 8 where k x is a functional norm taken over the domain of x x we consider two possible norms the l 1 norm the mean k x and the l norm maxx k we show in sec 4 2 that minimizing the mean can lead to pockets of high anisotropy which can cause increased scat tering directly optimizing the peak anisotropy on the other hand avoids such pockets while simultaneously keeping the mean nearly as low the continuity of x and j at the input output interfaces as well as other constraints on the interface locations are imposed implicitly by the parametrization of x x as explained in sec 3 4 3 multimode bend design in this section we design a bend transformation depicted in fig 3 using general methods to locally solve the optimization problem of eq 8 in contrast previous work on to bend design either utilized materials that were either anisotropic or consisted of multiple stacked isotropic layers 11 15 17 18 or employed slipping boundary conditions 6 10 which result in endfacet reflections when coupled to untransformed waveguide 3 1 simple circular bends first we consider a simple circular bend transformation which we refer to hereafter as the circular to bend that maps a rectangular segment of length l and width unity in arbitrary distance units to be determined later into a bend with inner radius r and outer radius r 1 as shown in fig 3 for convenience we choose the untransformed coordinates to be r x r 1 and l 2 y l 2 with the untransformed segment length l r 2 equal to the inner arclength of the bend the transformation x x can be written as x r cos y r sin z z 9 where r x and yr while x is continuous at the input output interfaces y l 2 one issue is that j is not continuous there which can be seen from detj xr 6 1 another issue is that 6 0 i is highly anisotropic the anisotropy for this transformation is k x y 1 x 2 r r 2 x 1 which has a peak value maxx k 1 12 r 2 for r 1 at the outer radius x r 1 note that one can instead choose r exp x 2 l which gives the conformal bend x iy exp 2 l x iy as explained in sec 2 3 this map has zero anisotropy but neither x nor j are continuous at the input output interfaces leading to large reflections there 3 2 generalized bend transformations in order to address the problems of the circular to bend we look for minimum anisotropy and continuous interface transformations of the form of eq 9 where the intermediate polar co ordinates are now arbitrary functions r x y and x y the ratio l r is now an optimization parameter the jacobian then satisfies trj tj r 2 r 2 detj r r we find that the optimization always seems to prefer a symmetric bend and if the optimum is unique it must be symmetric so we impose a mirror symmetry in order to halve our search space r x y r x y x y x y 10 we also require interface continuity of x and j as discussed in sec 2 3 which give the conditions at y l 2 r x 4 r y 0 y 1 x 11 3 3 numerical optimization problem besides minimizing the objective function k the optimization must keep track of several con straints first any fabrication method will bound the overall refractive index n to lie between some values nmin and nmax we choose units so that the width of the transformed region is unity r x r 1 and consider transforming a straight waveguide of width w 1 w should be small enough so that the exponential tails of the waveguide modes are negligible outside the transformed region in the straight waveguide segment to be transformed as well as the straight waveguides to be coupled into the input and output interfaces of the bend n x is high in the core x r 12 w 2 and low in the cladding x r 12 w 2 for convenience we write this refractive index as a product n x n 0 p x of an overall refractive index n 0 and a normalized profile p x that is unity in the cladding and some value greater than unity in the core determined by the ratio of the high and low index regions of the straight waveguide the transformed refractive index is given by n x n 0 p x trj tj 2 detj 2 where the average eigenvalue of the magnetic permeability eq 7 has been absorbed into the dielectric index the overall refractive index scaling n 0 is then allowed to freely vary as a parameter in the optimization second like the circular to bend the optimum to bend is expected to have a tradeoff between the bend radius and anisotropy because of this expected tradeoff we can choose to either minimize r while keeping k fixed or minimize k while keeping r fixed we focus on the latter choice since the bend radius is the more intuitive target quantity to know beforehand also we find empirically that optimizing k converges much faster than optimizing r while yielding the same local minima with these constraints there are several ways to set up the optimization problem depending on which norm we are minimizing one method is to minimize the peak anisotropy maxxk with x g for some grid g of some points to be defined in sec 3 4 however the peak the l norm is not a differentiable function of the design parameters so it should not be directly used as the objective function instead we perform a standard transformation 114 we intro duce a dummy variable t and indirectly minimize the peak k using a differentiable inequality constraint between t and k x at all x g min r x x n 0 l t t subject to continuity conditions 10 11 nmin n 0 p x trj tj 2 detj 2 nmax forx g r r 0 k x t forx g 12 for comparison we explain in sec 4 2 why the l norm is better to minimize than the l 1 norm the mean anisotropy the minimization of the l 1 norm k x kdxdy area which is differentiable in terms of the parameters r x x n 0 and l is implemented as min r x x n 0 l k x subject to continuity conditions 10 11 nmin n 0 p x trj tj 2 detj 2 nmax forx g r r 0 13 we use the circular bend r x y 2 l y r as a starting guess and search the space of general transformations r x x by perturbing from this base case we only perform local optimization not global optimization but comment in sec 4 3 on a simple technique to avoid being trapped in poor local minima as explained in sec 3 4 the perturbations will be param eterized such that the symmetry and continuity constraints are satisfied automatically figure 3 shows a schematic of the bend transformation optimization process first the straight region is mapped to a circular bend then the intermediate polar coordinates r and for every point x are perturbed using an optimization algorithm described at the end of sec 3 4 and the de sired norm either l 1 and l of the anisotropy is computed this process is repeated at each optimization step until the structure converges to a local minimum in k fig 3 in the transformation process the untransformed straight waveguide is bent per turbed and optimized darker regions indicate higher refractive index 3 4 spectral parameterization to faciliate efficient computation of the objective and constraints the functions r and can be written as the circular bend transformation plus perturbations parametrized in the spectral basis 113 114 r x y x n nm m cr mt 2 x 2 r 1 cos 2 m y l x y y 2 l 1 x n nm m c mt 2 x 2 r 1 sin 2 m y l 14 where the coordinate 2 x 2 r 1 has been centered appropriately for the domain 1 1 of degree chebyshev polynomials t the sines and cosines have been chosen to satisfy the mirror symmetry conditions of eq 10 the sine series also automatically satisfies the second continuity condition of eq 11 in order to satisfy the rest of the conditions the following constraints are also imposed nm m cr m 1 m 0 nm m c m 1 m m l 8 r 4 1 8 0 18 1 0 2 15 these equations are solved to simply eliminate the cr nm coefficients before optimization this spectral parametrization has several advantages over finite element discretizations such as the piecewise linear parameterization of 104 first the spectral basis converges exponen tially for smooth functions 113 we found that only a small number n nm 100 of spec tral coefficients cr are needed to achieve very low anisotropy k 1 10 4 transformations second if the fabrication process favors slowly varying transformations or if these are needed to make the eikonal approximation for the te polarization as in sec 2 2 this constraint may be imposed simply by using smaller n and nm with this spectral parameterization the formulation of the optimization problem eq 12 fig 4 optimization decreases anisotropy by a factor of 10 4 while dramatically improv ing the scattered power matrix becomes min c r m n 0 l t t subject to constraint 15 nmin n 0 p x trj tj 2 detj 2 nmax forx g r r 0 k x t forx g 16 the local optimization was performed using the derivative free cobyla non linear op timization algorithm 127 128 in the nlopt package 129 in principle we can make the optimization faster by analytically computing the derivatives of the objective and constraints with respect to the design parameters and using a gradient based optimization algorithm but that is not necessary because both trj tj and detj which determine all the non trivial objec tive and constraint functions in this optimization problem are so computationally inexpensive to evaluate that the convergence rate is not a practical concern 4 optimization results 4 1 minimal peak anisotropy a min k design is shown in fig 4 along with the scalarized circular to bend for compari son the bend radius was r 2 and the number of spectral coefficients was n 5 nm 8 the objective and constraints were evaluated on a 100 140 grid g in x chebyshev points in the x direction and a uniform grid in the y direction this design had maxxk 1 5 10 4 and mean k 1 10 4 in comparison the circular to bend of the same radius has maxxk 1 0 1 and k 1 10 2 the r 2 optimized design structure was compared in finite element maxwell simulations using the fenics code 130 with the conventional non to bend simply bending the waveg uide profile around a circular arc with n x n x and the scalarized circular to bend the four lowest frequency modes of a multimode straight waveguide were injected at the input in terface y l 2 and the scattered power matrix t was computed using the measured fields at the fig 5 fem field profiles show heavy scattering in the conventional non to and scalarized circular bends but very little scattering in the optimized bend output interface y l 2 the scattered power matrix is defined as ti j r 1 r dx e 0 j hi 2 y l 2 where is the propagation direction of the guided modes e 0 j is the normalized electric field of the jth exactly guided mode of the non scalarized material and hi is the actual mag netic field of the approximate scalarized material at the interface after injecting a normalized mode e 0 i at the input interface this makes ti j equal to the power scattered into the jth output mode from the ith input mode for a straight waveguide which has no intermodal scattering t i figure 4 shows a dramatically improved t for the scalarized and optimized to bend compared to the scalarized circular to bend the rows and columns of t for the circular bend add up to less than one because some power has either been scattered out of the waveguide en tirely or some power has been scattered into fifth or higher order modes the rows and columns of t for the optimized bend add up to nearly 1 with the small deficiency due to the o k 1 out of bend and higher order intermodal scattering as well as mesh descretization error the electric field profiles for the fundamental mode displayed in fig 5 show a dramatic difference in the performance of the optimized structure versus the other structures both the conventional and circular to bend show heavy intermodal scattering in the bend region while the optimized transformation displays very little scattering 4 2 minimizing max versus minimizing mean we found a clear difference between minimizing the peak anisotropy versus minimizing the mean the results of an optimization run with r 2 5 n 3 and nm 6 are shown in fig 6 both structures had very low mean anisotropy k x 1 the mean minimized struc ture at k 1 10 5 had a slightly lower mean than the peak minimized structure which had k 1 1 5 10 5 however in terms of the peak anisotropy the peak minimized structure is the clear winner by a factor of 2 5 with maxxk 1 2 10 4 as opposed to maxxk 1 5 10 4 for the mean optimized structure both structures were scalarized and tested in finite element maxwell simulations of the four lowest frequency modes of the straight waveguide the scattered power matrix shows that the difference in maxx k resulted in an order of magnitude reduction in the intermodal scattering as shown in the off diagonal elements and noticeably improved transmission especially in the element t 44 0 89 for the fourth mode fig 6 anisotropy profile and scattered power matrices for optimized designs that mini mize the mean and the peak with r 2 5 n 3 and nm 6 4 3 tradeoff between anisotropy and radius in optimized structures we found that maxxk for the optimized bend similar to the circular to bend decreases monotonically with r as shown in fig 7 unlike the circular bend how ever this tradeoff seems asymptotically exponential rather than o r 2 in particular there are two clearly different regimes for this tradeoff a power law k 1 r 4 at small r 3 and an exponential decay k 1 exp 0 34 r at larger r the second regime was only attained after using successive optimization because with only one independent optimization run the algorithm tended to get stuck in local minima for successive optimization the optimum struc ture is used as a starting guess for the next run and the initial step size is set large enough so that the algorithm can reach better local minima than the previous one for r 3 we found that there are multiple local minima and that independent optimiza tions for different r tend to be trapped in suboptimal local minima as shown by the open dots in fig 7 to avoid this problem we used a successive optimization technique in which the optimal structure for smaller r is rescaled as the starting guess for local optima at a larger r in order to stay along the exponential tradeoff curve another possible heuristic is succes sive refinement 131 134 in which optima for smaller n m are used as starting points for optimizing using larger n m 5 mode squeezer we also applied transformation inverse design to another interesting geometry a mode squeezer that concentrates modes and their power in a small region in space again with minimal intermodal scattering quite unlike a conventional lens which is intrinsically angle mode dependent similar to the problem considered in 19 which did not construct isotropic de signs we choose the untransformed region to be 1 x 1 and 0 y l the goal of this transformation x x is to focus the beam by minimizing the mid beam width w 1 1 dx x x 2 y x 2 y l 2 fig 7 successive optimization with n 5 nm 8 results in a power law decaying trade off maxxk 1 r 4 at low r and an exponentially decaying tradeoff at higher r for comparison the unoptimized anisotropy for the circular to bend is shown above as in sec 3 4 the transformation is written as a perturbation from the identity transformation which was used as the starting guess and parameterized in the spectral basis x x y x n nm m cx mt x sin 2 m 1 y l y x y y n nm m cy mt x sin 2 m 1 y l the sine series automatically satisfies mirror symmetry about y l 2 and continuity of x at the input output interfaces y 0 l however we found that constraining the coefficients cx y to enforce continuity ofj as in sec 3 4 was not necessary although it might give a better result since the optimization algorithm only squeezed the center region while leaving the interfaces and the regions around them relatively untouched in this problem we could either minimize k for a fixed w or minimize w for a fixed k and we happened to choose the latter fig 8 optimized squeezer outperforms gaussian taper and stretched optimized squeezers in finite element simulations finite element maxwell simulations shown in fig 8 demonstrate that the optimized design is greatly superior to a simple gaussian taper transformation designed by hand the gaus sian transformation was given by x x x x exp y l 2 2 where 0 and 0 1 superficially the design seems similar to an adiabatic taper between a wide low index waveg uide and a narrow high index waveguide and it is known that any sufficiently gradual taper of this form would have low scattering due to the adiabatic theorem 135 however the optimized to design is much too short to be in this adiabatic regime if it were in the adiabatic regime then taking the same design and simply stretching the index profile to be more gradual a taper twice as long would reduce the scattering but in fig 8 we perform precisely this experiment and find that the stretched design increases the scattering 6 concluding remarks the analytical simplicity of to design no maxwell equations need be solved in order to warp light in a prescribed way paradoxically makes the application of computational techniques more attractive in order to discover the best transformation by rapidly searching a large space of possibilities previous work on to design used optimization to some extent but overcon strained the transformation by fixing the boundary shape while underconstraining the boundary conditions required for reflectionless interfaces in fact even our present work imposes more constraints than are strictly necessary as long as we require continuous j at the input output interfaces there is no conceptual reason why those interfaces need be flat a better bend for example might be designed by constraining the location of only two corners to fix the bend ra dius and constraining only j on other parts of the endfacets however we already achieve an exponential tradeoff between radius and anisotropy so we suspect that further relaxing the con straints would only gain a small constant factor rather than yielding an asymptotically faster tradeoff in the case of the mode squeezer one could certainly achieve better results by im posing the proper j constraints at the endfacets it would also be interesting to apply similar techniques to ground plane cloaking all to techniques suffer from some limitations that should be kept in mind first to seems poorly suited for optical devices in which one wants to discriminate between modes e g a modal filter or to scatter light between modes e g a mode transformer to is ideal for devices in which it is desirable that all modes be transported equally with no scattering even for the latter case such as our multimode bend however to designs almost certainly trade off com putational convenience for optimality because they impose a stronger constraint than is strictly required to is restricted to designs where the solutions at all points in the design are coordi nate transformations of the original system whereas most devices are only concerned with the solutions at the endfacets for example it is conceivable that a more compact multimode bend could be designed by allowing intermodal scattering within the bend as long as the modes scat ter back to their original configurations by the endfacet the interior of the bend might not even be a waveguide and instead might be a resonant cavity of some sort 55 75 76 136 however optimizing over such structures seems to require solving maxwell s equations in some form at each optimization step which is far more computationally expensive than the to design and unlike the to design must be repeated for different wavelengths and waveguide designs appendix in this appendix we briefly derive the fact mentioned in sec 2 5 that the endfacet discon tinuity scales much worse with anisotropy than the scalarization errors in the transformation interior which leads us to impose an explicit continuity constraint on the jacobian j in par ticular we examine the jacobian j for nearly isotropic transformations k 1 that also have x x explicitly constrained at the interfaces the following analysis can also be straight fowardly extended to situations where x is a simple rotation of x on the interface or where the interface has an arbitrary shape in this case the jacobian is j 1 0 1 where x y and y y 1 are small quantities 1 if j tj is nearly isotropic the anisotropy eq 6 is then k 1 1 2 1 2 2 1 1 1 2 2 2 o 2 3 17 the determinant then satisfies detj 1 2 k 1 2 o 2 3 o k 1 this square root dependence is also reflected in the refractive index n and leads to o k 1 power loss due to interface reflections that overwhelm the o k 1 2 corrections to scattered power due to the scalarization of nearly isotropic transformations as explained in sec 2 5 hence it becomes necessary to explicitly constrain j i in addition to x x acknowledgment this work was supported in part by the afosr muri for complex and robust on chip nanophotonics dr gernot pomrenke grant number fa 9550 09 1 0704 1 introduction 2 mathematical preliminaries 2 1 transformation optics 2 2 transformations to isotropic dielectric materials 2 3 conformal maps and uniqueness 2 4 quasiconformal maps and measures of anisotropy 2 5 scalarization errors for nearly isotropic materials 2 6 general optimization of anisotropy 3 multimode bend design 3 1 simple circular bends 3 2 generalized bend transformations 3 3 numerical optimization problem 3 4 spectral parameterization 4 optimization results 4 1 minimal peak anisotropy 4 2 minimizing max versus minimizing mean 4 3 tradeoff between anisotropy and radius 5 mode squeezer 6 concluding remarks